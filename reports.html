<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูุฃุนูุงู - ุงูุชูุงุฑูุฑ</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: white;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* ุชุฎุตูุต ููุทูุฉ ุงูุชูุงุฑูุฑ */
        .reports-section {
            background: white;
            min-height: calc(100vh - 80px);
            padding: 20px;
            margin-top: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .report-header-modern {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .report-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 32px;
            position: relative;
            z-index: 1;
        }

        .report-info-enhanced {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }

        .report-icon-wrapper {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .report-main-icon {
            font-size: 24px;
            color: white;
            display: block;
        }

        .report-text-info h2 {
            font-size: 22px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }

        .system-status.connected {
            color: #28a745;
        }

        .system-status.connected i {
            color: #28a745;
        }

        .system-status.disconnected {
            color: #dc3545;
        }

        .system-status.disconnected i {
            color: #dc3545;
        }

        .system-status.checking i {
            color: #ffc107;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .report-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .breadcrumb-separator {
            opacity: 0.6;
        }

        .report-actions-enhanced {
            display: flex;
            gap: 12px;
        }

        .btn-enhanced {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-family: 'Cairo', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-back {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn-generate {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.6);
        }

        .report-categories-modern {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .category-card-modern {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: right;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.25);
            border: none;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 18px;
            min-height: 100px;
        }

        .category-card-modern:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.35);
        }

        .category-icon-modern {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            transition: all 0.3s ease;
            flex-shrink: 0;
            backdrop-filter: blur(10px);
        }

        .category-card-modern:hover .category-icon-modern {
            transform: scale(1.1);
        }

        .category-content-modern {
            flex: 1;
        }

        .category-content-modern h3 {
            font-size: 19px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .category-content-modern p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 14px;
            line-height: 1.5;
            font-weight: 400;
            margin: 0;
        }

        #selected-report {
            display: none;
        }

        .report-content-modern {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* ุชูุณูู ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ */
        .available-reports-modern {
            margin-top: 20px;
        }

        .reports-grid-modern {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 22px;
            margin-top: 25px;
        }

        .report-card-modern {
            background: white;
            border-radius: 15px;
            padding: 22px;
            box-shadow: 0 5px 18px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #f5f7fa;
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .report-card-modern:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 28px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .report-card-modern:hover .report-icon-modern {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .report-icon-modern {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .report-details-modern {
            flex: 1;
        }

        .report-details-modern h5 {
            margin: 0 0 6px 0;
            font-size: 17px;
            font-weight: 700;
            color: #2c3e50;
        }

        .report-details-modern p {
            margin: 0;
            font-size: 14px;
            color: #64748b;
            line-height: 1.5;
            font-weight: 400;
        }

        .report-action-modern {
            color: #667eea;
            font-size: 18px;
            flex-shrink: 0;
        }

        /* ุชูุณููุงุช ุงูุชูุงุฑูุฑ ุงูููุตูุฉ */
        .report-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .report-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 20px;
        }

        .report-header h2 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 24px;
        }

        .report-header p {
            color: #666;
            margin: 0;
            font-size: 16px;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }

        .table-container {
            margin: 30px 0;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .empty-state {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .report-table th {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #495057;
        }

        .report-table td {
            border: 1px solid #dee2e6;
            padding: 10px 8px;
            text-align: center;
        }

        .report-table .subtotal {
            background: #e9ecef;
            font-weight: 600;
        }

        .report-table .total {
            background: #667eea;
            color: white;
            font-weight: 700;
        }

        .report-table .final-total {
            background: #28a745;
            color: white;
            font-weight: 700;
        }

        .report-table .profit {
            background: #d4edda;
            color: #155724;
            font-weight: 600;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-card h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .summary-card .amount {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .summary-card .count {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .summary-card .average {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .summary-card .warning {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
            color: #ffc107;
        }

        /* ุชุญุณูู ุชูุณูู ุงูุชูุงุฑูุฑ */
        .report-container {
            max-width: 100%;
            margin: 0;
            padding: 0;
        }

        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 0;
        }

        .report-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .report-header p {
            margin: 5px 0 0 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .report-summary .summary-card {
            background: white;
            color: #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .report-summary .summary-card h3 {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .report-summary .summary-card .summary-value {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .report-table-container {
            padding: 0;
            margin: 0;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background: white;
        }

        .report-table th {
            background: #667eea;
            color: white;
            padding: 12px 8px;
            text-align: right;
            font-size: 14px;
            font-weight: 600;
        }

        .report-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }

        .report-table tr:hover {
            background: #f8f9fa;
        }

        .status-available {
            color: #28a745;
            font-weight: bold;
        }

        .status-low {
            color: #ffc107;
            font-weight: bold;
        }

        .status-out {
            color: #dc3545;
            font-weight: bold;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1.1em;
        }

        .summary-card .amount {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 0;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .no-data-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            background: white;
        }

        .no-data-message i {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 15px;
            display: block;
        }

        .no-data-message small {
            display: block;
            margin-top: 10px;
            color: #999;
            font-size: 12px;
        }

        /* ุชุญุณูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ ููุชูุงุฑูุฑ */
        .modal-overlay .modal-content {
            max-width: 95vw;
            max-height: 90vh;
            overflow-y: auto;
            margin: 2vh auto;
        }

        .modal-overlay .report-container {
            border-radius: 0;
            box-shadow: none;
        }

        /* ุชุญุณูู ุงูุฌุฏูู ููุดุงุดุงุช ุงูุตุบูุฑุฉ */
        @media (max-width: 768px) {
            .report-summary {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 10px;
                padding: 15px;
            }

            .report-summary .summary-card {
                padding: 10px;
            }

            .report-summary .summary-card h3 {
                font-size: 11px;
            }

            .report-summary .summary-card .summary-value {
                font-size: 16px;
            }

            .report-table th,
            .report-table td {
                padding: 8px 4px;
                font-size: 12px;
            }
        }

        /* ุชุญุณูู ุฃููุงู ุงูุญุงูุฉ */
        .status-paid {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-overdue {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .report-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .btn-print, .btn-excel, .btn-pdf {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-print {
            background: #6c757d;
            color: white;
        }

        .btn-excel {
            background: #28a745;
            color: white;
        }

        .btn-pdf {
            background: #dc3545;
            color: white;
        }

        .btn-print:hover, .btn-excel:hover, .btn-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* ุญุงูุงุช ุงูุฃุตูุงู ูุงูุนููุงุก */
        .status-paid { background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status-pending { background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status-good { background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status-warning { background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status-critical { background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status-low { background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 12px; }

        /* ุนูุงุตุฑ ุงูุชุญูู ูู ุงูุชูุงุฑูุฑ */
        .report-controls-modern {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-apply-filters {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-family: 'Cairo', sans-serif;
        }

        .btn-apply-filters:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }



        /* ========== ุดุฑูุท ุงูุชููู ุงูุฑุฆูุณู ุงูููุญุฏ ========== */
        .main-header {
            background: linear-gradient(to left, #0078ff, #00c3ff);
            color: white;
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
            height: 70px;
        }

        .main-header .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            height: 100%;
        }

        .main-header .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .main-header .logo i {
            font-size: 28px;
            color: #f39c12;
        }

        .main-header .logo h1 {
            font-size: 24px;
            margin: 0;
            font-weight: 600;
            color: white;
        }

        .main-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 0;
        }

        .main-nav li {
            margin: 0;
        }

        .main-nav a {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            height: 50px;
            box-sizing: border-box;
        }

        .main-nav a:hover {
            background: rgba(255,255,255,0.1);
            border-bottom-color: #f39c12;
            transform: translateY(-1px);
        }

        .main-nav a.active {
            background: rgba(255,255,255,0.15);
            border-bottom-color: #f39c12;
            font-weight: 600;
        }

        .main-nav a i {
            font-size: 16px;
            width: 18px;
            text-align: center;
        }

        /* ุงุณุชุฌุงุจุฉ ููุดุงุดุงุช ุงูุตุบูุฑุฉ */
        @media (max-width: 768px) {
            .main-header .container {
                flex-direction: column;
                height: auto;
                padding: 10px 20px;
            }

            .main-header .logo {
                margin-bottom: 10px;
            }

            .main-nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }

            .main-nav a {
                padding: 12px 15px;
                font-size: 13px;
                height: auto;
            }

            .main-header .logo h1 {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .main-nav ul {
                flex-direction: column;
                width: 100%;
            }

            .main-nav a {
                justify-content: center;
                padding: 15px;
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
        }

        /* ุฃููุงุท ุญุงูุฉ ุงููุฎุฒูู */
        .status-available {
            background-color: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-low {
            background-color: #fff3e0;
            color: #f57c00;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-out {
            background-color: #ffebee;
            color: #d32f2f;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .total-row {
            border-top: 2px solid #dee2e6;
            background: #f8f9fa !important;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }

        .badge.secondary {
            background-color: #f5f5f5;
            color: #616161;
        }

        .positive {
            color: #2e7d32;
            font-weight: 600;
        }

        /* ุฅุตูุงุญ ุฃููุงู ุงูุชูุงุฑูุฑ */
        .report-container {
            background: white;
            color: #333;
        }

        .report-header h2 {
            color: #333 !important;
            font-weight: 600;
        }

        .report-header p {
            color: #666 !important;
        }

        .report-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
        }

        .report-table td {
            color: #333 !important;
        }

        .summary-card h3,
        .summary-card h4 {
            color: #333 !important;
        }

        .summary-card p {
            color: #666 !important;
        }

        /* ุชุฃููุฏ ุฃููุงู ุงููุตูุต ูู ุงูุชูุงุฑูุฑ */
        #report-content h1,
        #report-content h2,
        #report-content h3,
        #report-content h4 {
            color: #333 !important;
        }

        #report-content p,
        #report-content span,
        #report-content div {
            color: #333 !important;
        }

        /* ุฃููุงู ุฎุงุตุฉ ููููู ุงููุงููุฉ */
        .amount {
            color: #2e7d32 !important;
            font-weight: bold;
        }

        .count {
            color: #1976d2 !important;
            font-weight: bold;
        }

        .average {
            color: #f57c00 !important;
            font-weight: bold;
        }

        /* ุฃููุงู ุงูุฑุจุญ ูุงูุฎุณุงุฑุฉ */
        .profit {
            color: #2e7d32 !important;
            font-weight: bold;
        }

        .loss {
            color: #d32f2f !important;
            font-weight: bold;
        }

        .cost {
            color: #ff6f00 !important;
            font-weight: bold;
        }

        .margin {
            color: #1976d2 !important;
            font-weight: bold;
        }

        .negative {
            color: #d32f2f !important;
            font-weight: 600;
        }

        /* ุฃููุงู ูุงูุด ุงูุฑุจุญ */
        .profit-high {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .profit-medium {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .profit-low {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .profit-loss {
            background-color: #ffebee;
            color: #d32f2f;
        }

        /* ุฃููุงุท ุงูุทุจุงุนุฉ ูุชูุฑูุฑ ุฅุบูุงู ุงูููู */
        @media print {
            .report-container {
                max-width: none !important;
                margin: 0 !important;
                padding: 10px !important;
                box-shadow: none !important;
                page-break-inside: avoid;
            }

            .report-header {
                padding: 15px !important;
                margin-bottom: 15px !important;
                page-break-inside: avoid;
            }

            .report-table {
                font-size: 0.75em !important;
                page-break-inside: auto;
            }

            .report-table thead {
                display: table-header-group;
            }

            .report-table tr {
                page-break-inside: avoid;
            }

            .total-row {
                page-break-inside: avoid;
            }

            /* ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ุนูุฏ ุงูุทุจุงุนุฉ */
            button {
                display: none !important;
            }

            /* ุถุบุท ุงููุณุงุญุงุช ููุทุจุงุนุฉ */
            h3 {
                margin-bottom: 8px !important;
                font-size: 1em !important;
            }

            .summary-cards > div {
                padding: 8px !important;
            }
        }
    </style>
</head>
<body>
    <!-- ุดุฑูุท ุงูุชููู ุงูุนููู -->
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>ูุธุงู ุฅุฏุงุฑุฉ ุงูุฃุนูุงู</h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</a></li>
                    <li><a href="sales.html"><i class="fas fa-shopping-cart"></i> ุงููุจูุนุงุช</a></li>
                    <li><a href="purchases.html"><i class="fas fa-truck"></i> ุงููุดุชุฑูุงุช</a></li>
                    <li><a href="customers.html"><i class="fas fa-users"></i> ุงูุนููุงุก</a></li>
                    <li><a href="suppliers.html"><i class="fas fa-user-tie"></i> ุงูููุฑุฏูู</a></li>
                    <li><a href="products.html"><i class="fas fa-boxes"></i> ุงููุฎุฒูู</a></li>
                    <li><a href="reports.html" class="active"><i class="fas fa-chart-bar"></i> ุงูุชูุงุฑูุฑ</a></li>
                    <li><a href="accounting.html"><i class="fas fa-calculator"></i> ุงูุญุณุงุจุงุช</a></li>
                    <li><a href="settings.html"><i class="fas fa-cog"></i> ุงูุฅุนุฏุงุฏุงุช</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ูุณู ุงูุชูุงุฑูุฑ -->
    <div class="reports-section">
        <div class="container">
        <!-- ุฑุฃุณ ุงูุชูุฑูุฑ ุงููุฏูุฌ -->
        <div class="report-header-modern" id="selected-report" style="padding: 15px 20px; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="background: #667eea; color: white; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-chart-line" style="font-size: 1.2em;"></i>
                    </div>
                    <div>
                        <h2 id="report-title" style="margin: 0; font-size: 1.3em; color: white;">ุชูุฑูุฑ ููุตู</h2>
                        <div style="font-size: 0.85em; color: rgba(255,255,255,0.8); margin-top: 2px;">
                            <i class="fas fa-home"></i> ุงูุชูุงุฑูุฑ > <span id="breadcrumb-category">ุงููุงููุฉ</span>
                        </div>
                    </div>
                </div>
                <button class="btn-enhanced btn-back" onclick="goBack()" style="padding: 8px 15px; font-size: 0.9em;">
                    <i class="fas fa-arrow-right"></i>
                    <span>ุงูุนูุฏุฉ</span>
                </button>
            </div>

            <!-- ุนูุงุตุฑ ุงูุชุญูู ุงููุญุณูุฉ -->
            <div class="report-controls-modern" id="report-controls" style="display: none; background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <!-- ููุงุชุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ -->
                <div id="monthly-controls" style="display: none;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <label style="font-size: 0.9em; color: #495057; margin-bottom: 8px; display: block; font-weight: 600;">
                                <i class="fas fa-calendar" style="margin-left: 8px; color: #667eea;"></i>
                                ุงูุณูุฉ
                            </label>
                            <select id="report-year" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 0.95em; background: white; transition: border-color 0.3s;" onchange="updateMonthOptions()">
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <label style="font-size: 0.9em; color: #495057; margin-bottom: 8px; display: block; font-weight: 600;">
                                <i class="fas fa-calendar-day" style="margin-left: 8px; color: #28a745;"></i>
                                ุงูุดูุฑ
                            </label>
                            <select id="report-month" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 0.95em; background: white; transition: border-color 0.3s;">
                                <option value="all">ุฌููุน ุงูุฃุดูุฑ</option>
                                <option value="1">ููุงูุฑ</option>
                                <option value="2">ูุจุฑุงูุฑ</option>
                                <option value="3">ูุงุฑุณ</option>
                                <option value="4">ุฃุจุฑูู</option>
                                <option value="5">ูุงูู</option>
                                <option value="6">ููููู</option>
                                <option value="7">ููููู</option>
                                <option value="8">ุฃุบุณุทุณ</option>
                                <option value="9">ุณุจุชูุจุฑ</option>
                                <option value="10">ุฃูุชูุจุฑ</option>
                                <option value="11">ููููุจุฑ</option>
                                <option value="12">ุฏูุณูุจุฑ</option>
                            </select>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <label style="font-size: 0.9em; color: #495057; margin-bottom: 8px; display: block; font-weight: 600;">
                                <i class="fas fa-chart-bar" style="margin-left: 8px; color: #ffc107;"></i>
                                ููุน ุงูุนุฑุถ
                            </label>
                            <select id="report-view-type" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 0.95em; background: white; transition: border-color 0.3s;">
                                <option value="summary">๐ ููุฎุต ุดูุฑู</option>
                                <option value="detailed">๐ ุชูุงุตูู ุจุงูููุงุชูุฑ</option>
                                <option value="comparison">๐ ููุงุฑูุฉ ุจุงูุณูุฉ ุงูุณุงุจูุฉ</option>
                            </select>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <button onclick="applyMonthlyReportFilters()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 0.95em; width: 100%; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <i class="fas fa-sync-alt" style="margin-left: 8px;"></i>
                                ุชุญุฏูุซ ุงูุชูุฑูุฑ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ููุงุชุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ -->
                <div id="sales-monthly-controls" style="display: none;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <label style="font-size: 0.9em; color: #495057; margin-bottom: 8px; display: block; font-weight: 600;">
                                <i class="fas fa-calendar" style="margin-left: 8px; color: #667eea;"></i>
                                ุงูุณูุฉ
                            </label>
                            <select id="sales-report-year" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 0.95em; background: white; transition: border-color 0.3s;">
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <label style="font-size: 0.9em; color: #495057; margin-bottom: 8px; display: block; font-weight: 600;">
                                <i class="fas fa-calendar-day" style="margin-left: 8px; color: #28a745;"></i>
                                ุงูุดูุฑ
                            </label>
                            <select id="sales-report-month" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 0.95em; background: white; transition: border-color 0.3s;">
                                <option value="all">ุฌููุน ุงูุฃุดูุฑ</option>
                                <option value="1">ููุงูุฑ</option>
                                <option value="2">ูุจุฑุงูุฑ</option>
                                <option value="3">ูุงุฑุณ</option>
                                <option value="4">ุฃุจุฑูู</option>
                                <option value="5">ูุงูู</option>
                                <option value="6">ููููู</option>
                                <option value="7">ููููู</option>
                                <option value="8">ุฃุบุณุทุณ</option>
                                <option value="9">ุณุจุชูุจุฑ</option>
                                <option value="10">ุฃูุชูุจุฑ</option>
                                <option value="11">ููููุจุฑ</option>
                                <option value="12">ุฏูุณูุจุฑ</option>
                            </select>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <label style="font-size: 0.9em; color: #495057; margin-bottom: 8px; display: block; font-weight: 600;">
                                <i class="fas fa-chart-bar" style="margin-left: 8px; color: #ffc107;"></i>
                                ููุน ุงูุนุฑุถ
                            </label>
                            <select id="sales-report-view-type" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 0.95em; background: white; transition: border-color 0.3s;">
                                <option value="summary">๐ ููุฎุต ุดูุฑู</option>
                                <option value="detailed">๐ ุชูุงุตูู ุจุงูููุงุชูุฑ</option>
                                <option value="comparison">๐ ููุงุฑูุฉ ุจุงูุณูุฉ ุงูุณุงุจูุฉ</option>
                            </select>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <button onclick="applySalesMonthlyReportFilters()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 0.95em; width: 100%; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <i class="fas fa-sync-alt" style="margin-left: 8px;"></i>
                                ุชุญุฏูุซ ุงูุชูุฑูุฑ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ููุงุชุฑ ุนุงูุฉ ููุชูุงุฑูุฑ ุงูุฃุฎุฑู -->
                <div id="general-controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                    <div>
                        <label for="report-date-from" style="font-size: 0.85em; color: #666; margin-bottom: 5px; display: block;">ูู ุชุงุฑูุฎ:</label>
                        <input type="date" id="report-date-from" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9em;">
                    </div>
                    <div>
                        <label for="report-date-to" style="font-size: 0.85em; color: #666; margin-bottom: 5px; display: block;">ุฅูู ุชุงุฑูุฎ:</label>
                        <input type="date" id="report-date-to" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9em;">
                    </div>
                    <div>
                        <label for="report-account" style="font-size: 0.85em; color: #666; margin-bottom: 5px; display: block;">ุงูุญุณุงุจ:</label>
                        <select id="report-account" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9em;">
                            <!-- ุณูุชู ููุก ุงูุฎูุงุฑุงุช ุฏููุงููููุงู -->
                        </select>
                    </div>
                    <div>
                        <button onclick="applyReportFilters()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 0.9em; width: 100%;">
                            <i class="fas fa-filter"></i> ุชุทุจูู
                        </button>
                    </div>
                </div>
            </div>

            <!-- ูุญุชูู ุงูุชูุฑูุฑ ุงููุญุณู -->
            <div class="report-content-modern" id="report-content">
                <!-- ุณูุชู ููุก ูุฐุง ุงููุณู ุฏููุงููููุงู ุญุณุจ ุงููุฆุฉ ุงููุฎุชุงุฑุฉ -->
            </div>
        </div>

        <!-- ุงุฎุชูุงุฑ ููุน ุงูุชูุฑูุฑ -->
        <div class="report-categories-modern">
            <div class="category-card-modern" data-category="financial" onclick="selectCategory('financial')">
                <div class="category-icon-modern">
                    <i class="fas fa-calculator"></i>
                </div>
                <div class="category-content-modern">
                    <h3>ุงูุชูุงุฑูุฑ ุงููุงููุฉ</h3>
                    <p>ููุงุฆู ูุงููุฉ ูุชูุงุฑูุฑ ูุญุงุณุจูุฉ ุดุงููุฉ</p>
                </div>
            </div>

            <div class="category-card-modern" data-category="sales" onclick="selectCategory('sales')">
                <div class="category-icon-modern">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="category-content-modern">
                    <h3>ุชูุงุฑูุฑ ุงููุจูุนุงุช</h3>
                    <p>ุชุญููู ุงููุจูุนุงุช ูุงูุฃุฏุงุก ุงูุชุฌุงุฑู</p>
                </div>
            </div>

            <div class="category-card-modern" data-category="purchases" onclick="selectCategory('purchases')">
                <div class="category-icon-modern">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="category-content-modern">
                    <h3>ุชูุงุฑูุฑ ุงููุดุชุฑูุงุช</h3>
                    <p>ุชุญููู ุงููุดุชุฑูุงุช ูุฃุฏุงุก ุงูููุฑุฏูู</p>
                </div>
            </div>

            <div class="category-card-modern" data-category="inventory" onclick="selectCategory('inventory')">
                <div class="category-icon-modern">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="category-content-modern">
                    <h3>ุชูุงุฑูุฑ ุงููุฎุฒูู</h3>
                    <p>ุญุฑูุฉ ุงููุฎุฒูู ูุงูุฌุฑุฏ ูุงูุชูููู</p>
                </div>
            </div>

            <div class="category-card-modern" data-category="customers" onclick="selectCategory('customers')">
                <div class="category-icon-modern">
                    <i class="fas fa-users"></i>
                </div>
                <div class="category-content-modern">
                    <h3>ุชูุงุฑูุฑ ุงูุนููุงุก</h3>
                    <p>ุชุญููู ุงูุนููุงุก ูุงููุฏููููุงุช</p>
                </div>
            </div>

            <div class="category-card-modern" data-category="suppliers" onclick="selectCategory('suppliers')">
                <div class="category-icon-modern">
                    <i class="fas fa-handshake"></i>
                </div>
                <div class="category-content-modern">
                    <h3>ุชูุงุฑูุฑ ุงูููุฑุฏูู</h3>
                    <p>ุชุญููู ุงูููุฑุฏูู ูุงููุฏููุนุงุช</p>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // ูุชุบูุฑุงุช ุนุงูุฉ ูุญุณูุฉ
        let currentCategory = null;
        let currentReportType = null;
        let navigationHistory = [];
        let currentView = 'categories'; // categories, reports, report-detail
        let savedFilters = {}; // ูุญูุธ ุงููุฑุดุญุงุช ุงููุฎุชุงุฑุฉ

        // ูุธููุฉ ุนุฑุถ ุงูุชูุฑูุฑ ูุจุงุดุฑุฉ
        function generateReportDirectly(reportType) {
            console.log('๐ ุนุฑุถ ุงูุชูุฑูุฑ ูุจุงุดุฑุฉ:', reportType);

            try {
                let reportData;

                if (reportType === 'end-of-day') {
                    // ุชุนููู ููุน ุงูุชูุฑูุฑ
                    currentReportType = 'end-of-day';

                    // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุชูุฑูุฑ
                    reportData = getDetailedReportData('end-of-day');

                    if (!reportData || !reportData.html) {
                        throw new Error('ูุดู ูู ุฅูุดุงุก ุชูุฑูุฑ ุฅุบูุงู ุงูููู');
                    }

                    // ุนุฑุถ ุงูุชูุฑูุฑ
                    const reportContent = document.getElementById('report-content');
                    if (reportContent) {
                        reportContent.innerHTML = reportData.html;
                        showSuccessMessage('ุชู ุนุฑุถ ุชูุฑูุฑ ุฅุบูุงู ุงูููู ุจูุฌุงุญ!');
                    } else {
                        throw new Error('ุนูุตุฑ ุนุฑุถ ุงูุชูุฑูุฑ ุบูุฑ ููุฌูุฏ');
                    }
                } else {
                    throw new Error('ููุน ุงูุชูุฑูุฑ ุบูุฑ ูุฏุนูู: ' + reportType);
                }

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุนุฑุถ ุงูุชูุฑูุฑ:', error);
                showErrorMessage('ุญุฏุซ ุฎุทุฃ ูู ุนุฑุถ ุงูุชูุฑูุฑ: ' + error.message);
            }
        }

        // ูุธููุฉ ูุญุต ุญุงูุฉ ุงููุธุงู ุงููุฑูุฒู
        function checkSystemStatus() {
            console.log('๐ ูุญุต ุญุงูุฉ ุงููุธุงู ุงููุฑูุฒู...');

            let statusMessage = '';
            let statusColor = '';

            try {
                // ุงูุชุญูู ูู ูุฌูุฏ ุงููุธุงู ุงููุฑูุฒู
                if (!window.dataManager) {
                    console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุฑูุฒู...');
                    window.dataManager = new DataManager();
                }

                // ุฌูุน ุฅุญุตุงุฆูุงุช ุงููุธุงู
                const products = window.dataManager.getProducts();
                const customers = window.dataManager.getCustomers();
                const sales = window.dataManager.getSales();
                const suppliers = window.dataManager.getSuppliers ? window.dataManager.getSuppliers() : [];

                statusMessage = `
                    โ ุงููุธุงู ุงููุฑูุฒู ูุนูู ุจุดูู ุทุจูุนู

                    ๐ ุฅุญุตุงุฆูุงุช ุงููุธุงู:
                    โข ุงูููุชุฌุงุช: ${products.length}
                    โข ุงูุนููุงุก: ${customers.length}
                    โข ุงููุจูุนุงุช: ${sales.length}
                    โข ุงูููุฑุฏูู: ${suppliers.length}

                    ๐ ุฌููุน ุงูุชูุงุฑูุฑ ูุฑุชุจุทุฉ ุจุงููุธุงู ุงููุฑูุฒู
                    ๐ ุงูุจูุงูุงุช ูุญุฏุซุฉ ูู ุงูููุช ุงููุนูู
                `;
                statusColor = '#28a745';

                console.log('โ ุงููุธุงู ุงููุฑูุฒู ูุนูู ุจุดูู ุทุจูุนู:', {
                    products: products.length,
                    customers: customers.length,
                    sales: sales.length,
                    suppliers: suppliers.length
                });

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุงููุธุงู ุงููุฑูุฒู:', error);
                statusMessage = `
                    โ ุฎุทุฃ ูู ุงููุธุงู ุงููุฑูุฒู

                    ุชูุงุตูู ุงูุฎุทุฃ: ${error.message}

                    ๐ง ุงูุญููู ุงูููุชุฑุญุฉ:
                    โข ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
                    โข ุงูุชุญูู ูู ููู data-manager.js
                    โข ูุฑุงุฌุนุฉ ูุญุฏุฉ ุงูุชุญูู ููุฃุฎุทุงุก
                `;
                statusColor = '#dc3545';
            }

            // ุนุฑุถ ุงููุชูุฌุฉ
            const reportContent = document.getElementById('report-content');
            if (reportContent) {
                reportContent.innerHTML = `
                    <div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center;">
                        <div style="font-size: 4em; margin-bottom: 20px; color: ${statusColor};">
                            <i class="fas fa-${statusColor === '#28a745' ? 'check-circle' : 'exclamation-triangle'}"></i>
                        </div>
                        <h2 style="color: ${statusColor}; margin-bottom: 20px;">ุญุงูุฉ ุงููุธุงู ุงููุฑูุฒู</h2>
                        <pre style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: right; white-space: pre-wrap; font-family: 'Arial', sans-serif;">${statusMessage}</pre>
                        <div style="margin-top: 30px;">
                            <button class="btn" onclick="location.reload()" style="background: #667eea; color: white; margin: 5px;">
                                <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
                            </button>

                        </div>
                    </div>
                `;
            }

            showSuccessMessage('ุชู ูุญุต ุญุงูุฉ ุงููุธุงู ุงููุฑูุฒู');
        }



        // ูุธููุฉ ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงูุชูุงุฑูุฑ
        function testReportGeneration() {
            console.log('๐งช ุจุฏุก ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงูุชูุงุฑูุฑ...');

            // ุงูุชุญูู ูู ูุฌูุฏ ุงููุธุงุฆู ุงููุทููุจุฉ
            if (typeof generateSalesReport === 'undefined') {
                console.error('โ ูุธููุฉ generateSalesReport ุบูุฑ ูุนุฑููุฉ');
                showErrorMessage('ูุธููุฉ generateSalesReport ุบูุฑ ูุนุฑููุฉ. ุชุฃูุฏ ูู ุชุญููู ููู js/reports.js');
                return;
            }

            // ุงุฎุชุจุงุฑ ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ
            currentReportType = 'daily';
            console.log('๐ ุงุฎุชุจุงุฑ ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ...');

            try {
                // ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ุฃููุงู
                console.log('๐ง ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ...');
                const salesData = generateSalesReport('daily');
                console.log('โ ูุธููุฉ generateSalesReport ุชุนูู:', salesData);

                const reportData = getDetailedReportData('daily');
                console.log('โ ูุฌุญ ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ:', reportData);

                const reportContent = document.getElementById('report-content');
                if (reportContent) {
                    reportContent.innerHTML = reportData.html;
                    showSuccessMessage('ุชู ุงุฎุชุจุงุฑ ุงูุชูุฑูุฑ ุจูุฌุงุญ! ุฌููุน ุงููุธุงุฆู ุชุนูู ุจุดูู ุตุญูุญ.');
                } else {
                    console.error('โ ุนูุตุฑ report-content ุบูุฑ ููุฌูุฏ');
                    showErrorMessage('ุนูุตุฑ ุนุฑุถ ุงูุชูุฑูุฑ ุบูุฑ ููุฌูุฏ');
                }
            } catch (error) {
                console.error('โ ูุดู ุงุฎุชุจุงุฑ ุงูุชูุฑูุฑ:', error);
                showErrorMessage('ูุดู ูู ุงุฎุชุจุงุฑ ุงูุชูุฑูุฑ: ' + error.message);
            }
        }

        // ุฅุถุงูุฉ event listener ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('โ ุชู ุชุญููู ุตูุญุฉ ุงูุชูุงุฑูุฑ ุจูุฌุงุญ');
            console.log('๐ง ุชู ุฅุตูุงุญ ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ - ุฌุงูุฒ ููุงุณุชุฎุฏุงู!');
            console.log('๐ฆ ุชู ุฅุถุงูุฉ ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ - ูุฑุชุจุท ุจุงููุธุงู ุงููุฑูุฒู!');
            console.log('๐๏ธ ุชู ุฅุตูุงุญ ุฌููุน ุฃุฎุทุงุก includes - ุงูููุงุชุฑ ุชุนูู ุจุดูู ุตุญูุญ!');
            console.log('๐ ุชู ุฅุถุงูุฉ ุงูุจุญุซ ุงููุชูุฏู ูู localStorage ูููุดุชุฑูุงุช!');

            // ุชุดุฎูุต ุณุฑูุน ูููุดุชุฑูุงุช
            console.log('๐ ุชุดุฎูุต ุณุฑูุน ูููุดุชุฑูุงุช:');
            const storageKeys = Object.keys(localStorage);
            console.log('๐ ุฌููุน ููุงุชูุญ localStorage:', storageKeys);

            const purchaseKeys = storageKeys.filter(key =>
                key.toLowerCase().includes('purchase') ||
                key.toLowerCase().includes('ุดุฑุงุก') ||
                key === 'monjizPurchases'
            );
            console.log('๐ ููุงุชูุญ ุงููุดุชุฑูุงุช:', purchaseKeys);

            purchaseKeys.forEach(key => {
                try {
                    const data = JSON.parse(localStorage.getItem(key) || '[]');
                    console.log(`๐ฆ ${key}: ${Array.isArray(data) ? data.length : 'ููุณ ูุตูููุฉ'} ุนูุตุฑ`);
                    if (Array.isArray(data) && data.length > 0) {
                        console.log(`๐ ุนููุฉ ูู ${key}:`, data[0]);
                    }
                } catch (e) {
                    console.log(`โ๏ธ ุฎุทุฃ ูู ูุฑุงุกุฉ ${key}:`, e.message);
                }
            });

            // ุชููุฆุฉ ุงูุญุงูุฉ ุงูุฃูููุฉ
            initializeReportsPage();

            // ุฅุนุฏุงุฏ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู
            setupAutoRefresh();

            // ูุญุต ุญุงูุฉ ุงููุธุงู ุงููุฑูุฒู
            checkSystemStatus();

            // ุฅุตูุงุญ ุจูุงูุงุช ุงูููุชุฌุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
            if (typeof fixProductsData === 'function') {
                setTimeout(() => {
                    fixProductsData();
                }, 1000);
            }

            // ูุณุชูุน ูุชุญุฏูุซุงุช ุงููุฎุฒูู
            window.addEventListener('inventoryUpdated', function(event) {
                console.log('๐ฆ ุชู ุงุณุชูุงู ุฅุดุนุงุฑ ุชุญุฏูุซ ุงููุฎุฒูู ูู ุงูุชูุงุฑูุฑ');

                // ุฅุนุงุฏุฉ ุชุญููู ุชูุฑูุฑ ุงููุฎุฒูู ุฅุฐุง ูุงู ููุชูุญุงู
                if (currentReportType && currentReportType.includes('inventory')) {
                    console.log('๐ ุฅุนุงุฏุฉ ุชุญููู ุชูุฑูุฑ ุงููุฎุฒูู...');
                    setTimeout(() => {
                        generateReport(currentReportType);
                    }, 500);
                }
            });

            // ุฅุถุงูุฉ event delegation ููุชูุงุฑูุฑ
            document.addEventListener('click', function(e) {
                const reportCard = e.target.closest('.report-card-modern');
                if (reportCard) {
                    const reportType = reportCard.getAttribute('data-report-type');
                    if (reportType) {
                        console.log('๐ ุชู ุงูููุฑ ุนูู ุงูุชูุฑูุฑ:', reportType);

                        // ุฑุณุงูุฉ ุฎุงุตุฉ ูุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ
                        if (reportType === 'by-supplier') {
                            console.log('๐ ุชู ุฅุตูุงุญ ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ - ุฌุงุฑู ุงูุชุญููู...');
                        }

                        currentReportType = reportType;
                        generateReportDirectly(reportType);
                    }
                }
            });

            // ุฅุถุงูุฉ ุฏุนู ููุชููู ุจุงูููุจูุฑุฏ
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    goBack();
                }
            });
        });

        // ุฏุงูุฉ ุชููุฆุฉ ุงูุตูุญุฉ
        function initializeReportsPage() {
            currentView = 'categories';
            navigationHistory = [];
            updateBreadcrumb();
        }

        // ุฏุงูุฉ ุงุฎุชูุงุฑ ูุฆุฉ ุงูุชูุฑูุฑ ูุญุณูุฉ
        function selectCategory(category) {
            console.log('ุชู ุงุฎุชูุงุฑ ูุฆุฉ:', category);

            // ุญูุธ ุงูุญุงูุฉ ุงูุณุงุจูุฉ ูู ุงูุชุงุฑูุฎ
            if (currentView === 'categories') {
                navigationHistory.push({
                    view: 'categories',
                    category: null,
                    reportType: null
                });
            }

            // ุชุญุฏูุซ ุงูุญุงูุฉ ุงูุญุงููุฉ
            currentCategory = category;
            currentReportType = null;
            currentView = 'reports';

            // ุฅุฎูุงุก ูุณู ุงููุฆุงุช ูุฅุธูุงุฑ ูุณู ุงูุชูุฑูุฑ ุงููุญุฏุฏ ูุน ุชุฃุซูุฑ ุงูุชูุงู
            const categoriesSection = document.querySelector('.report-categories-modern');
            const selectedSection = document.getElementById('selected-report');

            categoriesSection.style.opacity = '0';
            setTimeout(() => {
                categoriesSection.style.display = 'none';
                selectedSection.style.display = 'block';
                selectedSection.style.opacity = '0';
                setTimeout(() => {
                    selectedSection.style.opacity = '1';
                }, 50);
            }, 200);

            // ุชุญุฏูุซ ุนููุงู ุงูุชูุฑูุฑ
            const titles = {
                'financial': 'ุงูุชูุงุฑูุฑ ุงููุงููุฉ',
                'sales': 'ุชูุงุฑูุฑ ุงููุจูุนุงุช',
                'purchases': 'ุชูุงุฑูุฑ ุงููุดุชุฑูุงุช',
                'inventory': 'ุชูุงุฑูุฑ ุงููุฎุฒูู',
                'customers': 'ุชูุงุฑูุฑ ุงูุนููุงุก',
                'suppliers': 'ุชูุงุฑูุฑ ุงูููุฑุฏูู'
            };

            const categoryNames = {
                'financial': 'ุงููุงููุฉ',
                'sales': 'ุงููุจูุนุงุช',
                'purchases': 'ุงููุดุชุฑูุงุช',
                'inventory': 'ุงููุฎุฒูู',
                'customers': 'ุงูุนููุงุก',
                'suppliers': 'ุงูููุฑุฏูู'
            };

            document.getElementById('report-title').textContent = titles[category] || 'ุชูุฑูุฑ ููุตู';
            document.getElementById('breadcrumb-category').textContent = categoryNames[category] || 'ุชูุฑูุฑ ููุตู';

            // ุชุญุฏูุซ breadcrumb
            updateBreadcrumb();

            // ุนุฑุถ ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ ูููุฆุฉ ุงููุฎุชุงุฑุฉ
            displayAvailableReports(category);
        }

        // ุฏุงูุฉ ุนุฑุถ ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ
        function displayAvailableReports(category) {
            const reportContent = document.getElementById('report-content');
            if (!reportContent) return;

            const categoryOptions = {
                'financial': [
                    { value: 'end-of-day', text: 'ุฅุบูุงู ุงูููู', icon: 'fas fa-moon', description: 'ุชูุฑูุฑ ุดุงูู ูุฅุบูุงู ุงูููู ูุน ุงููุจูุนุงุช ูุงูุญุฑูุฉ ุงููุญุงุณุจูุฉ' },
                    { value: 'balance-sheet', text: 'ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู', icon: 'fas fa-balance-scale', description: 'ุงูููุฒุงููุฉ ุงูุนููููุฉ ูุงูุฃุตูู ูุงูุฎุตูู' },
                    { value: 'profit-loss', text: 'ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ', icon: 'fas fa-chart-line', description: 'ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช ูุตุงูู ุงูุฑุจุญ' },
                    { value: 'cash-flow', text: 'ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ', icon: 'fas fa-money-bill-wave', description: 'ุงูุชุฏููุงุช ุงูููุฏูุฉ ุงูุฏุงุฎูุฉ ูุงูุฎุงุฑุฌุฉ' },
                    { value: 'trial-balance', text: 'ููุฒุงู ุงููุฑุงุฌุนุฉ', icon: 'fas fa-calculator', description: 'ุฃุฑุตุฏุฉ ุฌููุน ุงูุญุณุงุจุงุช' },
                    { value: 'account-statement', text: 'ูุดู ุงูุญุณุงุจ', icon: 'fas fa-file-invoice', description: 'ูุดู ุญุณุงุจ ูุญุงุณุจู ููุตู ูุน ุงูุญุฑูุงุช ูุงูุฃุฑุตุฏุฉ' }
                ],
                'sales': [
                    { value: 'daily', text: 'ุงููุจูุนุงุช ุงูููููุฉ', icon: 'fas fa-calendar-day', description: 'ุชูุฑูุฑ ูุจูุนุงุช ุงูููู' },
                    { value: 'monthly', text: 'ุงููุจูุนุงุช ุงูุดูุฑูุฉ', icon: 'fas fa-calendar-alt', description: 'ุชูุฑูุฑ ูุจูุนุงุช ุงูุดูุฑ' },
                    { value: 'by-customer', text: 'ุงููุจูุนุงุช ุญุณุจ ุงูุนููู', icon: 'fas fa-user-tie', description: 'ุชุญููู ูุจูุนุงุช ูู ุนููู' },
                    { value: 'by-product', text: 'ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ', icon: 'fas fa-box', description: 'ุชุญููู ูุจูุนุงุช ูู ููุชุฌ' }
                ],
                'purchases': [
                    { value: 'purchases-daily', text: 'ุงููุดุชุฑูุงุช ุงูููููุฉ', icon: 'fas fa-calendar-day', description: 'ุชูุฑูุฑ ูุดุชุฑูุงุช ุงูููู' },
                    { value: 'purchases-monthly', text: 'ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ', icon: 'fas fa-calendar-alt', description: 'ุชูุฑูุฑ ูุดุชุฑูุงุช ุงูุดูุฑ' },
                    { value: 'by-supplier', text: 'ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ', icon: 'fas fa-handshake', description: 'ุชุญููู ูุดุชุฑูุงุช ูู ููุฑุฏ' },
                    { value: 'purchases-by-product', text: 'ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ', icon: 'fas fa-box', description: 'ุชุญููู ูุดุชุฑูุงุช ูู ููุชุฌ' }
                ],
                'inventory': [
                    { value: 'current-stock', text: 'ุงููุฎุฒูู ุงูุญุงูู', icon: 'fas fa-warehouse', description: 'ูููุงุช ูููู ุงููุฎุฒูู ุงูุญุงูู' },
                    { value: 'stock-movement', text: 'ุญุฑูุฉ ุงููุฎุฒูู', icon: 'fas fa-exchange-alt', description: 'ุญุฑูุงุช ุงูุฏุฎูู ูุงูุฎุฑูุฌ' },
                    { value: 'product-operations', text: 'ุนูููุงุช ุตูู', icon: 'fas fa-chart-line', description: 'ุญุฑูุงุช ุดุฑุงุก ูุจูุน ุตูู ุฎูุงู ูุชุฑุฉ ุฒูููุฉ' },
                    { value: 'low-stock', text: 'ุชูุฑูุฑ ุงูููุงูุต', icon: 'fas fa-exclamation-triangle', description: 'ุงูุฃุตูุงู ุงูุชู ูุตูุช ููุญุฏ ุงูุฃุฏูู' },
                    { value: 'stock-valuation', text: 'ุชูููู ุงููุฎุฒูู', icon: 'fas fa-dollar-sign', description: 'ุชูููู ุงููุฎุฒูู ุจุงูุชูููุฉ ูุงูุณูู' }
                ],
                'customers': [
                    { value: 'customer-list', text: 'ูุงุฆูุฉ ุงูุนููุงุก', icon: 'fas fa-list', description: 'ุฌููุน ุจูุงูุงุช ุงูุนููุงุก' },
                    { value: 'customer-balances', text: 'ุฃุฑุตุฏุฉ ุงูุนููุงุก', icon: 'fas fa-credit-card', description: 'ุงููุฏููููุงุช ูุงููุฏููุนุงุช' },
                    { value: 'customer-analysis', text: 'ุชุญููู ุงูุนููุงุก', icon: 'fas fa-chart-bar', description: 'ุชุญููู ุณููู ูุฃุฏุงุก ุงูุนููุงุก' },
                    { value: 'customer-aging', text: 'ุฃุนูุงุฑ ุงูุฏููู', icon: 'fas fa-clock', description: 'ุชุญููู ุฃุนูุงุฑ ุฏููู ุงูุนููุงุก' }
                ],
                'suppliers': [
                    { value: 'supplier-list', text: 'ูุงุฆูุฉ ุงูููุฑุฏูู', icon: 'fas fa-user-tie', description: 'ุฌููุน ุจูุงูุงุช ุงูููุฑุฏูู' },
                    { value: 'supplier-balances', text: 'ุฃุฑุตุฏุฉ ุงูููุฑุฏูู', icon: 'fas fa-credit-card', description: 'ุงููุณุชุญูุงุช ูุงููุฏููุนุงุช' },
                    { value: 'supplier-analysis', text: 'ุชุญููู ุงูููุฑุฏูู', icon: 'fas fa-chart-bar', description: 'ุฃุฏุงุก ุงูููุฑุฏูู ูุงูุฌูุฏุฉ' },
                    { value: 'supplier-evaluation', text: 'ุชูููู ุงูููุฑุฏูู', icon: 'fas fa-star', description: 'ุชูููู ุฃุฏุงุก ูููุซูููุฉ ุงูููุฑุฏูู' }
                ]
            };

            const reports = categoryOptions[category] || [];

            if (reports.length === 0) {
                reportContent.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">ูุง ุชูุฌุฏ ุชูุงุฑูุฑ ูุชุงุญุฉ ููุฐู ุงููุฆุฉ</div>';
                return;
            }

            reportContent.innerHTML = `
                <div class="available-reports-modern">
                    <div class="reports-grid-modern">
                        ${reports.map(report => `
                            <div class="report-card-modern" data-report-type="${report.value}">
                                <div class="report-icon-modern">
                                    <i class="${report.icon}"></i>
                                </div>
                                <div class="report-details-modern">
                                    <h5>${report.text}</h5>
                                    <p>${report.description}</p>
                                </div>
                                <div class="report-action-modern">
                                    <i class="fas fa-arrow-left"></i>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุงูุนูุฏุฉ ุงููุญุณูุฉ
        function goBack() {
            console.log('ุงูุนูุฏุฉ ูู:', currentView);

            if (currentView === 'report-detail') {
                // ุงูุนูุฏุฉ ูู ุชูุงุตูู ุงูุชูุฑูุฑ ุฅูู ูุงุฆูุฉ ุงูุชูุงุฑูุฑ
                currentView = 'reports';
                // ูุง ูุนูุฏ ุชุนููู currentReportType ููุงุญุชูุงุธ ุจุงููุฑุดุญุงุช
                // currentReportType = null;

                // ุฅุฎูุงุก ุนูุงุตุฑ ุงูุชุญูู
                const reportControls = document.getElementById('report-controls');
                if (reportControls) {
                    reportControls.style.display = 'none';
                }

                // ุฅุฎูุงุก ุฒุฑ ุฅูุดุงุก ุงูุชูุฑูุฑ
                const generateBtn = document.getElementById('generate-report-btn');
                if (generateBtn) {
                    generateBtn.style.display = 'none';
                }

                // ุนุฑุถ ูุงุฆูุฉ ุงูุชูุงุฑูุฑ ูููุฆุฉ ุงูุญุงููุฉ
                displayAvailableReports(currentCategory);

                // ุชุญุฏูุซ ุงูุนููุงู
                const titles = {
                    'financial': 'ุงูุชูุงุฑูุฑ ุงููุงููุฉ',
                    'sales': 'ุชูุงุฑูุฑ ุงููุจูุนุงุช',
                    'purchases': 'ุชูุงุฑูุฑ ุงููุดุชุฑูุงุช',
                    'inventory': 'ุชูุงุฑูุฑ ุงููุฎุฒูู',
                    'customers': 'ุชูุงุฑูุฑ ุงูุนููุงุก',
                    'suppliers': 'ุชูุงุฑูุฑ ุงูููุฑุฏูู'
                };

                document.getElementById('report-title').textContent = titles[currentCategory] || 'ุชูุฑูุฑ ููุตู';

            } else if (currentView === 'reports') {
                // ุงูุนูุฏุฉ ูู ูุงุฆูุฉ ุงูุชูุงุฑูุฑ ุฅูู ุงููุฆุงุช ุงูุฑุฆูุณูุฉ
                currentView = 'categories';
                currentCategory = null;
                // ูุนูุฏ ุชุนููู currentReportType ููุท ุนูุฏ ุงูุนูุฏุฉ ูููุฆุงุช ุงูุฑุฆูุณูุฉ
                currentReportType = null;

                // ุฅุฎูุงุก ุนูุงุตุฑ ุงูุชุญูู
                const reportControls = document.getElementById('report-controls');
                if (reportControls) {
                    reportControls.style.display = 'none';
                }

                // ุฅุฎูุงุก ูุณู ุงูุชูุฑูุฑ ุงููุญุฏุฏ ูุฅุธูุงุฑ ุงููุฆุงุช ูุน ุชุฃุซูุฑ ุงูุชูุงู
                const categoriesSection = document.querySelector('.report-categories-modern');
                const selectedSection = document.getElementById('selected-report');

                selectedSection.style.opacity = '0';
                setTimeout(() => {
                    selectedSection.style.display = 'none';
                    categoriesSection.style.display = 'grid';
                    categoriesSection.style.opacity = '0';
                    setTimeout(() => {
                        categoriesSection.style.opacity = '1';
                    }, 50);
                }, 200);

                // ุฅุฎูุงุก ุฒุฑ ุฅูุดุงุก ุงูุชูุฑูุฑ
                const generateBtn = document.getElementById('generate-report-btn');
                if (generateBtn) {
                    generateBtn.style.display = 'none';
                }
            }

            // ุชุญุฏูุซ breadcrumb
            updateBreadcrumb();
        }

        // ูุธููุฉ ุชุญุฏูุซ ุชูุฑูุฑ ุงููุฎุฒูู
        function refreshInventoryReport() {
            console.log('๐ ุฅุนุงุฏุฉ ุชุญููู ุชูุฑูุฑ ุงููุฎุฒูู...');

            // ุงุณุชุฎุฏุงู ูุธููุฉ ุงูุฅุตูุงุญ ุงูุฌุฏูุฏุฉ
            if (typeof fixProductsData === 'function') {
                fixProductsData();
            } else {
                console.warn('โ๏ธ ูุธููุฉ fixProductsData ุบูุฑ ูุชุงุญุฉ');
            }

            // ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุชูุฑูุฑ
            if (currentReportType && currentReportType.includes('inventory')) {
                setTimeout(() => {
                    generateReport(currentReportType);
                }, 500);
            } else {
                // ุฅุฐุง ูู ููู ููุงู ุชูุฑูุฑ ููุชูุญุ ุงูุชุญ ุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู
                setTimeout(() => {
                    generateReport('inventory-current');
                }, 500);
            }
        }

        // ุฅุนุฏุงุฏ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููุชูุงุฑูุฑ
        function setupAutoRefresh() {
            console.log('๐ ุฅุนุฏุงุฏ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููุชูุงุฑูุฑ');

            // ุงูุงุณุชูุงุน ูุชุญุฏูุซุงุช ุงููุธุงู ุงููุฑูุฒู
            if (window.BroadcastChannel) {
                const channel = new BroadcastChannel('monjiz-updates');
                channel.addEventListener('message', function(event) {
                    const { type, data } = event.data;
                    console.log('๐ก ุชู ุงุณุชูุงู ุชุญุฏูุซ:', type, data);

                    // ุชุญุฏูุซ ุงูุชูุงุฑูุฑ ุนูุฏ ุชุบููุฑ ุงูุจูุงูุงุช
                    switch(type) {
                        case 'sales-updated':
                        case 'purchase-updated':
                        case 'customer-updated':
                        case 'supplier-updated':
                        case 'product-updated':
                        case 'account-updated':
                            refreshCurrentReport();
                            break;
                    }
                });
            }

            // ุงูุงุณุชูุงุน ูุชุญุฏูุซุงุช localStorage
            window.addEventListener('storage', function(e) {
                if (e.key && (
                    e.key.startsWith('monjiz') ||
                    e.key === 'chartOfAccounts'
                )) {
                    console.log('๐พ ุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ูู localStorage:', e.key);
                    refreshCurrentReport();
                }
            });

            // ุชุญุฏูุซ ุฏูุฑู ูู 30 ุซุงููุฉ
            setInterval(function() {
                if (currentReportType && window.dataManager) {
                    console.log('โฐ ุชุญุฏูุซ ุฏูุฑู ููุชูุฑูุฑ');
                    refreshCurrentReport();
                }
            }, 30000);
        }

        // ุชุญุฏูุซ ุงูุชูุฑูุฑ ุงูุญุงูู ูุน ุงูุญูุงุธ ุนูู ุงูููุงุชุฑ
        function refreshCurrentReportLegacy() {
            if (currentReportType && currentView === 'report-detail') {
                console.log('๐ ุชุญุฏูุซ ุงูุชูุฑูุฑ ุงูุญุงูู (Legacy):', currentReportType);
                // ุงุณุชุฎุฏุงู ุงูููุงุชุฑ ุงููุญููุธุฉ
                const filters = savedFilters[currentReportType] || {};
                const reportData = getDetailedReportData(currentReportType, filters);
                const reportContent = document.getElementById('report-content');
                if (reportContent && reportData) {
                    reportContent.innerHTML = reportData.html;
                }
            }
        }

        // ูุญุต ุญุงูุฉ ุงููุธุงู ุงููุฑูุฒู
        function checkSystemStatus() {
            const statusElement = document.getElementById('system-status');
            if (!statusElement) return;

            // ุชุญุฏูุซ ุญุงูุฉ ุงููุญุต
            statusElement.className = 'system-status checking';
            statusElement.innerHTML = '<i class="fas fa-circle"></i><span>ุฌุงุฑู ูุญุต ุงููุธุงู...</span>';

            setTimeout(() => {
                if (window.dataManager) {
                    // ุงููุธุงู ูุชุตู
                    statusElement.className = 'system-status connected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>ุงููุธุงู ุงููุฑูุฒู ูุชุตู</span>';

                    // ุนุฑุถ ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ
                    const stats = getSystemStats();
                    if (stats) {
                        statusElement.innerHTML = `<i class="fas fa-circle"></i><span>ูุชุตู - ${stats.customers} ุนูููุ ${stats.products} ููุชุฌุ ${stats.sales} ูุงุชูุฑุฉ</span>`;
                    }

                    console.log('โ ุงููุธุงู ุงููุฑูุฒู ูุชุตู ููุนูู ุจุดูู ุทุจูุนู');
                } else {
                    // ุงููุธุงู ุบูุฑ ูุชุตู
                    statusElement.className = 'system-status disconnected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>ุงููุธุงู ุงููุฑูุฒู ุบูุฑ ูุชุงุญ - ุงูุจูุงูุงุช ูู ุงูุชุฎุฒูู ุงููุญูู</span>';

                    console.log('โ๏ธ ุงููุธุงู ุงููุฑูุฒู ุบูุฑ ูุชุงุญุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุญููุฉ');
                }
            }, 1000);

            // ูุญุต ุฏูุฑู ูู ุฏูููุฉ
            setInterval(() => {
                checkSystemStatus();
            }, 60000);
        }

        // ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ุงููุธุงู
        function getSystemStats() {
            if (!window.dataManager) return null;

            try {
                const customers = window.dataManager.getCustomers().length;
                const products = window.dataManager.getProducts().length;
                const sales = window.dataManager.getSales().length;
                const suppliers = window.dataManager.getSuppliers().length;

                return { customers, products, sales, suppliers };
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฌูุจ ุฅุญุตุงุฆูุงุช ุงููุธุงู:', error);
                return null;
            }
        }



        // ุฏุงูุฉ ุฅูุดุงุก ุงูุชูุฑูุฑ ูุจุงุดุฑุฉ ูุญุณูุฉ
        function generateReportDirectly(reportType) {
            console.log('ุฅูุดุงุก ุงูุชูุฑูุฑ:', reportType);

            // ุชุญุฏูุซ ุงูุญุงูุฉ
            currentReportType = reportType;
            currentView = 'report-detail';

            const reportContent = document.getElementById('report-content');
            const reportControls = document.getElementById('report-controls');
            const monthlyControls = document.getElementById('monthly-controls');
            const generalControls = document.getElementById('general-controls');

            if (reportContent) {
                // ุฅุธูุงุฑ ุนูุงุตุฑ ุงูุชุญูู
                if (reportControls) {
                    reportControls.style.display = 'block';

                    // ุฅุธูุงุฑ ุงูููุงุชุฑ ุงูููุงุณุจุฉ ุญุณุจ ููุน ุงูุชูุฑูุฑ
                    const salesMonthlyControls = document.getElementById('sales-monthly-controls');

                    if (reportType === 'purchases-monthly') {
                        // ุฅุธูุงุฑ ููุงุชุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ
                        if (monthlyControls) monthlyControls.style.display = 'block';
                        if (salesMonthlyControls) salesMonthlyControls.style.display = 'none';
                        if (generalControls) generalControls.style.display = 'none';
                        console.log('๐ ุชู ุชูุนูู ููุงุชุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ');
                    } else if (reportType === 'monthly') {
                        // ุฅุธูุงุฑ ููุงุชุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ
                        if (monthlyControls) monthlyControls.style.display = 'none';
                        if (salesMonthlyControls) salesMonthlyControls.style.display = 'block';
                        if (generalControls) generalControls.style.display = 'none';
                        console.log('๐ ุชู ุชูุนูู ููุงุชุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ');
                    } else {
                        // ุฅุธูุงุฑ ุงูููุงุชุฑ ุงูุนุงูุฉ ููุชูุงุฑูุฑ ุงูุฃุฎุฑู
                        if (monthlyControls) monthlyControls.style.display = 'none';
                        if (salesMonthlyControls) salesMonthlyControls.style.display = 'none';
                        if (generalControls) generalControls.style.display = 'grid';
                        // ุชุนููู ุงูุชูุงุฑูุฎ ุงูุงูุชุฑุงุถูุฉ
                        setDefaultDates();
                        // ุชุญุฏูุซ ุฎูุงุฑุงุช ุงูุญุณุงุจุงุช ุญุณุจ ููุน ุงูุชูุฑูุฑ
                        updateAccountOptions(reportType);
                        // ุงุณุชุนุงุฏุฉ ุงููุฑุดุญุงุช ุงููุญููุธุฉ ุฅู ูุฌุฏุช
                        restoreSavedFilters(reportType);
                    }
                }

                // ุฅุธูุงุฑ ูุคุดุฑ ุงูุชุญููู
                reportContent.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <p style="margin-top: 20px; color: #666;">ุฌุงุฑู ุชุญููู ุงูุชูุฑูุฑ...</p>
                    </div>
                `;

                // ุชุฃุฎูุฑ ูุตูุฑ ูุฅุธูุงุฑ ุงูุชุญููู
                setTimeout(() => {
                    try {
                        console.log('๐ ุจุฏุก ุฅูุดุงุก ุงูุชูุฑูุฑ:', reportType);
                        const reportData = getDetailedReportData(reportType);

                        if (!reportData) {
                            throw new Error('ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุชูุฑูุฑ');
                        }

                        if (!reportData.html) {
                            throw new Error('ูุญุชูู ุงูุชูุฑูุฑ ูุงุฑุบ');
                        }

                        console.log('โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุจูุฌุงุญ:', reportData.title);
                        reportContent.innerHTML = reportData.html;

                        // ุชุญุฏูุซ ุงูุนููุงู
                        document.getElementById('report-title').textContent = reportData.title;

                        // ุฅุธูุงุฑ ุฒุฑ ุฅูุดุงุก ุงูุชูุฑูุฑ
                        const generateBtn = document.getElementById('generate-report-btn');
                        if (generateBtn) {
                            generateBtn.style.display = 'flex';
                        }

                        // ุชุญุฏูุซ breadcrumb
                        updateBreadcrumb();

                        // ุชูุฑูุฑ ุณูุณ ุฅูู ุฃุนูู ุงูุชูุฑูุฑ
                        reportContent.scrollIntoView({ behavior: 'smooth', block: 'start' });

                    } catch (error) {
                        console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ:', error);
                        reportContent.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                                <h3>ุฎุทุฃ ูู ุชุญููู ุงูุชูุฑูุฑ</h3>
                                <p>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุชูุฑูุฑ: ${error.message}</p>
                                <button onclick="generateReportDirectly('${reportType}')" class="btn-enhanced" style="margin-top: 20px;">
                                    <i class="fas fa-redo"></i>
                                    <span>ุฅุนุงุฏุฉ ุงููุญุงููุฉ</span>
                                </button>
                            </div>
                        `;
                    }

                }, 500);
            }
        }

        // ุฏูุงู ุนูุงุตุฑ ุงูุชุญูู ูู ุงูุชูุงุฑูุฑ
        function setDefaultDates() {
            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);

            const dateFromInput = document.getElementById('report-date-from');
            const dateToInput = document.getElementById('report-date-to');

            if (dateFromInput) {
                dateFromInput.value = firstDayOfMonth.toISOString().split('T')[0];
            }
            if (dateToInput) {
                dateToInput.value = today.toISOString().split('T')[0];
            }
        }

        // ูุชุบูุฑ ุนุงู ูุฎูุงุฑุงุช ุงูุชูุงุฑูุฑ
        window.reportFilters = {};

        // ุฏุงูุฉ ุงุณุชุนุงุฏุฉ ุงููุฑุดุญุงุช ุงููุญููุธุฉ
        function restoreSavedFilters(reportType) {
            if (!savedFilters[reportType]) return;

            const filters = savedFilters[reportType];
            console.log('๐ ุงุณุชุนุงุฏุฉ ุงููุฑุดุญุงุช ุงููุญููุธุฉ ูู', reportType, ':', filters);

            // ุงุณุชุนุงุฏุฉ ุงูุชูุงุฑูุฎ
            const dateFromElement = document.getElementById('report-date-from');
            const dateToElement = document.getElementById('report-date-to');
            const accountElement = document.getElementById('report-account');
            const branchElement = document.getElementById('report-branch');

            if (dateFromElement && filters.dateFrom) {
                dateFromElement.value = filters.dateFrom;
            }
            if (dateToElement && filters.dateTo) {
                dateToElement.value = filters.dateTo;
            }
            if (accountElement && filters.account) {
                accountElement.value = filters.account;
            }
            if (branchElement && filters.branch) {
                branchElement.value = filters.branch;
            }

            console.log('โ ุชู ุงุณุชุนุงุฏุฉ ุงููุฑุดุญุงุช ุจูุฌุงุญ');
        }

        // ุชุฃููุฏ ุชุณุฌูู ุงูุฏุฎูู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            // ุชุณุฌูู ุฏุฎูู ุชููุงุฆู
            localStorage.setItem('monjizLoggedIn', 'true');
        });



        // ุฏุงูุฉ ุชุญุฏูุซ ุฎูุงุฑุงุช ุงูุญุณุงุจุงุช ุญุณุจ ููุน ุงูุชูุฑูุฑ
        function updateAccountOptions(reportType) {
            console.log('๐ ุชุญุฏูุซ ุฎูุงุฑุงุช ุงูุญุณุงุจุงุช ูุชูุฑูุฑ:', reportType);

            const accountSelect = document.getElementById('report-account');
            if (!accountSelect) {
                console.log('โ ุนูุตุฑ report-account ุบูุฑ ููุฌูุฏ');
                return;
            }

            // ุญูุธ ุงููููุฉ ุงููุฎุชุงุฑุฉ ุญุงููุงู
            const currentValue = accountSelect.value;
            console.log('๐พ ุงููููุฉ ุงููุญููุธุฉ:', currentValue);

            // ูุณุญ ุงูุฎูุงุฑุงุช ุงูุญุงููุฉ ุจุงููุงูู
            accountSelect.innerHTML = '';
            console.log('๐งน ุชู ูุณุญ ุฌููุน ุงูุฎูุงุฑุงุช');

            // ุฅุถุงูุฉ ุงูุฎูุงุฑ ุงูุงูุชุฑุงุถู
            const defaultOption = document.createElement('option');
            defaultOption.value = '';

            if (reportType === 'sales-by-customer' || reportType === 'by-customer' ||
                reportType === 'customer-analysis' || reportType === 'customer-balances' ||
                reportType === 'customer-aging' || reportType === 'customer-list') {

                // ุชูุธูู ุงููุงุฆูุฉ ุฃููุงู ูููุน ุงูุชูุฑุงุฑ
                accountSelect.innerHTML = '';
                console.log('๐งน ุชู ุชูุธูู ูุงุฆูุฉ ุงูุนููุงุก');

                // ุฅุถุงูุฉ ุงูุฎูุงุฑ ุงูุงูุชุฑุงุถู
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'ุฌููุน ุงูุนููุงุก';
                accountSelect.appendChild(defaultOption);

                let customersData = [];
                if (window.dataManager) {
                    customersData = window.dataManager.getCustomers();
                    console.log('๐ฅ ุชู ุฌูุจ ุงูุนููุงุก ูู ุงููุธุงู ุงููุฑูุฒู:', customersData.length);
                } else {
                    customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                    console.log('๐ฅ ุชู ุฌูุจ ุงูุนููุงุก ูู localStorage:', customersData.length);
                }

                // ุฅุฒุงูุฉ ุงูุนููุงุก ุงูููุฑุฑูู ุจูุงุกู ุนูู ุงูุงุณู ูุงููุงุชู (ุฃูุซุฑ ุฐูุงุกู)
                const uniqueCustomers = [];
                const seenCustomers = new Map();

                customersData.forEach(customer => {
                    if (customer && customer.name) {
                        // ุฅูุดุงุก ููุชุงุญ ูุฑูุฏ ุจูุงุกู ุนูู ุงูุงุณู ูุงููุงุชู
                        const customerKey = `${customer.name.trim()}_${customer.phone || 'no-phone'}`;

                        if (!seenCustomers.has(customerKey)) {
                            seenCustomers.set(customerKey, customer);
                            uniqueCustomers.push(customer);
                        }
                    }
                });

                console.log('๐ ุงูุนููุงุก ุงูุฃุตูููู:', customersData.length, 'ุงูุนููุงุก ุงููุฑูุฏูู:', uniqueCustomers.length);

                // ุชุฑุชูุจ ุงูุนููุงุก ุฃุจุฌุฏูุงู
                uniqueCustomers.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'ar'));

                uniqueCustomers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;

                    // ุฅุถุงูุฉ ูุนูููุงุช ุฅุถุงููุฉ ููุนููู ูุณูููุฉ ุงูุชุนุฑู ุนููู
                    let customerInfo = '';
                    if (customer.phone) {
                        customerInfo += ` (${customer.phone})`;
                    }

                    option.textContent = `${customer.name}${customerInfo}`;
                    option.setAttribute('data-customer-id', customer.id);
                    option.setAttribute('data-customer-name', customer.name);
                    accountSelect.appendChild(option);
                });

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูุนููุงุก ุจู', uniqueCustomers.length, 'ุนููู ูุฑูุฏ');

                // ุงุณุชุนุงุฏุฉ ุงููููุฉ ุงููุฎุชุงุฑุฉ ุณุงุจูุงู
                if (currentValue) {
                    accountSelect.value = currentValue;
                    console.log('๐ ุชู ุงุณุชุนุงุฏุฉ ุงูุนููู ุงููุฎุชุงุฑ:', currentValue);
                }

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูุนููู:';
                return;

            } else if (reportType === 'current-stock') {
                // ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู
                defaultOption.textContent = 'ุฌููุน ุงูุฃุตูุงู';
                accountSelect.appendChild(defaultOption);

                let productsData = [];
                if (window.dataManager) {
                    productsData = window.dataManager.getProducts();
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูุฑูุฑ ุงููุฎุฒูู:', productsData.length);
                } else {
                    productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู localStorage ูุชูุฑูุฑ ุงููุฎุฒูู:', productsData.length);
                }

                productsData.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id || product.name;
                    option.textContent = product.name;
                    accountSelect.appendChild(option);
                });

                // ุงุณุชุนุงุฏุฉ ุงููููุฉ ุงููุฎุชุงุฑุฉ ุณุงุจูุงู
                if (currentValue) {
                    accountSelect.value = currentValue;
                }

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูุตูู:';

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู ุจูุฌุงุญ');
                return;

            } else if (reportType === 'sales-by-product' || reportType === 'by-product' ||
                       reportType === 'product-operations' || reportType === 'stock-movement') {
                // ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู
                if (reportType === 'product-operations') {
                    defaultOption.textContent = 'ุงุฎุชุฑ ุงูุตูู';
                } else if (reportType === 'stock-movement') {
                    defaultOption.textContent = 'ุฌููุน ุงูุฃุตูุงู';
                } else {
                    defaultOption.textContent = 'ุฌููุน ุงูููุชุฌุงุช';
                }
                accountSelect.appendChild(defaultOption);

                let productsData = [];
                if (window.dataManager) {
                    productsData = window.dataManager.getProducts();
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', productsData.length);
                } else {
                    productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู localStorage:', productsData.length);
                }

                // ููุชูุงุฑูุฑ ุงููุฎุฒูููุฉุ ุนุฑุถ ููุท ุงูููุชุฌุงุช ุงูุญููููุฉ ุงูุชู ููุง ุญุฑูุงุช ูุฎุฒูู
                if (reportType === 'stock-movement') {
                    // ูุงุฆูุฉ ุงูููุชุฌุงุช ุงูููููุฉ ุงูุชู ูุฌุจ ุงุณุชุจุนุงุฏูุง
                    const fakeProductNames = [
                        'ูุงุจุชูุจ ุฏูู XPS 13',
                        'ูุงุจุชูุจ ุฏูู',
                        'ูุงุชู ุขูููู 14',
                        'ูุงุชู ุขูููู',
                        'ุขูููู',
                        'ูุงุจุชูุจ',
                        'ูุชุงุจ ุฅุฏุงุฑุฉ ุงูุฃุนูุงู',
                        'ุดุงูุจู ููุดุนุฑ',
                        'ูููุต ูุทูู'
                    ];

                    // ุงุณุชุจุนุงุฏ ุงูููุชุฌุงุช ุงูููููุฉ ุฃููุงู
                    const originalCount = productsData.length;
                    productsData = productsData.filter(product => {
                        const isFake = fakeProductNames.some(fakeName => {
                            const productName = product.name || '';
                            const fakeNameStr = fakeName || '';
                            return (productName && fakeNameStr && productName.includes(fakeNameStr)) ||
                                   (fakeNameStr && productName && fakeNameStr.includes(productName));
                        });
                        return !isFake;
                    });

                    console.log(`๐งน ุชู ุงุณุชุจุนุงุฏ ุงูููุชุฌุงุช ุงูููููุฉ: ${originalCount} โ ${productsData.length} ููุชุฌ`);

                    const stockMovements = window.dataManager ? window.dataManager.getStockMovements() :
                                         JSON.parse(localStorage.getItem('monjizStockMovements')) || [];

                    // ุงูุญุตูู ุนูู ูุนุฑูุงุช ุงูููุชุฌุงุช ุงูุชู ููุง ุญุฑูุงุช ุญููููุฉ
                    const productsWithMovements = new Set();
                    stockMovements.forEach(movement => {
                        // ุชุฌุงูู ุงูุญุฑูุงุช ููููุชุฌุงุช ุงูููููุฉ
                        const isFakeMovement = fakeProductNames.some(fakeName => {
                            const productName = movement.productName || '';
                            const fakeNameStr = fakeName || '';
                            return productName && fakeNameStr && productName.includes(fakeNameStr);
                        });

                        if (!isFakeMovement) {
                            if (movement.productId) {
                                productsWithMovements.add(String(movement.productId));
                            }
                            if (movement.productName) {
                                // ุงูุจุญุซ ุนู ุงูููุชุฌ ุจุงูุงุณู
                                const product = productsData.find(p => p.name === movement.productName);
                                if (product) {
                                    productsWithMovements.add(String(product.id));
                                }
                            }
                        }
                    });

                    // ููุชุฑุฉ ุงูููุชุฌุงุช ูุนุฑุถ ููุท ุงูุชู ููุง ุญุฑูุงุช ุญููููุฉ
                    const beforeMovementFilter = productsData.length;
                    productsData = productsData.filter(product =>
                        productsWithMovements.has(String(product.id))
                    );

                    console.log(`๐ ุชู ููุชุฑุฉ ุงูููุชุฌุงุช ููุชูุฑูุฑ: ${beforeMovementFilter} โ ${productsData.length} ููุชุฌ ูู ุญุฑูุงุช ุญููููุฉ`);
                }

                productsData.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id || product.name;
                    option.textContent = product.name;
                    accountSelect.appendChild(option);
                });

                // ุงุณุชุนุงุฏุฉ ุงููููุฉ ุงููุฎุชุงุฑุฉ ุณุงุจูุงู
                if (currentValue) {
                    accountSelect.value = currentValue;
                }

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) {
                    if (reportType === 'product-operations') {
                        label.textContent = 'ุงูุตูู:';
                    } else {
                        label.textContent = 'ุงูููุชุฌ:';
                    }
                }

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ุจูุฌุงุญ');
                return;

            } else if (reportType === 'stock-movement') {
                // ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูุฑูุฑ ุญุฑูุฉ ุงููุฎุฒูู
                defaultOption.textContent = 'ุฌููุน ุงูููุชุฌุงุช';
                accountSelect.appendChild(defaultOption);

                let productsData = [];
                if (window.dataManager) {
                    productsData = window.dataManager.getProducts();
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุญุฑูุฉ ุงููุฎุฒูู:', productsData.length);
                } else {
                    productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู localStorage ูุญุฑูุฉ ุงููุฎุฒูู:', productsData.length);
                }

                productsData.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id || product.name;
                    option.textContent = product.name;
                    accountSelect.appendChild(option);
                });

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูููุชุฌ:';

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูุชูุฑูุฑ ุญุฑูุฉ ุงููุฎุฒูู ุจูุฌุงุญ');
                return;

            } else if (reportType === 'stock-valuation') {
                // ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูุฑูุฑ ุชูููู ุงููุฎุฒูู
                defaultOption.textContent = 'ุฌููุน ุงูููุชุฌุงุช';
                accountSelect.appendChild(defaultOption);

                let productsData = [];
                if (window.dataManager) {
                    productsData = window.dataManager.getProducts();
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูููู ุงููุฎุฒูู:', productsData.length);
                } else {
                    productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู localStorage ูุชูููู ุงููุฎุฒูู:', productsData.length);
                }

                productsData.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id || product.name;
                    option.textContent = product.name;
                    accountSelect.appendChild(option);
                });

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูููุชุฌ:';

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูุชูุฑูุฑ ุชูููู ุงููุฎุฒูู ุจูุฌุงุญ');
                return;

            } else if (reportType === 'low-stock') {
                // ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูุฑูุฑ ุงูููุงูุต
                defaultOption.textContent = 'ุฌููุน ุงูููุชุฌุงุช';
                accountSelect.appendChild(defaultOption);

                let productsData = [];
                if (window.dataManager) {
                    productsData = window.dataManager.getProducts();
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูุฑูุฑ ุงูููุงูุต:', productsData.length);
                } else {
                    productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู localStorage ูุชูุฑูุฑ ุงูููุงูุต:', productsData.length);
                }

                productsData.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id || product.name;
                    option.textContent = product.name;
                    accountSelect.appendChild(option);
                });

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูููุชุฌ:';

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูุชูุฑูุฑ ุงูููุงูุต ุจูุฌุงุญ');
                return;

            } else if (reportType === 'purchases-by-product' || reportType === 'by-product') {
                // ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู ูุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ
                console.log('๐ฆ ุชุญุฏูุซ ูุงุฆูุฉ ุงูููุชุฌุงุช ูุชูุฑูุฑ:', reportType);

                defaultOption.textContent = 'ุฌููุน ุงูููุชุฌุงุช';
                accountSelect.appendChild(defaultOption);

                let productsData = [];
                if (window.dataManager) {
                    productsData = window.dataManager.getProducts();
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', productsData.length);
                } else {
                    productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                    console.log('๐ฆ ุชู ุฌูุจ ุงูููุชุฌุงุช ูู localStorage:', productsData.length);
                }

                // ุฅุฒุงูุฉ ุงูููุชุฌุงุช ุงูููุฑุฑุฉ
                const uniqueProducts = [];
                const seenProducts = new Map();

                productsData.forEach(product => {
                    if (product && product.name) {
                        const productKey = `${product.name.trim()}_${product.code || 'no-code'}`;
                        if (!seenProducts.has(productKey)) {
                            seenProducts.set(productKey, product);
                            uniqueProducts.push(product);
                        }
                    }
                });

                console.log('๐ ุงูููุชุฌุงุช ุงูุฃุตููุฉ:', productsData.length, 'ุงูููุชุฌุงุช ุงููุฑูุฏุฉ:', uniqueProducts.length);

                // ุชุฑุชูุจ ุงูููุชุฌุงุช ุฃุจุฌุฏูุงู
                uniqueProducts.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'ar'));

                uniqueProducts.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;

                    // ุฅุถุงูุฉ ูุนูููุงุช ุฅุถุงููุฉ ููููุชุฌ ูุณูููุฉ ุงูุชุนุฑู ุนููู
                    let productInfo = '';
                    if (product.code) {
                        productInfo += ` (${product.code})`;
                    }

                    option.textContent = `${product.name}${productInfo}`;
                    option.setAttribute('data-product-id', product.id);
                    option.setAttribute('data-product-name', product.name);
                    accountSelect.appendChild(option);
                });

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูููุชุฌุงุช ุจู', uniqueProducts.length, 'ููุชุฌ ูุฑูุฏ');

                // ุงุณุชุนุงุฏุฉ ุงููููุฉ ุงููุฎุชุงุฑุฉ ุณุงุจูุงู
                if (currentValue) {
                    accountSelect.value = currentValue;
                    console.log('๐ ุชู ุงุณุชุนุงุฏุฉ ุงูููุชุฌ ุงููุฎุชุงุฑ:', currentValue);
                }

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูููุชุฌ:';
                return;

            } else if (reportType === 'by-supplier' || reportType === 'purchases-by-supplier' ||
                       reportType === 'supplier-list' || reportType === 'supplier-balances' ||
                       reportType === 'supplier-analysis' || reportType === 'supplier-evaluation') {
                // ููุก ูุงุฆูุฉ ุงูููุฑุฏูู ูู ุงููุธุงู ุงููุฑูุฒู
                console.log('๐ช ุชุญุฏูุซ ูุงุฆูุฉ ุงูููุฑุฏูู ูุชูุฑูุฑ:', reportType);

                defaultOption.textContent = 'ุฌููุน ุงูููุฑุฏูู';
                accountSelect.appendChild(defaultOption);

                let suppliersData = [];
                if (window.dataManager) {
                    suppliersData = window.dataManager.getSuppliers();
                    console.log('๐ช ุชู ุฌูุจ ุงูููุฑุฏูู ูู ุงููุธุงู ุงููุฑูุฒู:', suppliersData.length);
                } else {
                    suppliersData = JSON.parse(localStorage.getItem('monjizSuppliers')) || [];
                    console.log('๐ช ุชู ุฌูุจ ุงูููุฑุฏูู ูู localStorage:', suppliersData.length);
                }

                // ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
                if (suppliersData.length === 0) {
                    console.log('๐ ุฅูุดุงุก ููุฑุฏูู ุชุฌุฑูุจููู...');
                    const sampleData = createSamplePurchasesData();
                    suppliersData = sampleData.suppliers;
                    console.log('โ ุชู ุฅูุดุงุก', suppliersData.length, 'ููุฑุฏ ุชุฌุฑูุจู');
                }

                // ุฅุฒุงูุฉ ุงูููุฑุฏูู ุงูููุฑุฑูู
                const uniqueSuppliers = [];
                const seenSuppliers = new Map();

                suppliersData.forEach(supplier => {
                    if (supplier && supplier.name) {
                        const supplierKey = `${supplier.name.trim()}_${supplier.phone || 'no-phone'}`;
                        if (!seenSuppliers.has(supplierKey)) {
                            seenSuppliers.set(supplierKey, supplier);
                            uniqueSuppliers.push(supplier);
                        }
                    }
                });

                console.log('๐ ุงูููุฑุฏูู ุงูุฃุตูููู:', suppliersData.length, 'ุงูููุฑุฏูู ุงููุฑูุฏูู:', uniqueSuppliers.length);

                // ุชุฑุชูุจ ุงูููุฑุฏูู ุฃุจุฌุฏูุงู
                uniqueSuppliers.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'ar'));

                uniqueSuppliers.forEach(supplier => {
                    const option = document.createElement('option');
                    option.value = supplier.id;

                    // ุฅุถุงูุฉ ูุนูููุงุช ุฅุถุงููุฉ ููููุฑุฏ ูุณูููุฉ ุงูุชุนุฑู ุนููู
                    let supplierInfo = '';
                    if (supplier.phone) {
                        supplierInfo += ` (${supplier.phone})`;
                    }

                    option.textContent = `${supplier.name}${supplierInfo}`;
                    option.setAttribute('data-supplier-id', supplier.id);
                    option.setAttribute('data-supplier-name', supplier.name);
                    accountSelect.appendChild(option);
                });

                console.log('โ ุชู ููุก ูุงุฆูุฉ ุงูููุฑุฏูู ุจู', uniqueSuppliers.length, 'ููุฑุฏ ูุฑูุฏ');

                // ุงุณุชุนุงุฏุฉ ุงููููุฉ ุงููุฎุชุงุฑุฉ ุณุงุจูุงู
                if (currentValue) {
                    accountSelect.value = currentValue;
                    console.log('๐ ุชู ุงุณุชุนุงุฏุฉ ุงูููุฑุฏ ุงููุฎุชุงุฑ:', currentValue);
                }

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูููุฑุฏ:';
                return;

            } else {
                // ููุชูุงุฑูุฑ ุงูุฃุฎุฑูุ ุงุณุชุฎุฏุงู ุงูููุงุฆู ุงูุซุงุจุชุฉ
                defaultOption.textContent = 'ุฌููุน ุงูุญุณุงุจุงุช';
                accountSelect.appendChild(defaultOption);

                // ุชุญุฏูุซ ุงูุชุณููุฉ
                const label = accountSelect.previousElementSibling;
                if (label) label.textContent = 'ุงูุญุณุงุจ:';
            }

            // ุชุญุฏูุฏ ุงูุฎูุงุฑุงุช ุงูููุงุณุจุฉ ููู ููุน ุชูุฑูุฑ (ููุชูุงุฑูุฑ ุงูุฃุฎุฑู)
            const accountOptions = {
                // ุงูุชูุงุฑูุฑ ุงููุงููุฉ
                'balance-sheet': [
                    { value: '', text: 'ุฌููุน ุงูุญุณุงุจุงุช' },
                    { value: 'assets', text: 'ุงูุฃุตูู' },
                    { value: 'liabilities', text: 'ุงูุฎุตูู' },
                    { value: 'equity', text: 'ุญููู ุงูููููุฉ' },
                    { value: 'cash', text: 'ุงูููุฏูุฉ' },
                    { value: 'bank', text: 'ุงูุจููู' }
                ],
                'profit-loss': [
                    { value: '', text: 'ุฌููุน ุงูุญุณุงุจุงุช' },
                    { value: 'revenue', text: 'ุงูุฅูุฑุงุฏุงุช' },
                    { value: 'expenses', text: 'ุงููุตุฑููุงุช' },
                    { value: 'sales', text: 'ุงููุจูุนุงุช' },
                    { value: 'cost-of-goods', text: 'ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ' }
                ],
                'cash-flow': [
                    { value: '', text: 'ุฌููุน ุงูุญุณุงุจุงุช ุงูููุฏูุฉ' },
                    { value: 'cash', text: 'ุงูููุฏูุฉ' },
                    { value: 'bank-main', text: 'ุงูุจูู ุงูุฑุฆูุณู' },
                    { value: 'bank-secondary', text: 'ุงูุจูู ุงูุซุงููู' },
                    { value: 'petty-cash', text: 'ุงููุซุฑูุฉ' }
                ],
                'trial-balance': [
                    { value: '', text: 'ุฌููุน ุงูุญุณุงุจุงุช' },
                    { value: 'assets', text: 'ุงูุฃุตูู' },
                    { value: 'liabilities', text: 'ุงูุฎุตูู' },
                    { value: 'equity', text: 'ุญููู ุงูููููุฉ' },
                    { value: 'revenue', text: 'ุงูุฅูุฑุงุฏุงุช' },
                    { value: 'expenses', text: 'ุงููุตุฑููุงุช' }
                ],

                // ุชูุงุฑูุฑ ุงููุจูุนุงุช
                'daily': [
                    { value: '', text: 'ุฌููุน ุทุฑู ุงูุฏูุน' },
                    { value: 'ููุฏุงู', text: 'ููุฏุงู' },
                    { value: 'ุขุฌู', text: 'ุขุฌู' },
                    { value: 'ุชุญููู ุจููู', text: 'ุชุญููู ุจููู' }
                ],
                'monthly': [
                    { value: '', text: 'ุฌููุน ุทุฑู ุงูุฏูุน' },
                    { value: 'cash', text: 'ููุฏุงู' },
                    { value: 'credit-card', text: 'ุจุทุงูุฉ ุงุฆุชูุงู' },
                    { value: 'bank-transfer', text: 'ุชุญููู ุจููู' },
                    { value: 'installment', text: 'ุชูุณูุท' }
                ],


                // ุชูุงุฑูุฑ ุงููุดุชุฑูุงุช
                'purchases-daily': [
                    { value: '', text: 'ุฌููุน ุทุฑู ุงูุฏูุน' },
                    { value: 'cash', text: 'ููุฏุงู' },
                    { value: 'credit', text: 'ุขุฌู' },
                    { value: 'bank-transfer', text: 'ุชุญููู ุจููู' },
                    { value: 'check', text: 'ุดูู' }
                ],
                'monthly': [
                    { value: '', text: 'ุฌููุน ุทุฑู ุงูุฏูุน' },
                    { value: 'cash', text: 'ููุฏุงู' },
                    { value: 'credit', text: 'ุขุฌู' },
                    { value: 'bank-transfer', text: 'ุชุญููู ุจููู' },
                    { value: 'check', text: 'ุดูู' }
                ],
                'by-supplier': [
                    { value: '', text: 'ุฌููุน ุงูููุฑุฏูู' },
                    { value: 'advanced-tech', text: 'ุดุฑูุฉ ุงูุชูููุฉ ุงููุชูุฏูุฉ ุงููุญุฏูุฏุฉ' },
                    { value: 'modern-furniture', text: 'ูุคุณุณุฉ ุงูุฃุซุงุซ ุงูุญุฏูุซ' },
                    { value: 'office-solutions', text: 'ุดุฑูุฉ ุงูุญููู ุงูููุชุจูุฉ' },
                    { value: 'electronics-world', text: 'ุนุงูู ุงูุฅููุชุฑูููุงุช ุงูุชุฌุงุฑู' },
                    { value: 'stationery-house', text: 'ุจูุช ุงููุฑุทุงุณูุฉ ูุงูููุชุจูุงุช' },
                    { value: 'computer-center', text: 'ูุฑูุฒ ุงูุญุงุณูุจ ูุงูุชูููุฉ' },
                    { value: 'mobile-plaza', text: 'ูุฌูุน ุงูุฌูุงูุงุช ูุงูุงุชุตุงูุงุช' },
                    { value: 'office-depot', text: 'ูุณุชูุฏุน ุงูููุงุชุจ ูุงูุฃุซุงุซ' }
                ],
                'by-category': [
                    { value: '', text: 'ุฌููุน ุงููุฆุงุช' },
                    { value: 'electronics', text: 'ุงูุฅููุชุฑูููุงุช' },
                    { value: 'furniture', text: 'ุงูุฃุซุงุซ' },
                    { value: 'stationery', text: 'ุงููุฑุทุงุณูุฉ' },
                    { value: 'accessories', text: 'ุงูุฅูุณุณูุงุฑุงุช' },
                    { value: 'computers', text: 'ุงูุญุงุณูุจ' },
                    { value: 'mobiles', text: 'ุงูุฌูุงูุงุช' }
                ],

                // ุชูุงุฑูุฑ ุงููุฎุฒูู - ุณูุชู ููุคูุง ุฏููุงููููุงู ูู ุงููุธุงู ุงููุฑูุฒู
                'current-stock': [
                    { value: '', text: 'ุฌููุน ุงูุฃุตูุงู' }
                ],
                'stock-movement': [
                    { value: '', text: 'ุฌููุน ุงูููุชุฌุงุช' }
                ],
                'low-stock': [
                    { value: '', text: 'ุฌููุน ุงูููุชุฌุงุช' }
                ],
                'stock-valuation': [
                    { value: '', text: 'ุฌููุน ุงูููุชุฌุงุช' }
                ],

                // ุชูุงุฑูุฑ ุงูุนููุงุก
                'customer-list': [
                    { value: '', text: 'ุฌููุน ุงูุนููุงุก' },
                    { value: 'ahmed-ali', text: 'ุฃุญูุฏ ูุญูุฏ ุนูู' },
                    { value: 'fatima-saad', text: 'ูุงุทูุฉ ุงูุณุนุฏ' },
                    { value: 'mohammed-ahmed', text: 'ูุญูุฏ ุงูุฃุญูุฏ' },
                    { value: 'sara-khalid', text: 'ุณุงุฑุฉ ุฎุงูุฏ' },
                    { value: 'abdullah-otaibi', text: 'ุนุจุฏุงููู ุงูุนุชูุจู' },
                    { value: 'nora-zahrani', text: 'ููุฑุง ุงูุฒูุฑุงูู' },
                    { value: 'khalid-mutairi', text: 'ุฎุงูุฏ ุงููุทูุฑู' },
                    { value: 'reem-shahri', text: 'ุฑูู ุงูุดูุฑู' },
                    { value: 'omar-salem', text: 'ุนูุฑ ุณุงูู' },
                    { value: 'layla-ahmed', text: 'ูููู ุฃุญูุฏ' }
                ],
                'customer-balances': [
                    { value: '', text: 'ุฌููุน ุงูุนููุงุก' },
                    { value: 'ahmed-ali', text: 'ุฃุญูุฏ ูุญูุฏ ุนูู' },
                    { value: 'fatima-saad', text: 'ูุงุทูุฉ ุงูุณุนุฏ' },
                    { value: 'mohammed-ahmed', text: 'ูุญูุฏ ุงูุฃุญูุฏ' },
                    { value: 'sara-khalid', text: 'ุณุงุฑุฉ ุฎุงูุฏ' },
                    { value: 'abdullah-otaibi', text: 'ุนุจุฏุงููู ุงูุนุชูุจู' },
                    { value: 'nora-zahrani', text: 'ููุฑุง ุงูุฒูุฑุงูู' },
                    { value: 'khalid-mutairi', text: 'ุฎุงูุฏ ุงููุทูุฑู' },
                    { value: 'reem-shahri', text: 'ุฑูู ุงูุดูุฑู' }
                ],
                'customer-analysis': [
                    { value: '', text: 'ุฌููุน ุงูุนููุงุก' },
                    { value: 'high-value', text: 'ุนููุงุก ุนุงูู ุงููููุฉ (ุฃูุซุฑ ูู 20,000 ุฑ.ุณ)' },
                    { value: 'medium-value', text: 'ุนููุงุก ูุชูุณุท ุงููููุฉ (10,000 - 20,000 ุฑ.ุณ)' },
                    { value: 'low-value', text: 'ุนููุงุก ููุฎูุถ ุงููููุฉ (ุฃูู ูู 10,000 ุฑ.ุณ)' },
                    { value: 'frequent-buyers', text: 'ุนููุงุก ุฏุงุฆููู (ุฃูุซุฑ ูู 10 ูุดุชุฑูุงุช)' },
                    { value: 'new-customers', text: 'ุนููุงุก ุฌุฏุฏ (ุขุฎุฑ 3 ุฃุดูุฑ)' }
                ],
                'customer-aging': [
                    { value: '', text: 'ุฌููุน ุงูุนููุงุก' },
                    { value: 'current', text: 'ูุณุชุญู ุญุงููุงู (0-30 ููู)' },
                    { value: 'overdue-30', text: 'ูุชุฃุฎุฑ 30 ููู (31-60 ููู)' },
                    { value: 'overdue-60', text: 'ูุชุฃุฎุฑ 60 ููู (61-90 ููู)' },
                    { value: 'overdue-90', text: 'ูุชุฃุฎุฑ 90 ููู (ุฃูุซุฑ ูู 90 ููู)' }
                ],

                // ุชูุงุฑูุฑ ุงูููุฑุฏูู
                'supplier-list': [
                    { value: '', text: 'ุฌููุน ุงูููุฑุฏูู' },
                    { value: 'advanced-tech', text: 'ุดุฑูุฉ ุงูุชูููุฉ ุงููุชูุฏูุฉ ุงููุญุฏูุฏุฉ' },
                    { value: 'modern-furniture', text: 'ูุคุณุณุฉ ุงูุฃุซุงุซ ุงูุญุฏูุซ' },
                    { value: 'office-solutions', text: 'ุดุฑูุฉ ุงูุญููู ุงูููุชุจูุฉ' },
                    { value: 'electronics-world', text: 'ุนุงูู ุงูุฅููุชุฑูููุงุช ุงูุชุฌุงุฑู' },
                    { value: 'stationery-house', text: 'ุจูุช ุงููุฑุทุงุณูุฉ ูุงูููุชุจูุงุช' },
                    { value: 'computer-center', text: 'ูุฑูุฒ ุงูุญุงุณูุจ ูุงูุชูููุฉ' },
                    { value: 'mobile-plaza', text: 'ูุฌูุน ุงูุฌูุงูุงุช ูุงูุงุชุตุงูุงุช' },
                    { value: 'office-depot', text: 'ูุณุชูุฏุน ุงูููุงุชุจ ูุงูุฃุซุงุซ' },
                    { value: 'tech-innovations', text: 'ุดุฑูุฉ ุงูุงุจุชูุงุฑุงุช ุงูุชูููุฉ' }
                ],
                'supplier-balances': [
                    { value: '', text: 'ุฌููุน ุงูููุฑุฏูู' },
                    { value: 'advanced-tech', text: 'ุดุฑูุฉ ุงูุชูููุฉ ุงููุชูุฏูุฉ ุงููุญุฏูุฏุฉ' },
                    { value: 'modern-furniture', text: 'ูุคุณุณุฉ ุงูุฃุซุงุซ ุงูุญุฏูุซ' },
                    { value: 'office-solutions', text: 'ุดุฑูุฉ ุงูุญููู ุงูููุชุจูุฉ' },
                    { value: 'electronics-world', text: 'ุนุงูู ุงูุฅููุชุฑูููุงุช ุงูุชุฌุงุฑู' },
                    { value: 'stationery-house', text: 'ุจูุช ุงููุฑุทุงุณูุฉ ูุงูููุชุจูุงุช' },
                    { value: 'computer-center', text: 'ูุฑูุฒ ุงูุญุงุณูุจ ูุงูุชูููุฉ' },
                    { value: 'mobile-plaza', text: 'ูุฌูุน ุงูุฌูุงูุงุช ูุงูุงุชุตุงูุงุช' }
                ],
                'supplier-analysis': [
                    { value: '', text: 'ุฌููุน ุงูููุฑุฏูู' },
                    { value: 'high-volume', text: 'ููุฑุฏูู ุนุงูู ุงูุญุฌู (ุฃูุซุฑ ูู 50,000 ุฑ.ุณ)' },
                    { value: 'medium-volume', text: 'ููุฑุฏูู ูุชูุณุท ุงูุญุฌู (20,000 - 50,000 ุฑ.ุณ)' },
                    { value: 'low-volume', text: 'ููุฑุฏูู ููุฎูุถ ุงูุญุฌู (ุฃูู ูู 20,000 ุฑ.ุณ)' },
                    { value: 'reliable-suppliers', text: 'ููุฑุฏูู ููุซูููู (ุชูููู ููุชุงุฒ)' },
                    { value: 'new-suppliers', text: 'ููุฑุฏูู ุฌุฏุฏ (ุขุฎุฑ 6 ุฃุดูุฑ)' }
                ],
                'supplier-evaluation': [
                    { value: '', text: 'ุฌููุน ุงูููุฑุฏูู' },
                    { value: 'excellent-rating', text: 'ุชูููู ููุชุงุฒ (90-100%)' },
                    { value: 'good-rating', text: 'ุชูููู ุฌูุฏ (80-89%)' },
                    { value: 'average-rating', text: 'ุชูููู ูุชูุณุท (70-79%)' },
                    { value: 'poor-rating', text: 'ุชูููู ุถุนูู (ุฃูู ูู 70%)' }
                ]
            };

            // ููุชูุงุฑูุฑ ุงูุฃุฎุฑูุ ุงุณุชุฎุฏุงู ุงูููุงุฆู ุงูุซุงุจุชุฉ
            const options = accountOptions[reportType] || [
                { value: '', text: 'ุฌููุน ุงูุญุณุงุจุงุช' },
                { value: 'cash', text: 'ุงูููุฏูุฉ' },
                { value: 'bank', text: 'ุงูุจูู' },
                { value: 'customers', text: 'ุงูุนููุงุก' },
                { value: 'suppliers', text: 'ุงูููุฑุฏูู' }
            ];

            // ุฅุถุงูุฉ ุงูุฎูุงุฑุงุช ุงูุฌุฏูุฏุฉ (ููุท ููุชูุงุฑูุฑ ุงูุฃุฎุฑู)
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.textContent = option.text;
                accountSelect.appendChild(optionElement);
            });

            // ุชููุฆุฉ reportFilters ูุน ุงูุจูุงูุงุช ุงูุญุงููุฉ
            window.reportFilters = accountOptions;
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุฎูุงุฑุงุช ุงูุดูุฑ ุญุณุจ ุงูุณูุฉ
        function updateMonthOptions() {
            const yearElement = document.getElementById('report-year');
            const monthElement = document.getElementById('report-month');

            if (!yearElement || !monthElement) return;

            const selectedYear = parseInt(yearElement.value);
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;

            // ุฅุนุงุฏุฉ ุชุนููู ุฎูุงุฑุงุช ุงูุดูุฑ
            monthElement.innerHTML = '<option value="all">ุฌููุน ุงูุฃุดูุฑ</option>';

            const months = [
                'ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู',
                'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'
            ];

            for (let i = 1; i <= 12; i++) {
                // ุฅุฐุง ูุงูุช ุงูุณูุฉ ุงูุญุงููุฉุ ูุง ูุนุฑุถ ุงูุฃุดูุฑ ุงููุณุชูุจููุฉ
                if (selectedYear === currentYear && i > currentMonth) {
                    continue;
                }

                const option = document.createElement('option');
                option.value = i;
                option.textContent = months[i - 1];
                monthElement.appendChild(option);
            }
        }

        // ุฏุงูุฉ ุฎุงุตุฉ ูููุงุชุฑ ุงูุชูุฑูุฑ ุงูุดูุฑู ุงููุญุณูุฉ
        function applyMonthlyReportFilters() {
            console.log('๐ ุชุทุจูู ููุงุชุฑ ุงูุชูุฑูุฑ ุงูุดูุฑู ุงููุญุณู...');

            try {
                const yearElement = document.getElementById('report-year');
                const monthElement = document.getElementById('report-month');
                const viewTypeElement = document.getElementById('report-view-type');

                const selectedYear = yearElement ? yearElement.value : '2025';
                const selectedMonth = monthElement ? monthElement.value : 'all';
                const viewType = viewTypeElement ? viewTypeElement.value : 'summary';

                console.log('๐ ุงูุณูุฉ ุงููุฎุชุงุฑุฉ:', selectedYear);
                console.log('๐ ุงูุดูุฑ ุงููุฎุชุงุฑ:', selectedMonth);
                console.log('๐ ููุน ุงูุนุฑุถ:', viewType);

                // ุฅูุดุงุก ูุทุงู ุชุงุฑูุฎู
                let dateRange;
                if (selectedMonth === 'all') {
                    dateRange = `ุงูุณูุฉ ุงููุงููุฉ ${selectedYear}`;
                } else {
                    const monthNames = ['', 'ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู',
                                      'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'];
                    dateRange = `${monthNames[selectedMonth]} ${selectedYear}`;
                }

                // ุฅูุดุงุก ุงูุชูุฑูุฑ ูุน ุงูููุงุชุฑ ุงูุฌุฏูุฏุฉ
                const filters = {
                    year: selectedYear,
                    month: selectedMonth,
                    viewType: viewType,
                    dateFrom: selectedMonth === 'all' ? `${selectedYear}-01-01` : `${selectedYear}-${selectedMonth.padStart(2, '0')}-01`,
                    dateTo: selectedMonth === 'all' ? `${selectedYear}-12-31` : `${selectedYear}-${selectedMonth.padStart(2, '0')}-31`
                };

                // ุฅุธูุงุฑ ูุคุดุฑ ุงูุชุญููู
                const reportContent = document.getElementById('report-content');
                if (reportContent) {
                    reportContent.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <p style="margin-top: 20px; color: #666;">ุฌุงุฑู ุชุญุฏูุซ ุงูุชูุฑูุฑ...</p>
                        </div>
                    `;

                    // ุชุฃุฎูุฑ ูุตูุฑ ูุฅุธูุงุฑ ุงูุชุญููู
                    setTimeout(() => {
                        const reportData = createPurchasesMonthlyReport(dateRange, filters);
                        reportContent.innerHTML = reportData;
                        console.log('โ ุชู ุชุญุฏูุซ ุงูุชูุฑูุฑ ุงูุดูุฑู ุจูุฌุงุญ');
                    }, 500);
                }

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุทุจูู ููุงุชุฑ ุงูุชูุฑูุฑ ุงูุดูุฑู:', error);
                const reportContent = document.getElementById('report-content');
                if (reportContent) {
                    reportContent.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                            <h3>ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุชูุฑูุฑ</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // ุฏุงูุฉ ุฎุงุตุฉ ูููุงุชุฑ ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ
        function applySalesMonthlyReportFilters() {
            console.log('๐ ุชุทุจูู ููุงุชุฑ ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ...');

            try {
                const yearElement = document.getElementById('sales-report-year');
                const monthElement = document.getElementById('sales-report-month');
                const viewTypeElement = document.getElementById('sales-report-view-type');

                const selectedYear = yearElement ? yearElement.value : '2025';
                const selectedMonth = monthElement ? monthElement.value : 'all';
                const viewType = viewTypeElement ? viewTypeElement.value : 'summary';

                console.log('๐ ุงูุณูุฉ ุงููุฎุชุงุฑุฉ:', selectedYear);
                console.log('๐ ุงูุดูุฑ ุงููุฎุชุงุฑ:', selectedMonth);
                console.log('๐ ููุน ุงูุนุฑุถ:', viewType);

                // ุฅูุดุงุก ูุทุงู ุชุงุฑูุฎู
                let dateRange;
                if (selectedMonth === 'all') {
                    dateRange = `ุงูุณูุฉ ุงููุงููุฉ ${selectedYear}`;
                } else {
                    const monthNames = ['', 'ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู',
                                      'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'];
                    dateRange = `${monthNames[selectedMonth]} ${selectedYear}`;
                }

                // ุฅูุดุงุก ุงูุชูุฑูุฑ ูุน ุงูููุงุชุฑ ุงูุฌุฏูุฏุฉ
                const filters = {
                    year: selectedYear,
                    month: selectedMonth,
                    viewType: viewType,
                    dateFrom: selectedMonth === 'all' ? `${selectedYear}-01-01` : `${selectedYear}-${selectedMonth.padStart(2, '0')}-01`,
                    dateTo: selectedMonth === 'all' ? `${selectedYear}-12-31` : `${selectedYear}-${selectedMonth.padStart(2, '0')}-31`
                };

                // ุฅุธูุงุฑ ูุคุดุฑ ุงูุชุญููู
                const reportContent = document.getElementById('report-content');
                if (reportContent) {
                    reportContent.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #28a745; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <p style="margin-top: 20px; color: #666;">ุฌุงุฑู ุชุญุฏูุซ ุชูุฑูุฑ ุงููุจูุนุงุช...</p>
                        </div>
                    `;

                    // ุชุฃุฎูุฑ ูุตูุฑ ูุฅุธูุงุฑ ุงูุชุญููู
                    setTimeout(() => {
                        const reportData = createMonthlySalesReport(dateRange, filters);
                        reportContent.innerHTML = reportData;
                        console.log('โ ุชู ุชุญุฏูุซ ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ ุจูุฌุงุญ');
                    }, 500);
                }

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุทุจูู ููุงุชุฑ ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ:', error);
                const reportContent = document.getElementById('report-content');
                if (reportContent) {
                    reportContent.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                            <h3>ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุชูุฑูุฑ</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        function applyReportFilters() {
            console.log('๐ ุจุฏุก ุชุดุบูู ุฏุงูุฉ applyReportFilters...');

            try {
                // ูุญุต ูุฌูุฏ ุงูุนูุงุตุฑ ูุจู ูุฑุงุกุฉ ุงูููู
                const dateFromElement = document.getElementById('report-date-from');
                const dateToElement = document.getElementById('report-date-to');
                const accountElement = document.getElementById('report-account');
                const branchElement = document.getElementById('report-branch');

                console.log('๐ ูุญุต ูุฌูุฏ ุงูุนูุงุตุฑ:');
                console.log('   ๐ report-date-from:', dateFromElement ? 'ููุฌูุฏ' : 'ุบูุฑ ููุฌูุฏ');
                console.log('   ๐ report-date-to:', dateToElement ? 'ููุฌูุฏ' : 'ุบูุฑ ููุฌูุฏ');
                console.log('   ๐ค report-account:', accountElement ? 'ููุฌูุฏ' : 'ุบูุฑ ููุฌูุฏ');
                console.log('   ๐ข report-branch:', branchElement ? 'ููุฌูุฏ' : 'ุบูุฑ ููุฌูุฏ');

                const dateFrom = dateFromElement ? dateFromElement.value : '';
                const dateTo = dateToElement ? dateToElement.value : '';
                const account = accountElement ? accountElement.value : '';
                const branch = branchElement ? branchElement.value : '';

                // ุญูุธ ุงููุฑุดุญุงุช ููุงุณุชุฎุฏุงู ูุงุญูุงู
                savedFilters[currentReportType] = {
                    dateFrom: dateFrom,
                    dateTo: dateTo,
                    account: account,
                    branch: branch
                };

                // ุฅุถุงูุฉ ุนูุงูุฉ ูููุน ุฅุนุงุฏุฉ ุงูุชุญููู ุงูุชููุงุฆู
                window.isApplyingFilters = true;

            console.log('๐ง ุชุทุจูู ุงููุฑุดุญุงุช:');
            console.log('   ๐ ููุน ุงูุชูุฑูุฑ ุงูุญุงูู:', currentReportType);
            console.log('   ๐ ูู ุชุงุฑูุฎ:', dateFrom);
            console.log('   ๐ ุฅูู ุชุงุฑูุฎ:', dateTo);
            console.log('   ๐ค ุงูุญุณุงุจ/ุงูุตูู:', account);
            console.log('   ๐ข ุงููุฑุน:', branch);
            console.log('๐พ ุชู ุญูุธ ุงููุฑุดุญุงุช:', savedFilters[currentReportType]);

            // ุงูุชุญูู ูู ุตุญุฉ ุงูุชูุงุฑูุฎ
            if (dateFrom && dateTo && new Date(dateFrom) > new Date(dateTo)) {
                showErrorMessage('ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุฌุจ ุฃู ูููู ูุจู ุชุงุฑูุฎ ุงูููุงูุฉ!');
                return;
            }

            // ุฅุธูุงุฑ ูุคุดุฑ ุงูุชุญููู
            showLoadingMessage('ุฌุงุฑู ุชุทุจูู ุงููุฑุดุญุงุช ูุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุชูุฑูุฑ...');

            // ูุญุงูุงุฉ ุชุทุจูู ุงููุฑุดุญุงุช
            setTimeout(() => {
                hideLoadingMessage();

                // ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุชูุฑูุฑ ุจุงููุฑุดุญุงุช ุงูุฌุฏูุฏุฉ
                console.log('๐ ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุชูุฑูุฑ ุจุงูููุงุชุฑ ุงูุฌุฏูุฏุฉ...');
                const reportData = getDetailedReportData(currentReportType, {
                    dateFrom: dateFrom,
                    dateTo: dateTo,
                    account: account,
                    branch: branch
                });

                console.log('๐ ุจูุงูุงุช ุงูุชูุฑูุฑ ุงููุญุฏุซุฉ:', reportData ? 'ุชู ุงูุญุตูู ุนูููุง' : 'ูุงุฑุบุฉ');

                const reportContent = document.getElementById('report-content');
                if (reportContent && reportData && reportData.html) {
                    console.log('โ ุชุญุฏูุซ ูุญุชูู ุงูุชูุฑูุฑ...');
                    reportContent.innerHTML = reportData.html;
                } else {
                    console.error('โ ูุดู ูู ุชุญุฏูุซ ุงูุชูุฑูุฑ:', {
                        reportContent: !!reportContent,
                        reportData: !!reportData,
                        html: !!(reportData && reportData.html)
                    });
                }

                // ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฌุงุญ ูุน ุชูุงุตูู ุงููุฑุดุญุงุช
                let filterDetails = [];
                if (dateFrom && dateTo) {
                    filterDetails.push(`ุงููุชุฑุฉ: ${dateFrom} ุฅูู ${dateTo}`);
                }
                if (account && accountElement && accountElement.selectedOptions.length > 0) {
                    const accountText = accountElement.selectedOptions[0].text;
                    filterDetails.push(`ุงูุตูู: ${accountText}`);
                }
                if (branch && branchElement && branchElement.selectedOptions.length > 0) {
                    const branchText = branchElement.selectedOptions[0].text;
                    filterDetails.push(`ุงููุฑุน: ${branchText}`);
                }

                const message = filterDetails.length > 0
                    ? `ุชู ุชุทุจูู ุงููุฑุดุญุงุช ุจูุฌุงุญ! (${filterDetails.join(', ')})`
                    : 'ุชู ุชุญุฏูุซ ุงูุชูุฑูุฑ ุจูุฌุงุญ!';

                showSuccessMessage(message);

                // ุฅุฒุงูุฉ ุนูุงูุฉ ุชุทุจูู ุงูููุงุชุฑ
                setTimeout(() => {
                    window.isApplyingFilters = false;
                }, 1000);
            }, 1000);

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฏุงูุฉ applyReportFilters:', error);
                hideLoadingMessage();
                showErrorMessage(`ุฎุทุฃ ูู ุชุทุจูู ุงููุฑุดุญุงุช: ${error.message}`);
            }
        }



        // ุฏุงูุฉ ุชุญุฏูุซ breadcrumb
        function updateBreadcrumb() {
            const breadcrumbCategory = document.getElementById('breadcrumb-category');

            if (currentView === 'categories') {
                breadcrumbCategory.textContent = 'ุงุฎุชูุงุฑ ููุน ุงูุชูุฑูุฑ';
            } else if (currentView === 'reports') {
                const categoryNames = {
                    'financial': 'ุงููุงููุฉ',
                    'sales': 'ุงููุจูุนุงุช',
                    'purchases': 'ุงููุดุชุฑูุงุช',
                    'inventory': 'ุงููุฎุฒูู',
                    'customers': 'ุงูุนููุงุก',
                    'suppliers': 'ุงูููุฑุฏูู'
                };
                breadcrumbCategory.textContent = categoryNames[currentCategory] || 'ุชูุฑูุฑ';
            } else if (currentView === 'report-detail') {
                const reportNames = {
                    'balance-sheet': 'ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู',
                    'profit-loss': 'ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ',
                    'daily': 'ุงููุจูุนุงุช ุงูููููุฉ',
                    'current-stock': 'ุงููุฎุฒูู ุงูุญุงูู'
                };
                breadcrumbCategory.textContent = reportNames[currentReportType] || 'ุชูุฑูุฑ ููุตู';
            }
        }

        // ุฏุงูุฉ ุชุญุณูู ุงูุฃุฏุงุก - ุชุญููู ูุณุจู ููุจูุงูุงุช
        function preloadReportData() {
            // ุชุญููู ูุณุจู ููุชูุงุฑูุฑ ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู
            const popularReports = ['balance-sheet', 'profit-loss', 'daily', 'current-stock'];
            popularReports.forEach(reportType => {
                setTimeout(() => {
                    getDetailedReportData(reportType);
                }, 100);
            });
        }

        // ุฏุงูุฉ ุฅุถุงูุฉ ุชุฃุซูุฑุงุช ุจุตุฑูุฉ ูุญุณูุฉ
        function addVisualEnhancements() {
            // ุฅุถุงูุฉ ุชุฃุซูุฑ hover ููุจุทุงูุงุช
            const categoryCards = document.querySelectorAll('.category-card-modern');
            categoryCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.02)';
                });

                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        }

        // ุฏุงูุฉ ุชูุณูู ุงูุชุงุฑูุฎ ุจุงููููุงุฏู
        function formatDateArabic(date) {
            if (!date) return '';

            const dateObj = typeof date === 'string' ? new Date(date) : date;

            return dateObj.toLocaleDateString('ar', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                calendar: 'gregory'
            });
        }

        // ุฏุงูุฉ ุชูุณูู ุงูุชุงุฑูุฎ ุจุตูุบุฉ ุฃูุซุฑ ูุถูุญุงู
        function formatDateDetailed(date) {
            if (!date) return '';

            const dateObj = typeof date === 'string' ? new Date(date) : date;

            return dateObj.toLocaleDateString('ar', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                calendar: 'gregory'
            });
        }

        // ุฏุงูุฉ ุชูุณูู ุงูุชุงุฑูุฎ ุจุงููููุงุฏู (ุชูุณูู ูุฎุชุตุฑ)
        function formatDateGregorian(date) {
            if (!date) return '';
            const d = new Date(date);
            const year = d.getFullYear();
            const month = (d.getMonth() + 1).toString().padStart(2, '0');
            const day = d.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ุฏุงูุฉ ุชูุณูู ุงูุชุงุฑูุฎ ุจุงูุนุฑุจูุฉ ุงููููุงุฏูุฉ
        function formatDateArabicGregorian(date) {
            if (!date) return '';
            return new Date(date).toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                calendar: 'gregory'
            });
        }

        // ุฏุงูุฉ ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุชูุฑูุฑ ุงูููุตูุฉ ูุญุณูุฉ
        function getDetailedReportData(reportType, filters = {}) {
            try {
                console.log('๐ ุฅูุดุงุก ุจูุงูุงุช ุงูุชูุฑูุฑ:', reportType, filters);

                // ุชูุณูู ุงูุชุงุฑูุฎ ุจุงููููุงุฏู
                const currentDate = formatDateArabic(new Date());

                // ุชุทุจูู ุงููุฑุดุญุงุช ุนูู ุงูุจูุงูุงุช
                let dateRange = null;
                let dateRangeText = '';
                if (filters.dateFrom && filters.dateTo) {
                    const fromDate = formatDateArabic(filters.dateFrom);
                    const toDate = formatDateArabic(filters.dateTo);
                    dateRangeText = `ูู ${fromDate} ุฅูู ${toDate}`;
                    // ุฅูุดุงุก object ููุชุงุฑูุฎ ููุงุณุชุฎุฏุงู ูู ุงูููุชุฑุฉ
                    dateRange = {
                        from: filters.dateFrom,
                        to: filters.dateTo
                    };
                } else {
                    dateRangeText = `ููุง ูู ${currentDate}`;
                }

                console.log('๐ ูุทุงู ุงูุชุงุฑูุฎ:', dateRangeText);
                console.log('๐ ูุงุฆู ุงูุชุงุฑูุฎ ููููุชุฑุฉ:', dateRange);

                console.log('๐ง ุฅูุดุงุก ููุงูุจ ุงูุชูุงุฑูุฑ...');
                const reportTemplates = {
                // ุงูุชูุงุฑูุฑ ุงููุงููุฉ
                'end-of-day': {
                    title: 'ุชูุฑูุฑ ุฅุบูุงู ุงูููู',
                    category: 'financial',
                    html: createEndOfDayReportRedirect(dateRange, filters)
                },
                'balance-sheet': {
                    title: 'ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู',
                    category: 'financial',
                    html: createBalanceSheetReport(dateRange, filters)
                },
                'profit-loss': {
                    title: 'ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ',
                    category: 'financial',
                    html: createProfitLossReport(dateRange, filters)
                },
                'cash-flow': {
                    title: 'ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ',
                    category: 'financial',
                    html: createCashFlowReport(dateRange, filters)
                },
                'trial-balance': {
                    title: 'ููุฒุงู ุงููุฑุงุฌุนุฉ',
                    category: 'financial',
                    html: createTrialBalanceReport(dateRange, filters)
                },

                // ุชูุงุฑูุฑ ุงููุจูุนุงุช
                'daily': {
                    title: 'ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ',
                    category: 'sales',
                    html: createDailySalesReport(dateRange, filters)
                },
                'monthly': {
                    title: 'ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ',
                    category: 'sales',
                    html: createMonthlySalesReport(dateRange, filters),
                    getDynamicTitle: function() {
                        if (filters.dateFrom && filters.dateTo) {
                            const startDate = new Date(filters.dateFrom);
                            const endDate = new Date(filters.dateTo);
                            const startMonth = startDate.toLocaleDateString('ar', { month: 'long', year: 'numeric' });
                            const endMonth = endDate.toLocaleDateString('ar', { month: 'long', year: 'numeric' });

                            if (startMonth === endMonth) {
                                return `ูุจูุนุงุช ุดูุฑ ${startMonth}`;
                            } else {
                                return `ุงููุจูุนุงุช ุงูุดูุฑูุฉ ูู ${startMonth} ุฅูู ${endMonth}`;
                            }
                        }
                        return 'ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ';
                    }
                },
                'by-customer': {
                    title: 'ุงููุจูุนุงุช ุญุณุจ ุงูุนููู',
                    category: 'sales',
                    html: createSalesByCustomerReport(dateRange, filters),
                    getDynamicTitle: function() {
                        // ุฅุฐุง ูุงู ููุงู ุนููู ูุญุฏุฏุ ุงุณุชุฎุฏู ุงุณูู ูู ุงูุนููุงู
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูุนููู ุงููุญุฏุฏ
                            let customersData = [];
                            if (window.dataManager) {
                                customersData = window.dataManager.getCustomers();
                            } else {
                                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                            }
                            const selectedCustomer = customersData.find(c => c.id == filters.account || c.id === filters.account);
                            if (selectedCustomer) {
                                return `ูุจูุนุงุช ุงูุนููู: ${selectedCustomer.name}`;
                            }
                        }
                        return 'ุงููุจูุนุงุช ุญุณุจ ุงูุนููู';
                    }
                },
                'by-product': {
                    title: 'ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ',
                    category: 'sales',
                    html: createSalesByProductReport(dateRange, filters),
                    getDynamicTitle: function() {
                        // ุฅุฐุง ูุงู ููุงู ููุชุฌ ูุญุฏุฏุ ุงุณุชุฎุฏู ุงุณูู ูู ุงูุนููุงู
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูููุชุฌ ุงููุญุฏุฏ
                            let productsData = [];
                            if (window.dataManager) {
                                productsData = window.dataManager.getProducts();
                            } else {
                                productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                            }
                            const selectedProduct = productsData.find(p => p.id == filters.account || p.name === filters.account);
                            if (selectedProduct) {
                                return `ูุจูุนุงุช ุงูููุชุฌ: ${selectedProduct.name}`;
                            }
                        }
                        return 'ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ';
                    }
                },

                // ุชูุงุฑูุฑ ุงููุดุชุฑูุงุช
                'purchases-daily': {
                    title: 'ุงููุดุชุฑูุงุช ุงูููููุฉ',
                    category: 'purchases',
                    html: createPurchasesDailyReport(dateRange, filters)
                },
                'purchases-monthly': {
                    title: 'ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ',
                    category: 'purchases',
                    html: createPurchasesMonthlyReport(dateRange, filters)
                },
                'by-supplier': {
                    title: 'ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ',
                    category: 'purchases',
                    html: createPurchasesBySupplierReport(dateRange, filters),
                    getDynamicTitle: function() {
                        // ุฅุฐุง ูุงู ููุงู ููุฑุฏ ูุญุฏุฏุ ุงุณุชุฎุฏู ุงุณูู ูู ุงูุนููุงู
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูููุฑุฏ ุงููุญุฏุฏ
                            let suppliersData = [];
                            if (window.dataManager) {
                                suppliersData = window.dataManager.getSuppliers();
                            } else {
                                suppliersData = JSON.parse(localStorage.getItem('monjizSuppliers')) || [];
                            }

                            // ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
                            if (suppliersData.length === 0) {
                                const sampleData = createSamplePurchasesData();
                                suppliersData = sampleData.suppliers;
                            }

                            const selectedSupplier = suppliersData.find(s =>
                                String(s.id) === String(filters.account) ||
                                s.name === filters.account
                            );

                            if (selectedSupplier) {
                                return `ูุดุชุฑูุงุช ุงูููุฑุฏ: ${selectedSupplier.name}`;
                            }
                        }
                        return 'ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ';
                    }
                },
                'purchases-by-product': {
                    title: 'ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ',
                    category: 'purchases',
                    html: createPurchasesByProductReport(dateRange, filters),
                    getDynamicTitle: function() {
                        // ุฅุฐุง ูุงู ููุงู ููุชุฌ ูุญุฏุฏุ ุงุณุชุฎุฏู ุงุณูู ูู ุงูุนููุงู
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูููุชุฌ ุงููุญุฏุฏ
                            let productsData = [];
                            if (window.dataManager) {
                                productsData = window.dataManager.getProducts();
                            } else {
                                productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                            }

                            const selectedProduct = productsData.find(p =>
                                String(p.id) === String(filters.account) ||
                                p.name === filters.account
                            );

                            if (selectedProduct) {
                                return `ูุดุชุฑูุงุช ุงูููุชุฌ: ${selectedProduct.name}`;
                            }
                        }
                        return 'ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ';
                    }
                },

                // ุชูุงุฑูุฑ ุงููุฎุฒูู
                'current-stock': {
                    title: 'ุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู',
                    category: 'inventory',
                    html: createStockReport(dateRange, filters)
                },
                'stock-movement': {
                    title: 'ุญุฑูุฉ ุงููุฎุฒูู',
                    category: 'inventory',
                    html: createStockMovementReport(dateRange, filters),
                    getDynamicTitle: function() {
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูููุชุฌ ุงููุญุฏุฏ
                            let productsData = [];
                            if (window.dataManager) {
                                productsData = window.dataManager.getProducts();
                            } else {
                                productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                            }

                            const selectedProduct = productsData.find(p =>
                                p.id == filters.account ||
                                p.id === filters.account ||
                                p.name === filters.account ||
                                String(p.id) === String(filters.account)
                            );

                            if (selectedProduct) {
                                return `ุญุฑูุฉ ุงููุฎุฒูู: ${selectedProduct.name}`;
                            }
                        }
                        return 'ุญุฑูุฉ ุงููุฎุฒูู';
                    }
                },
                'product-operations': {
                    title: 'ุชูุฑูุฑ ุนูููุงุช ุตูู',
                    category: 'inventory',
                    html: createProductOperationsReport(currentDate, filters),
                    getDynamicTitle: function() {
                        // ุฅุฐุง ูุงู ููุงู ุตูู ูุญุฏุฏุ ุงุณุชุฎุฏู ุงุณูู ูู ุงูุนููุงู
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูููุชุฌ ุงููุญุฏุฏ
                            let productsData = [];
                            if (window.dataManager) {
                                productsData = window.dataManager.getProducts();
                            } else {
                                productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                            }
                            const selectedProduct = productsData.find(p => p.id == filters.account || p.name === filters.account);
                            if (selectedProduct) {
                                return `ุนูููุงุช ุงูุตูู: ${selectedProduct.name}`;
                            }
                        }
                        return 'ุชูุฑูุฑ ุนูููุงุช ุตูู';
                    }
                },
                'low-stock': {
                    title: 'ุชูุฑูุฑ ุงูููุงูุต',
                    category: 'inventory',
                    html: createLowStockReport(dateRange, filters)
                },
                'stock-valuation': {
                    title: 'ุชูููู ุงููุฎุฒูู',
                    category: 'inventory',
                    html: createStockValuationReport(dateRange, filters)
                },

                // ุชูุงุฑูุฑ ุงูุนููุงุก
                'customer-list': {
                    title: 'ูุงุฆูุฉ ุงูุนููุงุก',
                    category: 'customers',
                    html: createCustomerListReport(dateRange, filters)
                },
                'customer-balances': {
                    title: 'ุฃุฑุตุฏุฉ ุงูุนููุงุก',
                    category: 'customers',
                    html: createCustomerBalancesReport(dateRange, filters),
                    getDynamicTitle: function() {
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูุนููู ุงููุญุฏุฏ
                            let customersData = [];
                            if (window.dataManager) {
                                customersData = window.dataManager.getCustomers();
                            } else {
                                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                            }
                            const selectedCustomer = customersData.find(c => c.id == filters.account || c.name === filters.account);
                            if (selectedCustomer) {
                                return `ุฑุตูุฏ ุงูุนููู: ${selectedCustomer.name}`;
                            }
                        }
                        return 'ุฃุฑุตุฏุฉ ุงูุนููุงุก';
                    }
                },
                'customer-analysis': {
                    title: 'ุชุญููู ุงูุนููุงุก',
                    category: 'customers',
                    html: createCustomerAnalysisReport(dateRange, filters),
                    getDynamicTitle: function() {
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูุนููู ุงููุญุฏุฏ
                            let customersData = [];
                            if (window.dataManager) {
                                customersData = window.dataManager.getCustomers();
                            } else {
                                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                            }

                            // ุงูุจุญุซ ุจุทุฑู ูุชุนุฏุฏุฉ ููุชุฃูุฏ ูู ุงูุฏูุฉ
                            const selectedCustomer = customersData.find(c =>
                                c.id == filters.account ||
                                c.id === filters.account ||
                                c.name === filters.account ||
                                String(c.id) === String(filters.account)
                            );

                            if (selectedCustomer) {
                                return `ุชุญููู ุงูุนููู: ${selectedCustomer.name}`;
                            }
                        }
                        return 'ุชุญููู ุงูุนููุงุก';
                    }
                },
                'customer-aging': {
                    title: 'ุฃุนูุงุฑ ุงูุฏููู',
                    category: 'customers',
                    html: createCustomerAgingReport(dateRange, filters),
                    getDynamicTitle: function() {
                        if (filters.account && filters.account !== '') {
                            // ุงูุจุญุซ ุนู ุงูุนููู ุงููุญุฏุฏ
                            let customersData = [];
                            if (window.dataManager) {
                                customersData = window.dataManager.getCustomers();
                            } else {
                                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                            }

                            const selectedCustomer = customersData.find(c =>
                                c.id == filters.account ||
                                c.id === filters.account ||
                                c.name === filters.account ||
                                String(c.id) === String(filters.account)
                            );

                            if (selectedCustomer) {
                                return `ุฃุนูุงุฑ ุฏููู ุงูุนููู: ${selectedCustomer.name}`;
                            }
                        }
                        return 'ุฃุนูุงุฑ ุงูุฏููู';
                    }
                },

                // ุชูุงุฑูุฑ ุงูููุฑุฏูู
                'supplier-list': {
                    title: 'ูุงุฆูุฉ ุงูููุฑุฏูู',
                    category: 'suppliers',
                    html: createSupplierListReport(dateRange, filters)
                },
                'supplier-balances': {
                    title: 'ุฃุฑุตุฏุฉ ุงูููุฑุฏูู',
                    category: 'suppliers',
                    html: createSupplierBalancesReport(dateRange, filters)
                },
                'supplier-analysis': {
                    title: 'ุชุญููู ุงูููุฑุฏูู',
                    category: 'suppliers',
                    html: createSupplierAnalysisReport(dateRange, filters)
                },
                'supplier-evaluation': {
                    title: 'ุชูููู ุงูููุฑุฏูู',
                    category: 'suppliers',
                    html: createSupplierEvaluationReport(dateRange, filters)
                }
            };

                const result = reportTemplates[reportType] || {
                    title: 'ุชูุฑูุฑ ุนุงู',
                    category: 'general',
                    html: createDefaultReport(reportType, currentDate)
                };

                // ุงุณุชุฎุฏุงู ุงูุนููุงู ุงูุฏููุงูููู ุฅุฐุง ูุงู ูุชุงุญุงู
                if (result.getDynamicTitle && typeof result.getDynamicTitle === 'function') {
                    result.title = result.getDynamicTitle();
                }

                console.log('โ ุชู ุฅูุดุงุก ุจูุงูุงุช ุงูุชูุฑูุฑ:', result.title);
                return result;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุจูุงูุงุช ุงูุชูุฑูุฑ:', error);
                return {
                    title: 'ุฎุทุฃ ูู ุงูุชูุฑูุฑ',
                    category: 'error',
                    html: `
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                            <p>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงูุชูุฑูุฑ: ${error.message}</p>
                            <p style="font-size: 14px; color: #666; margin-top: 20px;">ููุน ุงูุชูุฑูุฑ: ${reportType}</p>
                        </div>
                    `
                };
            }
        }

        // ุชู ุญุฐู ุงูุฏุงูุฉ ุงูููุฑุฑุฉ - ุณูุชู ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงููุญุณูุฉ ูู ุงูุฃุณูู

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ
        function createProfitLossReport(currentDate) {
            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ</h2>
                        <p>ูููุชุฑุฉ ุงูููุชููุฉ ูู ${currentDate}</p>
                    </div>
                    <div class="report-content">
                        <table class="report-table">
                            <thead>
                                <tr><th>ุงูุจูุฏ</th><th>ุงููุจูุบ (ุฑ.ุณ)</th><th>ุงููุณุจุฉ %</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>ุฅูุฑุงุฏุงุช ุงููุจูุนุงุช</td><td>1,200,000</td><td>100.0%</td></tr>
                                <tr><td>ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ</td><td>(720,000)</td><td>60.0%</td></tr>
                                <tr class="profit"><td><strong>ุฅุฌูุงูู ุงูุฑุจุญ</strong></td><td><strong>480,000</strong></td><td><strong>40.0%</strong></td></tr>
                                <tr><td>ูุตุฑููุงุช ุงูุจูุน ูุงูุชุณููู</td><td>(120,000)</td><td>10.0%</td></tr>
                                <tr><td>ุงููุตุฑููุงุช ุงูุฅุฏุงุฑูุฉ</td><td>(85,000)</td><td>7.1%</td></tr>
                                <tr><td>ูุตุฑููุงุช ุงูุฅููุงู</td><td>(35,000)</td><td>2.9%</td></tr>
                                <tr class="profit"><td><strong>ุงูุฑุจุญ ุงูุชุดุบููู</strong></td><td><strong>240,000</strong></td><td><strong>20.0%</strong></td></tr>
                                <tr><td>ูุตุฑููุงุช ุงูููุงุฆุฏ</td><td>(18,000)</td><td>1.5%</td></tr>
                                <tr><td>ุถุฑูุจุฉ ุงูุฏุฎู</td><td>(33,000)</td><td>2.8%</td></tr>
                                <tr class="final-total"><td><strong>ุตุงูู ุงูุฑุจุญ</strong></td><td><strong>189,000</strong></td><td><strong>15.7%</strong></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="report-actions">
                        <button onclick="window.print()" class="btn-print">ุทุจุงุนุฉ</button>
                        <button onclick="exportToExcel('profit-loss')" class="btn-excel">ุชุตุฏูุฑ Excel</button>
                        <button onclick="exportToPDF('profit-loss')" class="btn-pdf">ุชุตุฏูุฑ PDF</button>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ูุณุงุนุฏุฉ ูุชูุณูู ุงูุฃุฑูุงู ุจุฃูุงู
        function formatNumber(value, decimals = 2) {
            if (value === null || value === undefined || value === '' || isNaN(value)) {
                return '0.00';
            }
            const num = parseFloat(value);
            if (isNaN(num)) {
                return '0.00';
            }
            return num.toFixed(decimals);
        }

        // ุฏุงูุฉ ุชุญููู ุทุฑู ุงูุฏูุน ูู ุงูุฅูุฌููุฒูุฉ ุฅูู ุงูุนุฑุจูุฉ
        function convertPaymentMethodToArabic(paymentMethod) {
            const conversionMap = {
                'cash': 'ููุฏุงู',
                'credit': 'ุขุฌู',
                'transfer': 'ุชุญููู ุจููู',
                'bank-transfer': 'ุชุญููู ุจููู',
                'card': 'ุชุญููู ุจููู'
            };
            return conversionMap[paymentMethod] || paymentMethod;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ
        function createDailySalesReport(dateRange, filters = {}) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ ูู ุงูุจูุงูุงุช ุงูุญููููุฉ...', filters);

            try {
                // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ุงููุธุงู
                let salesData = [];
                let customersData = [];

                if (window.dataManager) {
                    salesData = window.dataManager.getSales();
                    customersData = window.dataManager.getCustomers();
                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', salesData.length, 'ูุงุชูุฑุฉุ', customersData.length, 'ุนููู');
                } else {
                    // ุงูุฑุฌูุน ููุจูุงูุงุช ุงููุญููุฉ
                    salesData = JSON.parse(localStorage.getItem('monjizSales')) || [];
                    const invoicesData = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                    customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];

                    // ุฏูุฌ ุงูุจูุงูุงุช ูู ุงูููุชุงุญูู
                    salesData = [...salesData, ...invoicesData];

                    // ุฅุฒุงูุฉ ุงูููุฑุฑุงุช
                    salesData = salesData.filter((sale, index, self) =>
                        index === self.findIndex(s => s.id === sale.id)
                    );

                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู localStorage:', salesData.length, 'ูุงุชูุฑุฉุ', customersData.length, 'ุนููู');
                }

                // ุงุณุชุฎุฏุงู ุงูููุฏ ุงูุฃุตูู ููุนุงูุฌุฉ ุงูุชุงุฑูุฎ ูุน ุฅุตูุงุญ ุงูุจูุงูุงุช ููุท
                console.log('๐ ูุทุงู ุงูุชุงุฑูุฎ ุงููุณุชูู:', dateRange);

                // ููุชุฑุฉ ุงููุจูุนุงุช ุญุณุจ ุงูุชุงุฑูุฎ ุฅุฐุง ุชู ุชุญุฏูุฏู
                let filteredSales = salesData;
                let dateInfo = '';

                if (dateRange && dateRange.from && dateRange.to) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', dateRange);
                    const fromDate = new Date(dateRange.from);
                    const toDate = new Date(dateRange.to);
                    toDate.setHours(23, 59, 59, 999); // ููุงูุฉ ุงูููู

                    filteredSales = salesData.filter(sale => {
                        if (!sale.date && !sale.createdAt) return false;

                        let saleDate;
                        if (sale.createdAt) {
                            saleDate = new Date(sale.createdAt);
                        } else if (sale.date) {
                            // ูุญุงููุฉ ุชุญููู ุงูุชุงุฑูุฎ ุจุชูุณููุงุช ูุฎุชููุฉ
                            if (sale.date.includes('/')) {
                                // ุชูุณูู DD/MM/YYYY
                                const parts = sale.date.split('/');
                                if (parts.length === 3) {
                                    saleDate = new Date(parts[2], parts[1] - 1, parts[0]);
                                }
                            } else {
                                saleDate = new Date(sale.date);
                            }
                        }

                        return saleDate && saleDate >= fromDate && saleDate <= toDate;
                    });

                    dateInfo = `${fromDate.toLocaleDateString('ar-EG')} - ${toDate.toLocaleDateString('ar-EG')}`;
                    console.log('๐ ุงููุจูุนุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', filteredSales.length, 'ูุงุชูุฑุฉ');
                } else {
                    // ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุชุงุฑูุฎุ ุงุณุชุฎุฏู ุงูููู ุงูุญุงูู
                    const today = new Date();
                    const todayStr = today.toISOString().split('T')[0];
                    const todayDDMMYYYY = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;

                    filteredSales = salesData.filter(sale => {
                        if (!sale.date && !sale.createdAt) return false;

                        if (sale.date) {
                            // ุชุญูู ูู ุชูุณููุงุช ูุฎุชููุฉ
                            if (sale.date === todayDDMMYYYY || sale.date === todayStr) {
                                return true;
                            }

                            // ูุญุงููุฉ ุชุญููู ููุงุฑู
                            try {
                                const saleDate = new Date(sale.date);
                                const saleDateStr = saleDate.toISOString().split('T')[0];
                                return saleDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        if (sale.createdAt) {
                            try {
                                const createdDate = new Date(sale.createdAt);
                                const createdDateStr = createdDate.toISOString().split('T')[0];
                                return createdDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        return false;
                    });

                    dateInfo = today.toLocaleDateString('ar-EG');
                    console.log('๐ ูุจูุนุงุช ุงูููู (ุงูุชุฑุงุถู):', filteredSales.length, 'ูุงุชูุฑุฉ');
                }



                // ุชุทุจูู ููุชุฑ ุทุฑููุฉ ุงูุฏูุน ุฅุฐุง ูุฌุฏ
                if (filters.account && filters.account !== '') {
                    const paymentMethodMap = {
                        'ููุฏุงู': ['cash', 'ููุฏุงู', 'ููุฏู'],
                        'ุจุทุงูุฉ ุงุฆุชูุงู': ['card', 'ุจุทุงูุฉ ุงุฆุชูุงู', 'ุจุทุงูุฉ'],
                        'ุชุญููู ุจููู': ['bank', 'ุชุญููู ุจููู', 'ุชุญููู'],
                        'ุขุฌู': ['credit', 'ุขุฌู', 'ุฃุฌู']
                    };

                    const allowedMethods = paymentMethodMap[filters.account] || [filters.account];
                    filteredSales = filteredSales.filter(sale =>
                        allowedMethods.includes(sale.paymentMethod)
                    );
                    console.log('๐ณ ูุจูุนุงุช ุงูููู ุจุนุฏ ููุชุฑ ุทุฑููุฉ ุงูุฏูุน:', filteredSales.length);
                }

                // ุชุญููู ุงูุจูุงูุงุช ุฅูู ุชูุณูู ุงูุชูุฑูุฑ
                const dailyInvoices = filteredSales.map(sale => {
                    // ุงูุจุญุซ ุนู ุงุณู ุงูุนููู
                    let customerName = sale.customerName || sale.customer || 'ุนููู ุบูุฑ ูุญุฏุฏ';
                    if (sale.customerId) {
                        const customer = customersData.find(c => c.id == sale.customerId);
                        if (customer) {
                            customerName = customer.name;
                        }
                    }

                    // ุชุญููู ุทุฑููุฉ ุงูุฏูุน ููุนุฑุจูุฉ
                    const paymentMethodMap = {
                        'cash': 'ููุฏุงู',
                        'card': 'ุจุทุงูุฉ ุงุฆุชูุงู',
                        'bank': 'ุชุญููู ุจููู',
                        'credit': 'ุขุฌู'
                    };
                    const paymentMethod = paymentMethodMap[sale.paymentMethod] || sale.paymentMethod || 'ุบูุฑ ูุญุฏุฏ';

                    // ุงุณุชุฎุฑุงุฌ ุงูููุช ูู ุงูุชุงุฑูุฎ
                    let time = 'ุบูุฑ ูุญุฏุฏ';
                    if (sale.createdAt) {
                        const date = new Date(sale.createdAt);
                        time = date.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
                    }

                    // ุชุญุฏูุฏ ุงูุญุงูุฉ
                    const statusMap = {
                        'completed': 'ูุฏููุนุฉ',
                        'paid': 'ูุฏููุนุฉ',
                        'pending': 'ูุนููุฉ',
                        'cancelled': 'ููุบูุฉ'
                    };
                    const status = statusMap[sale.status] || 'ูุฏููุนุฉ';

                    return {
                        id: sale.id,
                        customer: customerName,
                        amount: parseFloat(sale.total) || 0,
                        method: paymentMethod,
                        time: time,
                        status: status
                    };
                });

                // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                const totalAmount = dailyInvoices.reduce((sum, invoice) => sum + invoice.amount, 0);
                const totalInvoices = dailyInvoices.length;
                const averageInvoice = totalInvoices > 0 ? totalAmount / totalInvoices : 0;
                const paidInvoices = dailyInvoices.filter(inv => inv.status === 'ูุฏููุนุฉ').length;
                const pendingInvoices = dailyInvoices.filter(inv => inv.status === 'ูุนููุฉ').length;

                // ุฅูุดุงุก ุจูุงูุงุช ุงูุชูุฑูุฑ
                const reportData = {
                    total: totalAmount,
                    invoices: totalInvoices,
                    average: averageInvoice,
                    paid: paidInvoices,
                    pending: pendingInvoices,
                    rawData: dailyInvoices,
                    date: dateInfo, // ุงุณุชุฎุฏุงู ุงูุชุงุฑูุฎ ุงููุญุณูุจ ูู ุงูููุชุฑุฉ
                    filterInfo: filters.account ? ` - ุทุฑููุฉ ุงูุฏูุน: ${filters.account}` : ''
                };

                console.log('๐ ุฅุญุตุงุฆูุงุช ุงูุชูุฑูุฑ:', reportData);

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ุฅุฌูุงูู ุงููุจูุนุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.total)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุนุฏุฏ ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.invoices}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ูุชูุณุท ุงููุงุชูุฑุฉ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.average)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">โ ููุงุชูุฑ ูุฏููุนุฉ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.paid}</div>
                            </div>
                            ${reportData.pending > 0 ? `
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">โณ ููุงุชูุฑ ูุนููุฉ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.pending}</div>
                            </div>
                            ` : ''}
                        </div>

                        <!-- ุฌุฏูู ุชูุงุตูู ุงูููุงุชูุฑ -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #28a745; padding-bottom: 10px;">
                                ๐ ุชูุงุตูู ููุงุชูุฑ ${dateRange && dateRange.from ? 'ุงููุชุฑุฉ' : 'ุงูููู'} - ${reportData.date}${reportData.filterInfo}
                            </h3>

                            ${reportData.rawData && reportData.rawData.length > 0 ? `
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูุนููู</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงููุจูุบ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุทุฑููุฉ ุงูุฏูุน</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูููุช</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${reportData.rawData.map((invoice, index) => {
                                                const isEven = index % 2 === 0;


                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${invoice.id}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${invoice.customer}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(invoice.amount)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${invoice.method}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057; font-size: 0.9em;">${invoice.time}</td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                            <!-- ุตู ุงูุฅุฌูุงูู -->
                                            <tr style="background: linear-gradient(135deg, #28a745, #20c997); color: white; font-weight: bold;">
                                                <td colspan="2" style="padding: 16px 12px; text-align: center; font-size: 1.1em;">ุงูุฅุฌูุงูู</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.2em;">${formatCurrency(reportData.total)}</td>
                                                <td colspan="2" style="padding: 16px 12px; text-align: center;">${reportData.invoices} ูุงุชูุฑุฉ</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            ` : `
                                <div style="text-align: center; padding: 40px; color: #666;">
                                    <i class="fas fa-receipt" style="font-size: 3em; margin-bottom: 15px; opacity: 0.3;"></i>
                                    <br>ูุง ุชูุฌุฏ ููุงุชูุฑ ูุจูุนุงุช ุงูููู
                                    <div style="margin-top: 20px;">
                                        <a href="sales.html" style="background: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-weight: 600;">
                                            <i class="fas fa-plus"></i> ุฅุถุงูุฉ ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
                                        </a>
                                    </div>
                                </div>
                            `}
                        </div>

                        <!-- ูุนูููุงุช ุฅุถุงููุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #28a745;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ ููุฎุต ${dateRange && dateRange.from ? 'ุงูุชุงุฑูุฎ ุงููุญุฏุฏ' : 'ุงูููู'}</h4>
                                <div style="color: #495057; line-height: 1.6;">
                                    <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุจูุนุงุช: <strong style="color: #28a745;">${formatCurrency(reportData.total)}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูููุงุชูุฑ: <strong>${reportData.invoices}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ูุชูุณุท ุงููุงุชูุฑุฉ: <strong style="color: #667eea;">${formatCurrency(reportData.average)}</strong></div>
                                    <div>โข ูุนุฏู ุงูุฅูุฌุงุฒ: <strong style="color: #28a745;">${reportData.invoices > 0 ? ((reportData.paid / reportData.invoices) * 100).toFixed(1) : '0'}%</strong></div>
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #17a2b8;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">โฐ ุชูุฒูุน ุงููุจูุนุงุช</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    ${reportData.rawData.length > 0 ? `
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงูุตุจุงุญูุฉ: ${reportData.rawData.filter(inv => {
                                            const hour = inv.time.includes(':') ? parseInt(inv.time.split(':')[0]) : 0;
                                            return hour < 12;
                                        }).length} ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ูุชุฑุฉ ุงูุธููุฑุฉ: ${reportData.rawData.filter(inv => {
                                            const hour = inv.time.includes(':') ? parseInt(inv.time.split(':')[0]) : 0;
                                            return hour >= 12 && hour < 17;
                                        }).length} ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงููุณุงุฆูุฉ: ${reportData.rawData.filter(inv => {
                                            const hour = inv.time.includes(':') ? parseInt(inv.time.split(':')[0]) : 0;
                                            return hour >= 17;
                                        }).length} ูุงุชูุฑุฉ</div>
                                        <div>โข ุฃุนูู ูุจูุนุงุช: <strong style="color: #28a745;">${formatCurrency(Math.max(...reportData.rawData.map(inv => inv.amount)))}</strong></div>
                                    ` : `
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงูุตุจุงุญูุฉ: 0 ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ูุชุฑุฉ ุงูุธููุฑุฉ: 0 ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงููุณุงุฆูุฉ: 0 ูุงุชูุฑุฉ</div>
                                        <div>โข ุฃุนูู ูุจูุนุงุช: <strong style="color: #28a745;">0 ุฑ.ุณ</strong></div>
                                    `}
                                </div>
                            </div>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุชุตุฏูุฑ -->
                        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                            <button onclick="printReport()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(108, 117, 125, 0.3)'">
                                <i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ
                            </button>
                            <button onclick="exportToExcel('daily-sales')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                                <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="exportToPDF('daily-sales')" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(220, 53, 69, 0.3)'">
                                <i class="fas fa-file-pdf"></i> ุชุตุฏูุฑ PDF
                            </button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ:', error);
                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 40px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center;">
                        <div style="color: #dc3545; margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 15px;"></i>
                            <h3>ุฎุทุฃ ูู ุชุญููู ุงูุชูุฑูุฑ</h3>
                            <p>ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.</p>
                        </div>
                        <button onclick="location.reload()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                        </button>
                    </div>
                `;
            }
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ูุงุฆูุฉ ุงูุนููุงุก
        function createCustomerListReport(dateRange, filters = {}) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ูุงุฆูุฉ ุงูุนููุงุก...', { dateRange, filters });

            // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ุงููุธุงู ุงููุฑูุฒู
            let customersData = [];
            if (window.dataManager) {
                customersData = window.dataManager.getCustomers();
                console.log('โ ุชู ุฌูุจ', customersData.length, 'ุนููู ูู ุงููุธุงู ุงููุฑูุฒู');
            } else {
                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                console.log('๐ฆ ุชู ุฌูุจ', customersData.length, 'ุนููู ูู localStorage');
            }

            // ุชุทุจูู ููุชุฑ ุงูุนููู ุงููุญุฏุฏ ุฅุฐุง ูุฌุฏ
            if (filters.account && filters.account !== '') {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูุนููู:', filters.account);
                customersData = customersData.filter(customer => {
                    return String(customer.id) === String(filters.account) ||
                           customer.name === filters.account ||
                           customer.name.includes(filters.account);
                });
                console.log('๐ ุงูุนููุงุก ุจุนุฏ ุงูููุชุฑ:', customersData.length);
            }

            // ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ (ุงูุนููุงุก ุงููุถุงููู ูู ูุชุฑุฉ ูุนููุฉ)
            if (dateRange && dateRange.from && dateRange.to) {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', dateRange);
                const fromDate = new Date(dateRange.from);
                const toDate = new Date(dateRange.to);
                toDate.setHours(23, 59, 59, 999);

                customersData = customersData.filter(customer => {
                    if (!customer.createdAt && !customer.dateAdded) return true; // ุฅุฐุง ูู ููู ููุงู ุชุงุฑูุฎุ ุงุนุฑุถ ุงูุนููู

                    let customerDate;
                    if (customer.createdAt) {
                        customerDate = new Date(customer.createdAt);
                    } else if (customer.dateAdded) {
                        customerDate = new Date(customer.dateAdded);
                    }

                    return customerDate && customerDate >= fromDate && customerDate <= toDate;
                });

                console.log('๐ ุงูุนููุงุก ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', customersData.length);
            }

            // ุฅุญุตุงุฆูุงุช ุงูุนููุงุก
            const totalCustomers = customersData.length;
            const activeCustomers = customersData.filter(c => c.status === 'active' || !c.status).length;
            const individualCustomers = customersData.filter(c => c.type === 'individual').length;
            const companyCustomers = customersData.filter(c => c.type === 'company').length;

            // ุจูุงุก ุตููู ุงูุฌุฏูู
            let tableRows = '';
            if (customersData.length > 0) {
                customersData.forEach((customer, index) => {
                    const customerType = customer.type === 'company' ? 'ุดุฑูุฉ' : 'ูุฑุฏ';
                    const customerStatus = customer.status === 'active' || !customer.status ? 'ูุดุท' : 'ุบูุฑ ูุดุท';
                    const customerBalance = formatNumber(customer.balance);
                    const balanceClass = parseFloat(customerBalance) >= 0 ? 'positive' : 'negative';
                    const statusClass = customer.status === 'active' || !customer.status ? 'status-paid' : 'status-pending';

                    tableRows += `
                        <tr>
                            <td>${index + 1}</td>
                            <td><strong>${customer.name || 'ุบูุฑ ูุญุฏุฏ'}</strong></td>
                            <td>${customerType}</td>
                            <td>${customer.phone || 'ุบูุฑ ูุญุฏุฏ'}</td>
                            <td>${customer.email || 'ุบูุฑ ูุญุฏุฏ'}</td>
                            <td>${customer.address || 'ุบูุฑ ูุญุฏุฏ'}</td>
                            <td><span class="${balanceClass}">${customerBalance} ุฑ.ุณ</span></td>
                            <td><span class="${statusClass}">${customerStatus}</span></td>
                        </tr>
                    `;
                });
            } else {
                tableRows = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-users" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                            <br>ูุง ุชูุฌุฏ ุนููุงุก ูุณุฌููู ูู ุงููุธุงู
                        </td>
                    </tr>
                `;
            }

            return `
                <div class="report-container">
                    <div class="report-header">
                        <p>ุชุงุฑูุฎ ุงูุชูุฑูุฑ: ${formatDateGregorian(new Date())}</p>
                    </div>
                    <div class="report-content">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th><i class="fas fa-user"></i> ุงุณู ุงูุนููู</th>
                                    <th><i class="fas fa-tag"></i> ุงูููุน</th>
                                    <th><i class="fas fa-phone"></i> ุงููุงุชู</th>
                                    <th><i class="fas fa-envelope"></i> ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
                                    <th><i class="fas fa-map-marker-alt"></i> ุงูุนููุงู</th>
                                    <th><i class="fas fa-money-bill-wave"></i> ุงูุฑุตูุฏ</th>
                                    <th><i class="fas fa-info-circle"></i> ุงูุญุงูุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                    <div class="report-actions">
                        <button onclick="window.print()" class="btn-print">ุทุจุงุนุฉ</button>
                        <button onclick="exportToExcel('customer-list')" class="btn-excel">ุชุตุฏูุฑ Excel</button>
                        <button onclick="exportToPDF('customer-list')" class="btn-pdf">ุชุตุฏูุฑ PDF</button>
                    </div>
                </div>

                <style>
                .card-icon {
                    font-size: 1.5rem;
                    margin-bottom: 8px;
                    color: #007bff;
                }
                .card-content h4 {
                    margin: 0 0 8px 0;
                    font-size: 0.9rem;
                    color: #666;
                }
                .card-content .count {
                    margin: 0;
                    font-size: 1.8rem;
                    font-weight: bold;
                    color: #333;
                }
                .positive {
                    color: #28a745;
                    font-weight: 600;
                }
                .negative {
                    color: #dc3545;
                    font-weight: 600;
                }
                .status-paid {
                    background-color: #d4edda;
                    color: #155724;
                    padding: 4px 12px;
                    border-radius: 20px;
                    font-size: 0.85rem;
                    font-weight: 600;
                }
                .status-pending {
                    background-color: #f8d7da;
                    color: #721c24;
                    padding: 4px 12px;
                    border-radius: 20px;
                    font-size: 0.85rem;
                    font-weight: 600;
                }
                </style>
            `;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุฃุฑุตุฏุฉ ุงูุนููุงุก
        function createCustomerBalancesReport(dateRange, filters = {}) {
            console.log('๐ฐ ุฅูุดุงุก ุชูุฑูุฑ ุฃุฑุตุฏุฉ ุงูุนููุงุก...', { dateRange, filters });

            // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุนููุงุก ูุงููุจูุนุงุช
            let customersData = [];
            let salesData = [];

            if (window.dataManager) {
                customersData = window.dataManager.getCustomers();
                salesData = window.dataManager.getSales();
            } else {
                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                salesData = JSON.parse(localStorage.getItem('monjizSales')) ||
                           JSON.parse(localStorage.getItem('monjizInvoices')) || [];
            }

            // ุฅุฒุงูุฉ ุงูุนููุงุก ุงูููุฑุฑูู ูู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
            const uniqueCustomersMap = new Map();
            customersData.forEach(customer => {
                if (customer && customer.name) {
                    const customerKey = `${customer.name.trim()}_${customer.phone || 'no-phone'}`;
                    if (!uniqueCustomersMap.has(customerKey)) {
                        uniqueCustomersMap.set(customerKey, customer);
                    }
                }
            });
            customersData = Array.from(uniqueCustomersMap.values());

            console.log('๐ฅ ุจูุงูุงุช ุงูุนููุงุก (ุจุนุฏ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ):', customersData.length);
            console.log('๐ฐ ุจูุงูุงุช ุงููุจูุนุงุช:', salesData.length);

            // ุชุทุจูู ููุงุชุฑ ุงูุชุงุฑูุฎ
            let filteredSales = salesData;
            if (dateRange && dateRange.from && dateRange.to) {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', dateRange.from, 'ุฅูู', dateRange.to);
                const fromDate = new Date(dateRange.from);
                const toDate = new Date(dateRange.to);
                toDate.setHours(23, 59, 59, 999);

                filteredSales = salesData.filter(sale => {
                    let saleDate;
                    if (sale.createdAt) {
                        saleDate = new Date(sale.createdAt);
                    } else if (sale.date) {
                        if (sale.date && sale.date.includes && sale.date.includes('/')) {
                            const parts = sale.date.split('/');
                            if (parts.length === 3) {
                                saleDate = new Date(`${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`);
                            } else {
                                saleDate = new Date(sale.date);
                            }
                        } else {
                            saleDate = new Date(sale.date);
                        }
                    }
                    return saleDate && !isNaN(saleDate.getTime()) && saleDate >= fromDate && saleDate <= toDate;
                });
                console.log('๐ ุงููุจูุนุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', filteredSales.length);
            } else {
                console.log('๐ ูู ูุชู ุชุญุฏูุฏ ููุชุฑ ุชุงุฑูุฎุ ุณูุชู ุนุฑุถ ุฌููุน ุงููุจูุนุงุช');
            }

            // ุชุทุจูู ููุชุฑ ุงูุนููู ุงููุญุฏุฏ
            if (filters.account && filters.account !== '') {
                const selectedCustomer = customersData.find(c => c.id == filters.account || c.name === filters.account);
                if (selectedCustomer) {
                    customersData = [selectedCustomer];
                    console.log('๐ค ุชู ุชุญุฏูุฏ ุนููู ูุงุญุฏ:', selectedCustomer.name);
                }
            }

            // ุญุณุงุจ ุฃุฑุตุฏุฉ ุงูุนููุงุก ุงูููุตูุฉ
            const customerBalances = customersData.map(customer => {
                const customerSales = filteredSales.filter(sale =>
                    sale.customerId === customer.id ||
                    sale.customerName === customer.name
                );

                // ุญุณุงุจ ุฅุฌูุงูู ุงููุจูุนุงุช
                const totalSales = customerSales.reduce((sum, sale) => sum + (parseFloat(sale.total) || 0), 0);
                const totalInvoices = customerSales.length;

                // ุญุณุงุจ ุงููุฏููุนุงุช (ุงูููุงุชูุฑ ุงููุฏููุนุฉ)
                const paidSales = customerSales.filter(sale =>
                    sale.status === 'paid' || sale.paymentStatus === 'paid' || sale.paymentMethod === 'ููุฏุงู'
                );
                const totalPaid = paidSales.reduce((sum, sale) => sum + (parseFloat(sale.total) || 0), 0);

                // ุญุณุงุจ ุงููุจุงูุบ ุงููุณุชุญูุฉ (ุบูุฑ ุงููุฏููุนุฉ)
                const unpaidSales = customerSales.filter(sale =>
                    sale.status === 'pending' || sale.paymentStatus === 'pending' || sale.paymentMethod === 'ุขุฌู'
                );
                const totalDue = unpaidSales.reduce((sum, sale) => sum + (parseFloat(sale.total) || 0), 0);

                // ุงูุฑุตูุฏ ุงูููุงุฆู (ุงููุจูุบ ุงููุณุชุญู ูู ุงูุนููู)
                const balance = totalSales - totalPaid;

                // ุขุฎุฑ ุนูููุฉ ุดุฑุงุก
                const lastSale = customerSales.length > 0 ?
                    customerSales.sort((a, b) => new Date(b.date || b.createdAt) - new Date(a.date || a.createdAt))[0] : null;

                // ุญุงูุฉ ุงูุนููู
                let customerStatus = 'ูุดุท';
                if (balance > 1000) {
                    customerStatus = 'ูุฏููู';
                } else if (balance < 0) {
                    customerStatus = 'ุฏุงุฆู';
                } else if (totalInvoices === 0) {
                    customerStatus = 'ุบูุฑ ูุดุท';
                }

                return {
                    ...customer,
                    totalSales,
                    totalPaid,
                    totalDue,
                    balance,
                    totalInvoices,
                    lastSaleDate: lastSale ? (lastSale.date || lastSale.createdAt) : 'ูุง ุชูุฌุฏ ูุจูุนุงุช',
                    averageSale: totalInvoices > 0 ? totalSales / totalInvoices : 0,
                    customerStatus
                };
            });

            // ุชุทุจูู ููุชุฑ ุงูุนููู ุงููุญุฏุฏ ุนูู ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ
            let finalCustomerBalances = customerBalances;
            if (filters.account && filters.account !== '') {
                finalCustomerBalances = customerBalances.filter(customer =>
                    customer.id == filters.account || customer.name === filters.account
                );
                console.log('๐ค ุชู ุชุตููุฉ ุงูุนููุงุก ููุนููู ุงููุญุฏุฏ:', finalCustomerBalances.length);
            }

            // ุชุฑุชูุจ ุงูุนููุงุก ุญุณุจ ุงูุฑุตูุฏ (ุงูุฃูุซุฑ ุงุณุชุญูุงูุงู ุฃููุงู)
            finalCustomerBalances.sort((a, b) => b.balance - a.balance);

            // ุจูุงุก ุตููู ุงูุฌุฏูู
            let tableRows = '';
            let totalAllSales = 0;
            let totalAllPaid = 0;
            let totalAllDue = 0;
            let totalAllBalance = 0;

            if (finalCustomerBalances.length > 0) {
                finalCustomerBalances.forEach((customer, index) => {
                    totalAllSales += customer.totalSales;
                    totalAllPaid += customer.totalPaid;
                    totalAllDue += customer.totalDue;
                    totalAllBalance += customer.balance;

                    // ุชุญุฏูุฏ ููู ุงูุฑุตูุฏ
                    let balanceClass = '';
                    let balanceIcon = '';
                    if (customer.balance > 0) {
                        balanceClass = 'text-danger'; // ุฃุญูุฑ ูููุฏููู
                        balanceIcon = 'โ๏ธ';
                    } else if (customer.balance < 0) {
                        balanceClass = 'text-success'; // ุฃุฎุถุฑ ููุฏุงุฆู
                        balanceIcon = 'โ';
                    } else {
                        balanceClass = 'text-muted'; // ุฑูุงุฏู ูููุชูุงุฒู
                        balanceIcon = 'โ';
                    }

                    // ุชุญุฏูุฏ ููู ุญุงูุฉ ุงูุนููู
                    let statusClass = '';
                    switch (customer.customerStatus) {
                        case 'ูุฏููู': statusClass = 'status-warning'; break;
                        case 'ุฏุงุฆู': statusClass = 'status-success'; break;
                        case 'ูุดุท': statusClass = 'status-good'; break;
                        default: statusClass = 'status-inactive'; break;
                    }

                    tableRows += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 6px; text-align: center;">${index + 1}</td>
                            <td style="padding: 6px;">
                                <strong style="font-size: 13px;">${customer.name}</strong>
                                ${customer.phone ? `<br><small style="color: #666; font-size: 11px;">${customer.phone}</small>` : ''}
                            </td>
                            <td style="padding: 6px; text-align: right; font-weight: 500;">${formatNumber(customer.totalSales)}</td>
                            <td style="padding: 6px; text-align: right; color: #28a745;">${formatNumber(customer.totalPaid)}</td>
                            <td style="padding: 6px; text-align: right;" class="${balanceClass}">
                                <span style="font-size: 12px;">${balanceIcon}</span> ${formatNumber(Math.abs(customer.balance))}
                            </td>
                            <td style="padding: 6px; text-align: center;">${customer.totalInvoices}</td>
                            <td style="padding: 6px; text-align: right;">${formatNumber(customer.averageSale)}</td>
                            <td style="padding: 6px; text-align: center;">
                                <span class="badge ${statusClass}" style="font-size: 10px; padding: 2px 6px;">${customer.customerStatus}</span>
                            </td>
                            <td style="padding: 6px; text-align: center; font-size: 11px; color: #666;">
                                ${customer.lastSaleDate !== 'ูุง ุชูุฌุฏ ูุจูุนุงุช' ? new Date(customer.lastSaleDate).toLocaleDateString('ar') : customer.lastSaleDate}
                            </td>
                        </tr>
                    `;
                });

                // ุตู ุงูุฅุฌูุงูู
                const totalBalanceClass = totalAllBalance > 0 ? 'color: #dc3545' : totalAllBalance < 0 ? 'color: #28a745' : 'color: #6c757d';
                tableRows += `
                    <tr style="background-color: #f8f9fa; font-weight: bold; border-top: 2px solid #dee2e6;">
                        <td colspan="2" style="padding: 8px;"><strong>ุงูุฅุฌูุงูู</strong></td>
                        <td style="padding: 8px; text-align: right;"><strong>${formatNumber(totalAllSales)}</strong></td>
                        <td style="padding: 8px; text-align: right; color: #28a745;"><strong>${formatNumber(totalAllPaid)}</strong></td>
                        <td style="padding: 8px; text-align: right; ${totalBalanceClass}"><strong>${formatNumber(Math.abs(totalAllBalance))}</strong></td>
                        <td colspan="4" style="padding: 8px;"></td>
                    </tr>
                `;
            } else {
                const noDataMessage = filters.account && filters.account !== '' ?
                    'ูุง ุชูุฌุฏ ุจูุงูุงุช ููุนููู ุงููุญุฏุฏ ูู ุงููุชุฑุฉ ุงููุฎุชุงุฑุฉ' :
                    'ูุง ุชูุฌุฏ ุจูุงูุงุช ุนููุงุก';
                tableRows = `<tr><td colspan="9" style="text-align: center; padding: 20px; color: #666;">${noDataMessage}</td></tr>`;
            }

            return `
                <div class="report-container" style="padding: 0; margin: 0;">
                    <div class="report-content">
                        <!-- ุงูุฌุฏูู ุงูููุตู -->
                        <div class="table-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0; font-size: 16px; color: #333;">๐ ุชูุงุตูู ุงูุฃุฑุตุฏุฉ</h3>
                                <div style="font-size: 12px; color: #666;">
                                    <span><strong>ุงููุชุฑุฉ:</strong> ${dateRange}</span> |
                                    <span>ุชุงุฑูุฎ ุงูุฅูุดุงุก: ${new Date().toLocaleDateString('ar')}</span>
                                </div>
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="report-table enhanced" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">#</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุงูุนููู</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุฅุฌูุงูู ุงููุจูุนุงุช</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุงููุฏููุน</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุงููุณุชุญู</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูููุงุชูุฑ</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูุญุงูุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุขุฎุฑ ุดุฑุงุก</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${tableRows}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="report-actions" style="margin-top: 15px; text-align: center;">
                        <button onclick="window.print()" class="btn-print" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ ุทุจุงุนุฉ
                        </button>
                        <button onclick="exportToExcel('customer-balances')" class="btn-excel" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ Excel
                        </button>
                        <button onclick="exportToPDF('customer-balances')" class="btn-pdf" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุชุญููู ุงูุนููุงุก
        function createCustomerAnalysisReport(dateRange, filters = {}) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ุชุญููู ุงูุนููุงุก...', { dateRange, filters });

            // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุนููุงุก ูุงููุจูุนุงุช
            let customersData = [];
            let salesData = [];

            if (window.dataManager) {
                customersData = window.dataManager.getCustomers();
                salesData = window.dataManager.getSales();
            } else {
                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                salesData = JSON.parse(localStorage.getItem('monjizSales')) ||
                           JSON.parse(localStorage.getItem('monjizInvoices')) || [];
            }

            // ุฅุฒุงูุฉ ุงูุนููุงุก ุงูููุฑุฑูู ูู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
            const uniqueCustomersMap = new Map();
            customersData.forEach(customer => {
                if (customer && customer.name) {
                    const customerKey = `${customer.name.trim()}_${customer.phone || 'no-phone'}`;
                    if (!uniqueCustomersMap.has(customerKey)) {
                        uniqueCustomersMap.set(customerKey, customer);
                    }
                }
            });
            customersData = Array.from(uniqueCustomersMap.values());

            console.log('๐ฅ ุจูุงูุงุช ุงูุนููุงุก (ุจุนุฏ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ):', customersData.length);
            console.log('๐ฐ ุจูุงูุงุช ุงููุจูุนุงุช:', salesData.length);

            // ุชุทุจูู ููุงุชุฑ ุงูุชุงุฑูุฎ
            let filteredSales = salesData;
            if (filters.dateFrom && filters.dateTo) {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', filters.dateFrom, 'ุฅูู', filters.dateTo);
                const fromDate = new Date(filters.dateFrom);
                const toDate = new Date(filters.dateTo);
                toDate.setHours(23, 59, 59, 999);

                filteredSales = salesData.filter(sale => {
                    let saleDate;
                    if (sale.createdAt) {
                        saleDate = new Date(sale.createdAt);
                    } else if (sale.date) {
                        if (sale.date && sale.date.includes && sale.date.includes('/')) {
                            const parts = sale.date.split('/');
                            if (parts.length === 3) {
                                saleDate = new Date(`${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`);
                            } else {
                                saleDate = new Date(sale.date);
                            }
                        } else {
                            saleDate = new Date(sale.date);
                        }
                    }
                    return saleDate && !isNaN(saleDate.getTime()) && saleDate >= fromDate && saleDate <= toDate;
                });
                console.log('๐ ุงููุจูุนุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', filteredSales.length);
            }

            // ุชุทุจูู ููุชุฑ ุงูุนููู ุงููุญุฏุฏ
            let finalCustomersData = customersData;
            if (filters.account && filters.account !== '') {
                console.log('๐ ุงูุจุญุซ ุนู ุงูุนููู ุงููุญุฏุฏ:', filters.account);

                // ุงูุจุญุซ ุจุทุฑู ูุชุนุฏุฏุฉ ููุชุฃูุฏ ูู ุงูุฏูุฉ
                const selectedCustomer = customersData.find(c =>
                    c.id == filters.account ||
                    c.id === filters.account ||
                    c.name === filters.account ||
                    String(c.id) === String(filters.account)
                );

                if (selectedCustomer) {
                    finalCustomersData = [selectedCustomer];
                    console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุงูุนููู:', selectedCustomer.name, 'ID:', selectedCustomer.id);
                } else {
                    console.log('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนููู ุงููุญุฏุฏ:', filters.account);
                    console.log('๐ ุงูุนููุงุก ุงููุชุงุญูู:', customersData.map(c => ({ id: c.id, name: c.name })));
                }
            }

            // ุชุญููู ุงูุนููุงุก ุงูููุตู
            const customerAnalysis = finalCustomersData.map(customer => {
                const customerSales = filteredSales.filter(sale => {
                    // ููุงุฑูุฉ ุฏูููุฉ ููุนููู
                    return (
                        sale.customerId == customer.id ||
                        sale.customerId === customer.id ||
                        String(sale.customerId) === String(customer.id) ||
                        sale.customerName === customer.name ||
                        (sale.customerName && sale.customerName.trim() === customer.name.trim())
                    );
                });

                console.log(`๐ ุงูุนููู ${customer.name}: ${customerSales.length} ูุงุชูุฑุฉ`);

                // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                const totalSales = customerSales.reduce((sum, sale) => sum + (parseFloat(sale.total) || 0), 0);
                const totalInvoices = customerSales.length;
                const avgInvoiceValue = totalInvoices > 0 ? totalSales / totalInvoices : 0;

                // ุชุญููู ุงููุชุฑุงุช ุงูุฒูููุฉ
                const salesByMonth = {};
                customerSales.forEach(sale => {
                    const saleDate = new Date(sale.createdAt || sale.date);
                    if (!isNaN(saleDate.getTime())) {
                        const monthKey = `${saleDate.getFullYear()}-${(saleDate.getMonth() + 1).toString().padStart(2, '0')}`;
                        if (!salesByMonth[monthKey]) {
                            salesByMonth[monthKey] = { count: 0, total: 0 };
                        }
                        salesByMonth[monthKey].count++;
                        salesByMonth[monthKey].total += (parseFloat(sale.total) || 0);
                    }
                });

                // ุขุฎุฑ ุนูููุฉ ุดุฑุงุก
                const lastSale = customerSales.length > 0 ?
                    customerSales.sort((a, b) => new Date(b.date || b.createdAt) - new Date(a.date || a.createdAt))[0] : null;

                // ุชุตููู ุงูุนููู
                let customerCategory = 'ุฌุฏูุฏ';
                if (totalSales > 10000) {
                    customerCategory = 'VIP';
                } else if (totalSales > 5000) {
                    customerCategory = 'ุฐูุจู';
                } else if (totalSales > 1000) {
                    customerCategory = 'ูุถู';
                } else if (totalInvoices > 0) {
                    customerCategory = 'ุนุงุฏู';
                }

                // ูุนุฏู ุงูุชูุฑุงุฑ (ุนุฏุฏ ุงูุฃุดูุฑ ุงููุดุทุฉ)
                const activeMonths = Object.keys(salesByMonth).length;
                const frequency = activeMonths > 0 ? totalInvoices / activeMonths : 0;

                return {
                    ...customer,
                    totalSales,
                    totalInvoices,
                    avgInvoiceValue,
                    activeMonths,
                    frequency: frequency.toFixed(1),
                    lastSaleDate: lastSale ? (lastSale.date || lastSale.createdAt) : 'ูุง ุชูุฌุฏ ูุจูุนุงุช',
                    customerCategory,
                    salesByMonth: Object.keys(salesByMonth).length
                };
            });

            // ุชุฑุชูุจ ุงูุนููุงุก ุญุณุจ ุฅุฌูุงูู ุงููุจูุนุงุช
            customerAnalysis.sort((a, b) => b.totalSales - a.totalSales);

            // ุจูุงุก ุตููู ุงูุฌุฏูู
            let tableRows = '';
            if (customerAnalysis.length > 0) {
                customerAnalysis.forEach((customer, index) => {
                    // ุชุญุฏูุฏ ููู ุงูุชุตููู
                    let categoryClass = '';
                    switch (customer.customerCategory) {
                        case 'VIP': categoryClass = 'badge status-success'; break;
                        case 'ุฐูุจู': categoryClass = 'badge status-warning'; break;
                        case 'ูุถู': categoryClass = 'badge status-good'; break;
                        case 'ุนุงุฏู': categoryClass = 'badge status-inactive'; break;
                        default: categoryClass = 'badge status-pending'; break;
                    }

                    tableRows += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 8px; text-align: center;">${index + 1}</td>
                            <td style="padding: 8px;">
                                <strong style="font-size: 14px;">${customer.name}</strong>
                                ${customer.phone ? `<br><small style="color: #666; font-size: 11px;">${customer.phone}</small>` : ''}
                            </td>
                            <td style="padding: 8px; text-align: right; font-weight: 500;">${formatNumber(customer.totalSales)}</td>
                            <td style="padding: 8px; text-align: center;">${customer.totalInvoices}</td>
                            <td style="padding: 8px; text-align: right;">${formatNumber(customer.avgInvoiceValue)}</td>
                            <td style="padding: 8px; text-align: center;">${customer.activeMonths}</td>
                            <td style="padding: 8px; text-align: center;">${customer.frequency}</td>
                            <td style="padding: 8px; text-align: center;">
                                <span class="${categoryClass}" style="font-size: 10px; padding: 2px 6px;">${customer.customerCategory}</span>
                            </td>
                            <td style="padding: 8px; text-align: center; font-size: 11px; color: #666;">
                                ${customer.lastSaleDate !== 'ูุง ุชูุฌุฏ ูุจูุนุงุช' ? new Date(customer.lastSaleDate).toLocaleDateString('ar') : customer.lastSaleDate}
                            </td>
                        </tr>
                    `;
                });
            } else {
                const noDataMessage = filters.account && filters.account !== '' ?
                    'ูุง ุชูุฌุฏ ุจูุงูุงุช ููุนููู ุงููุญุฏุฏ ูู ุงููุชุฑุฉ ุงููุฎุชุงุฑุฉ' :
                    'ูุง ุชูุฌุฏ ุจูุงูุงุช ุนููุงุก';
                tableRows = `<tr><td colspan="9" style="text-align: center; padding: 20px; color: #666;">${noDataMessage}</td></tr>`;
            }

            return `
                <div class="report-container">
                    <div class="report-content">
                        <!-- ุงูุฌุฏูู ุงูููุตู -->
                        <div class="table-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0; font-size: 16px; color: #333;">๐ ุชุญููู ุฃุฏุงุก ุงูุนููุงุก</h3>
                                <div style="font-size: 12px; color: #666;">
                                    <span><strong>ุงููุชุฑุฉ:</strong> ${dateRange}</span> |
                                    <span>ุชุงุฑูุฎ ุงูุฅูุดุงุก: ${new Date().toLocaleDateString('ar')}</span>
                                </div>
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="report-table enhanced" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">#</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุงูุนููู</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุฅุฌูุงูู ุงููุจูุนุงุช</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูุฃุดูุฑ ุงููุดุทุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ูุนุฏู ุงูุชูุฑุงุฑ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูุชุตููู</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุขุฎุฑ ุดุฑุงุก</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${tableRows}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="report-actions" style="margin-top: 15px; text-align: center;">
                        <button onclick="window.print()" class="btn-print" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ ุทุจุงุนุฉ
                        </button>
                        <button onclick="exportToExcel('customer-analysis')" class="btn-excel" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ Excel
                        </button>
                        <button onclick="exportToPDF('customer-analysis')" class="btn-pdf" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุฃุนูุงุฑ ุงูุฏููู
        function createCustomerAgingReport(dateRange, filters = {}) {
            console.log('โฐ ุฅูุดุงุก ุชูุฑูุฑ ุฃุนูุงุฑ ุงูุฏููู...', { dateRange, filters });

            // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุนููุงุก ูุงููุจูุนุงุช
            let customersData = [];
            let salesData = [];

            if (window.dataManager) {
                customersData = window.dataManager.getCustomers();
                salesData = window.dataManager.getSales();
            } else {
                customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                salesData = JSON.parse(localStorage.getItem('monjizSales')) ||
                           JSON.parse(localStorage.getItem('monjizInvoices')) || [];
            }

            // ุฅุฒุงูุฉ ุงูุนููุงุก ุงูููุฑุฑูู ูู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
            const uniqueCustomersMap = new Map();
            customersData.forEach(customer => {
                if (customer && customer.name) {
                    const customerKey = `${customer.name.trim()}_${customer.phone || 'no-phone'}`;
                    if (!uniqueCustomersMap.has(customerKey)) {
                        uniqueCustomersMap.set(customerKey, customer);
                    }
                }
            });
            customersData = Array.from(uniqueCustomersMap.values());

            console.log('๐ฅ ุจูุงูุงุช ุงูุนููุงุก (ุจุนุฏ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ):', customersData.length);
            console.log('๐ฐ ุจูุงูุงุช ุงููุจูุนุงุช:', salesData.length);

            // ุชุทุจูู ููุงุชุฑ ุงูุชุงุฑูุฎ
            let filteredSales = salesData;
            if (filters.dateFrom && filters.dateTo) {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', filters.dateFrom, 'ุฅูู', filters.dateTo);
                const fromDate = new Date(filters.dateFrom);
                const toDate = new Date(filters.dateTo);
                toDate.setHours(23, 59, 59, 999);

                filteredSales = salesData.filter(sale => {
                    let saleDate;
                    if (sale.createdAt) {
                        saleDate = new Date(sale.createdAt);
                    } else if (sale.date) {
                        if (sale.date && sale.date.includes && sale.date.includes('/')) {
                            const parts = sale.date.split('/');
                            if (parts.length === 3) {
                                saleDate = new Date(`${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`);
                            } else {
                                saleDate = new Date(sale.date);
                            }
                        } else {
                            saleDate = new Date(sale.date);
                        }
                    }
                    return saleDate && !isNaN(saleDate.getTime()) && saleDate >= fromDate && saleDate <= toDate;
                });
                console.log('๐ ุงููุจูุนุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', filteredSales.length);
            }

            // ุชุทุจูู ููุชุฑ ุงูุนููู ุงููุญุฏุฏ
            let finalCustomersData = customersData;
            if (filters.account && filters.account !== '') {
                console.log('๐ ุงูุจุญุซ ุนู ุงูุนููู ุงููุญุฏุฏ:', filters.account);

                const selectedCustomer = customersData.find(c =>
                    c.id == filters.account ||
                    c.id === filters.account ||
                    c.name === filters.account ||
                    String(c.id) === String(filters.account)
                );

                if (selectedCustomer) {
                    finalCustomersData = [selectedCustomer];
                    console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุงูุนููู:', selectedCustomer.name, 'ID:', selectedCustomer.id);
                } else {
                    console.log('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนููู ุงููุญุฏุฏ:', filters.account);
                }
            }

            // ุชุญููู ุฃุนูุงุฑ ุงูุฏููู
            const currentDate = new Date();
            const customerAging = finalCustomersData.map(customer => {
                const customerSales = filteredSales.filter(sale => {
                    return (
                        sale.customerId == customer.id ||
                        sale.customerId === customer.id ||
                        String(sale.customerId) === String(customer.id) ||
                        sale.customerName === customer.name ||
                        (sale.customerName && sale.customerName.trim() === customer.name.trim())
                    );
                });

                console.log(`๐ ุงูุนููู ${customer.name}: ${customerSales.length} ูุงุชูุฑุฉ`);

                // ุญุณุงุจ ุงูุฃุฑุตุฏุฉ ูุงูุฃุนูุงุฑ
                let current = 0;      // 0-30 ููู
                let days30 = 0;       // 31-60 ููู
                let days60 = 0;       // 61-90 ููู
                let days90 = 0;       // 91-120 ููู
                let over120 = 0;      // ุฃูุซุฑ ูู 120 ููู
                let totalDue = 0;

                customerSales.forEach(sale => {
                    const saleTotal = parseFloat(sale.total) || 0;
                    const salePaid = parseFloat(sale.paid) || 0;
                    const saleBalance = saleTotal - salePaid;

                    if (saleBalance > 0) { // ููุท ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ
                        const saleDate = new Date(sale.createdAt || sale.date);
                        const daysDiff = Math.floor((currentDate - saleDate) / (1000 * 60 * 60 * 24));

                        totalDue += saleBalance;

                        if (daysDiff <= 30) {
                            current += saleBalance;
                        } else if (daysDiff <= 60) {
                            days30 += saleBalance;
                        } else if (daysDiff <= 90) {
                            days60 += saleBalance;
                        } else if (daysDiff <= 120) {
                            days90 += saleBalance;
                        } else {
                            over120 += saleBalance;
                        }
                    }
                });

                // ุชุญุฏูุฏ ูุณุชูู ุงููุฎุงุทุฑ
                let riskLevel = 'ููุฎูุถ';
                let riskClass = 'status-success';

                if (over120 > 0) {
                    riskLevel = 'ุนุงูู ุฌุฏุงู';
                    riskClass = 'status-danger';
                } else if (days90 > 0) {
                    riskLevel = 'ุนุงูู';
                    riskClass = 'status-warning';
                } else if (days60 > 0) {
                    riskLevel = 'ูุชูุณุท';
                    riskClass = 'status-pending';
                } else if (days30 > 0) {
                    riskLevel = 'ููุฎูุถ';
                    riskClass = 'status-good';
                }

                return {
                    ...customer,
                    current,
                    days30,
                    days60,
                    days90,
                    over120,
                    totalDue,
                    riskLevel,
                    riskClass
                };
            });

            // ููุชุฑุฉ ุงูุนููุงุก ุงูุฐูู ูุฏููู ุฏููู ููุท
            const customersWithDebt = customerAging.filter(customer => customer.totalDue > 0);

            // ุชุฑุชูุจ ุงูุนููุงุก ุญุณุจ ุฅุฌูุงูู ุงููุณุชุญูุงุช
            customersWithDebt.sort((a, b) => b.totalDue - a.totalDue);

            // ุจูุงุก ุตููู ุงูุฌุฏูู
            let tableRows = '';
            if (customersWithDebt.length > 0) {
                customersWithDebt.forEach((customer, index) => {
                    tableRows += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 8px; text-align: center;">${index + 1}</td>
                            <td style="padding: 8px;">
                                <strong style="font-size: 14px;">${customer.name}</strong>
                                ${customer.phone ? `<br><small style="color: #666; font-size: 11px;">${customer.phone}</small>` : ''}
                            </td>
                            <td style="padding: 8px; text-align: right; color: #28a745;">${formatNumber(customer.current)}</td>
                            <td style="padding: 8px; text-align: right; color: #ffc107;">${formatNumber(customer.days30)}</td>
                            <td style="padding: 8px; text-align: right; color: #fd7e14;">${formatNumber(customer.days60)}</td>
                            <td style="padding: 8px; text-align: right; color: #dc3545;">${formatNumber(customer.days90)}</td>
                            <td style="padding: 8px; text-align: right; color: #6f42c1;">${formatNumber(customer.over120)}</td>
                            <td style="padding: 8px; text-align: right; font-weight: bold;">${formatNumber(customer.totalDue)}</td>
                            <td style="padding: 8px; text-align: center;">
                                <span class="badge ${customer.riskClass}" style="font-size: 10px; padding: 2px 6px;">${customer.riskLevel}</span>
                            </td>
                        </tr>
                    `;
                });

                // ุตู ุงูุฅุฌูุงูู
                const totals = customersWithDebt.reduce((acc, customer) => ({
                    current: acc.current + customer.current,
                    days30: acc.days30 + customer.days30,
                    days60: acc.days60 + customer.days60,
                    days90: acc.days90 + customer.days90,
                    over120: acc.over120 + customer.over120,
                    totalDue: acc.totalDue + customer.totalDue
                }), { current: 0, days30: 0, days60: 0, days90: 0, over120: 0, totalDue: 0 });

                tableRows += `
                    <tr style="background-color: #f8f9fa; font-weight: bold; border-top: 2px solid #dee2e6;">
                        <td colspan="2" style="padding: 8px;"><strong>ุงูุฅุฌูุงูู</strong></td>
                        <td style="padding: 8px; text-align: right; color: #28a745;"><strong>${formatNumber(totals.current)}</strong></td>
                        <td style="padding: 8px; text-align: right; color: #ffc107;"><strong>${formatNumber(totals.days30)}</strong></td>
                        <td style="padding: 8px; text-align: right; color: #fd7e14;"><strong>${formatNumber(totals.days60)}</strong></td>
                        <td style="padding: 8px; text-align: right; color: #dc3545;"><strong>${formatNumber(totals.days90)}</strong></td>
                        <td style="padding: 8px; text-align: right; color: #6f42c1;"><strong>${formatNumber(totals.over120)}</strong></td>
                        <td style="padding: 8px; text-align: right;"><strong>${formatNumber(totals.totalDue)}</strong></td>
                        <td style="padding: 8px;"></td>
                    </tr>
                `;
            } else {
                const noDataMessage = filters.account && filters.account !== '' ?
                    'ูุง ุชูุฌุฏ ุฏููู ููุนููู ุงููุญุฏุฏ ูู ุงููุชุฑุฉ ุงููุฎุชุงุฑุฉ' :
                    'ูุง ุชูุฌุฏ ุฏููู ูุณุชุญูุฉ';
                tableRows = `<tr><td colspan="9" style="text-align: center; padding: 20px; color: #666;">${noDataMessage}</td></tr>`;
            }

            return `
                <div class="report-container">
                    <div class="report-content">
                        <!-- ุงูุฌุฏูู ุงูููุตู -->
                        <div class="table-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0; font-size: 16px; color: #333;">โฐ ุฃุนูุงุฑ ุงูุฏููู ุงููุณุชุญูุฉ</h3>
                                <div style="font-size: 12px; color: #666;">
                                    <span><strong>ุงููุชุฑุฉ:</strong> ${dateRange}</span> |
                                    <span>ุชุงุฑูุฎ ุงูุฅูุดุงุก: ${new Date().toLocaleDateString('ar')}</span>
                                </div>
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="report-table enhanced" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">#</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุงูุนููู</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6; color: #28a745;">ุญุงูู<br><small>(0-30 ููู)</small></th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6; color: #ffc107;">30 ููู<br><small>(31-60 ููู)</small></th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6; color: #fd7e14;">60 ููู<br><small>(61-90 ููู)</small></th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6; color: #dc3545;">90 ููู<br><small>(91-120 ููู)</small></th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6; color: #6f42c1;">+120 ููู<br><small>(ุฃูุซุฑ ูู 120)</small></th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุฅุฌูุงูู ุงููุณุชุญู</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ูุณุชูู ุงููุฎุงุทุฑ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${tableRows}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="report-actions" style="margin-top: 15px; text-align: center;">
                        <button onclick="window.print()" class="btn-print" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ ุทุจุงุนุฉ
                        </button>
                        <button onclick="exportToExcel('customer-aging')" class="btn-excel" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ Excel
                        </button>
                        <button onclick="exportToPDF('customer-aging')" class="btn-pdf" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุงููุฎุฒูู
        function createStockReport(currentDate, filters = {}) {
            console.log('๐ฆ ุฅูุดุงุก ุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู...', { currentDate, filters });

            // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุธุงู ุงููุฑูุฒู
            if (!window.dataManager) {
                console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุฑูุฒู...');
                window.dataManager = new DataManager();
            }

            // ุงูุชุญูู ูู ูุฌูุฏ ุจูุงูุงุช ุงูููุชุฌุงุช
            let products = window.dataManager.getProducts();
            console.log('๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช ูู ุงููุธุงู ูุจู ุงูููุชุฑุฉ:', products.length);

            // ุชุทุจูู ููุชุฑ ุงูููุชุฌ ุงููุญุฏุฏ
            if (filters.account && filters.account !== '') {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูููุชุฌ:', filters.account, typeof filters.account);
                console.log('๐ ุนููุฉ ูู ุงูููุชุฌุงุช ูุจู ุงูููุชุฑุฉ:', products.slice(0, 2).map(p => ({
                    id: p.id,
                    name: p.name,
                    code: p.code,
                    idType: typeof p.id
                })));

                products = products.filter(product => {
                    const matchById = String(product.id) === String(filters.account);
                    const matchByName = product.name === filters.account;
                    const matchByCode = product.code === filters.account;

                    console.log(`๐ ูุญุต ุงูููุชุฌ ${product.name}:`, {
                        productId: product.id,
                        filterId: filters.account,
                        matchById,
                        matchByName,
                        matchByCode
                    });

                    return matchById || matchByName || matchByCode;
                });
                console.log('๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช ุจุนุฏ ุงูููุชุฑุฉ:', products.length);

                if (products.length > 0) {
                    console.log('โ ุงูููุชุฌุงุช ุงููุทุงุจูุฉ:', products.map(p => p.name));
                }
            }

            // ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
            if (products.length === 0) {
                console.log('โ ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููููุชุฌุงุช...');
                const sampleProducts = [
                    {
                        id: 1,
                        name: 'ุฃุฑุฒ ุจุณูุชู - ููุณ 5 ูููู',
                        quantity: 50,
                        salePrice: 45.00,
                        purchasePrice: 35.00,
                        minQuantity: 10,
                        category: 'ููุงุฏ ุบุฐุงุฆูุฉ'
                    },
                    {
                        id: 2,
                        name: 'ุณูุฑ ุฃุจูุถ - ููุณ 2 ูููู',
                        quantity: 30,
                        salePrice: 22.00,
                        purchasePrice: 18.00,
                        minQuantity: 5,
                        category: 'ููุงุฏ ุบุฐุงุฆูุฉ'
                    },
                    {
                        id: 3,
                        name: 'ุฒูุช ุงูุทุจุฎ - ุนุจูุฉ 1.8 ูุชุฑ',
                        quantity: 0,
                        salePrice: 28.00,
                        purchasePrice: 22.00,
                        minQuantity: 8,
                        category: 'ููุงุฏ ุบุฐุงุฆูุฉ'
                    }
                ];

                window.dataManager.saveProducts(sampleProducts);
                console.log('โ ุชู ุฅุถุงูุฉ', sampleProducts.length, 'ููุชุฌ ุชุฌุฑูุจู');
            }

            // ุงูุชุญูู ูู ูุฌูุฏ ููุชุฌุงุช
            if (products.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู</h2>
                            <p>ููุง ูู ${currentDate}</p>
                        </div>
                        <div class="report-content">
                            <p style="text-align: center; padding: 40px; color: #666;">
                                ${filters.account ? 'ูุง ุชูุฌุฏ ููุชุฌุงุช ุชุทุงุจู ุงูููุชุฑ ุงููุญุฏุฏ' : 'ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงููุฎุฒูู'}
                            </p>
                        </div>
                    </div>
                `;
            }

            // ุจูุงุก ุตููู ุงูุฌุฏูู ูู ุงูููุชุฌุงุช ุงููููุชุฑุฉ
            let tableRows = '';
            if (products.length > 0) {
                products.forEach(item => {
                    let statusClass = '';
                    let statusText = '';

                    if (item.status === 'ููุฏ') {
                        statusClass = 'status-critical';
                        statusText = 'ููุฏ';
                    } else if (item.status === 'ููุฎูุถ') {
                        statusClass = 'status-warning';
                        statusText = 'ููุฎูุถ';
                    } else {
                        statusClass = 'status-good';
                        statusText = 'ูุชููุฑ';
                    }

                    // ุงุณุชุฎุฏุงู ุงูุฃุณูุงุก ุงูุตุญูุญุฉ ููุญููู
                    const productName = item.name || 'ุบูุฑ ูุญุฏุฏ';
                    const currentStock = item.quantity || 0;
                    const salePrice = item.salePrice || 0;
                    const minQuantity = item.minQuantity || 5;

                    // ุชุญุฏูุฏ ุญุงูุฉ ุงููุฎุฒูู
                    if (currentStock === 0) {
                        statusClass = 'status-critical';
                        statusText = 'ููุฏ';
                    } else if (currentStock <= minQuantity) {
                        statusClass = 'status-warning';
                        statusText = 'ููุฎูุถ';
                    } else {
                        statusClass = 'status-good';
                        statusText = 'ูุชููุฑ';
                    }

                    const totalValue = currentStock * salePrice;

                    tableRows += `
                        <tr>
                            <td>${item.id || 'ุบูุฑ ูุญุฏุฏ'}</td>
                            <td><strong>${productName}</strong></td>
                            <td>${currentStock}</td>
                            <td>${formatNumber(salePrice)}</td>
                            <td>${formatNumber(totalValue)}</td>
                            <td><span class="${statusClass}">${statusText}</span></td>
                        </tr>
                    `;
                });

                const totalValue = products.reduce((sum, item) => {
                    const stock = item.quantity || 0;
                    const price = item.salePrice || 0;
                    return sum + (stock * price);
                }, 0);

                tableRows += `<tr class="total"><td colspan="4"><strong>ุงูุฅุฌูุงูู</strong></td><td><strong>${formatNumber(totalValue)}</strong></td><td></td></tr>`;
            } else {
                tableRows = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #666;">ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงููุฎุฒูู</td></tr>';
            }

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู</h2>
                        <p>ููุง ูู ${currentDate}</p>
                    </div>
                    <div class="report-content">
                        <table class="report-table">
                            <thead>
                                <tr><th>ููุฏ ุงูุตูู</th><th>ุงุณู ุงูุตูู</th><th>ุงููููุฉ</th><th>ุณุนุฑ ุงููุญุฏุฉ (ุฑ.ุณ)</th><th>ุฅุฌูุงูู ุงููููุฉ (ุฑ.ุณ)</th><th>ุงูุญุงูุฉ</th></tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                    <div class="report-actions">
                        <button onclick="window.print()" class="btn-print">ุทุจุงุนุฉ</button>
                        <button onclick="exportToExcel('current-stock')" class="btn-excel">ุชุตุฏูุฑ Excel</button>
                        <button onclick="exportToPDF('current-stock')" class="btn-pdf">ุชุตุฏูุฑ PDF</button>
                    </div>
                </div>
            `;
        }



        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุงูุชุฑุงุถู
        function createDefaultReport(reportType, currentDate) {
            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุชูุฑูุฑ: ${reportType}</h2>
                        <p>ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ูู ${currentDate}</p>
                    </div>
                    <div class="report-content">
                        <table class="report-table">
                            <thead>
                                <tr><th>ุงูุจูุฏ</th><th>ุงููููุฉ (ุฑ.ุณ)</th><th>ุงููุณุจุฉ %</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>ุฅุฌูุงูู ุงููุจูุนุงุช</td><td>150,000</td><td>100%</td></tr>
                                <tr><td>ุงูุชูุงููู</td><td>90,000</td><td>60%</td></tr>
                                <tr class="profit"><td><strong>ุตุงูู ุงูุฑุจุญ</strong></td><td><strong>60,000</strong></td><td><strong>40%</strong></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="report-actions">
                        <button onclick="window.print()" class="btn-print">ุทุจุงุนุฉ</button>
                        <button onclick="exportToExcel('${reportType}')" class="btn-excel">ุชุตุฏูุฑ Excel</button>
                        <button onclick="exportToPDF('${reportType}')" class="btn-pdf">ุชุตุฏูุฑ PDF</button>
                    </div>
                </div>
            `;
        }

        // ุฏูุงู ุงูุชูุงุฑูุฑ ุงูุฅุถุงููุฉ ุงููุจุณุทุฉ
        // ุชู ุญุฐู createCashFlowReport ุงููุจุณุทุฉ - ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุตูุฉ ุจุฏูุงู ูููุง

        function createTrialBalanceReport(currentDate) {
            return createDefaultReport('ููุฒุงู ุงููุฑุงุฌุนุฉ', currentDate);
        }

        function createMonthlySalesReport(dateRange, filters = {}) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ ุงููุญุณู...', filters);

            try {
                let salesData = generateSalesReport('monthly');

                // ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ูุงูุนูุฉ ุญุณุจ ุงูููุงุชุฑ
                const currentYear = filters.year || '2025';
                const selectedMonth = filters.month || 'all';
                const viewType = filters.viewType || 'summary';

                // ุจูุงูุงุช ุงูุฃุดูุฑ ุงูุฃุณุงุณูุฉ ูููุจูุนุงุช
                const allMonths = [
                    { name: 'ููุงูุฑ', value: 28500, invoices: 18, number: 1 },
                    { name: 'ูุจุฑุงูุฑ', value: 32300, invoices: 22, number: 2 },
                    { name: 'ูุงุฑุณ', value: 29800, invoices: 19, number: 3 },
                    { name: 'ุฃุจุฑูู', value: 35600, invoices: 25, number: 4 },
                    { name: 'ูุงูู', value: 31400, invoices: 21, number: 5 },
                    { name: 'ููููู', value: 33700, invoices: 23, number: 6 },
                    { name: 'ููููู', value: 30900, invoices: 20, number: 7 },
                    { name: 'ุฃุบุณุทุณ', value: 34800, invoices: 24, number: 8 },
                    { name: 'ุณุจุชูุจุฑ', value: 32100, invoices: 22, number: 9 },
                    { name: 'ุฃูุชูุจุฑ', value: 36300, invoices: 26, number: 10 },
                    { name: 'ููููุจุฑ', value: 33900, invoices: 24, number: 11 },
                    { name: 'ุฏูุณูุจุฑ', value: 37400, invoices: 28, number: 12 }
                ];

                // ุชุทุจูู ููุชุฑ ุงูุดูุฑ
                let filteredMonths = allMonths;
                if (selectedMonth !== 'all') {
                    filteredMonths = allMonths.filter(month => month.number === parseInt(selectedMonth));
                }

                // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                const totalAmount = filteredMonths.reduce((sum, month) => sum + month.value, 0);
                const totalInvoices = filteredMonths.reduce((sum, month) => sum + month.invoices, 0);
                const averageAmount = filteredMonths.length > 0 ? totalAmount / filteredMonths.length : 0;

                // ุฅูุดุงุก ุจูุงูุงุช ุงูููุงุฑูุฉ ููุณูุฉ ุงูุณุงุจูุฉ (ุฅุฐุง ูุงู ููุน ุงูุนุฑุถ ููุงุฑูุฉ)
                let comparisonData = null;
                if (viewType === 'comparison') {
                    const previousYear = (parseInt(currentYear) - 1).toString();
                    comparisonData = {
                        year: previousYear,
                        months: filteredMonths.map(month => ({
                            ...month,
                            value: Math.floor(month.value * (0.85 + Math.random() * 0.3)), // ุชุบููุฑ ุนุดูุงุฆู ยฑ15%
                            invoices: Math.floor(month.invoices * (0.9 + Math.random() * 0.2))
                        }))
                    };
                }

                salesData = {
                    total: totalAmount,
                    average: averageAmount,
                    rawData: Array.from({length: totalInvoices}, (_, i) => ({id: i + 1})),
                    customers: [
                        {id: 1, name: 'ุดุฑูุฉ ุงููุฌุงุญ ุงูุชุฌุงุฑูุฉ'},
                        {id: 2, name: 'ูุคุณุณุฉ ุงูุฅุจุฏุงุน ููุชุณููู'},
                        {id: 3, name: 'ุดุฑูุฉ ุงูุฃูู ููุฎุฏูุงุช'},
                        {id: 4, name: 'ูุคุณุณุฉ ุงูุชููุฒ ุงูุชุฌุงุฑูุฉ'},
                        {id: 5, name: 'ุดุฑูุฉ ุงูุฑุคูุฉ ููุชุทููุฑ'},
                        {id: 6, name: 'ูุคุณุณุฉ ุงูุงุฒุฏูุงุฑ ููุฃุนูุงู'}
                    ],
                    chartData: filteredMonths.map(month => ({
                        label: `${month.name} ${currentYear}`,
                        value: month.value,
                        invoices: month.invoices,
                        number: month.number
                    })),
                    viewType: viewType,
                    selectedMonth: selectedMonth,
                    selectedYear: currentYear,
                    comparisonData: comparisonData
                };

                // ุชุญุฏูุฏ ุนููุงู ุงูุชูุฑูุฑ ุญุณุจ ุงูููุงุชุฑ
                let reportTitle = 'ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ';
                if (salesData.selectedMonth !== 'all') {
                    const monthNames = ['', 'ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู',
                                      'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'];
                    reportTitle = `ูุจูุนุงุช ${monthNames[salesData.selectedMonth]} ${salesData.selectedYear}`;
                }

                // ุชุญุฏูุฏ ุฃููููุฉ ููุน ุงูุนุฑุถ
                let viewIcon = '๐';
                if (salesData.viewType === 'detailed') viewIcon = '๐';
                else if (salesData.viewType === 'comparison') viewIcon = '๐';

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ุฅุฌูุงูู ุงููุจูุนุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(salesData.total)}</div>
                                ${salesData.viewType === 'comparison' && salesData.comparisonData ? `
                                    <div style="font-size: 0.7em; opacity: 0.8; margin-top: 4px;">
                                        ${salesData.comparisonData.year}: ${formatCurrency(salesData.comparisonData.months.reduce((sum, m) => sum + m.value, 0))}
                                    </div>
                                ` : ''}
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ${salesData.selectedMonth === 'all' ? 'ูุชูุณุท ุดูุฑู' : 'ูุชูุณุท ุงููุงุชูุฑุฉ'}</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(salesData.selectedMonth === 'all' ? salesData.average : (salesData.total / (salesData.rawData ? salesData.rawData.length : 1)))}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุนุฏุฏ ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${salesData.rawData ? salesData.rawData.length : 0}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฅ ุงูุนููุงุก ุงููุดุทูู</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${salesData.customers ? salesData.customers.length : 0}</div>
                            </div>
                        </div>

                        <!-- ุฌุฏูู ุงูุจูุงูุงุช ุญุณุจ ููุน ุงูุนุฑุถ -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                                ${salesData.viewType === 'detailed' ? '๐ ุชูุงุตูู ุงูููุงุชูุฑ' :
                                  salesData.viewType === 'comparison' ? '๐ ููุงุฑูุฉ ุงูุณููุงุช' :
                                  '๐ ููุฎุต ุงููุจูุนุงุช ุงูุดูุฑูุฉ'}
                            </h3>

                            ${salesData.chartData && salesData.chartData.length > 0 ? `

                                ${(() => {
                                    if (salesData.viewType === 'detailed') {
                                        // ุนุฑุถ ุชูุงุตูู ุงูููุงุชูุฑ
                                        return `
                                            <div style="overflow-x: auto;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                                    <thead>
                                                        <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุชุงุฑูุฎ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุนููู</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุจูุบ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุญุงูุฉ</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${Array.from({length: salesData.rawData.length}, (_, i) => {
                                                            const invoiceNumber = 'SAL' + (1000 + i + 1);
                                                            const customer = salesData.customers[i % salesData.customers.length];
                                                            const amount = Math.floor(Math.random() * 3000) + 800;
                                                            const date = new Date(2025, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
                                                            const isEven = i % 2 === 0;

                                                            return `
                                                                <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'">
                                                                    <td style="padding: 12px; text-align: center; font-weight: 600; color: #333;">${invoiceNumber}</td>
                                                                    <td style="padding: 12px; text-align: center; color: #495057;">${date.toLocaleDateString('ar-EG')}</td>
                                                                    <td style="padding: 12px; text-align: center; color: #495057;">${customer.name}</td>
                                                                    <td style="padding: 12px; text-align: center; font-weight: 600; color: #28a745;">${formatCurrency(amount)}</td>
                                                                    <td style="padding: 12px; text-align: center;">
                                                                        <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em;">ูุฏููุนุฉ</span>
                                                                    </td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        `;
                                    } else if (salesData.viewType === 'comparison') {
                                        // ุนุฑุถ ููุงุฑูุฉ ุงูุณููุงุช
                                        return `
                                            <div style="overflow-x: auto;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                                    <thead>
                                                        <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุดูุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">${salesData.selectedYear}</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">${salesData.comparisonData.year}</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุชุบููุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุณุจุฉ %</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${salesData.chartData.map((month, index) => {
                                                            const compMonth = salesData.comparisonData.months[index];
                                                            const change = month.value - compMonth.value;
                                                            const changePercent = compMonth.value > 0 ? ((change / compMonth.value) * 100) : 0;
                                                            const isEven = index % 2 === 0;
                                                            const changeColor = change >= 0 ? '#28a745' : '#dc3545';
                                                            const changeIcon = change >= 0 ? '๐' : '๐';

                                                            return `
                                                                <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'">
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${month.label.split(' ')[0]}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #28a745;">${formatCurrency(month.value)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; color: #495057;">${formatCurrency(compMonth.value)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${changeColor};">
                                                                        ${changeIcon} ${formatCurrency(Math.abs(change))}
                                                                    </td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${changeColor};">
                                                                        ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(1)}%
                                                                    </td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        `;
                                    } else {
                                        // ุนุฑุถ ุงูููุฎุต ุงูุดูุฑู (ุงูุงูุชุฑุงุถู)
                                        return `
                                            <div style="overflow-x: auto;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                                    <thead>
                                                        <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุดูุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ูููุฉ ุงููุจูุนุงุช</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุณุจุฉ %</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${salesData.chartData.map((month, index) => {
                                                            const percentage = salesData.total > 0 ? (month.value / salesData.total * 100) : (100 / salesData.chartData.length);
                                                            const avgInvoice = month.invoices > 0 ? month.value / month.invoices : 0;
                                                            const isEven = index % 2 === 0;

                                                            // ุชุญุฏูุฏ ููู ุงูุฎูููุฉ ุญุณุจ ุงูุฃุฏุงุก
                                                            let performanceColor = '#495057';
                                                            if (percentage > 10) performanceColor = '#28a745';
                                                            else if (percentage > 7) performanceColor = '#ffc107';
                                                            else performanceColor = '#dc3545';

                                                            return `
                                                                <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333; border-right: 3px solid ${performanceColor};">${month.label}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(month.value)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; color: #495057; font-weight: 600;">${month.invoices || 0}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${formatCurrency(avgInvoice)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: ${performanceColor}; font-size: 1.05em;">
                                                                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                                                            <span>${percentage.toFixed(1)}%</span>
                                                                            <div style="width: 40px; height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden;">
                                                                                <div style="width: ${Math.min(percentage * 4, 100)}%; height: 100%; background: ${performanceColor}; border-radius: 3px; transition: width 0.3s ease;"></div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        `;
                                    }
                                })()}
                            ` : '<div style="text-align: center; padding: 40px; color: #666;"><i class="fas fa-chart-line" style="font-size: 3em; margin-bottom: 15px; opacity: 0.3;"></i><br>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุจูุนุงุช ูุชุงุญุฉ</div>'}
                        </div>

                        <!-- ูุนูููุงุช ุฅุถุงููุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ ููุฎุต ุงูุฃุฏุงุก</h4>
                                <div style="color: #495057; line-height: 1.6;">
                                    <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุจูุนุงุช: <strong style="color: #28a745;">${formatCurrency(salesData.total)}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูููุงุชูุฑ: <strong>${salesData.rawData ? salesData.rawData.length : 0}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ุงูุนููุงุก ุงููุดุทูู: <strong>${salesData.customers ? salesData.customers.length : 0}</strong></div>
                                    <div>โข ูุชูุณุท ุงููุงุชูุฑุฉ: <strong style="color: #667eea;">${formatCurrency(salesData.selectedMonth === 'all' ? salesData.average : (salesData.total / (salesData.rawData ? salesData.rawData.length : 1)))}</strong></div>
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #28a745;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ฏ ูุตุงุฆุญ ูุชุญุณูู ุงูุฃุฏุงุก</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    <div style="margin-bottom: 8px;">โข ุชุฑููุฒ ุนูู ุงูุฃุดูุฑ ุนุงููุฉ ุงูุฃุฏุงุก</div>
                                    <div style="margin-bottom: 8px;">โข ุชุทููุฑ ุงุณุชุฑุงุชูุฌูุงุช ููุฃุดูุฑ ุงูุถุนููุฉ</div>
                                    <div style="margin-bottom: 8px;">โข ุฒูุงุฏุฉ ูุชูุณุท ูููุฉ ุงููุงุชูุฑุฉ</div>
                                    <div>โข ุชุญุณูู ุฎุฏูุฉ ุงูุนููุงุก ุงูุญุงูููู</div>
                                </div>
                            </div>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุชุตุฏูุฑ -->
                        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                            <button onclick="printReport()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(108, 117, 125, 0.3)'">
                                <i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ
                            </button>
                            <button onclick="exportToExcel('monthly-sales')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                                <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="exportToPDF('monthly-sales')" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(220, 53, 69, 0.3)'">
                                <i class="fas fa-file-pdf"></i> ุชุตุฏูุฑ PDF
                            </button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ:', error);
                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 40px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center;">
                        <div style="color: #dc3545; margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 15px;"></i>
                            <h3>ุฎุทุฃ ูู ุชุญููู ุงูุชูุฑูุฑ</h3>
                            <p>ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุงูุดูุฑูุฉ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.</p>
                        </div>
                        <button onclick="location.reload()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                        </button>
                    </div>
                `;
            }
        }

        // ุฏุงูุฉ ุฅุฑุฌุงุน ููุงุชูุฑ ุงูุนููู ุงููุญุฏุฏ
        function getCustomerInvoices(customerId) {
            const customerInvoices = {
                'ahmed-ali': {
                    invoices: [
                        '<tr><td>INV-001</td><td>15/01/2024</td><td>3,500</td><td>ููุฏุงู</td><td>ูุงุจุชูุจ ุฏูู XPS 13</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-018</td><td>12/01/2024</td><td>650</td><td>ููุฏุงู</td><td>ูุฑุณู ููุชุจู ุฌูุฏ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-032</td><td>10/01/2024</td><td>1,100</td><td>ููุฏุงู</td><td>ุดุงุดุฉ ุณุงูุณููุฌ 27 ุจูุตุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '5,250',
                    count: '3'
                },
                'sara-khalid': {
                    invoices: [
                        '<tr><td>INV-005</td><td>14/01/2024</td><td>4,200</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ูุงุชู ุขูููู 15</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-025</td><td>11/01/2024</td><td>1,200</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุทุงุจุนุฉ ููุฒุฑ HP</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-038</td><td>09/01/2024</td><td>850</td><td>ุชุญููู ุจููู</td><td>ูุงูุณ ูุงุณููู + ููุจูุฑุฏ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-052</td><td>07/01/2024</td><td>2,800</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุชุงุจูุช ุขูุจุงุฏ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '9,050',
                    count: '4'
                },
                'mohammed-ahmed': {
                    invoices: [
                        '<tr><td>INV-012</td><td>13/01/2024</td><td>1,800</td><td>ุชุญููู ุจููู</td><td>ููุชุจ ุฎุดุจู ูุงุฎุฑ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-045</td><td>08/01/2024</td><td>12,100</td><td>ุชูุณูุท</td><td>ูุฌููุนุฉ ููุชุจูุฉ ูุงููุฉ</td><td><span class="status-pending">ุฌุงุฑู ุงูุชุญุตูู</span></td></tr>'
                    ],
                    total: '13,900',
                    count: '2'
                },
                'fatima-saad': {
                    invoices: [
                        '<tr><td>INV-029</td><td>10/01/2024</td><td>3,200</td><td>ููุฏุงู</td><td>ูุฑุณู ููุชุจู ุฌูุฏ - 5 ูุทุน</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-041</td><td>08/01/2024</td><td>1,500</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุฃุฏูุงุช ููุชุจูุฉ ูุชููุนุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-055</td><td>06/01/2024</td><td>950</td><td>ููุฏุงู</td><td>ุณูุงุนุงุช ุณููู</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '5,650',
                    count: '3'
                },
                'abdullah-otaibi': {
                    invoices: [
                        '<tr><td>INV-063</td><td>09/01/2024</td><td>2,400</td><td>ุชุญููู ุจููู</td><td>ููุจูุฑุฏ ูููุงูููู - 3 ูุทุน</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-071</td><td>07/01/2024</td><td>1,800</td><td>ููุฏุงู</td><td>ุณูุงุนุงุช ูุงุณูููุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '4,200',
                    count: '2'
                },
                'nora-zahrani': {
                    invoices: [
                        '<tr><td>INV-078</td><td>10/01/2024</td><td>1,829</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุฃุฏูุงุช ููุชุจูุฉ ููุฑุทุงุณูุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-085</td><td>08/01/2024</td><td>3,200</td><td>ุชุญููู ุจููู</td><td>ูุฑุณู ููุชุจู ูุชุญุฑู</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-092</td><td>06/01/2024</td><td>950</td><td>ููุฏุงู</td><td>ูุงูุณ ูููุจูุฑุฏ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-099</td><td>05/01/2024</td><td>2,100</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุดุงุดุฉ ููุจููุชุฑ 24 ุจูุตุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-106</td><td>04/01/2024</td><td>1,650</td><td>ุชุญููู ุจููู</td><td>ุทุงุจุนุฉ ูุงูุซุฉ ููุญุจุฑ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-113</td><td>03/01/2024</td><td>1,200</td><td>ููุฏุงู</td><td>ูุงุจูุงุช ูููุตูุงุช</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-120</td><td>02/01/2024</td><td>871</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุฅูุณุณูุงุฑุงุช ููุชุจูุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '12,800',
                    count: '7'
                },
                'khalid-mutairi': {
                    invoices: [
                        '<tr><td>INV-127</td><td>11/01/2024</td><td>4,500</td><td>ุชูุณูุท</td><td>ููุชุจ ุชูููุฐู ูุงุฎุฑ</td><td><span class="status-pending">ุฌุงุฑู ุงูุชุญุตูู</span></td></tr>',
                        '<tr><td>INV-134</td><td>09/01/2024</td><td>2,200</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ูุฑุณู ูุฏูุฑ ุฌูุฏ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-141</td><td>07/01/2024</td><td>1,100</td><td>ููุฏุงู</td><td>ูุตุจุงุญ ููุชุจู LED</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '7,800',
                    count: '3'
                },
                'reem-shahri': {
                    invoices: [
                        '<tr><td>INV-148</td><td>12/01/2024</td><td>3,800</td><td>ุชุญููู ุจููู</td><td>ุชุงุจูุช ุณุงูุณููุฌ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-155</td><td>10/01/2024</td><td>1,950</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุณูุงุนุงุช ุจููุชูุซ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '5,750',
                    count: '2'
                },
                'omar-salem': {
                    invoices: [
                        '<tr><td>INV-162</td><td>13/01/2024</td><td>2,650</td><td>ููุฏุงู</td><td>ูุงููุฑุง ููุจ ุนุงููุฉ ุงูุฏูุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-169</td><td>11/01/2024</td><td>1,400</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ูููุฑูููู USB</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-176</td><td>09/01/2024</td><td>3,200</td><td>ุชุญููู ุจููู</td><td>ุดุงุดุฉ ููุญููุฉ 32 ุจูุตุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-183</td><td>07/01/2024</td><td>850</td><td>ููุฏุงู</td><td>ุญุงูู ุดุงุดุฉ ูุงุจู ููุชุนุฏูู</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '8,100',
                    count: '4'
                },
                'layla-ahmed': {
                    invoices: [
                        '<tr><td>INV-190</td><td>14/01/2024</td><td>5,200</td><td>ุชูุณูุท</td><td>ูุงุจุชูุจ HP EliteBook</td><td><span class="status-pending">ุฌุงุฑู ุงูุชุญุตูู</span></td></tr>',
                        '<tr><td>INV-197</td><td>12/01/2024</td><td>1,800</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุญููุจุฉ ูุงุจุชูุจ ูุงุฎุฑุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '7,000',
                    count: '2'
                },
                'youssef-hassan': {
                    invoices: [
                        '<tr><td>INV-204</td><td>15/01/2024</td><td>2,100</td><td>ููุฏุงู</td><td>ุทุงุจุนุฉ ูุชุนุฏุฏุฉ ุงููุธุงุฆู</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-211</td><td>13/01/2024</td><td>1,650</td><td>ุชุญููู ุจููู</td><td>ูุงุณุญ ุถูุฆู ูุญููู</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-218</td><td>11/01/2024</td><td>950</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ูุฑู ุทุจุงุนุฉ ุนุงูู ุงูุฌูุฏุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '4,700',
                    count: '3'
                },
                'maryam-ali': {
                    invoices: [
                        '<tr><td>INV-225</td><td>16/01/2024</td><td>3,400</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ูุฑุณู ูุฑูุญ ููุธูุฑ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-232</td><td>14/01/2024</td><td>2,800</td><td>ุชุญููู ุจููู</td><td>ููุชุจ ูุงุจู ููุชุนุฏูู</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-239</td><td>12/01/2024</td><td>1,200</td><td>ููุฏุงู</td><td>ููุธู ููุชุจู ุฎุดุจู</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-246</td><td>10/01/2024</td><td>750</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ูุฌููุนุฉ ุฃููุงู ูุงุฎุฑุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '8,150',
                    count: '4'
                },
                'hassan-ibrahim': {
                    invoices: [
                        '<tr><td>INV-253</td><td>17/01/2024</td><td>4,800</td><td>ุชูุณูุท</td><td>ุฌูุงุฒ ุนุฑุถ ูุญููู</td><td><span class="status-pending">ุฌุงุฑู ุงูุชุญุตูู</span></td></tr>',
                        '<tr><td>INV-260</td><td>15/01/2024</td><td>2,200</td><td>ุชุญููู ุจููู</td><td>ุดุงุดุฉ ุนุฑุถ ุชูุงุนููุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '7,000',
                    count: '2'
                },
                'aisha-mohammed': {
                    invoices: [
                        '<tr><td>INV-267</td><td>18/01/2024</td><td>1,950</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ูุงุชู ุฐูู ุณุงูุณููุฌ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-274</td><td>16/01/2024</td><td>1,400</td><td>ููุฏุงู</td><td>ุบุทุงุก ูุญุงูู ุดุงุดุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-281</td><td>14/01/2024</td><td>850</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ุดุงุญู ูุงุณููู ุณุฑูุน</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '4,200',
                    count: '3'
                },
                'waleed-abdulla': {
                    invoices: [
                        '<tr><td>INV-288</td><td>19/01/2024</td><td>6,500</td><td>ุชุญููู ุจููู</td><td>ูุธุงู ุตูุชู ููููุชุจ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-295</td><td>17/01/2024</td><td>3,200</td><td>ุจุทุงูุฉ ุงุฆุชูุงู</td><td>ููุจุฑุงุช ุตูุช ุฐููุฉ</td><td><span class="status-paid">ูุฏููุน</span></td></tr>',
                        '<tr><td>INV-302</td><td>15/01/2024</td><td>1,800</td><td>ููุฏุงู</td><td>ุณูุงุนุงุช ุฅูุบุงุก ุงูุถูุถุงุก</td><td><span class="status-paid">ูุฏููุน</span></td></tr>'
                    ],
                    total: '11,500',
                    count: '3'
                }
            };

            let customer = customerInvoices[customerId];

            // ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนูููุ ุชุญูู ูู ุงูุนููุงุก ุงูุฌุฏุฏ ูู localStorage
            if (!customer && customerId.startsWith('customer-')) {
                const customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                const customerIdNum = customerId.replace('customer-', '');
                const customerInfo = customersData.find(c => c.id == customerIdNum);

                if (customerInfo) {
                    // ุงูุจุญุซ ุนู ููุงุชูุฑ ุงูุนููู ุงูุญููููุฉ
                    const customerSales = salesData.filter(sale =>
                        sale.customerId === customerInfo.id ||
                        sale.customerName === customerInfo.name
                    );

                    if (customerSales.length > 0) {
                        const invoiceRows = customerSales.map(sale => {
                            const status = sale.status === 'paid' ? '<span class="status-paid">ูุฏููุน</span>' :
                                          sale.status === 'pending' ? '<span class="status-pending">ูุนูู</span>' :
                                          '<span class="status-overdue">ูุชุฃุฎุฑ</span>';
                            const paymentMethod = sale.paymentMethod === 'cash' ? 'ููุฏุงู' :
                                                sale.paymentMethod === 'credit' ? 'ุขุฌู' :
                                                sale.paymentMethod === 'card' ? 'ุจุทุงูุฉ' : 'ุชุญููู';

                            return `<tr><td>${sale.id}</td><td>${sale.date}</td><td>${(sale.total || 0).toFixed(2)}</td><td>${paymentMethod}</td><td>${sale.description || 'ูุงุชูุฑุฉ ูุจูุนุงุช'}</td><td>${status}</td></tr>`;
                        });

                        const totalAmount = customerSales.reduce((sum, sale) => sum + (sale.total || 0), 0);

                        customer = {
                            invoices: invoiceRows,
                            total: totalAmount.toFixed(2),
                            count: customerSales.length.toString()
                        };
                    } else {
                        customer = {
                            invoices: ['<tr><td colspan="6" style="text-align: center; padding: 20px; color: #666;">ูุง ุชูุฌุฏ ููุงุชูุฑ ููุฐุง ุงูุนููู</td></tr>'],
                            total: '0.00',
                            count: '0'
                        };
                    }
                }
            }

            if (!customer) {
                return '<tr><td colspan="6">ูุง ุชูุฌุฏ ููุงุชูุฑ ููุฐุง ุงูุนููู</td></tr>';
            }

            const invoicesHtml = customer.invoices.join('');
            const totalRow = `<tr class="total"><td colspan="2"><strong>ุงูุฅุฌูุงูู</strong></td><td><strong>${customer.total}</strong></td><td colspan="3"></td></tr>`;

            return invoicesHtml + totalRow;
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ููุงุฆู ุงูุนููุงุก ูู localStorage
        function updateCustomerFiltersFromStorage() {
            const customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];

            if (customersData.length > 0) {
                // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุนููุงุก ูู ุงููุฑุดุญุงุช
                const customerFilters = [];
                customerFilters.push({ value: '', text: 'ุฌููุน ุงูุนููุงุก' });

                customersData.forEach(customer => {
                    const customerId = `customer-${customer.id}`;
                    customerFilters.push({ value: customerId, text: customer.name });
                });

                // ุชุญุฏูุซ ุฌููุน ููุงุฆู ุงูุนููุงุก ูู reportFilters
                if (window.reportFilters) {
                    window.reportFilters['by-customer'] = customerFilters;
                    window.reportFilters['customer-list'] = customerFilters;
                    window.reportFilters['customer-balances'] = customerFilters;
                    window.reportFilters['customer-analysis'] = customerFilters;
                }

                console.log('ุชู ุชุญุฏูุซ ููุงุฆู ุงูุนููุงุก ูู ุงูุชูุงุฑูุฑ:', customersData.length, 'ุนููู');
            }
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ููุงุฆู ุงูููุชุฌุงุช ูู localStorage
        function updateProductFiltersFromStorage() {
            console.log('๐ ุชุญุฏูุซ ููุงุฆู ุงูููุชุฌุงุช...');

            // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู ุฃููุงู
            let productsData = [];

            if (window.dataManager) {
                productsData = window.dataManager.getProducts();
                console.log('โ ุชู ุชุญููู ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', productsData.length, 'ููุชุฌ');
            } else {
                productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
                console.log('โ๏ธ ุชู ุชุญููู ุงูููุชุฌุงุช ูู localStorage:', productsData.length, 'ููุชุฌ');
            }

            if (productsData.length > 0) {
                // ุชุญุฏูุซ ูุงุฆูุฉ ุงูููุชุฌุงุช ูู ุงููุฑุดุญุงุช
                const productFilters = [];
                productFilters.push({ value: '', text: 'ุฌููุน ุงูููุชุฌุงุช' });

                productsData.forEach(product => {
                    const productId = `product-${product.id}`;
                    productFilters.push({ value: productId, text: product.name });
                });

                // ุชุญุฏูุซ ุฌููุน ููุงุฆู ุงูููุชุฌุงุช ูู reportFilters
                if (window.reportFilters) {
                    window.reportFilters['by-product'] = productFilters;
                    window.reportFilters['product-list'] = productFilters;
                    window.reportFilters['inventory-status'] = productFilters;
                    window.reportFilters['product-analysis'] = productFilters;
                    window.reportFilters['current-stock'] = productFilters;
                    window.reportFilters['stock-movement'] = productFilters;
                    window.reportFilters['low-stock'] = productFilters;
                }

                // ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูุนุงูุฉ ููููุชุฌุงุช
                window.realProductsData = productsData;

                console.log('โ ุชู ุชุญุฏูุซ ููุงุฆู ุงูููุชุฌุงุช ูู ุงูุชูุงุฑูุฑ:', productsData.length, 'ููุชุฌ');

                // ุนุฑุถ ุชูุงุตูู ุงูููุชุฌุงุช
                productsData.forEach((product, index) => {
                    console.log(`   ${index + 1}. ${product.name} - ุงููููุฉ: ${product.quantity || 0} - ุงูุณุนุฑ: ${product.price || 0}`);
                });
            } else {
                console.log('โ๏ธ ูุง ุชูุฌุฏ ููุชุฌุงุช');
            }
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ููุงุฆู ุงูููุฑุฏูู ูู ุงููุธุงู ุงููุฑูุฒู
        function updateSupplierFiltersFromStorage() {
            console.log('ุชุญุฏูุซ ููุงุฆู ุงูููุฑุฏูู ูู ุงูุชูุงุฑูุฑ...');

            // ุงูุชุญูู ูู ุชููุฑ ุงููุธุงู ุงููุฑูุฒู
            if (!window.dataManager) {
                console.error('ุงููุธุงู ุงููุฑูุฒู ุบูุฑ ูุชุงุญ ูู ุงูุชูุงุฑูุฑ');
                return;
            }

            const suppliersData = window.dataManager.getSuppliers();
            console.log('ุงูููุฑุฏูู ุงููุชุงุญูู:', suppliersData);

            if (suppliersData.length > 0) {
                // ุชุญุฏูุซ ูุงุฆูุฉ ุงูููุฑุฏูู ูู ุงููุฑุดุญุงุช
                const supplierFilters = [];
                supplierFilters.push({ value: '', text: 'ุฌููุน ุงูููุฑุฏูู' });

                suppliersData.forEach(supplier => {
                    const supplierId = `supplier-${supplier.id}`;
                    supplierFilters.push({ value: supplierId, text: supplier.name });
                });

                // ุชุญุฏูุซ ุฌููุน ููุงุฆู ุงูููุฑุฏูู ูู reportFilters
                if (window.reportFilters) {
                    window.reportFilters['by-supplier'] = supplierFilters;
                    window.reportFilters['supplier-list'] = supplierFilters;
                    window.reportFilters['supplier-balances'] = supplierFilters;
                    window.reportFilters['supplier-analysis'] = supplierFilters;
                    window.reportFilters['supplier-evaluation'] = supplierFilters;
                }

                console.log('ุชู ุชุญุฏูุซ ููุงุฆู ุงูููุฑุฏูู ูู ุงูุชูุงุฑูุฑ:', suppliersData.length, 'ููุฑุฏ');
            } else {
                console.log('ูุง ุชูุฌุฏ ููุฑุฏูู ูู ุงููุธุงู');
            }
        }

        // ุฏุงูุฉ ุฅุฑุฌุงุน ููุฎุต ุงูุนููู ุงููุญุฏุฏ
        function getCustomerSummary(customerId) {
            const customerSummary = {
                'ahmed-ali': { total: '5,250', count: '3', average: '1,750' },
                'sara-khalid': { total: '9,050', count: '4', average: '2,263' },
                'mohammed-ahmed': { total: '13,900', count: '2', average: '6,950' },
                'fatima-saad': { total: '5,650', count: '3', average: '1,883' },
                'abdullah-otaibi': { total: '4,200', count: '2', average: '2,100' },
                'nora-zahrani': { total: '12,800', count: '7', average: '1,829' },
                'khalid-mutairi': { total: '7,800', count: '3', average: '2,600' },
                'reem-shahri': { total: '5,750', count: '2', average: '2,875' },
                'omar-salem': { total: '8,100', count: '4', average: '2,025' },
                'layla-ahmed': { total: '7,000', count: '2', average: '3,500' },
                'youssef-hassan': { total: '4,700', count: '3', average: '1,567' },
                'maryam-ali': { total: '8,150', count: '4', average: '2,038' },
                'hassan-ibrahim': { total: '7,000', count: '2', average: '3,500' },
                'aisha-mohammed': { total: '4,200', count: '3', average: '1,400' },
                'waleed-abdulla': { total: '11,500', count: '3', average: '3,833' }
            };

            let summary = customerSummary[customerId];

            // ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนูููุ ุชุญูู ูู ุงูุนููุงุก ุงูุฌุฏุฏ ูู localStorage
            if (!summary && customerId.startsWith('customer-')) {
                const customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                const customerIdNum = customerId.replace('customer-', '');
                const customerInfo = customersData.find(c => c.id == customerIdNum);

                if (customerInfo) {
                    // ุฅุฑุฌุงุน ููุฎุต ุงูุชุฑุงุถู ููุนููู ุงูุฌุฏูุฏ
                    summary = { total: '3,800', count: '2', average: '1,900' };
                }
            }

            return summary || { total: '0', count: '0', average: '0' };
        }

        function createSalesByCustomerReport(dateRange, filters = {}) {
            console.log('๐ฅ ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ุงูุนููู ูู ุงูุจูุงูุงุช ุงูุญููููุฉ...', { dateRange, filters });

            try {
                // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ุงููุธุงู
                let salesData = [];
                let customersData = [];

                if (window.dataManager) {
                    salesData = window.dataManager.getSales();
                    customersData = window.dataManager.getCustomers();
                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', salesData.length, 'ูุงุชูุฑุฉุ', customersData.length, 'ุนููู');
                } else {
                    // ุงูุฑุฌูุน ููุจูุงูุงุช ุงููุญููุฉ
                    salesData = JSON.parse(localStorage.getItem('monjizSales')) || [];
                    const invoicesData = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                    customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];

                    // ุฏูุฌ ุงูุจูุงูุงุช ูู ุงูููุชุงุญูู
                    salesData = [...salesData, ...invoicesData];

                    // ุฅุฒุงูุฉ ุงูููุฑุฑุงุช
                    salesData = salesData.filter((sale, index, self) =>
                        index === self.findIndex(s => s.id === sale.id)
                    );

                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู localStorage:', salesData.length, 'ูุงุชูุฑุฉุ', customersData.length, 'ุนููู');
                }

                // ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ (ููุณ ุงูุทุฑููุฉ ุงููุณุชุฎุฏูุฉ ูู ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ)
                console.log('๐ ูุทุงู ุงูุชุงุฑูุฎ ุงููุณุชูู:', dateRange);

                let filteredSales = salesData;
                let dateInfo = '';

                if (dateRange && dateRange.from && dateRange.to) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', dateRange);
                    const fromDate = new Date(dateRange.from);
                    const toDate = new Date(dateRange.to);
                    toDate.setHours(23, 59, 59, 999); // ููุงูุฉ ุงูููู

                    filteredSales = salesData.filter(sale => {
                        if (!sale.date && !sale.createdAt) return false;

                        let saleDate;
                        if (sale.createdAt) {
                            saleDate = new Date(sale.createdAt);
                        } else if (sale.date) {
                            // ูุญุงููุฉ ุชุญููู ุงูุชุงุฑูุฎ ุจุชูุณููุงุช ูุฎุชููุฉ
                            if (sale.date.includes('/')) {
                                // ุชูุณูู DD/MM/YYYY
                                const parts = sale.date.split('/');
                                if (parts.length === 3) {
                                    saleDate = new Date(parts[2], parts[1] - 1, parts[0]);
                                }
                            } else {
                                saleDate = new Date(sale.date);
                            }
                        }

                        return saleDate && saleDate >= fromDate && saleDate <= toDate;
                    });

                    const fromDateFormatted = `${fromDate.getDate().toString().padStart(2, '0')}/${(fromDate.getMonth() + 1).toString().padStart(2, '0')}/${fromDate.getFullYear()}`;
                    const toDateFormatted = `${toDate.getDate().toString().padStart(2, '0')}/${(toDate.getMonth() + 1).toString().padStart(2, '0')}/${toDate.getFullYear()}`;

                    if (fromDateFormatted === toDateFormatted) {
                        dateInfo = fromDateFormatted;
                    } else {
                        dateInfo = `${fromDateFormatted} - ${toDateFormatted}`;
                    }

                    console.log('๐ ุงููุจูุนุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', filteredSales.length, 'ูุงุชูุฑุฉ');
                } else {
                    // ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุชุงุฑูุฎุ ุงุณุชุฎุฏู ุงูููู ุงูุญุงูู
                    const today = new Date();
                    const todayStr = today.toISOString().split('T')[0];
                    const todayDDMMYYYY = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;

                    filteredSales = salesData.filter(sale => {
                        if (!sale.date && !sale.createdAt) return false;

                        if (sale.date) {
                            // ุชุญูู ูู ุชูุณููุงุช ูุฎุชููุฉ
                            if (sale.date === todayDDMMYYYY || sale.date === todayStr) {
                                return true;
                            }

                            // ูุญุงููุฉ ุชุญููู ููุงุฑู
                            try {
                                const saleDate = new Date(sale.date);
                                const saleDateStr = saleDate.toISOString().split('T')[0];
                                return saleDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        if (sale.createdAt) {
                            try {
                                const createdDate = new Date(sale.createdAt);
                                const createdDateStr = createdDate.toISOString().split('T')[0];
                                return createdDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        return false;
                    });

                    dateInfo = todayDDMMYYYY;
                    console.log('๐ ูุจูุนุงุช ุงูููู (ุงูุชุฑุงุถู):', filteredSales.length, 'ูุงุชูุฑุฉ');
                }

                // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููููุชุฑุฉ ุจุฏูุงู ูู ุงูุจูุงูุงุช ุงูุฃุตููุฉ
                salesData = filteredSales;

                // ุชุทุจูู ููุชุฑ ุงูุนููู ุงููุญุฏุฏ ุฅุฐุง ูุฌุฏ
                let selectedCustomer = null;
                let reportData = {};

                if (filters.account && filters.account !== '') {
                    // ุงูุจุญุซ ุนู ุงูุนููู ุงููุญุฏุฏ
                    selectedCustomer = customersData.find(c => c.id == filters.account);

                    if (selectedCustomer) {
                        console.log('๐ค ุงูุนููู ุงููุฎุชุงุฑ:', selectedCustomer.name);

                        // ููุชุฑุฉ ุงููุจูุนุงุช ููุนููู ุงููุญุฏุฏ
                        const customerSales = salesData.filter(sale => {
                            return sale.customerId == selectedCustomer.id ||
                                   sale.customerName === selectedCustomer.name ||
                                   sale.customer === selectedCustomer.name;
                        });

                        console.log('๐ ููุงุชูุฑ ุงูุนููู:', customerSales.length);

                        // ุชุญููู ุงูุจูุงูุงุช ุฅูู ุชูุณูู ุงูุชูุฑูุฑ
                        const customerInvoices = customerSales.map(sale => {
                            // ุชุญููู ุทุฑููุฉ ุงูุฏูุน ููุนุฑุจูุฉ
                            const paymentMethodMap = {
                                'cash': 'ููุฏุงู',
                                'card': 'ุจุทุงูุฉ ุงุฆุชูุงู',
                                'bank': 'ุชุญููู ุจููู',
                                'credit': 'ุขุฌู'
                            };
                            const paymentMethod = paymentMethodMap[sale.paymentMethod] || sale.paymentMethod || 'ุบูุฑ ูุญุฏุฏ';

                            // ุงุณุชุฎุฑุงุฌ ุงูููุชุฌุงุช
                            let products = 'ุบูุฑ ูุญุฏุฏ';
                            if (sale.items && sale.items.length > 0) {
                                products = sale.items.map(item => item.name || item.productName).join(', ');
                            } else if (sale.products && sale.products.length > 0) {
                                products = sale.products.map(item => item.name || item.productName).join(', ');
                            }

                            // ุชุญุฏูุฏ ุงูุญุงูุฉ
                            const statusMap = {
                                'completed': 'ูุฏููุนุฉ',
                                'paid': 'ูุฏููุนุฉ',
                                'pending': 'ูุนููุฉ',
                                'cancelled': 'ููุบูุฉ'
                            };
                            const status = statusMap[sale.status] || 'ูุฏููุนุฉ';

                            return {
                                id: sale.id,
                                date: sale.date || new Date(sale.createdAt).toLocaleDateString('ar-EG'),
                                amount: parseFloat(sale.total) || 0,
                                method: paymentMethod,
                                products: products,
                                status: status
                            };
                        });

                        // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                        const totalAmount = customerInvoices.reduce((sum, inv) => sum + inv.amount, 0);
                        const totalInvoices = customerInvoices.length;
                        const averageInvoice = totalInvoices > 0 ? totalAmount / totalInvoices : 0;

                        reportData = {
                            type: 'customer-detail',
                            customer: {
                                ...selectedCustomer,
                                status: selectedCustomer.type === 'company' ? 'VIP' : 'ูุดุท'
                            },
                            invoices: customerInvoices,
                            total: totalAmount,
                            count: totalInvoices,
                            average: averageInvoice,
                            dateInfo: dateInfo
                        };
                    }
                } else {
                    // ุนุฑุถ ููุฎุต ุฌููุน ุงูุนููุงุก
                    console.log('๐ ุฅูุดุงุก ููุฎุต ุฌููุน ุงูุนููุงุก...');

                    // ุชุฌููุน ุงููุจูุนุงุช ุญุณุจ ุงูุนููู
                    const customerSummary = {};

                    salesData.forEach(sale => {
                        let customerId = sale.customerId;
                        let customerName = sale.customerName || sale.customer || 'ุนููู ุบูุฑ ูุญุฏุฏ';

                        // ุงูุจุญุซ ุนู ุงูุนููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
                        let customer = null;
                        if (customerId) {
                            customer = customersData.find(c => c.id == customerId);
                        } else {
                            customer = customersData.find(c => c.name === customerName);
                        }

                        if (customer) {
                            customerId = customer.id;
                            customerName = customer.name;
                        }

                        const customerKey = customerId || customerName;

                        if (!customerSummary[customerKey]) {
                            customerSummary[customerKey] = {
                                id: customerId,
                                name: customerName,
                                invoices: 0,
                                total: 0,
                                lastPurchase: sale.date || new Date(sale.createdAt).toLocaleDateString('ar-EG'),
                                status: customer ? (customer.type === 'company' ? 'VIP' : 'ูุดุท') : 'ูุดุท'
                            };
                        }

                        customerSummary[customerKey].invoices++;
                        customerSummary[customerKey].total += parseFloat(sale.total) || 0;

                        // ุชุญุฏูุซ ุขุฎุฑ ุนูููุฉ ุดุฑุงุก
                        const saleDate = sale.date || new Date(sale.createdAt).toLocaleDateString('ar-EG');
                        if (saleDate > customerSummary[customerKey].lastPurchase) {
                            customerSummary[customerKey].lastPurchase = saleDate;
                        }
                    });

                    const customersArray = Object.values(customerSummary);
                    const totalAmount = customersArray.reduce((sum, customer) => sum + customer.total, 0);
                    const totalInvoices = customersArray.reduce((sum, customer) => sum + customer.invoices, 0);

                    reportData = {
                        type: 'customers-summary',
                        customers: customersArray,
                        total: totalAmount,
                        count: customersArray.length,
                        totalInvoices: totalInvoices,
                        average: customersArray.length > 0 ? totalAmount / customersArray.length : 0,
                        dateInfo: dateInfo
                    };
                }

                console.log('๐ ุจูุงูุงุช ุงูุชูุฑูุฑ:', reportData);

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ุฅุฌูุงูู ุงููุจูุนุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.total)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">${reportData.type === 'customer-detail' ? '๐ ุนุฏุฏ ุงูููุงุชูุฑ' : '๐ฅ ุนุฏุฏ ุงูุนููุงุก'}</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.type === 'customer-detail' ? reportData.count : reportData.count}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ูุชูุณุท ${reportData.type === 'customer-detail' ? 'ุงููุงุชูุฑุฉ' : 'ุงูุนููู'}</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.average)}</div>
                            </div>
                            ${reportData.type === 'customers-summary' ? `
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุฅุฌูุงูู ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.totalInvoices}</div>
                            </div>
                            ` : ''}
                            ${reportData.type === 'customer-detail' && reportData.customer ? `
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">โญ ุญุงูุฉ ุงูุนููู</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.customer.status}</div>
                            </div>
                            ` : ''}
                        </div>

                        <!-- ุฌุฏูู ุงูุจูุงูุงุช ุญุณุจ ููุน ุงูุนุฑุถ -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                                ${reportData.type === 'customer-detail' ?
                                  `๐ค ููุงุชูุฑ ุงูุนููู: ${reportData.customer.name} - ${dateInfo}` :
                                  `๐ฅ ููุฎุต ุงููุจูุนุงุช ุญุณุจ ุงูุนููู - ${dateInfo}`}
                            </h3>

                            ${reportData.type === 'customer-detail' ? `
                                <!-- ุนุฑุถ ุชูุงุตูู ููุงุชูุฑ ุงูุนููู ุงููุญุฏุฏ -->
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 0.9em;">
                                        <div><strong>๐ ุงููุงุชู:</strong> ${reportData.customer.phone}</div>
                                        <div><strong>๐ง ุงูุจุฑูุฏ:</strong> ${reportData.customer.email}</div>
                                        <div><strong>๐ ุขุฎุฑ ุดุฑุงุก:</strong> ${reportData.customer.lastPurchase}</div>
                                        <div><strong>โญ ุงูุญุงูุฉ:</strong> <span style="color: ${reportData.customer.status === 'VIP' ? '#dc3545' : '#28a745'}; font-weight: bold;">${reportData.customer.status}</span></div>
                                    </div>
                                </div>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุชุงุฑูุฎ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุจูุบ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุทุฑููุฉ ุงูุฏูุน</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูููุชุฌุงุช</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุญุงูุฉ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${reportData.invoices.map((invoice, index) => {
                                                const isEven = index % 2 === 0;
                                                const statusColor = invoice.status === 'ูุฏููุนุฉ' ? '#28a745' : '#ffc107';
                                                const statusBg = invoice.status === 'ูุฏููุนุฉ' ? '#d4edda' : '#fff3cd';

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${invoice.id}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${invoice.date}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(invoice.amount)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${invoice.method}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057; font-size: 0.9em;">${invoice.products}</td>
                                                        <td style="padding: 14px 12px; text-align: center;">
                                                            <span style="background: ${statusBg}; color: ${statusColor}; padding: 6px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; border: 1px solid ${statusColor};">
                                                                ${invoice.status}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            ` : `
                                <!-- ุนุฑุถ ููุฎุต ุฌููุน ุงูุนููุงุก -->
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงุณู ุงูุนููู</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุฅุฌูุงูู ุงููุจูุนุงุช</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุขุฎุฑ ุดุฑุงุก</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุญุงูุฉ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${reportData.customers.map((customer, index) => {
                                                const isEven = index % 2 === 0;
                                                const avgInvoice = customer.total / customer.invoices;
                                                const statusColor = customer.status === 'VIP' ? '#dc3545' : '#28a745';
                                                const statusBg = customer.status === 'VIP' ? '#f8d7da' : '#d4edda';

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${customer.name}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057; font-weight: 600;">${customer.invoices}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(customer.total)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${formatCurrency(avgInvoice)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057; font-size: 0.9em;">${customer.lastPurchase}</td>
                                                        <td style="padding: 14px 12px; text-align: center;">
                                                            <span style="background: ${statusBg}; color: ${statusColor}; padding: 6px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; border: 1px solid ${statusColor};">
                                                                ${customer.status}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            `}
                        </div>

                        <!-- ูุนูููุงุช ุฅุถุงููุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ ููุฎุต ุงูุฃุฏุงุก</h4>
                                <div style="color: #495057; line-height: 1.6;">
                                    ${reportData.type === 'customer-detail' ? `
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุจูุนุงุช: <strong style="color: #28a745;">${formatCurrency(reportData.total)}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูููุงุชูุฑ: <strong>${reportData.count}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ูุชูุณุท ุงููุงุชูุฑุฉ: <strong style="color: #667eea;">${formatCurrency(reportData.average)}</strong></div>
                                        <div>โข ุญุงูุฉ ุงูุนููู: <strong style="color: ${reportData.customer.status === 'VIP' ? '#dc3545' : '#28a745'};">${reportData.customer.status}</strong></div>
                                    ` : `
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุจูุนุงุช: <strong style="color: #28a745;">${formatCurrency(reportData.total)}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูุนููุงุก: <strong>${reportData.count}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ูุชูุณุท ุงูุนููู: <strong style="color: #667eea;">${formatCurrency(reportData.average)}</strong></div>
                                        <div>โข ุฅุฌูุงูู ุงูููุงุชูุฑ: <strong>${reportData.totalInvoices}</strong></div>
                                    `}
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #28a745;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ฏ ูุตุงุฆุญ ูุชุญุณูู ุงููุจูุนุงุช</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    ${reportData.type === 'customer-detail' ? `
                                        <div style="margin-bottom: 8px;">โข ูุชุงุจุนุฉ ุงูุนููู ุจุงูุชุธุงู</div>
                                        <div style="margin-bottom: 8px;">โข ุชูุฏูู ุนุฑูุถ ุฎุงุตุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ุชุญุณูู ุฎุฏูุฉ ูุง ุจุนุฏ ุงูุจูุน</div>
                                        <div>โข ุฒูุงุฏุฉ ูููุฉ ุงููุงุชูุฑุฉ ุงููุชูุณุทุฉ</div>
                                    ` : `
                                        <div style="margin-bottom: 8px;">โข ุงูุชุฑููุฒ ุนูู ุงูุนููุงุก ุงููููุฒูู</div>
                                        <div style="margin-bottom: 8px;">โข ุชุทููุฑ ุจุฑุงูุฌ ุงูููุงุก</div>
                                        <div style="margin-bottom: 8px;">โข ุชุญููู ุณููู ุงูุดุฑุงุก</div>
                                        <div>โข ุฒูุงุฏุฉ ุชูุฑุงุฑ ุงูุดุฑุงุก</div>
                                    `}
                                </div>
                            </div>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุชุตุฏูุฑ -->
                        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                            <button onclick="printReport()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(108, 117, 125, 0.3)'">
                                <i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ
                            </button>
                            <button onclick="exportToExcel('sales-by-customer')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                                <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="exportToPDF('sales-by-customer')" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(220, 53, 69, 0.3)'">
                                <i class="fas fa-file-pdf"></i> ุชุตุฏูุฑ PDF
                            </button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ุงูุนููู:', error);
                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 40px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center;">
                        <div style="color: #dc3545; margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 15px;"></i>
                            <h3>ุฎุทุฃ ูู ุชุญููู ุงูุชูุฑูุฑ</h3>
                            <p>ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ุงูุนููู. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.</p>
                        </div>
                        <button onclick="location.reload()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                        </button>
                    </div>
                `;
            }
        }

        function createSalesByProductReport(dateRange, filters = {}) {
            console.log('๐ฆ ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ ูู ุงูุจูุงูุงุช ุงูุญููููุฉ...', { dateRange, filters });

            try {
                // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ุงููุธุงู
                let salesData = [];
                let productsData = [];

                if (window.dataManager) {
                    salesData = window.dataManager.getSales();
                    productsData = window.dataManager.getProducts();
                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', salesData.length, 'ูุงุชูุฑุฉุ', productsData.length, 'ููุชุฌ');
                } else {
                    // ุงูุฑุฌูุน ููุจูุงูุงุช ุงููุญููุฉ
                    salesData = JSON.parse(localStorage.getItem('monjizSales')) || [];
                    const invoicesData = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                    productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];

                    // ุฏูุฌ ุงูุจูุงูุงุช ูู ุงูููุชุงุญูู
                    salesData = [...salesData, ...invoicesData];

                    // ุฅุฒุงูุฉ ุงูููุฑุฑุงุช
                    salesData = salesData.filter((sale, index, self) =>
                        index === self.findIndex(s => s.id === sale.id)
                    );

                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู localStorage:', salesData.length, 'ูุงุชูุฑุฉุ', productsData.length, 'ููุชุฌ');
                }

                // ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ (ููุณ ุงูุทุฑููุฉ ุงููุณุชุฎุฏูุฉ ูู ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ)
                console.log('๐ ูุทุงู ุงูุชุงุฑูุฎ ุงููุณุชูู:', dateRange);

                let filteredSales = salesData;
                let dateInfo = '';

                if (dateRange && dateRange.from && dateRange.to) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', dateRange);
                    const fromDate = new Date(dateRange.from);
                    const toDate = new Date(dateRange.to);
                    toDate.setHours(23, 59, 59, 999); // ููุงูุฉ ุงูููู

                    filteredSales = salesData.filter(sale => {
                        if (!sale.date && !sale.createdAt) {
                            console.log('โ ูุงุชูุฑุฉ ุจุฏูู ุชุงุฑูุฎ:', sale.id);
                            return false;
                        }

                        let saleDate;
                        if (sale.createdAt) {
                            saleDate = new Date(sale.createdAt);
                        } else if (sale.date) {
                            // ูุญุงููุฉ ุชุญููู ุงูุชุงุฑูุฎ ุจุชูุณููุงุช ูุฎุชููุฉ
                            if (sale.date.includes('/')) {
                                // ุชูุณูู DD/MM/YYYY
                                const parts = sale.date.split('/');
                                if (parts.length === 3) {
                                    saleDate = new Date(parts[2], parts[1] - 1, parts[0]);
                                }
                            } else {
                                saleDate = new Date(sale.date);
                            }
                        }

                        const isIncluded = saleDate && saleDate >= fromDate && saleDate <= toDate;
                        if (isIncluded) {
                            console.log('โ ูุงุชูุฑุฉ ูุดูููุฉ:', sale.id, 'ุชุงุฑูุฎ:', sale.date || sale.createdAt);
                        } else {
                            console.log('โ ูุงุชูุฑุฉ ูุณุชุจุนุฏุฉ:', sale.id, 'ุชุงุฑูุฎ:', sale.date || sale.createdAt, 'ุชุงุฑูุฎ ูุญูู:', saleDate);
                        }
                        return isIncluded;
                    });

                    const fromDateFormatted = `${fromDate.getDate().toString().padStart(2, '0')}/${(fromDate.getMonth() + 1).toString().padStart(2, '0')}/${fromDate.getFullYear()}`;
                    const toDateFormatted = `${toDate.getDate().toString().padStart(2, '0')}/${(toDate.getMonth() + 1).toString().padStart(2, '0')}/${toDate.getFullYear()}`;

                    if (fromDateFormatted === toDateFormatted) {
                        dateInfo = fromDateFormatted;
                    } else {
                        dateInfo = `${fromDateFormatted} - ${toDateFormatted}`;
                    }

                    console.log('๐ ุงููุจูุนุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', filteredSales.length, 'ูุงุชูุฑุฉ');
                } else {
                    // ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุชุงุฑูุฎุ ุงุณุชุฎุฏู ุงูููู ุงูุญุงูู
                    const today = new Date();
                    const todayStr = today.toISOString().split('T')[0];
                    const todayDDMMYYYY = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;

                    filteredSales = salesData.filter(sale => {
                        if (!sale.date && !sale.createdAt) return false;

                        if (sale.date) {
                            // ุชุญูู ูู ุชูุณููุงุช ูุฎุชููุฉ
                            if (sale.date === todayDDMMYYYY || sale.date === todayStr) {
                                return true;
                            }

                            // ูุญุงููุฉ ุชุญููู ููุงุฑู
                            try {
                                const saleDate = new Date(sale.date);
                                const saleDateStr = saleDate.toISOString().split('T')[0];
                                return saleDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        if (sale.createdAt) {
                            try {
                                const createdDate = new Date(sale.createdAt);
                                const createdDateStr = createdDate.toISOString().split('T')[0];
                                return createdDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        return false;
                    });

                    dateInfo = todayDDMMYYYY;
                    console.log('๐ ูุจูุนุงุช ุงูููู (ุงูุชุฑุงุถู):', filteredSales.length, 'ูุงุชูุฑุฉ');
                }

                // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููููุชุฑุฉ ุจุฏูุงู ูู ุงูุจูุงูุงุช ุงูุฃุตููุฉ
                salesData = filteredSales;

                // ุชุทุจูู ููุชุฑ ุงูููุชุฌ ุงููุญุฏุฏ ุฅุฐุง ูุฌุฏ
                let selectedProduct = null;
                let reportData = {};

                if (filters.account && filters.account !== '') {
                    // ุงูุจุญุซ ุนู ุงูููุชุฌ ุงููุญุฏุฏ
                    selectedProduct = productsData.find(p => p.id == filters.account);

                    if (selectedProduct) {
                        console.log('๐ฆ ุงูููุชุฌ ุงููุฎุชุงุฑ:', selectedProduct.name);

                        // ููุชุฑุฉ ุงููุจูุนุงุช ููููุชุฌ ุงููุญุฏุฏ
                        const productSales = [];

                        salesData.forEach(sale => {
                            const items = sale.items || sale.products || [];
                            items.forEach(item => {
                                if (item.productId == selectedProduct.id ||
                                    item.name === selectedProduct.name ||
                                    item.productName === selectedProduct.name) {

                                    // ุงูุจุญุซ ุนู ุงุณู ุงูุนููู
                                    let customerName = sale.customerName || sale.customer || 'ุนููู ุบูุฑ ูุญุฏุฏ';

                                    productSales.push({
                                        invoiceId: sale.id,
                                        date: sale.date || new Date(sale.createdAt).toLocaleDateString('ar-EG'),
                                        customer: customerName,
                                        quantity: item.quantity || 1,
                                        unitPrice: item.price || item.unitPrice || selectedProduct.salePrice || 0,
                                        total: item.total || (item.quantity * (item.price || item.unitPrice)) || 0,
                                        profit: 0 // ุณูุชู ุญุณุงุจู
                                    });
                                }
                            });
                        });

                        // ุญุณุงุจ ุงูุฑุจุญ ููู ูุงุชูุฑุฉ
                        productSales.forEach(sale => {
                            const costPrice = selectedProduct.purchasePrice || selectedProduct.costPrice || selectedProduct.cost || 0;
                            sale.profit = sale.quantity * (sale.unitPrice - costPrice);
                        });

                        // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                        const totalQuantity = productSales.reduce((sum, sale) => sum + sale.quantity, 0);
                        const totalSales = productSales.reduce((sum, sale) => sum + sale.total, 0);
                        const totalProfit = productSales.reduce((sum, sale) => sum + sale.profit, 0);
                        const profitMargin = totalSales > 0 ? (totalProfit / totalSales * 100) : 0;

                        reportData = {
                            type: 'product-detail',
                            product: {
                                ...selectedProduct,
                                costPrice: selectedProduct.purchasePrice || selectedProduct.costPrice || selectedProduct.cost || 0,
                                profitMargin: profitMargin
                            },
                            sales: productSales,
                            totalQuantity: totalQuantity,
                            totalSales: totalSales,
                            totalProfit: totalProfit,
                            profitMargin: profitMargin,
                            dateInfo: dateInfo
                        };

                        console.log('๐ ูุจูุนุงุช ุงูููุชุฌ:', productSales.length, 'ูุงุชูุฑุฉ');
                    }
                } else {
                    // ุนุฑุถ ููุฎุต ุฌููุน ุงูููุชุฌุงุช
                    console.log('๐ ุฅูุดุงุก ููุฎุต ุฌููุน ุงูููุชุฌุงุช...');
                    console.log('๐ ุนุฏุฏ ุงููุจูุนุงุช ุงููููุชุฑุฉ ูููุนุงูุฌุฉ:', salesData.length);

                    // ุทุจุงุนุฉ ุนููุฉ ูู ุงููุจูุนุงุช ุงููููุชุฑุฉ ููุชุดุฎูุต
                    if (salesData.length > 0) {
                        console.log('๐ ุนููุฉ ูู ุงููุจูุนุงุช ุงููููุชุฑุฉ:', salesData.slice(0, 3).map(s => ({
                            id: s.id,
                            date: s.date,
                            createdAt: s.createdAt,
                            items: s.items ? s.items.length : 0,
                            products: s.products ? s.products.length : 0
                        })));
                    } else {
                        console.log('โ๏ธ ูุง ุชูุฌุฏ ูุจูุนุงุช ูููุชุฑุฉ ููุชุงุฑูุฎ ุงููุญุฏุฏ!');
                    }

                    // ุชุฌููุน ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ
                    const productSummary = {};

                    salesData.forEach((sale, index) => {
                        console.log(`๐ ูุนุงูุฌุฉ ูุงุชูุฑุฉ ${index + 1}:`, sale.id, 'ุชุงุฑูุฎ:', sale.date || sale.createdAt);
                        const items = sale.items || sale.products || [];
                        console.log(`  ๐ฆ ุนูุงุตุฑ ุงููุงุชูุฑุฉ ${sale.id}:`, items.length, 'ุนูุตุฑ');

                        items.forEach((item, itemIndex) => {
                            console.log(`    ๐ธ ุนูุตุฑ ${itemIndex + 1}:`, item.name || item.productName, 'ูููุฉ:', item.quantity);
                            let productId = item.productId;
                            let productName = item.name || item.productName || 'ููุชุฌ ุบูุฑ ูุญุฏุฏ';

                            // ุงูุจุญุซ ุนู ุงูููุชุฌ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
                            let product = null;
                            if (productId) {
                                product = productsData.find(p => p.id == productId);
                            } else {
                                product = productsData.find(p => p.name === productName);
                            }

                            if (product) {
                                productId = product.id;
                                productName = product.name;
                            }

                            const productKey = productId || productName;

                            if (!productSummary[productKey]) {
                                const costPrice = product ? (product.purchasePrice || product.costPrice || product.cost || 0) : 0;
                                const salePrice = product ? (product.salePrice || product.price || 0) : (item.price || item.unitPrice || 0);

                                productSummary[productKey] = {
                                    id: productId,
                                    name: productName,
                                    category: product ? product.category : 'ุบูุฑ ูุญุฏุฏ',
                                    quantity: 0,
                                    totalSales: 0,
                                    costPrice: costPrice,
                                    salePrice: salePrice,
                                    profit: 0,
                                    profitMargin: 0,
                                    invoices: 0
                                };
                            }

                            const quantity = item.quantity || 1;
                            const total = item.total || (quantity * (item.price || item.unitPrice)) || 0;
                            const costPrice = productSummary[productKey].costPrice;
                            const profit = quantity * ((item.price || item.unitPrice || 0) - costPrice);

                            productSummary[productKey].quantity += quantity;
                            productSummary[productKey].totalSales += total;
                            productSummary[productKey].profit += profit;
                            productSummary[productKey].invoices++;
                        });
                    });

                    // ุญุณุงุจ ูุงูุด ุงูุฑุจุญ ููู ููุชุฌ
                    Object.values(productSummary).forEach(product => {
                        if (product.totalSales > 0) {
                            product.profitMargin = (product.profit / product.totalSales) * 100;
                        }
                    });

                    const productsArray = Object.values(productSummary);
                    console.log('๐ ููุฎุต ุงูููุชุฌุงุช ุจุนุฏ ุงููุนุงูุฌุฉ:', productsArray.length, 'ููุชุฌ');
                    console.log('๐ ุนููุฉ ูู ุงูููุชุฌุงุช:', productsArray.slice(0, 3).map(p => ({
                        name: p.name,
                        quantity: p.quantity,
                        totalSales: p.totalSales,
                        invoices: p.invoices
                    })));

                    const totalSales = productsArray.reduce((sum, product) => sum + product.totalSales, 0);
                    const totalProfit = productsArray.reduce((sum, product) => sum + product.profit, 0);
                    const totalQuantity = productsArray.reduce((sum, product) => sum + product.quantity, 0);
                    const totalCost = totalSales - totalProfit;

                    console.log('๐ฐ ุงูุฅุฌูุงููุงุช:', {
                        totalSales,
                        totalProfit,
                        totalQuantity,
                        productsCount: productsArray.length
                    });

                    reportData = {
                        type: 'products-summary',
                        products: productsArray,
                        totalSales: totalSales,
                        totalProfit: totalProfit,
                        totalCost: totalCost,
                        totalQuantity: totalQuantity,
                        profitMargin: totalSales > 0 ? (totalProfit / totalSales * 100) : 0,
                        productsCount: productsArray.length,
                        dateInfo: dateInfo
                    };
                }

                console.log('๐ ุจูุงูุงุช ุงูุชูุฑูุฑ:', reportData);

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ุฅุฌูุงูู ุงููุจูุนุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.totalSales || reportData.totalSales)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ธ ุฅุฌูุงูู ุงูุชูููุฉ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.totalCost || (reportData.totalSales - reportData.totalProfit))}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุฅุฌูุงูู ุงูุฑุจุญ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.totalProfit)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ูุงูุด ุงูุฑุจุญ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${(reportData.profitMargin || 0).toFixed(1)}%</div>
                            </div>
                            ${reportData.type === 'products-summary' ? `
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.productsCount}</div>
                            </div>
                            ` : ''}
                            ${reportData.type === 'product-detail' ? `
                            <div style="background: linear-gradient(135deg, #6f42c1, #5a2d91); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(111, 66, 193, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุนุฏุฏ ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.sales ? reportData.sales.length : 0}</div>
                            </div>
                            ` : ''}
                        </div>

                        <!-- ุฌุฏูู ุงูุจูุงูุงุช ุญุณุจ ููุน ุงูุนุฑุถ -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #28a745; padding-bottom: 10px;">
                                ${reportData.type === 'product-detail' ?
                                  `๐ฆ ุชูุงุตูู ูุจูุนุงุช ุงูููุชุฌ: ${reportData.product.name} - ${reportData.dateInfo}` :
                                  `๐ ููุฎุต ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ - ${reportData.dateInfo}`}
                            </h3>

                            ${reportData.type === 'product-detail' ? `
                                <!-- ุนุฑุถ ุชูุงุตูู ูุจูุนุงุช ุงูููุชุฌ ุงููุญุฏุฏ -->
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 0.9em;">
                                        <div><strong>๐ท๏ธ ุงููุฆุฉ:</strong> ${reportData.product.category}</div>
                                        <div><strong>๐ฐ ุณุนุฑ ุงูุจูุน:</strong> ${formatCurrency(reportData.product.salePrice)}</div>
                                        <div><strong>๐ธ ุณุนุฑ ุงูุชูููุฉ:</strong> ${formatCurrency(reportData.product.costPrice)}</div>
                                        <div><strong>๐ ูุงูุด ุงูุฑุจุญ:</strong> <span style="color: #28a745; font-weight: bold;">${reportData.product.profitMargin.toFixed(1)}%</span></div>
                                    </div>
                                </div>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูุชุงุฑูุฎ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูุนููู</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงููููุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุณุนุฑ ุงููุญุฏุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูุฅุฌูุงูู</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูุฑุจุญ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${reportData.sales.map((sale, index) => {
                                                const isEven = index % 2 === 0;

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${sale.invoiceId}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${sale.date}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${sale.customer}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #17a2b8;">${sale.quantity}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${formatCurrency(sale.unitPrice)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(sale.total)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #ffc107; font-size: 1.05em;">${formatCurrency(sale.profit)}</td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                            <!-- ุตู ุงูุฅุฌูุงูู -->
                                            <tr style="background: linear-gradient(135deg, #28a745, #20c997); color: white; font-weight: bold;">
                                                <td colspan="3" style="padding: 16px 12px; text-align: center; font-size: 1.1em;">ุงูุฅุฌูุงูู</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.1em;">${reportData.totalQuantity}</td>
                                                <td style="padding: 16px 12px; text-align: center;">-</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.2em;">${formatCurrency(reportData.totalSales)}</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.2em;">${formatCurrency(reportData.totalProfit)}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            ` : `

                                <!-- ุนุฑุถ ููุฎุต ุฌููุน ุงูููุชุฌุงุช -->
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงุณู ุงูููุชุฌ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงููุฆุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงููููุฉ ุงููุจุงุนุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุฅุฌูุงูู ุงููุจูุนุงุช</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุฅุฌูุงูู ุงูุฑุจุญ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ูุงูุด ุงูุฑุจุญ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${reportData.products.map((product, index) => {
                                                const isEven = index % 2 === 0;
                                                const profitColor = product.profitMargin >= 25 ? '#28a745' : product.profitMargin >= 15 ? '#ffc107' : '#dc3545';

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${product.name}</td>
                                                        <td style="padding: 14px 12px; text-align: center;">
                                                            <span style="background: #e9ecef; color: #495057; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 600;">
                                                                ${product.category}
                                                            </span>
                                                        </td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #17a2b8; font-size: 1.05em;">${product.quantity}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(product.totalSales)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #ffc107; font-size: 1.05em;">${formatCurrency(product.profit)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: ${profitColor}; font-size: 1.05em;">
                                                            ${product.profitMargin.toFixed(1)}%
                                                        </td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057; font-weight: 600;">${product.invoices}</td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                            <!-- ุตู ุงูุฅุฌูุงูู -->
                                            <tr style="background: linear-gradient(135deg, #28a745, #20c997); color: white; font-weight: bold;">
                                                <td colspan="2" style="padding: 16px 12px; text-align: center; font-size: 1.1em;">ุงูุฅุฌูุงูู</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.1em;">${reportData.totalQuantity}</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.2em;">${formatCurrency(reportData.totalSales)}</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.2em;">${formatCurrency(reportData.totalProfit)}</td>
                                                <td style="padding: 16px 12px; text-align: center; font-size: 1.1em;">${reportData.profitMargin.toFixed(1)}%</td>
                                                <td style="padding: 16px 12px; text-align: center;">-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            `}
                        </div>

                        <!-- ูุนูููุงุช ุฅุถุงููุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #28a745;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ ููุฎุต ุงูุฃุฏุงุก</h4>
                                <div style="color: #495057; line-height: 1.6;">
                                    ${reportData.type === 'product-detail' ? `
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุจูุนุงุช: <strong style="color: #28a745;">${formatCurrency(reportData.totalSales)}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุงููููุฉ ุงููุจุงุนุฉ: <strong>${reportData.totalQuantity}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงูุฑุจุญ: <strong style="color: #ffc107;">${formatCurrency(reportData.totalProfit)}</strong></div>
                                        <div>โข ูุงูุด ุงูุฑุจุญ: <strong style="color: #28a745;">${reportData.profitMargin.toFixed(1)}%</strong></div>
                                    ` : `
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุจูุนุงุช: <strong style="color: #28a745;">${formatCurrency(reportData.totalSales)}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูููุชุฌุงุช: <strong>${reportData.productsCount}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงูุฑุจุญ: <strong style="color: #ffc107;">${formatCurrency(reportData.totalProfit)}</strong></div>
                                        <div>โข ูุงูุด ุงูุฑุจุญ ุงูุนุงู: <strong style="color: #28a745;">${reportData.profitMargin.toFixed(1)}%</strong></div>
                                    `}
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ฏ ูุตุงุฆุญ ูุชุญุณูู ุงูุฑุจุญูุฉ</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    ${reportData.type === 'product-detail' ? `
                                        <div style="margin-bottom: 8px;">โข ุชุญููู ุฃููุงุช ุงูุฐุฑูุฉ ูููุจูุนุงุช</div>
                                        <div style="margin-bottom: 8px;">โข ุชุทููุฑ ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุณุนูุฑ</div>
                                        <div style="margin-bottom: 8px;">โข ุชุญุณูู ุฅุฏุงุฑุฉ ุงููุฎุฒูู</div>
                                        <div>โข ุฒูุงุฏุฉ ุงูุทูุจ ูู ุฎูุงู ุงูุชุณููู</div>
                                    ` : `
                                        <div style="margin-bottom: 8px;">โข ุงูุชุฑููุฒ ุนูู ุงูููุชุฌุงุช ุนุงููุฉ ุงูุฑุจุญ</div>
                                        <div style="margin-bottom: 8px;">โข ูุฑุงุฌุนุฉ ุชูุงููู ุงูููุชุฌุงุช ุงูุถุนููุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ุชุทููุฑ ููุชุฌุงุช ุฌุฏูุฏุฉ ูุฑุจุญุฉ</div>
                                        <div>โข ุชุญุณูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุณููู</div>
                                    `}
                                </div>
                            </div>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุชุตุฏูุฑ -->
                        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                            <button onclick="printReport()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(108, 117, 125, 0.3)'">
                                <i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ
                            </button>
                            <button onclick="exportToExcel('sales-by-product')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                                <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="exportToPDF('sales-by-product')" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(220, 53, 69, 0.3)'">
                                <i class="fas fa-file-pdf"></i> ุชุตุฏูุฑ PDF
                            </button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ:', error);
                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 40px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center;">
                        <div style="color: #dc3545; margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 15px;"></i>
                            <h3>ุฎุทุฃ ูู ุชุญููู ุงูุชูุฑูุฑ</h3>
                            <p>ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.</p>
                        </div>
                        <button onclick="location.reload()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                        </button>
                    </div>
                `;
            }
        }

        function createStockMovementReport(currentDate, filters = {}) {
            console.log('๐ฆ ุฅูุดุงุก ุชูุฑูุฑ ุญุฑูุฉ ุงููุฎุฒูู...', { currentDate, filters });

            // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุธุงู ุงููุฑูุฒู
            if (!window.dataManager) {
                console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุฑูุฒู...');
                window.dataManager = new DataManager();
            }

            // ุงูุญุตูู ุนูู ุญุฑูุงุช ุงููุฎุฒูู ุงูุญููููุฉ ููุท
            let stockMovements = window.dataManager.getStockMovements() || [];
            console.log('๐ฆ ุญุฑูุงุช ุงููุฎุฒูู ุงูููุฌูุฏุฉ ูุจู ุงูููุชุฑุฉ:', stockMovements.length, 'ุญุฑูุฉ');

            // ุงูุญุตูู ุนูู ูุงุฆูุฉ ุงูููุชุฌุงุช ุงูุญููููุฉ ููุชุญูู ูู ุตุญุฉ ุงูุญุฑูุงุช
            let realProducts = [];
            if (window.dataManager) {
                realProducts = window.dataManager.getProducts();
            } else {
                realProducts = JSON.parse(localStorage.getItem('monjizProducts')) || [];
            }

            // ูุงุฆูุฉ ุงูููุชุฌุงุช ุงูููููุฉ ุงูุชู ูุฌุจ ุงุณุชุจุนุงุฏูุง
            const fakeProductNames = [
                'ูุงุจุชูุจ ุฏูู XPS 13',
                'ูุงุจุชูุจ ุฏูู',
                'ูุงุชู ุขูููู 14',
                'ูุงุชู ุขูููู',
                'ุขูููู',
                'ูุงุจุชูุจ',
                'ูุชุงุจ ุฅุฏุงุฑุฉ ุงูุฃุนูุงู',
                'ุดุงูุจู ููุดุนุฑ',
                'ูููุต ูุทูู'
            ];

            // ููุชุฑุฉ ุงูููุชุฌุงุช ูุงุณุชุจุนุงุฏ ุงูููุชุฌุงุช ุงูููููุฉ
            realProducts = realProducts.filter(product => {
                const isFake = fakeProductNames.some(fakeName => {
                    const productName = product.name || '';
                    const fakeNameStr = fakeName || '';
                    return (productName && fakeNameStr && productName.includes(fakeNameStr)) ||
                           (fakeNameStr && productName && fakeNameStr.includes(productName));
                });

                if (isFake) {
                    console.log('โ ุชู ุงุณุชุจุนุงุฏ ููุชุฌ ูููู:', product.name);
                }

                return !isFake;
            });

            const realProductIds = new Set(realProducts.map(p => String(p.id)));
            const realProductNames = new Set(realProducts.map(p => p.name));

            console.log('๐ ุงูููุชุฌุงุช ุงูุญููููุฉ ุจุนุฏ ุงูููุชุฑุฉ:', realProducts.length, 'ููุชุฌ');
            console.log('๐ ุฃุณูุงุก ุงูููุชุฌุงุช ุงูุญููููุฉ:', Array.from(realProductNames).slice(0, 5));

            // ููุชุฑุฉ ุงูุญุฑูุงุช ููุงุญุชูุงุธ ุจุงูุญุฑูุงุช ุงูุญููููุฉ ููุท
            const originalCount = stockMovements.length;
            stockMovements = stockMovements.filter(movement => {
                // ุงูุชุญูู ูู ุนุฏู ููู ุงูููุชุฌ ูู ุงูููุชุฌุงุช ุงูููููุฉ
                const isFakeProduct = fakeProductNames.some(fakeName => {
                    const productName = movement.productName || '';
                    const fakeNameStr = fakeName || '';
                    return (productName && fakeNameStr && productName.includes(fakeNameStr)) ||
                           (productName && fakeNameStr && fakeNameStr.includes(productName));
                });

                if (isFakeProduct) {
                    console.log('โ ุชู ุงุณุชุจุนุงุฏ ุญุฑูุฉ ููุชุฌ ูููู:', movement.productName);
                    return false;
                }

                // ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุฌ ูู ูุงุฆูุฉ ุงูููุชุฌุงุช ุงูุญููููุฉ
                const hasValidProductId = movement.productId && realProductIds.has(String(movement.productId));
                const hasValidProductName = movement.productName && realProductNames.has(movement.productName);

                // ุงูุชุญูู ูู ูุฌูุฏ ุจูุงูุงุช ุฃุณุงุณูุฉ ุตุญูุญุฉ
                const hasValidData = movement.quantity &&
                                   movement.movementType &&
                                   (movement.createdAt || movement.date);

                const isValid = (hasValidProductId || hasValidProductName) && hasValidData;

                if (!isValid) {
                    console.log('โ ุชู ุงุณุชุจุนุงุฏ ุญุฑูุฉ ุบูุฑ ุตุญูุญุฉ:', {
                        productId: movement.productId,
                        productName: movement.productName,
                        hasValidProductId,
                        hasValidProductName,
                        hasValidData,
                        isFakeProduct
                    });
                }

                return isValid;
            });

            console.log(`๐งน ุชู ุชูุธูู ุงูุญุฑูุงุช: ${originalCount} โ ${stockMovements.length} ุญุฑูุฉ ุญููููุฉ`);

            // ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ
            if (filters.dateFrom || filters.dateTo) {
                const fromDate = filters.dateFrom ? new Date(filters.dateFrom) : new Date('1900-01-01');
                const toDate = filters.dateTo ? new Date(filters.dateTo) : new Date();

                // ุฅุถุงูุฉ ููู ูุงูู ูุชุงุฑูุฎ ุงูููุงูุฉ ููุชุฃูุฏ ูู ุชุถููู ุงูููู ูุงููุงู
                toDate.setHours(23, 59, 59, 999);

                console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', {
                    from: formatDateGregorian(fromDate),
                    to: formatDateGregorian(toDate)
                });

                stockMovements = stockMovements.filter(movement => {
                    const movementDate = new Date(movement.createdAt || movement.date);
                    return movementDate >= fromDate && movementDate <= toDate;
                });

                console.log('๐ฆ ุญุฑูุงุช ุงููุฎุฒูู ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', stockMovements.length, 'ุญุฑูุฉ');
            }

            // ุชุทุจูู ููุชุฑ ุงูุญุณุงุจ/ุงูููุชุฌ
            if (filters.account && filters.account !== '') {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูููุชุฌ:', filters.account, typeof filters.account);

                // ุงูุชุญูู ูู ุฃู ุงูููุชุฌ ุงููุฎุชุงุฑ ููุฌูุฏ ูู ุงูููุชุฌุงุช ุงูุญููููุฉ
                const selectedProduct = realProducts.find(p =>
                    String(p.id) === String(filters.account) ||
                    p.name === filters.account
                );

                if (!selectedProduct) {
                    console.log('โ ุงูููุชุฌ ุงููุฎุชุงุฑ ุบูุฑ ููุฌูุฏ ูู ุงูููุชุฌุงุช ุงูุญููููุฉ:', filters.account);
                    stockMovements = []; // ูุง ุชูุฌุฏ ุญุฑูุงุช ููููุชุฌ ุบูุฑ ุงูููุฌูุฏ
                } else {
                    console.log('โ ุงูููุชุฌ ุงููุฎุชุงุฑ ููุฌูุฏ:', selectedProduct.name, 'ID:', selectedProduct.id);

                    stockMovements = stockMovements.filter(movement => {
                        const matchById = String(movement.productId) === String(selectedProduct.id);
                        const matchByName = movement.productName === selectedProduct.name;
                        const matchByCode = movement.productCode === selectedProduct.code;

                        return matchById || matchByName || matchByCode;
                    });
                }

                console.log('๐ฆ ุญุฑูุงุช ุงููุฎุฒูู ุจุนุฏ ููุชุฑ ุงูููุชุฌ:', stockMovements.length, 'ุญุฑูุฉ');

                if (stockMovements.length > 0) {
                    console.log('โ ุงูุญุฑูุงุช ุงููุทุงุจูุฉ:', stockMovements.map(m => m.productName));
                }
            }

            // ุงูุชุญูู ูู ูุฌูุฏ ุญุฑูุงุช ูุฎุฒูู
            if (stockMovements.length === 0) {
                const noDataMessage = filters.account && filters.account !== '' ?
                    'ูุง ุชูุฌุฏ ุญุฑูุงุช ูุฎุฒูู ููุตูู ุงููุญุฏุฏ ูู ุงููุชุฑุฉ ุงููุฎุชุงุฑุฉ' :
                    'ูุง ุชูุฌุฏ ุญุฑูุงุช ูุฎุฒูู ุญููููุฉ ูู ุงููุธุงู';

                console.log('โ๏ธ', noDataMessage);
                return `
                    <div class="report-container">
                        <div class="report-content">
                            <div class="table-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="text-align: center; padding: 40px; color: #666;">
                                    <i class="fas fa-warehouse" style="font-size: 48px; margin-bottom: 20px; color: #ddd;"></i>
                                    <h3>${noDataMessage}</h3>
                                    <p>ุณุชุธูุฑ ุญุฑูุงุช ุงููุฎุฒูู ููุง ุนูุฏ ุฅุฌุฑุงุก ุนูููุงุช ุจูุน ุฃู ุดุฑุงุก ููููุชุฌุงุช ุงูููุฌูุฏุฉ ูู ุงููุธุงู</p>
                                    <div style="margin-top: 20px;">
                                        <button onclick="window.open('sales.html', '_blank')" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px;">
                                            <i class="fas fa-shopping-cart"></i> ุฅุถุงูุฉ ูุจูุนุงุช
                                        </button>
                                        <button onclick="window.open('purchases.html', '_blank')" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px;">
                                            <i class="fas fa-truck"></i> ุฅุถุงูุฉ ูุดุชุฑูุงุช
                                        </button>
                                        <button onclick="window.open('products.html', '_blank')" style="background: #6f42c1; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px;">
                                            <i class="fas fa-box"></i> ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            console.log('๐ฆ ุฅุฌูุงูู ุญุฑูุงุช ุงููุฎุฒูู ููุชูุฑูุฑ:', stockMovements.length, 'ุญุฑูุฉ');

            // ุชุฑุชูุจ ุงูุญุฑูุงุช ุญุณุจ ุงูุชุงุฑูุฎ (ุงูุฃุญุฏุซ ุฃููุงู)
            stockMovements.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช ุงูููุตูุฉ
            const totalMovements = stockMovements.length;
            const inMovements = stockMovements.filter(m => m.movementType === 'in');
            const outMovements = stockMovements.filter(m => m.movementType === 'out');
            const totalInQuantity = inMovements.reduce((sum, m) => sum + (m.quantity || 0), 0);
            const totalOutQuantity = outMovements.reduce((sum, m) => sum + (m.quantity || 0), 0);
            const netMovement = totalInQuantity - totalOutQuantity;

            // ุชุญููู ุญุณุจ ููุน ุงููุฑุฌุน
            const movementsByType = {
                purchase: stockMovements.filter(m => m.referenceType === 'purchase').length,
                sale: stockMovements.filter(m => m.referenceType === 'sale').length,
                adjustment: stockMovements.filter(m => m.referenceType === 'adjustment').length,
                transfer: stockMovements.filter(m => m.referenceType === 'transfer').length,
                manual: stockMovements.filter(m => m.referenceType === 'manual').length
            };

            // ุชุญููู ุญุณุจ ุงูููุชุฌุงุช
            const productMovements = {};
            stockMovements.forEach(movement => {
                if (!productMovements[movement.productId]) {
                    productMovements[movement.productId] = {
                        productName: movement.productName,
                        inQuantity: 0,
                        outQuantity: 0,
                        movementsCount: 0
                    };
                }

                if (movement.movementType === 'in') {
                    productMovements[movement.productId].inQuantity += movement.quantity || 0;
                } else {
                    productMovements[movement.productId].outQuantity += movement.quantity || 0;
                }
                productMovements[movement.productId].movementsCount++;
            });

            // ุฃูุซุฑ ุงูููุชุฌุงุช ุญุฑูุฉ
            const mostActiveProducts = Object.values(productMovements)
                .sort((a, b) => b.movementsCount - a.movementsCount)
                .slice(0, 5);

            // ุจูุงุก ุตููู ุงูุฌุฏูู ุงููุจุณุท
            let tableRows = '';
            if (stockMovements.length > 0) {
                stockMovements.forEach((movement, index) => {
                    // ุชุญุฏูุฏ ููุน ุงูุญุฑูุฉ ุจุดูู ูุจุณุท
                    const isIncoming = movement.movementType === 'in';
                    const typeText = isIncoming ? 'ูุงุฑุฏ' : 'ุตุงุฏุฑ';
                    const typeClass = isIncoming ? 'status-good' : 'status-warning';
                    const typeIcon = isIncoming ? '๐ฅ' : '๐ค';

                    // ุชุญุฏูุฏ ููุน ุงูุนูููุฉ
                    const operationType = {
                        'sale': 'ูุจูุนุงุช',
                        'purchase': 'ูุดุชุฑูุงุช',
                        'adjustment': 'ุชุณููุฉ',
                        'manual': 'ุชุนุฏูู',
                        'transfer': 'ุชุญููู'
                    }[movement.referenceType] || 'ุฃุฎุฑู';

                    // ุชูุณูู ุงููููุฉ ูุน ุงูุฃููุงู
                    const quantityDisplay = isIncoming ?
                        `<span style="color: #28a745; font-weight: bold;">+${movement.quantity}</span>` :
                        `<span style="color: #dc3545; font-weight: bold;">-${movement.quantity}</span>`;

                    // ุชูุณูู ุงูุชุงุฑูุฎ ุจุงููููุงุฏู
                    const movementDate = new Date(movement.createdAt || movement.date);
                    const displayDate = movementDate.toLocaleDateString('en-GB').split('/').reverse().join('-');

                    tableRows += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 6px; text-align: center; font-size: 12px;">${displayDate}</td>
                            <td style="padding: 6px;">
                                <strong style="font-size: 13px;">${movement.productName || 'ุบูุฑ ูุญุฏุฏ'}</strong>
                            </td>
                            <td style="padding: 6px; text-align: center;">
                                <span class="badge ${typeClass}" style="font-size: 10px; padding: 2px 6px;">${typeIcon} ${typeText}</span>
                            </td>
                            <td style="padding: 6px; text-align: center;">${quantityDisplay}</td>
                            <td style="padding: 6px; text-align: center; font-weight: bold;">${movement.newQuantity || 0}</td>
                            <td style="padding: 6px; text-align: center; font-size: 12px;">${movement.reference || operationType}</td>
                        </tr>
                    `;
                });
            } else {
                tableRows = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #666;">ูุง ุชูุฌุฏ ุญุฑูุงุช ูุฎุฒูู</td></tr>';
            }

            return `
                <div class="report-container">
                    <div class="report-content">
                        <!-- ุงูุฌุฏูู ุงูููุตู -->
                        <div class="table-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0; font-size: 16px; color: #333;">๐ฆ ุณุฌู ุญุฑูุงุช ุงููุฎุฒูู</h3>
                                <div style="font-size: 12px; color: #666;">
                                    <span><strong>ููุง ูู:</strong> ${currentDate}</span> |
                                    <span>ุฅุฌูุงูู ุงูุญุฑูุงุช: ${totalMovements}</span>
                                </div>
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="report-table enhanced" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูุชุงุฑูุฎ</th>
                                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #dee2e6;">ุงูููุชุฌ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูููุน</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงููููุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูุฑุตูุฏ ุงูุฌุฏูุฏ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงููุฑุฌุน</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${tableRows}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="report-actions" style="margin-top: 15px; text-align: center;">
                        <button onclick="window.print()" class="btn-print" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ ุทุจุงุนุฉ
                        </button>
                        <button onclick="exportToExcel('stock-movement')" class="btn-excel" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ Excel
                        </button>
                        <button onclick="exportToPDF('stock-movement')" class="btn-pdf" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ PDF
                        </button>
                    </div>
                </div>
            `;
        }

        function createProductOperationsReport(currentDate, filters = {}) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ุนูููุงุช ุตูู...');
            console.log('๐ ุงูููุงุชุฑ ุงููุณุชููุฉ:', JSON.stringify(filters, null, 2));

            // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุธุงู ุงููุฑูุฒู
            if (!window.dataManager) {
                console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุฑูุฒู...');
                window.dataManager = new DataManager();
            }

            // ุงูุญุตูู ุนูู ุงูููุชุฌุงุช ุงููุชุงุญุฉ
            const products = window.dataManager.getProducts() || [];

            // ุงูุชุญูู ูู ูุฌูุฏ ููุชุฌุงุช ูู ุงููุธุงู
            if (products.length === 0) {
                console.log('โ๏ธ ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงููุธุงู');
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุชูุฑูุฑ ุนูููุงุช ุตูู</h2>
                            <p>ููุง ูู ${currentDate}</p>
                        </div>
                        <div class="report-content">
                            <div style="text-align: center; padding: 40px; color: #666;">
                                <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 20px; color: #ddd;"></i>
                                <h3>ูุง ุชูุฌุฏ ููุชุฌุงุช</h3>
                                <p>ูุฌุจ ุฅุถุงูุฉ ููุชุฌุงุช ุฃููุงู ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุฎุฒูู</p>
                                <button onclick="window.open('inventory.html', '_blank')" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
                                    <i class="fas fa-plus"></i> ุฅุถุงูุฉ ููุชุฌุงุช
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ุงูุญุตูู ุนูู ุงูููุชุฌ ุงููุญุฏุฏ ูู ุงูููุงุชุฑ
            let selectedProduct = null;

            console.log('๐ ุงูุจุญุซ ุนู ุงูููุชุฌ ุงููุญุฏุฏ...');
            console.log('๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช ุงููุชุงุญุฉ:', products.length);

            // ุฃููุงู: ูุญุงููุฉ ุงูุญุตูู ุนูู ุงูููุชุฌ ูู ูุนุงูู filters
            if (filters.account && filters.account !== '') {
                const selectedId = filters.account;
                console.log('๐ฏ ุงูุจุญุซ ุนู ุงูููุชุฌ ุจุงููุนุฑู ูู filters:', selectedId);
                selectedProduct = products.find(p => p.id == selectedId || p.name === selectedId);
                if (selectedProduct) {
                    console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ ูู ูุนุงูู filters:', selectedProduct.name);
                } else {
                    console.log('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ ุจุงููุนุฑู:', selectedId);
                }
            }

            // ุซุงููุงู: ูุญุงููุฉ ุงูุญุตูู ุนูู ุงูููุชุฑ ูู DOM
            if (!selectedProduct) {
                const reportAccount = document.getElementById('report-account');
                console.log('๐ ูุญุต ุนูุตุฑ DOM:', reportAccount ? 'ููุฌูุฏ' : 'ุบูุฑ ููุฌูุฏ');
                if (reportAccount) {
                    console.log('๐ ูููุฉ ุงูููุชุฑ ูู DOM:', reportAccount.value);
                }
                if (reportAccount && reportAccount.value && reportAccount.value !== '') {
                    const selectedId = reportAccount.value;
                    console.log('๐ฏ ุงูุจุญุซ ุนู ุงูููุชุฌ ุจุงููุนุฑู ูู DOM:', selectedId);
                    selectedProduct = products.find(p => p.id == selectedId || p.name === selectedId);
                    if (selectedProduct) {
                        console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ ูู DOM:', selectedProduct.name);
                    } else {
                        console.log('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ ุจุงููุนุฑู:', selectedId);
                    }
                }
            }

            // ุฅุฐุง ูู ูุชู ุงุฎุชูุงุฑ ููุชุฌุ ุงุณุชุฎุฏู ุฃูู ููุชุฌ
            if (!selectedProduct) {
                selectedProduct = products[0];
                console.log('๐ฆ ุงุณุชุฎุฏุงู ุฃูู ููุชุฌ ูุงูุชุฑุงุถู:', selectedProduct?.name);
            }

            console.log('๐ฏ ุงูููุชุฌ ุงูููุงุฆู ุงููุญุฏุฏ:', selectedProduct?.name);

            if (!selectedProduct) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุชูุฑูุฑ ุนูููุงุช ุตูู</h2>
                            <p>ููุง ูู ${currentDate}</p>
                        </div>
                        <div class="report-content">
                            <p style="text-align: center; padding: 40px; color: #666;">ูุง ุชูุฌุฏ ููุชุฌุงุช ูุชุงุญุฉ</p>
                        </div>
                    </div>
                `;
            }

            // ุงูุญุตูู ุนูู ุงูุนูููุงุช ุงููุนููุฉ ููููุชุฌ ุงููุญุฏุฏ
            const operations = getProductOperations(selectedProduct, filters);

            // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
            const purchaseOperations = operations.filter(op => op.type === 'purchase');
            const saleOperations = operations.filter(op => op.type === 'sale');

            const totalPurchaseQuantity = purchaseOperations.reduce((sum, op) => sum + op.quantity, 0);
            const totalSaleQuantity = saleOperations.reduce((sum, op) => sum + op.quantity, 0);
            const totalPurchaseValue = purchaseOperations.reduce((sum, op) => sum + (op.quantity * op.price), 0);
            const totalSaleValue = saleOperations.reduce((sum, op) => sum + (op.quantity * op.price), 0);

            const avgPurchasePrice = totalPurchaseQuantity > 0 ? totalPurchaseValue / totalPurchaseQuantity : 0;
            const avgSalePrice = totalSaleQuantity > 0 ? totalSaleValue / totalSaleQuantity : 0;
            const totalProfit = totalSaleValue - (totalSaleQuantity * avgPurchasePrice);

            // ุจูุงุก ุตููู ุงูุฌุฏูู
            let tableRows = '';
            if (operations.length === 0) {
                tableRows = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                            <br>
                            <strong>ูุง ุชูุฌุฏ ุนูููุงุช ููููุชุฌ: ${selectedProduct.name}</strong>
                            <br>
                            <small>ูู ุจุฅุฌุฑุงุก ุนูููุงุช ุจูุน ุฃู ุดุฑุงุก ููุฐุง ุงูููุชุฌ ูุชุธูุฑ ููุง</small>
                            <br><br>
                            <button onclick="window.open('sales.html', '_blank')" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 12px;">
                                ๐ฐ ุฅุถุงูุฉ ูุจูุนุงุช
                            </button>
                            <button onclick="window.open('purchases.html', '_blank')" style="background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 12px;">
                                ๐ ุฅุถุงูุฉ ูุดุชุฑูุงุช
                            </button>
                        </td>
                    </tr>
                `;
            } else {
                operations.forEach((operation, index) => {
                    const isPurchase = operation.type === 'purchase';
                    const typeText = isPurchase ? 'ุดุฑุงุก' : 'ุจูุน';
                    const typeClass = isPurchase ? 'status-good' : 'status-warning';
                    const typeIcon = isPurchase ? '๐' : '๐ฐ';
                    const totalValue = operation.quantity * operation.price;

                    tableRows += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 6px; text-align: center; font-size: 12px;">${operation.date}</td>
                            <td style="padding: 6px; text-align: center;">
                                <span class="badge ${typeClass}" style="font-size: 10px; padding: 2px 6px;">${typeIcon} ${typeText}</span>
                            </td>
                            <td style="padding: 6px; text-align: center; font-weight: bold;">${operation.quantity}</td>
                            <td style="padding: 6px; text-align: center;">${formatNumber(operation.price)}</td>
                            <td style="padding: 6px; text-align: center; font-weight: bold; color: ${isPurchase ? '#28a745' : '#ffc107'};">${formatNumber(totalValue)}</td>
                            <td style="padding: 6px; text-align: center; font-size: 11px;">${operation.reference}</td>
                        </tr>
                    `;
                });
            }

            // ุฅุถุงูุฉ ุตููู ุงูุฅุฌูุงููุงุช
            let summaryRows = '';
            if (operations.length > 0) {
                // ุตู ุฅุฌูุงูู ุงููุดุชุฑูุงุช
                if (totalPurchaseQuantity > 0) {
                    summaryRows += `
                        <tr style="background-color: #e8f5e8; font-weight: bold;">
                            <td colspan="2"><strong>๐ ุฅุฌูุงูู ุงููุดุชุฑูุงุช</strong></td>
                            <td><strong>${totalPurchaseQuantity}</strong></td>
                            <td><strong>${formatNumber(avgPurchasePrice)}</strong></td>
                            <td><strong>${formatNumber(totalPurchaseValue)}</strong></td>
                            <td><strong>${purchaseOperations.length} ุนูููุฉ</strong></td>
                        </tr>
                    `;
                }

                // ุตู ุฅุฌูุงูู ุงููุจูุนุงุช
                if (totalSaleQuantity > 0) {
                    summaryRows += `
                        <tr style="background-color: #fff3cd; font-weight: bold;">
                            <td colspan="2"><strong>๐ฐ ุฅุฌูุงูู ุงููุจูุนุงุช</strong></td>
                            <td><strong>${totalSaleQuantity}</strong></td>
                            <td><strong>${formatNumber(avgSalePrice)}</strong></td>
                            <td><strong>${formatNumber(totalSaleValue)}</strong></td>
                            <td><strong>${saleOperations.length} ุนูููุฉ</strong></td>
                        </tr>
                    `;
                }

                // ุตู ุงูุฑุจุญ
                const profitColor = totalProfit >= 0 ? '#d4edda' : '#f8d7da';
                const profitTextColor = totalProfit >= 0 ? '#155724' : '#721c24';
                summaryRows += `
                    <tr style="background-color: ${profitColor}; font-weight: bold; color: ${profitTextColor};">
                        <td colspan="2"><strong>๐ ุตุงูู ุงูุฑุจุญ</strong></td>
                        <td><strong>${totalSaleQuantity - totalPurchaseQuantity}</strong></td>
                        <td><strong>-</strong></td>
                        <td><strong>${formatNumber(totalProfit)}</strong></td>
                        <td><strong>${totalProfit >= 0 ? 'ุฑุจุญ' : 'ุฎุณุงุฑุฉ'}</strong></td>
                    </tr>
                `;
            }

            return `
                <div class="report-container">
                    <div class="report-content">
                        <!-- ุงูุฌุฏูู ุงูููุตู -->
                        <div class="table-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0; font-size: 16px; color: #333;">๐ฆ ุนูููุงุช ุงูููุชุฌ: ${selectedProduct.name}</h3>
                                <div style="font-size: 12px; color: #666;">
                                    <span><strong>ุฅุฌูุงูู ุงูุนูููุงุช:</strong> ${operations.length}</span> |
                                    <span><strong>ูุดุชุฑูุงุช:</strong> ${purchaseOperations.length}</span> |
                                    <span><strong>ูุจูุนุงุช:</strong> ${saleOperations.length}</span>
                                </div>
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="report-table enhanced" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูุชุงุฑูุฎ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ููุน ุงูุนูููุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงููููุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงูุณุนุฑ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุฅุฌูุงูู ุงููููุฉ</th>
                                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #dee2e6;">ุงููุฑุฌุน</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${tableRows}
                                        ${summaryRows}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ููุฎุต ูุงูู ูุญุณู -->
                        <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                                <h4 style="margin: 0 0 10px 0; color: #155724;">๐ ุงููุดุชุฑูุงุช</h4>
                                <div style="font-size: 18px; font-weight: bold; color: #155724;">${formatNumber(totalPurchaseValue)} ุฑ.ุณ</div>
                                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                    ${totalPurchaseQuantity} ูุทุนุฉ | ูุชูุณุท ${formatNumber(avgPurchasePrice)} ุฑ.ุณ
                                </div>
                            </div>

                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; text-align: center;">
                                <h4 style="margin: 0 0 10px 0; color: #856404;">๐ฐ ุงููุจูุนุงุช</h4>
                                <div style="font-size: 18px; font-weight: bold; color: #856404;">${formatNumber(totalSaleValue)} ุฑ.ุณ</div>
                                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                    ${totalSaleQuantity} ูุทุนุฉ | ูุชูุณุท ${formatNumber(avgSalePrice)} ุฑ.ุณ
                                </div>
                            </div>

                            <div style="background: ${totalProfit >= 0 ? '#d4edda' : '#f8d7da'}; padding: 15px; border-radius: 8px; text-align: center;">
                                <h4 style="margin: 0 0 10px 0; color: ${totalProfit >= 0 ? '#155724' : '#721c24'};">๐ ุตุงูู ุงูุฑุจุญ</h4>
                                <div style="font-size: 18px; font-weight: bold; color: ${totalProfit >= 0 ? '#155724' : '#721c24'};">${formatNumber(totalProfit)} ุฑ.ุณ</div>
                                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                    ูุงูุด ${totalSaleValue > 0 ? formatNumber((totalProfit / totalSaleValue) * 100) : '0'}%
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="report-actions" style="margin-top: 15px; text-align: center;">
                        <button onclick="window.print()" class="btn-print" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ ุทุจุงุนุฉ
                        </button>
                        <button onclick="exportToExcel('product-operations')" class="btn-excel" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ Excel
                        </button>
                        <button onclick="exportToPDF('product-operations')" class="btn-pdf" style="margin: 0 5px; padding: 8px 15px; font-size: 13px;">
                            ๐ PDF
                        </button>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ููุญุตูู ุนูู ุงูุนูููุงุช ุงููุนููุฉ ููููุชุฌ
        function getProductOperations(product, filters = {}) {
            console.log('๐ ุฌูุจ ุงูุนูููุงุช ุงููุนููุฉ ููููุชุฌ:', product.name);

            const operations = [];

            try {
                // 1. ุฌูุจ ุนูููุงุช ุงูุจูุน (ุงููุจูุนุงุช)
                const sales = window.dataManager.getSales() || [];
                console.log('๐ฐ ุนุฏุฏ ููุงุชูุฑ ุงููุจูุนุงุช:', sales.length);

                sales.forEach(sale => {
                    if (sale.products && Array.isArray(sale.products)) {
                        sale.products.forEach(saleProduct => {
                            // ุงูุชุญูู ูู ุชุทุงุจู ุงูููุชุฌ
                            if (saleProduct.productId == product.id ||
                                saleProduct.name === product.name ||
                                saleProduct.id == product.id) {

                                operations.push({
                                    date: sale.date || formatDateGregorian(new Date()),
                                    type: 'sale',
                                    quantity: parseInt(saleProduct.quantity) || 0,
                                    price: parseFloat(saleProduct.price) || 0,
                                    reference: sale.invoiceNumber || `INV-${sale.id}`,
                                    createdAt: sale.createdAt || new Date().toISOString(),
                                    customer: sale.customerName || 'ุนููู ููุฏู'
                                });
                            }
                        });
                    }
                });

                // 2. ุฌูุจ ุนูููุงุช ุงูุดุฑุงุก (ุงููุดุชุฑูุงุช) ูู ูุตุงุฏุฑ ูุชุนุฏุฏุฉ
                let purchases = [];

                // ุงููุญุงููุฉ ุงูุฃููู: ุงููุธุงู ุงููุฑูุฒู ุจุทุฑู ูุชุนุฏุฏุฉ
                if (window.dataManager) {
                    if (window.dataManager.getPurchases) {
                        purchases = window.dataManager.getPurchases() || [];
                        console.log('๐ ุฌูุจ ุงููุดุชุฑูุงุช ูู getPurchases():', purchases.length);
                    } else if (window.dataManager.purchases) {
                        purchases = window.dataManager.purchases || [];
                        console.log('๐ ุฌูุจ ุงููุดุชุฑูุงุช ูู dataManager.purchases:', purchases.length);
                    } else if (window.dataManager.data && window.dataManager.data.purchases) {
                        purchases = window.dataManager.data.purchases || [];
                        console.log('๐ ุฌูุจ ุงููุดุชุฑูุงุช ูู dataManager.data.purchases:', purchases.length);
                    }
                }

                // ุงููุญุงููุฉ ุงูุซุงููุฉ: localStorage ูุจุงุดุฑุฉ
                if (purchases.length === 0) {
                    purchases = JSON.parse(localStorage.getItem('monjizPurchases')) || [];
                    console.log('๐ ุฌูุจ ุงููุดุชุฑูุงุช ูู localStorage:', purchases.length);
                }

                // ุงููุญุงููุฉ ุงูุซุงูุซุฉ: ุฃุณูุงุก ูุฎุชููุฉ ูู localStorage
                if (purchases.length === 0) {
                    const alternativeKeys = ['purchases', 'monjizPurchaseInvoices', 'purchaseInvoices'];
                    for (const key of alternativeKeys) {
                        const data = JSON.parse(localStorage.getItem(key)) || [];
                        if (data.length > 0) {
                            purchases = data;
                            console.log(`๐ ุฌูุจ ุงููุดุชุฑูุงุช ูู ${key}:`, purchases.length);
                            break;
                        }
                    }
                }

                console.log('๐ ุฅุฌูุงูู ููุงุชูุฑ ุงููุดุชุฑูุงุช ุงููุชุงุญุฉ:', purchases.length);

                if (purchases.length === 0) {
                    console.log('โ๏ธ ูุง ุชูุฌุฏ ูุดุชุฑูุงุช ูู ุงููุธุงู - ุชุญูู ูู ุฅุถุงูุฉ ููุงุชูุฑ ุงูุดุฑุงุก');
                    console.log('๐ ููุงุชูุญ localStorage ุงููุชุงุญุฉ:', Object.keys(localStorage).filter(key => key.includes('purchase') || key.includes('Purchase')));
                }

                purchases.forEach((purchase, purchaseIndex) => {
                    console.log(`๐ ูุญุต ูุงุชูุฑุฉ ุดุฑุงุก ${purchaseIndex + 1}:`, {
                        id: purchase.id,
                        date: purchase.date,
                        supplier: purchase.supplierName || purchase.supplier,
                        productsCount: purchase.products ? purchase.products.length : (purchase.items ? purchase.items.length : 0),
                        structure: Object.keys(purchase)
                    });

                    // ุฏุนู ุจูู ูุฎุชููุฉ ููููุชุฌุงุช (products ุฃู items)
                    const purchaseProducts = purchase.products || purchase.items || [];

                    if (purchaseProducts && Array.isArray(purchaseProducts)) {
                        purchaseProducts.forEach((purchaseProduct, productIndex) => {
                            console.log(`   ๐ฆ ููุชุฌ ${productIndex + 1} ูู ุงููุงุชูุฑุฉ:`, {
                                productId: purchaseProduct.productId,
                                id: purchaseProduct.id,
                                name: purchaseProduct.name,
                                quantity: purchaseProduct.quantity,
                                price: purchaseProduct.price,
                                cost: purchaseProduct.cost,
                                unitPrice: purchaseProduct.unitPrice
                            });

                            // ุงูุชุญูู ูู ุชุทุงุจู ุงูููุชุฌ ุจุทุฑู ูุชุนุฏุฏุฉ
                            const matchById = purchaseProduct.productId == product.id;
                            const matchByName = purchaseProduct.name === product.name;
                            const matchByDirectId = purchaseProduct.id == product.id;
                            const matchByStringId = String(purchaseProduct.productId) === String(product.id);
                            const matchByItemId = purchaseProduct.itemId == product.id;
                            const matchByProductName = purchaseProduct.productName === product.name;

                            console.log(`   ๐ฏ ูุชุงุฆุฌ ุงููุทุงุจูุฉ ููููุชุฌ ุงููุทููุจ (${product.name}, ID: ${product.id}):`, {
                                matchById,
                                matchByName,
                                matchByDirectId,
                                matchByStringId,
                                matchByItemId,
                                matchByProductName
                            });

                            if (matchById || matchByName || matchByDirectId || matchByStringId || matchByItemId || matchByProductName) {
                                console.log(`   โ ุชู ุงูุนุซูุฑ ุนูู ูุทุงุจูุฉ! ุฅุถุงูุฉ ุนูููุฉ ุดุฑุงุก`);

                                // ุงุณุชุฎุฑุงุฌ ุงูุณุนุฑ ูู ุญููู ูุฎุชููุฉ ูุญุชููุฉ
                                const productPrice = parseFloat(purchaseProduct.price) ||
                                                   parseFloat(purchaseProduct.cost) ||
                                                   parseFloat(purchaseProduct.unitPrice) ||
                                                   parseFloat(purchaseProduct.purchasePrice) ||
                                                   parseFloat(purchaseProduct.unitCost) || 0;

                                // ุงุณุชุฎุฑุงุฌ ุงููููุฉ ูู ุญููู ูุฎุชููุฉ
                                const productQuantity = parseInt(purchaseProduct.quantity) ||
                                                      parseInt(purchaseProduct.qty) ||
                                                      parseInt(purchaseProduct.amount) || 0;

                                const purchaseOperation = {
                                    date: purchase.date || purchase.createdAt || formatDateGregorian(new Date()),
                                    type: 'purchase',
                                    quantity: productQuantity,
                                    price: productPrice,
                                    reference: purchase.invoiceNumber || purchase.referenceNumber || purchase.number || `PUR-${purchase.id}`,
                                    createdAt: purchase.createdAt || purchase.date || new Date().toISOString(),
                                    supplier: purchase.supplierName || purchase.supplier || 'ููุฑุฏ ููุฏู'
                                };

                                console.log(`   ๐ ุชูุงุตูู ุงูุนูููุฉ ุงููุถุงูุฉ:`, purchaseOperation);
                                operations.push(purchaseOperation);
                            } else {
                                console.log(`   โ ูุง ุชูุฌุฏ ูุทุงุจูุฉ ููููุชุฌ`);
                            }
                        });
                    } else {
                        console.log(`   โ๏ธ ูุงุชูุฑุฉ ุงูุดุฑุงุก ูุง ุชุญุชูู ุนูู ููุชุฌุงุช ุฃู ุงูุจููุฉ ุบูุฑ ุตุญูุญุฉ`);
                    }
                });

                // 3. ุชุทุจูู ููุงุชุฑ ุงูุชุงุฑูุฎ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
                let filteredOperations = operations;
                if (filters.dateFrom || filters.dateTo) {
                    filteredOperations = operations.filter(op => {
                        const opDate = new Date(op.createdAt);
                        let include = true;

                        if (filters.dateFrom) {
                            const fromDate = new Date(filters.dateFrom);
                            include = include && opDate >= fromDate;
                        }

                        if (filters.dateTo) {
                            const toDate = new Date(filters.dateTo);
                            toDate.setHours(23, 59, 59, 999); // ููุงูุฉ ุงูููู
                            include = include && opDate <= toDate;
                        }

                        return include;
                    });
                }

                // 4. ุชุฑุชูุจ ุงูุนูููุงุช ุญุณุจ ุงูุชุงุฑูุฎ (ุงูุฃุญุฏุซ ุฃููุงู)
                filteredOperations.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                const purchaseOps = filteredOperations.filter(op => op.type === 'purchase');
                const saleOps = filteredOperations.filter(op => op.type === 'sale');

                console.log(`โ ุชู ุฌูุจ ${filteredOperations.length} ุนูููุฉ ูุนููุฉ ููููุชุฌ ${product.name}`);
                console.log(`   ๐ ุนูููุงุช ุดุฑุงุก: ${purchaseOps.length}`);
                console.log(`   ๐ฐ ุนูููุงุช ุจูุน: ${saleOps.length}`);

                if (purchaseOps.length > 0) {
                    console.log(`   ๐ ุชูุงุตูู ุงููุดุชุฑูุงุช:`, purchaseOps.map(op => ({
                        date: op.date,
                        quantity: op.quantity,
                        price: op.price,
                        reference: op.reference
                    })));
                }

                if (saleOps.length > 0) {
                    console.log(`   ๐ ุชูุงุตูู ุงููุจูุนุงุช:`, saleOps.map(op => ({
                        date: op.date,
                        quantity: op.quantity,
                        price: op.price,
                        reference: op.reference
                    })));
                }

                return filteredOperations;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฌูุจ ุงูุนูููุงุช:', error);
                return [];
            }
        }

        // ุชู ุญุฐู ุงูุฏุงูุฉ ุงูููุฑุฑุฉ - ุณูุชู ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงููุญุณูุฉ ูู ุงูุฃุณูู



        // ุฏูุงู ุงูุชุตุฏูุฑ ูุญุณูุฉ
        function exportToExcel(reportType) {
            // ุฅุธูุงุฑ ูุคุดุฑ ุงูุชุญููู
            showLoadingMessage('ุฌุงุฑู ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุฅูู Excel...');

            setTimeout(() => {
                hideLoadingMessage();
                showSuccessMessage(`ุชู ุชุตุฏูุฑ ุชูุฑูุฑ ${getReportTitle(reportType)} ุฅูู Excel ุจูุฌุงุญ!`);
            }, 1500);
        }

        function exportToPDF(reportType) {
            // ุฅุธูุงุฑ ูุคุดุฑ ุงูุชุญููู
            showLoadingMessage('ุฌุงุฑู ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุฅูู PDF...');

            setTimeout(() => {
                hideLoadingMessage();
                showSuccessMessage(`ุชู ุชุตุฏูุฑ ุชูุฑูุฑ ${getReportTitle(reportType)} ุฅูู PDF ุจูุฌุงุญ!`);
            }, 1500);
        }

        function generateDetailedReport() {
            try {
                console.log('๐ ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุตู...');
                console.log('๐ ููุน ุงูุชูุฑูุฑ ุงูุญุงูู:', currentReportType);

                // ุงูุชุญูู ูู ููุน ุงูุชูุฑูุฑ ุงูุญุงูู
                if (!currentReportType) {
                    console.error('โ ูู ูุชู ุชุญุฏูุฏ ููุน ุงูุชูุฑูุฑ');
                    throw new Error('ูู ูุชู ุชุญุฏูุฏ ููุน ุงูุชูุฑูุฑ');
                }

                // ุฌูุน ุงููุฑุดุญุงุช ูู ุงููุงุฌูุฉ
                const dateFrom = document.getElementById('date-from')?.value || '';
                const dateTo = document.getElementById('date-to')?.value || '';
                const account = document.getElementById('report-account')?.value || '';
                const branch = document.getElementById('report-branch')?.value || '';

                console.log('๐ ุงููุฑุดุญุงุช ุงููุฌูุนุฉ:', { dateFrom, dateTo, account, branch });

                // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุชูุฑูุฑ ุงูููุตู ูุน ุงููุฑุดุญุงุช
                console.log('๐ ุฌุงุฑู ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุชูุฑูุฑ...');
                const reportData = getDetailedReportData(currentReportType, {
                    dateFrom: dateFrom,
                    dateTo: dateTo,
                    account: account,
                    branch: branch
                });
                console.log('๐ ุจูุงูุงุช ุงูุชูุฑูุฑ:', reportData);

                if (!reportData) {
                    console.error('โ ูู ูุชู ุฅุฑุฌุงุน ุจูุงูุงุช ุงูุชูุฑูุฑ');
                    throw new Error('ูุดู ูู ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุชูุฑูุฑ');
                }

                if (!reportData.html) {
                    console.error('โ ูุญุชูู HTML ููุชูุฑูุฑ ูุงุฑุบ');
                    throw new Error('ูุดู ูู ุฅูุดุงุก ูุญุชูู ุงูุชูุฑูุฑ');
                }

                // ุนุฑุถ ุงูุชูุฑูุฑ ูู ุงููุงุฌูุฉ
                const reportContent = document.getElementById('report-content');
                console.log('๐ฏ ุนูุตุฑ ุนุฑุถ ุงูุชูุฑูุฑ:', reportContent);

                if (reportContent) {
                    console.log('๐ ุฌุงุฑู ุนุฑุถ ุงูุชูุฑูุฑ ูู ุงููุงุฌูุฉ...');
                    reportContent.innerHTML = reportData.html;
                    console.log('โ ุชู ุนุฑุถ ุงูุชูุฑูุฑ ูู ุงููุงุฌูุฉ ุจูุฌุงุญ');
                } else {
                    console.error('โ ุนูุตุฑ ุนุฑุถ ุงูุชูุฑูุฑ ุบูุฑ ููุฌูุฏ');
                    throw new Error('ุนูุตุฑ ุนุฑุถ ุงูุชูุฑูุฑ ุบูุฑ ููุฌูุฏ');
                }

                console.log('ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ:', reportData.title);
                showSuccessMessage('ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุตู ุจูุฌุงุญ!');

                // ุนุฑุถ ุงูุฑุณูู ุงูุจูุงููุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
                setTimeout(() => {
                    if (currentReportType === 'daily-sales' || currentReportType === 'monthly-sales') {
                        const canvas = document.getElementById('dailySalesChart') || document.getElementById('monthlySalesChart');
                        if (canvas) {
                            const salesData = generateSalesReport();
                            displaySalesChart(canvas.id, salesData);
                        }
                    }
                }, 500);

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ:', error);
                showErrorMessage('ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ: ' + error.message);

                // ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูู ููุทูุฉ ุงูุชูุฑูุฑ
                const reportContent = document.getElementById('report-content');
                if (reportContent) {
                    reportContent.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                            <p>${error.message}</p>
                            <button onclick="generateDetailedReport()" class="btn-enhanced" style="margin-top: 20px;">
                                <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                            </button>
                        </div>
                    `;
                }
            }
        }

        // ุฏูุงู ูุณุงุนุฏุฉ ููุฑุณุงุฆู
        function getReportTitle(reportType) {
            const titles = {
                'balance-sheet': 'ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู',
                'profit-loss': 'ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ',
                'daily': 'ุงููุจูุนุงุช ุงูููููุฉ',
                'current-stock': 'ุงููุฎุฒูู ุงูุญุงูู'
            };
            return titles[reportType] || reportType;
        }

        function showLoadingMessage(message) {
            const existingMessage = document.getElementById('loading-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-message';
            loadingDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                text-align: center;
                min-width: 300px;
            `;

            loadingDiv.innerHTML = `
                <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;"></div>
                <p style="margin: 0; color: #333; font-weight: 600;">${message}</p>
            `;

            document.body.appendChild(loadingDiv);
        }

        function hideLoadingMessage() {
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }

        function showSuccessMessage(message) {
            const existingMessage = document.getElementById('success-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const successDiv = document.createElement('div');
            successDiv.id = 'success-message';
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(40,167,69,0.3);
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;

            successDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-check-circle" style="font-size: 20px;"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(successDiv);

            setTimeout(() => {
                successDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (successDiv.parentNode) {
                        successDiv.remove();
                    }
                }, 300);
            }, 3000);
        }

        function showErrorMessage(message) {
            const existingMessage = document.getElementById('error-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const errorDiv = document.createElement('div');
            errorDiv.id = 'error-message';
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #dc3545, #c82333);
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(220,53,69,0.3);
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;

            errorDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-exclamation-circle" style="font-size: 20px;"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(errorDiv);

            setTimeout(() => {
                errorDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (errorDiv.parentNode) {
                        errorDiv.remove();
                    }
                }, 300);
            }, 4000);
        }

        // ุชููุฆุฉ ุงูุชุญุณููุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            // ุฅุถุงูุฉ CSS ููุฑุณูู ุงููุชุญุฑูุฉ
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
                .report-categories-modern, #selected-report {
                    transition: opacity 0.3s ease;
                }
            `;
            document.head.appendChild(style);

            // ุชุญุฏูุซ ููุงุฆู ุงูุนููุงุก ูุงูููุชุฌุงุช ูุงูููุฑุฏูู ูู ุงููุธุงู ุงููุฑูุฒู
            setTimeout(() => {
                if (window.dataManager) {
                    updateCustomerFiltersFromStorage();
                    updateProductFiltersFromStorage();
                    updateSupplierFiltersFromStorage();
                    updateSalesDataFromStorage();
                    updatePurchasesDataFromStorage();
                    updateAccountsDataFromStorage();

                    // ุฅุนุฏุงุฏ ูุฑุงูุจุฉ ุงูุชุญุฏูุซุงุช ุงููุจุงุดุฑุฉ
                    setupRealtimeDataMonitoring();
                } else {
                    console.error('ุงููุธุงู ุงููุฑูุฒู ุบูุฑ ูุญูู ูู ุงูุชูุงุฑูุฑ');
                }
            }, 500);

            // ุชุญููู ูุณุจู ููุจูุงูุงุช
            setTimeout(preloadReportData, 1000);

            // ุฅุถุงูุฉ ุชุฃุซูุฑุงุช ุจุตุฑูุฉ
            setTimeout(addVisualEnhancements, 500);
        });

        // ุฏุงูุฉ ุชุญุฏูุซ ุจูุงูุงุช ุงููุจูุนุงุช ูู localStorage
        function updateSalesDataFromStorage() {
            console.log('๐ ุชุญุฏูุซ ุจูุงูุงุช ุงููุจูุนุงุช...');

            // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู ุฃููุงู
            let salesData = [];

            if (window.dataManager) {
                salesData = window.dataManager.getSales();
                console.log('โ ุชู ุชุญููู ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', salesData.length, 'ูุงุชูุฑุฉ');
            } else {
                // ุงูุจุญุซ ูู localStorage ูุจุฏูู
                const invoicesData = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                const salesLocalData = JSON.parse(localStorage.getItem('monjizSales')) || [];

                // ุฏูุฌ ุงูุจูุงูุงุช ูู ุงูููุชุงุญูู
                salesData = [...invoicesData, ...salesLocalData];

                // ุฅุฒุงูุฉ ุงูููุฑุฑุงุช
                salesData = salesData.filter((sale, index, self) =>
                    index === self.findIndex(s => s.id === sale.id)
                );

                console.log('โ๏ธ ุชู ุชุญููู ุงูุจูุงูุงุช ูู localStorage:', salesData.length, 'ูุงุชูุฑุฉ');
            }

            if (salesData.length > 0) {
                // ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููููุฉ ุจุงูุจูุงูุงุช ุงูุญููููุฉ
                window.realSalesData = salesData;

                // ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุจูุนุงุช
                updateSalesStatistics(salesData);

                console.log('โ ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงููุจูุนุงุช ุงูุญููููุฉ');

                // ุนุฑุถ ุชูุงุตูู ุงูุจูุงูุงุช
                salesData.forEach((sale, index) => {
                    console.log(`   ${index + 1}. ${sale.id} - ${sale.customerName} - ${sale.total} ุฑ.ุณ`);
                });
            } else {
                console.log('โ๏ธ ูุง ุชูุฌุฏ ุจูุงูุงุช ูุจูุนุงุช');
            }
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุจูุงูุงุช ุงููุดุชุฑูุงุช ูู localStorage
        function updatePurchasesDataFromStorage() {
            const purchasesData = JSON.parse(localStorage.getItem('monjizPurchases')) || [];
            console.log('ุชุญุฏูุซ ุจูุงูุงุช ุงููุดุชุฑูุงุช ูู localStorage:', purchasesData.length, 'ูุงุชูุฑุฉ ุดุฑุงุก');

            if (purchasesData.length > 0) {
                // ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููููุฉ ุจุงูุจูุงูุงุช ุงูุญููููุฉ
                window.realPurchasesData = purchasesData;

                console.log('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงููุดุชุฑูุงุช ุงูุญููููุฉ');
            }
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุจูุงูุงุช ุงูุญุณุงุจุงุช ูู localStorage
        function updateAccountsDataFromStorage() {
            const accountsData = JSON.parse(localStorage.getItem('chartOfAccounts')) ||
                                JSON.parse(localStorage.getItem('monjizAccounts')) || [];
            console.log('ุชุญุฏูุซ ุจูุงูุงุช ุงูุญุณุงุจุงุช ูู localStorage:', accountsData.length, 'ุญุณุงุจ');

            if (accountsData.length > 0) {
                // ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููููุฉ ุจุงูุจูุงูุงุช ุงูุญููููุฉ
                window.realAccountsData = accountsData;

                // ุชุญุฏูุซ ุงูุชูุงุฑูุฑ ุงููุงููุฉ
                updateFinancialReportsData(accountsData);

                console.log('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุญุณุงุจุงุช ุงูุญููููุฉ');
            }
        }

        // ุฏุงูุฉ ุฅุนุฏุงุฏ ูุฑุงูุจุฉ ุงูุชุญุฏูุซุงุช ุงููุจุงุดุฑุฉ
        function setupRealtimeDataMonitoring() {
            console.log('๐ ุฅุนุฏุงุฏ ูุฑุงูุจุฉ ุงูุชุญุฏูุซุงุช ุงููุจุงุดุฑุฉ ููุชูุงุฑูุฑ...');

            // ูุฑุงูุจุฉ ุชุบููุฑุงุช localStorage
            window.addEventListener('storage', function(e) {
                console.log('๐ ุชู ุงูุชุดุงู ุชุบููุฑ ูู ุงูุจูุงูุงุช:', e.key);

                switch(e.key) {
                    case 'monjizSales':
                    case 'monjizInvoices':
                        updateSalesDataFromStorage();
                        refreshCurrentReport();
                        break;
                    case 'monjizPurchases':
                        updatePurchasesDataFromStorage();
                        refreshCurrentReport();
                        break;
                    case 'monjizCustomers':
                        updateCustomerFiltersFromStorage();
                        refreshCurrentReport();
                        break;
                    case 'monjizSuppliers':
                        updateSupplierFiltersFromStorage();
                        refreshCurrentReport();
                        break;
                    case 'monjizProducts':
                        updateProductFiltersFromStorage();
                        refreshCurrentReport();
                        break;
                    case 'chartOfAccounts':
                    case 'monjizAccounts':
                        updateAccountsDataFromStorage();
                        refreshCurrentReport();
                        break;
                    case 'monjizStockMovements':
                        console.log('๐ ุชุญุฏูุซ ุญุฑูุงุช ุงููุฎุฒูู...');
                        refreshCurrentReport();
                        break;
                }
            });

            // ูุฑุงูุจุฉ BroadcastChannel ุฅุฐุง ูุงู ูุชุงุญุงู
            if (window.BroadcastChannel) {
                const channel = new BroadcastChannel('monjiz-updates');
                channel.addEventListener('message', function(event) {
                    console.log('๐ ุชู ุงุณุชูุงู ุชุญุฏูุซ ุนุจุฑ BroadcastChannel:', event.data);

                    switch(event.data.type) {
                        case 'sales-updated':
                        case 'invoice-added':
                            updateSalesDataFromStorage();
                            refreshCurrentReport();
                            break;
                        case 'purchase-added':
                            updatePurchasesDataFromStorage();
                            refreshCurrentReport();
                            break;
                        case 'customer-added':
                        case 'customers-updated':
                            updateCustomerFiltersFromStorage();
                            refreshCurrentReport();
                            break;
                        case 'supplier-added':
                        case 'suppliers-updated':
                            updateSupplierFiltersFromStorage();
                            refreshCurrentReport();
                            break;
                        case 'product-added':
                        case 'products-updated':
                            updateProductFiltersFromStorage();
                            refreshCurrentReport();
                            break;
                        case 'accounts-updated':
                            updateAccountsDataFromStorage();
                            refreshCurrentReport();
                            break;
                    }
                });
            }

            // ูุฑุงูุจุฉ ุฏูุฑูุฉ ูู 30 ุซุงููุฉ
            setInterval(() => {
                console.log('๐ ุชุญุฏูุซ ุฏูุฑู ููุจูุงูุงุช...');
                updateAllDataFromStorage();
            }, 30000);

            console.log('โ ุชู ุฅุนุฏุงุฏ ูุฑุงูุจุฉ ุงูุชุญุฏูุซุงุช ุงููุจุงุดุฑุฉ');
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุฌููุน ุงูุจูุงูุงุช
        function updateAllDataFromStorage() {
            updateSalesDataFromStorage();
            updatePurchasesDataFromStorage();
            updateCustomerFiltersFromStorage();
            updateSupplierFiltersFromStorage();
            updateProductFiltersFromStorage();
            updateAccountsDataFromStorage();
        }

        // ุฏุงูุฉ ุฅุนุงุฏุฉ ุชุญููู ุงูุชูุฑูุฑ ุงูุญุงูู ูุน ุงูุญูุงุธ ุนูู ุงูููุงุชุฑ
        function refreshCurrentReport() {
            // ุชุฌุงูู ุฅุนุงุฏุฉ ุงูุชุญููู ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุทุจู ููุงุชุฑ ุญุงููุงู
            if (window.isApplyingFilters) {
                console.log('โธ๏ธ ุชู ุชุฌุงูู ุฅุนุงุฏุฉ ุงูุชุญููู ุงูุชููุงุฆู - ุงููุณุชุฎุฏู ูุทุจู ููุงุชุฑ');
                return;
            }

            if (currentReportType && currentView === 'report-detail') {
                console.log('๐ ุฅุนุงุฏุฉ ุชุญููู ุงูุชูุฑูุฑ ุงูุญุงูู:', currentReportType);
                console.log('๐พ ุงูููุงุชุฑ ุงููุญููุธุฉ:', savedFilters[currentReportType]);

                // ุชุฃุฎูุฑ ูุตูุฑ ูุถูุงู ุชุญุฏูุซ ุงูุจูุงูุงุช
                setTimeout(() => {
                    // ุงุณุชุฎุฏุงู ุงูููุงุชุฑ ุงููุญููุธุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
                    const filters = savedFilters[currentReportType] || {};
                    console.log('๐ง ุชุทุจูู ุงูููุงุชุฑ ุงููุญููุธุฉ:', filters);

                    const reportData = getDetailedReportData(currentReportType, filters);
                    const reportContent = document.getElementById('report-content');
                    if (reportContent) {
                        reportContent.innerHTML = reportData.html;
                        console.log('โ ุชู ุชุญุฏูุซ ุงูุชูุฑูุฑ ุงูุญุงูู ูุน ุงูููุงุชุฑ');

                        // ุงุณุชุนุงุฏุฉ ููู ุงูููุงุชุฑ ูู ุงููุงุฌูุฉ
                        if (filters.dateFrom || filters.dateTo || filters.account || filters.branch) {
                            restoreSavedFilters(currentReportType);
                        }
                    }
                }, 500);
            }
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุจูุนุงุช
        function updateSalesStatistics(invoicesData) {
            // ุญุณุงุจ ุฅุฌูุงูู ุงููุจูุนุงุช
            let totalSales = 0;
            let totalInvoices = invoicesData.length;

            invoicesData.forEach(invoice => {
                if (invoice.total) {
                    totalSales += parseFloat(invoice.total) || 0;
                }
            });

            // ุชุญุฏูุซ ุนูุงุตุฑ ุงูุฅุญุตุงุฆูุงุช ูู ุงูุตูุญุฉ
            const totalSalesElements = document.querySelectorAll('.total-sales, [data-stat="total-sales"]');
            totalSalesElements.forEach(element => {
                element.textContent = totalSales.toFixed(2) + ' ุฑ.ุณ';
            });

            const totalInvoicesElements = document.querySelectorAll('.total-invoices, [data-stat="total-invoices"]');
            totalInvoicesElements.forEach(element => {
                element.textContent = totalInvoices;
            });

            console.log('ุชู ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช:', { totalSales, totalInvoices });
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุจูุงูุงุช ุงูุชูุงุฑูุฑ ุงููุงููุฉ
        function updateFinancialReportsData(accountsData) {
            console.log('๐ฆ ุชุญุฏูุซ ุจูุงูุงุช ุงูุชูุงุฑูุฑ ุงููุงููุฉ...');

            // ุชุตููู ุงูุญุณุงุจุงุช ุญุณุจ ุงูููุน
            const assetAccounts = accountsData.filter(acc => acc.type === 'assets');
            const liabilityAccounts = accountsData.filter(acc => acc.type === 'liabilities');
            const equityAccounts = accountsData.filter(acc => acc.type === 'equity');
            const revenueAccounts = accountsData.filter(acc => acc.type === 'revenue');
            const expenseAccounts = accountsData.filter(acc => acc.type === 'expenses');

            // ุญุณุงุจ ุงูุฃุฑุตุฏุฉ
            const totalAssets = assetAccounts.reduce((sum, acc) => sum + (acc.balance || 0), 0);
            const totalLiabilities = liabilityAccounts.reduce((sum, acc) => sum + (acc.balance || 0), 0);
            const totalEquity = equityAccounts.reduce((sum, acc) => sum + (acc.balance || 0), 0);
            const totalRevenue = revenueAccounts.reduce((sum, acc) => sum + (acc.balance || 0), 0);
            const totalExpenses = expenseAccounts.reduce((sum, acc) => sum + (acc.balance || 0), 0);

            // ุญุณุงุจ ุตุงูู ุงูุฑุจุญ
            const netProfit = totalRevenue - totalExpenses;

            // ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูุนุงูุฉ ููุชูุงุฑูุฑ ุงููุงููุฉ
            window.financialData = {
                assets: {
                    accounts: assetAccounts,
                    total: totalAssets,
                    formatted: totalAssets.toLocaleString('ar-SA', { style: 'currency', currency: 'SAR' })
                },
                liabilities: {
                    accounts: liabilityAccounts,
                    total: totalLiabilities,
                    formatted: totalLiabilities.toLocaleString('ar-SA', { style: 'currency', currency: 'SAR' })
                },
                equity: {
                    accounts: equityAccounts,
                    total: totalEquity,
                    formatted: totalEquity.toLocaleString('ar-SA', { style: 'currency', currency: 'SAR' })
                },
                revenue: {
                    accounts: revenueAccounts,
                    total: totalRevenue,
                    formatted: totalRevenue.toLocaleString('ar-SA', { style: 'currency', currency: 'SAR' })
                },
                expenses: {
                    accounts: expenseAccounts,
                    total: totalExpenses,
                    formatted: totalExpenses.toLocaleString('ar-SA', { style: 'currency', currency: 'SAR' })
                },
                netProfit: {
                    amount: netProfit,
                    formatted: netProfit.toLocaleString('ar-SA', { style: 'currency', currency: 'SAR' })
                }
            };

            console.log('โ ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุชูุงุฑูุฑ ุงููุงููุฉ:', {
                totalAssets,
                totalLiabilities,
                totalEquity,
                netProfit
            });
        }

        // ุชู ุญุฐู ุงูุฏุงูุฉ ุงููุจุณุทุฉ - ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุตูุฉ ุจุฏูุงู ูููุง
        function createPurchasesDailyReportOLD_REMOVED(dateRange, filters = {}) {
            const purchasesData = window.dataManager ? window.dataManager.getPurchases() : [];

            if (purchasesData.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุงููุดุชุฑูุงุช ุงูููููุฉ</h2>
                            <p>ุงููุชุฑุฉ: ${dateRange}</p>
                        </div>
                        <div class="no-data-message">
                            <i class="fas fa-shopping-cart"></i>
                            <p>ูุง ุชูุฌุฏ ููุงุชูุฑ ุดุฑุงุก ูู ูุฐู ุงููุชุฑุฉ</p>
                            <small>ูู ุจุฅุถุงูุฉ ููุงุชูุฑ ุดุฑุงุก ุฌุฏูุฏุฉ ูุนุฑุถ ุงูุชูุฑูุฑ</small>
                        </div>
                    </div>
                `;
            }

            let totalPurchases = 0;
            let totalAmount = 0;
            let purchasesHtml = '';

            purchasesData.forEach(purchase => {
                totalPurchases++;
                totalAmount += parseFloat(purchase.total) || 0;

                purchasesHtml += `
                    <tr>
                        <td>${purchase.id}</td>
                        <td>${purchase.date}</td>
                        <td>${purchase.supplier}</td>
                        <td>${purchase.items ? purchase.items.length : 0}</td>
                        <td>${purchase.total ? purchase.total.toFixed(2) : '0.00'} ุฑ.ุณ</td>
                        <td>${purchase.payment || 'ููุฏุงู'}</td>
                    </tr>
                `;
            });

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุงููุดุชุฑูุงุช ุงูููููุฉ</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>

                    <div class="report-summary">
                        <div class="summary-card">
                            <h3>ุงูููุงุชูุฑ</h3>
                            <p class="summary-value">${totalPurchases}</p>
                        </div>
                        <div class="summary-card">
                            <h3>ุงููุจูุบ ุงูุฅุฌูุงูู</h3>
                            <p class="summary-value">${totalAmount.toFixed(2)} ุฑ.ุณ</p>
                        </div>
                        <div class="summary-card">
                            <h3>ูุชูุณุท ุงููุงุชูุฑุฉ</h3>
                            <p class="summary-value">${totalPurchases > 0 ? (totalAmount / totalPurchases).toFixed(2) : '0.00'} ุฑ.ุณ</p>
                        </div>
                    </div>

                    <div class="report-table-container">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th style="width: 15%;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                    <th style="width: 12%;">ุงูุชุงุฑูุฎ</th>
                                    <th style="width: 25%;">ุงูููุฑุฏ</th>
                                    <th style="width: 10%;">ุงูุฃุตูุงู</th>
                                    <th style="width: 18%;">ุงููุจูุบ</th>
                                    <th style="width: 20%;">ุทุฑููุฉ ุงูุฏูุน</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${purchasesHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ุชู ุญุฐู ุงูุฏุงูุฉ ุงููุจุณุทุฉ - ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูููุตูุฉ ุจุฏูุงู ูููุง
        function createPurchasesBySupplierReportOLD_REMOVED(dateRange, filters = {}) {
            // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู
            const purchasesData = window.dataManager ? window.dataManager.getPurchases() : [];
            const suppliersData = window.dataManager ? window.dataManager.getSuppliers() : [];

            console.log('ุจูุงูุงุช ุงููุดุชุฑูุงุช:', purchasesData);
            console.log('ุจูุงูุงุช ุงูููุฑุฏูู:', suppliersData);

            if (purchasesData.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ</h2>
                            <p>ุงููุชุฑุฉ: ${dateRange}</p>
                        </div>
                        <div class="no-data-message">
                            <i class="fas fa-info-circle"></i>
                            <p>ูุง ุชูุฌุฏ ููุงุชูุฑ ุดุฑุงุก ูู ูุฐู ุงููุชุฑุฉ</p>
                        </div>
                    </div>
                `;
            }

            // ุชุฌููุน ุงูุจูุงูุงุช ุญุณุจ ุงูููุฑุฏ
            const supplierData = {};

            purchasesData.forEach(purchase => {
                const supplier = purchase.supplier || 'ุบูุฑ ูุญุฏุฏ';

                if (!supplierData[supplier]) {
                    supplierData[supplier] = {
                        name: supplier,
                        invoices: 0,
                        totalAmount: 0,
                        items: 0
                    };
                }

                supplierData[supplier].invoices++;
                supplierData[supplier].totalAmount += parseFloat(purchase.total) || 0;
                supplierData[supplier].items += purchase.items ? purchase.items.length : 0;
            });

            let suppliersHtml = '';
            Object.values(supplierData).forEach(supplier => {
                suppliersHtml += `
                    <tr>
                        <td>${supplier.name}</td>
                        <td>${supplier.invoices}</td>
                        <td>${supplier.items}</td>
                        <td>${supplier.totalAmount.toFixed(2)} ุฑ.ุณ</td>
                        <td>${supplier.invoices > 0 ? (supplier.totalAmount / supplier.invoices).toFixed(2) : '0.00'} ุฑ.ุณ</td>
                    </tr>
                `;
            });

            const totalSuppliers = Object.keys(supplierData).length;
            const totalAmount = Object.values(supplierData).reduce((sum, supplier) => sum + supplier.totalAmount, 0);

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>

                    <div class="report-summary">
                        <div class="summary-card">
                            <h3>ุนุฏุฏ ุงูููุฑุฏูู</h3>
                            <p class="summary-value">${totalSuppliers}</p>
                        </div>
                        <div class="summary-card">
                            <h3>ุฅุฌูุงูู ุงููุดุชุฑูุงุช</h3>
                            <p class="summary-value">${totalAmount.toFixed(2)} ุฑ.ุณ</p>
                        </div>
                    </div>

                    <div class="report-table-container">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>ุงูููุฑุฏ</th>
                                    <th>ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                    <th>ุนุฏุฏ ุงูุฃุตูุงู</th>
                                    <th>ุฅุฌูุงูู ุงููุจูุบ</th>
                                    <th>ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${suppliersHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุชูุฑูุฑ ูุงุฆูุฉ ุงูููุฑุฏูู
        function createSupplierListReport(dateRange, filters = {}) {
            const suppliersData = window.dataManager ? window.dataManager.getSuppliers() : [];
            console.log('ูุงุฆูุฉ ุงูููุฑุฏูู ููุชูุฑูุฑ:', suppliersData);

            if (suppliersData.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงูููุฑุฏูู</h2>
                            <p>ุงููุชุฑุฉ: ${dateRange}</p>
                        </div>
                        <div class="no-data-message">
                            <i class="fas fa-info-circle"></i>
                            <p>ูุง ุชูุฌุฏ ููุฑุฏูู ูุณุฌููู ูู ุงููุธุงู</p>
                        </div>
                    </div>
                `;
            }

            let suppliersHtml = '';
            suppliersData.forEach(supplier => {
                suppliersHtml += `
                    <tr>
                        <td>${supplier.name}</td>
                        <td>${supplier.phone || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${supplier.email || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${supplier.address || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${supplier.category || 'ุนุงู'}</td>
                    </tr>
                `;
            });

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ูุงุฆูุฉ ุงูููุฑุฏูู</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>

                    <div class="report-summary">
                        <div class="summary-card">
                            <h3>ุฅุฌูุงูู ุงูููุฑุฏูู</h3>
                            <p class="summary-value">${suppliersData.length}</p>
                        </div>
                    </div>

                    <div class="report-table-container">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>ุงุณู ุงูููุฑุฏ</th>
                                    <th>ุงููุงุชู</th>
                                    <th>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
                                    <th>ุงูุนููุงู</th>
                                    <th>ุงููุฆุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${suppliersHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุชูุฑูุฑ ุฃุฑุตุฏุฉ ุงูููุฑุฏูู
        function createSupplierBalancesReport(dateRange, filters = {}) {
            const suppliersData = window.dataManager ? window.dataManager.getSuppliers() : [];
            const purchasesData = window.dataManager ? window.dataManager.getPurchases() : [];

            if (suppliersData.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุฃุฑุตุฏุฉ ุงูููุฑุฏูู</h2>
                            <p>ุงููุชุฑุฉ: ${dateRange}</p>
                        </div>
                        <div class="no-data-message">
                            <i class="fas fa-info-circle"></i>
                            <p>ูุง ุชูุฌุฏ ููุฑุฏูู ูุณุฌููู ูู ุงููุธุงู</p>
                        </div>
                    </div>
                `;
            }

            // ุญุณุงุจ ุฃุฑุตุฏุฉ ุงูููุฑุฏูู ูู ููุงุชูุฑ ุงูุดุฑุงุก
            const supplierBalances = {};

            suppliersData.forEach(supplier => {
                supplierBalances[supplier.name] = {
                    name: supplier.name,
                    totalPurchases: 0,
                    totalAmount: 0,
                    invoicesCount: 0
                };
            });

            purchasesData.forEach(purchase => {
                const supplierName = purchase.supplier;
                if (supplierBalances[supplierName]) {
                    supplierBalances[supplierName].totalAmount += parseFloat(purchase.total) || 0;
                    supplierBalances[supplierName].invoicesCount++;
                }
            });

            let balancesHtml = '';
            Object.values(supplierBalances).forEach(supplier => {
                balancesHtml += `
                    <tr>
                        <td>${supplier.name}</td>
                        <td>${supplier.invoicesCount}</td>
                        <td>${supplier.totalAmount.toFixed(2)} ุฑ.ุณ</td>
                        <td>${supplier.invoicesCount > 0 ? (supplier.totalAmount / supplier.invoicesCount).toFixed(2) : '0.00'} ุฑ.ุณ</td>
                        <td><span class="status-paid">ูุฏููุน</span></td>
                    </tr>
                `;
            });

            const totalAmount = Object.values(supplierBalances).reduce((sum, supplier) => sum + supplier.totalAmount, 0);

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุฃุฑุตุฏุฉ ุงูููุฑุฏูู</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>

                    <div class="report-summary">
                        <div class="summary-card">
                            <h3>ุฅุฌูุงูู ุงููุณุชุญูุงุช</h3>
                            <p class="summary-value">${totalAmount.toFixed(2)} ุฑ.ุณ</p>
                        </div>
                    </div>

                    <div class="report-table-container">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>ุงูููุฑุฏ</th>
                                    <th>ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                    <th>ุฅุฌูุงูู ุงููุจูุบ</th>
                                    <th>ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                    <th>ุงูุญุงูุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${balancesHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุชุญููู ุงูููุฑุฏูู
        function createSupplierAnalysisReport(dateRange, filters = {}) {
            const purchasesData = window.dataManager ? window.dataManager.getPurchases() : [];

            if (purchasesData.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุชุญููู ุงูููุฑุฏูู</h2>
                            <p>ุงููุชุฑุฉ: ${dateRange}</p>
                        </div>
                        <div class="no-data-message">
                            <i class="fas fa-info-circle"></i>
                            <p>ูุง ุชูุฌุฏ ููุงุชูุฑ ุดุฑุงุก ููุชุญููู</p>
                        </div>
                    </div>
                `;
            }

            // ุชุญููู ุฃุฏุงุก ุงูููุฑุฏูู
            const supplierAnalysis = {};

            purchasesData.forEach(purchase => {
                const supplier = purchase.supplier || 'ุบูุฑ ูุญุฏุฏ';

                if (!supplierAnalysis[supplier]) {
                    supplierAnalysis[supplier] = {
                        name: supplier,
                        invoices: 0,
                        totalAmount: 0,
                        totalItems: 0,
                        avgDeliveryTime: 0,
                        performance: 'ููุชุงุฒ'
                    };
                }

                supplierAnalysis[supplier].invoices++;
                supplierAnalysis[supplier].totalAmount += parseFloat(purchase.total) || 0;
                supplierAnalysis[supplier].totalItems += purchase.items ? purchase.items.length : 0;
            });

            let analysisHtml = '';
            Object.values(supplierAnalysis).forEach(supplier => {
                const avgInvoice = supplier.invoices > 0 ? (supplier.totalAmount / supplier.invoices) : 0;
                const performance = avgInvoice > 5000 ? 'ููุชุงุฒ' : avgInvoice > 2000 ? 'ุฌูุฏ' : 'ูุชูุณุท';

                analysisHtml += `
                    <tr>
                        <td>${supplier.name}</td>
                        <td>${supplier.invoices}</td>
                        <td>${supplier.totalAmount.toFixed(2)} ุฑ.ุณ</td>
                        <td>${avgInvoice.toFixed(2)} ุฑ.ุณ</td>
                        <td>${supplier.totalItems}</td>
                        <td><span class="performance-${performance.toLowerCase()}">${performance}</span></td>
                    </tr>
                `;
            });

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุชุญููู ุงูููุฑุฏูู</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>

                    <div class="report-table-container">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>ุงูููุฑุฏ</th>
                                    <th>ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                    <th>ุฅุฌูุงูู ุงููุจูุบ</th>
                                    <th>ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                    <th>ุฅุฌูุงูู ุงูุฃุตูุงู</th>
                                    <th>ุงูุชูููู</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${analysisHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ุฏุงูุฉ ุชูููู ุงูููุฑุฏูู
        function createSupplierEvaluationReport(dateRange, filters = {}) {
            return createSupplierAnalysisReport(dateRange, filters);
        }

        // ุฏุงูุฉ ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ
        function createPurchasesMonthlyReport(dateRange, filters = {}) {
            const purchasesData = window.dataManager ? window.dataManager.getPurchases() : [];

            if (purchasesData.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ</h2>
                            <p>ุงููุชุฑุฉ: ${dateRange}</p>
                        </div>
                        <div class="no-data-message">
                            <i class="fas fa-info-circle"></i>
                            <p>ูุง ุชูุฌุฏ ููุงุชูุฑ ุดุฑุงุก ูู ูุฐู ุงููุชุฑุฉ</p>
                        </div>
                    </div>
                `;
            }

            // ุชุฌููุน ุงูุจูุงูุงุช ุญุณุจ ุงูุดูุฑ
            const monthlyData = {};

            purchasesData.forEach(purchase => {
                const date = new Date(purchase.createdAt || purchase.date);
                const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                const monthName = date.toLocaleDateString('ar-SA', { year: 'numeric', month: 'long' });

                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = {
                        month: monthName,
                        invoices: 0,
                        totalAmount: 0,
                        suppliers: new Set()
                    };
                }

                monthlyData[monthKey].invoices++;
                monthlyData[monthKey].totalAmount += parseFloat(purchase.total) || 0;
                monthlyData[monthKey].suppliers.add(purchase.supplier);
            });

            let monthlyHtml = '';
            Object.values(monthlyData).forEach(month => {
                monthlyHtml += `
                    <tr>
                        <td>${month.month}</td>
                        <td>${month.invoices}</td>
                        <td>${month.suppliers.size}</td>
                        <td>${month.totalAmount.toFixed(2)} ุฑ.ุณ</td>
                        <td>${month.invoices > 0 ? (month.totalAmount / month.invoices).toFixed(2) : '0.00'} ุฑ.ุณ</td>
                    </tr>
                `;
            });

            const totalAmount = Object.values(monthlyData).reduce((sum, month) => sum + month.totalAmount, 0);
            const totalInvoices = Object.values(monthlyData).reduce((sum, month) => sum + month.invoices, 0);

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>

                    <div class="report-summary">
                        <div class="summary-card">
                            <h3>ุฅุฌูุงูู ุงูููุงุชูุฑ</h3>
                            <p class="summary-value">${totalInvoices}</p>
                        </div>
                        <div class="summary-card">
                            <h3>ุฅุฌูุงูู ุงููุจูุบ</h3>
                            <p class="summary-value">${totalAmount.toFixed(2)} ุฑ.ุณ</p>
                        </div>
                    </div>

                    <div class="report-table-container">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>ุงูุดูุฑ</th>
                                    <th>ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                    <th>ุนุฏุฏ ุงูููุฑุฏูู</th>
                                    <th>ุฅุฌูุงูู ุงููุจูุบ</th>
                                    <th>ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${monthlyHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ุชู ุญุฐู ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงููุฆุฉ ูุงุณุชุจุฏุงูู ุจุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ





        // ูุธุงุฆู ุฅูุดุงุก ุงูุชูุงุฑูุฑ ุงูููููุฏุฉ
        // ุชู ููู ุฏุงูุฉ createDailySalesReport ุฅูู ุงูุฃุนูู ูุชุฌูุจ ุงูุชูุฑุงุฑ

        function getPaymentMethodText(method) {
            const methodMap = {
                'cash': 'ููุฏู',
                'credit': 'ุขุฌู', 
                'card': 'ุจุทุงูุฉ',
                'bank': 'ุชุญููู ุจููู',
                'ููุฏู': 'ููุฏู',
                'ุขุฌู': 'ุขุฌู',
                'ุจุทุงูุฉ': 'ุจุทุงูุฉ',
                'ุชุญููู ุจููู': 'ุชุญููู ุจููู'
            };
            return methodMap[method] || 'ููุฏู';
        }



        function createCustomerSalesReport(dateRange, filters) {
            const customerData = generateCustomersReport();

            let customersTable = '';
            if (customerData.customers && customerData.customers.length > 0) {
                customersTable = `
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>ุงูุนููู</th>
                                <th>ุงููุงุชู</th>
                                <th>ุนุฏุฏ ุงููุดุชุฑูุงุช</th>
                                <th>ุฅุฌูุงูู ุงูุฅููุงู (ุฑ.ุณ)</th>
                                <th>ูุชูุณุท ุงูุทูุจ (ุฑ.ุณ)</th>
                                <th>ุขุฎุฑ ุดุฑุงุก</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${customerData.customers.map(customer => `
                                <tr>
                                    <td>${customer.name}</td>
                                    <td>${customer.phone}</td>
                                    <td>${customer.totalPurchases}</td>
                                    <td>${formatCurrency(customer.totalSpent)}</td>
                                    <td>${formatCurrency(customer.averageOrderValue)}</td>
                                    <td>${customer.lastPurchaseDate ?
                                        formatDateGregorian(customer.lastPurchaseDate) :
                                        'ูุง ููุฌุฏ'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                customersTable = '<p style="text-align: center; color: #666; padding: 20px;">ูุง ุชูุฌุฏ ุจูุงูุงุช ุนููุงุก</p>';
            }

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุชูุฑูุฑ ูุจูุนุงุช ุงูุนููุงุก</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>
                    <div class="report-content">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <h3>ุฅุฌูุงูู ุงูุนููุงุก</h3>
                                <p class="amount">${customerData.totalCustomers}</p>
                            </div>
                            <div class="summary-card">
                                <h3>ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</h3>
                                <p class="amount">${formatCurrency(customerData.totalRevenue)}</p>
                            </div>
                            <div class="summary-card">
                                <h3>ูุชูุณุท ุงูุฅููุงู</h3>
                                <p class="amount">${formatCurrency(customerData.averageSpending)}</p>
                            </div>
                            <div class="summary-card">
                                <h3>ุงูุนููุงุก ุงููุดุทูู</h3>
                                <p class="amount">${customerData.activeCustomers}</p>
                            </div>
                        </div>
                        <div style="margin-top: 30px;">
                            <h3>ุชูุงุตูู ุงูุนููุงุก</h3>
                            ${customersTable}
                        </div>
                    </div>
                </div>
            `;
        }

        function createProductSalesReport(dateRange, filters) {
            const productData = generateProductsReport();

            let productsTable = '';
            if (productData.topProducts && productData.topProducts.length > 0) {
                productsTable = `
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>ุงูููุชุฌ</th>
                                <th>ุงููุฆุฉ</th>
                                <th>ุงููููุฉ ุงููุจุงุนุฉ</th>
                                <th>ุงูุฅูุฑุงุฏุงุช (ุฑ.ุณ)</th>
                                <th>ุงููุฎุฒูู ุงูุญุงูู</th>
                                <th>ุงูุญุงูุฉ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${productData.topProducts.map(product => `
                                <tr>
                                    <td>${product.name}</td>
                                    <td>${product.category}</td>
                                    <td>${product.totalSold}</td>
                                    <td>${formatCurrency(product.totalRevenue)}</td>
                                    <td>${product.currentStock}</td>
                                    <td>
                                        <span class="status-${product.currentStock > product.minStock ? 'available' :
                                                              product.currentStock > 0 ? 'low' : 'out'}">
                                            ${product.currentStock > product.minStock ? 'ูุชููุฑ' :
                                              product.currentStock > 0 ? 'ููุฎูุถ' : 'ููุฏ'}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                productsTable = '<p style="text-align: center; color: #666; padding: 20px;">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุจูุนุงุช ููููุชุฌุงุช</p>';
            }

            return `
                <div class="report-container">
                    <div class="report-header">
                        <h2>ุชูุฑูุฑ ูุจูุนุงุช ุงูููุชุฌุงุช</h2>
                        <p>ุงููุชุฑุฉ: ${dateRange}</p>
                    </div>
                    <div class="report-content">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <h3>ุฅุฌูุงูู ุงูููุชุฌุงุช</h3>
                                <p class="amount">${productData.totalProducts}</p>
                            </div>
                            <div class="summary-card">
                                <h3>ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</h3>
                                <p class="amount">${formatCurrency(productData.totalRevenue)}</p>
                            </div>
                            <div class="summary-card">
                                <h3>ุฅุฌูุงูู ุงููููุฉ ุงููุจุงุนุฉ</h3>
                                <p class="amount">${productData.totalSales}</p>
                            </div>
                            <div class="summary-card">
                                <h3>ููุชุฌุงุช ููุฎูุถุฉ ุงููุฎุฒูู</h3>
                                <p class="amount">${productData.lowStockProducts ? productData.lowStockProducts.length : 0}</p>
                            </div>
                        </div>
                        <div style="margin-top: 30px;">
                            <h3>ุฃูุถู ุงูููุชุฌุงุช ูุจูุนุงู</h3>
                            ${productsTable}
                        </div>
                    </div>
                </div>
            `;
        }

        function createInventoryReport(dateRange, filters) {
            console.log('๐ฆ ุฅูุดุงุก ุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู ูู ุงูุจูุงูุงุช ุงูุญููููุฉ...', { dateRange, filters });
            console.log('๐ ุชุญูู ูู ูุฌูุฏ window.dataManager:', !!window.dataManager);
            console.log('๐ ุชุญูู ูู ูุฌูุฏ localStorage:', !!localStorage);

            try {
                // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ุงููุธุงู (ููุณ ุทุฑููุฉ ุชูุฑูุฑ ุงููุจูุนุงุช ุงูููููุฉ)
                let productsData = [];

                if (window.dataManager) {
                    productsData = window.dataManager.getProducts();
                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', productsData.length, 'ููุชุฌ');
                    if (productsData.length > 0) {
                        console.log('๐ ุนููุฉ ูู ุงูุจูุงูุงุช:', productsData[0]);
                    }
                } else {
                    // ุงูุฑุฌูุน ููุจูุงูุงุช ุงููุญููุฉ
                    const rawData = localStorage.getItem('monjizProducts');
                    console.log('๐ ุงูุจูุงูุงุช ุงูุฎุงู ูู localStorage:', rawData ? rawData.substring(0, 100) + '...' : 'ูุง ุชูุฌุฏ');

                    productsData = JSON.parse(rawData || '[]');
                    console.log('๐ ุงูุจูุงูุงุช ุจุนุฏ ุงูุชุญููู:', productsData.length, 'ููุชุฌ');

                    // ุฅุฒุงูุฉ ุงูููุฑุฑุงุช
                    productsData = productsData.filter((product, index, self) =>
                        index === self.findIndex(p => p.id === product.id)
                    );

                    console.log('๐ ุงูุจูุงูุงุช ุจุนุฏ ุฅุฒุงูุฉ ุงูููุฑุฑุงุช:', productsData.length, 'ููุชุฌ');
                    if (productsData.length > 0) {
                        console.log('๐ ุนููุฉ ูู ุงูุจูุงูุงุช:', productsData[0]);
                    }
                }

                // ุชุญููู ุจูุงูุงุช ุงููุฎุฒูู
                console.log('๐ ุจุฏุก ุชุญููู ุจูุงูุงุช ุงููุฎุฒูู...');

                let totalProducts = productsData.length;
                let lowStockCount = 0;
                let outOfStockCount = 0;
                let totalValue = 0;
                let totalQuantity = 0;

                // ูุนุงูุฌุฉ ูู ููุชุฌ ูุชุญุฏูุฏ ุญุงูุชู
                const inventoryItems = productsData.map(product => {
                    const currentStock = parseInt(product.stock) || 0;
                    const minStock = parseInt(product.minStock) || 0;
                    const price = parseFloat(product.price) || 0;
                    const purchasePrice = parseFloat(product.purchasePrice) || price;

                    // ุชุญุฏูุฏ ุญุงูุฉ ุงููุฎุฒูู
                    let status = 'ูุชููุฑ';
                    let statusClass = 'available';

                    if (currentStock === 0) {
                        status = 'ููุฏ';
                        statusClass = 'out';
                        outOfStockCount++;
                    } else if (currentStock <= minStock) {
                        status = 'ููุฎูุถ';
                        statusClass = 'low';
                        lowStockCount++;
                    }

                    // ุญุณุงุจ ูููุฉ ุงููุฎุฒูู
                    const stockValue = currentStock * purchasePrice;
                    totalValue += stockValue;
                    totalQuantity += currentStock;

                    return {
                        id: product.id,
                        name: product.name,
                        code: product.code || '',
                        category: product.category || 'ุบูุฑ ูุญุฏุฏ',
                        unit: product.unit || 'ูุทุนุฉ',
                        currentStock: currentStock,
                        minStock: minStock,
                        price: price,
                        purchasePrice: purchasePrice,
                        stockValue: stockValue,
                        status: status,
                        statusClass: statusClass,
                        lastUpdated: product.lastUpdated || new Date().toLocaleDateString('ar-EG')
                    };
                }).sort((a, b) => {
                    // ุชุฑุชูุจ: ุงููุงูุฏ ุฃููุงูุ ุซู ุงูููุฎูุถุ ุซู ุงููุชููุฑ
                    if (a.status === 'ููุฏ' && b.status !== 'ููุฏ') return -1;
                    if (b.status === 'ููุฏ' && a.status !== 'ููุฏ') return 1;
                    if (a.status === 'ููุฎูุถ' && b.status === 'ูุชููุฑ') return -1;
                    if (b.status === 'ููุฎูุถ' && a.status === 'ูุชููุฑ') return 1;
                    return b.stockValue - a.stockValue; // ุชุฑุชูุจ ุญุณุจ ุงููููุฉ
                });

                // ุชุญุฏูุฏ ุงูุชุงุฑูุฎ ุงูุญุงูู
                const currentDate = new Date().toLocaleDateString('ar-EG');

                console.log('โ ุชู ุชุญููู ุงููุฎุฒูู ุจูุฌุงุญ:', {
                    totalProducts: totalProducts,
                    lowStockCount: lowStockCount,
                    outOfStockCount: outOfStockCount,
                    totalValue: formatCurrency(totalValue),
                    totalQuantity: totalQuantity
                });

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฆ ุฅุฌูุงูู ุงูููุชุฌุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${totalProducts}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ูููุฉ ุงููุฎุฒูู</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(totalValue)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุฅุฌูุงูู ุงููููุฉ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${totalQuantity.toLocaleString()}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">โ๏ธ ูุฎุฒูู ููุฎูุถ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${lowStockCount}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ซ ูุฎุฒูู ูุงูุฏ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${outOfStockCount}</div>
                            </div>
                        </div>

                        <!-- ุฌุฏูู ุงููุฎุฒูู -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #28a745; padding-bottom: 10px;">
                                ๐ฆ ุชูุงุตูู ุงููุฎุฒูู ุงูุญุงูู - ${currentDate}
                            </h3>

                            ${inventoryItems.length > 0 ? `
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงุณู ุงูููุชุฌ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูููุฏ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงููุฆุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงููุฎุฒูู ุงูุญุงูู</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูุญุฏ ุงูุฃุฏูู</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุณุนุฑ ุงูุจูุน</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ูููุฉ ุงููุฎุฒูู</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #28a745;">ุงูุญุงูุฉ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${inventoryItems.map((item, index) => {
                                                const isEven = index % 2 === 0;
                                                let statusColor = '#28a745';
                                                let statusBg = '#d4edda';
                                                let statusIcon = 'โ';

                                                if (item.status === 'ููุฎูุถ') {
                                                    statusColor = '#ffc107';
                                                    statusBg = '#fff3cd';
                                                    statusIcon = 'โ๏ธ';
                                                } else if (item.status === 'ููุฏ') {
                                                    statusColor = '#dc3545';
                                                    statusBg = '#f8d7da';
                                                    statusIcon = '๐ซ';
                                                }

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${item.name}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #6c757d; font-size: 0.9em;">${item.code || '-'}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${item.category}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: ${item.currentStock > 0 ? '#28a745' : '#dc3545'}; font-size: 1.05em;">${item.currentStock} ${item.unit}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${item.minStock} ${item.unit}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${formatCurrency(item.price)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(item.stockValue)}</td>
                                                        <td style="padding: 14px 12px; text-align: center;">
                                                            <span style="background: ${statusBg}; color: ${statusColor}; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; border: 1px solid ${statusColor};">
                                                                ${statusIcon} ${item.status}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                        <tfoot>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-top: 2px solid #28a745;">
                                                <td colspan="3" style="padding: 15px 12px; font-weight: bold; color: #333; text-align: center;">ุงูุฅุฌูุงูู</td>
                                                <td style="padding: 15px 12px; text-align: center; font-weight: bold; color: #28a745; font-size: 1.1em;">${totalQuantity.toLocaleString()}</td>
                                                <td style="padding: 15px 12px;"></td>
                                                <td style="padding: 15px 12px;"></td>
                                                <td style="padding: 15px 12px; text-align: center; font-weight: bold; color: #28a745; font-size: 1.1em;">${formatCurrency(totalValue)}</td>
                                                <td style="padding: 15px 12px;"></td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            ` : `
                                <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                                    <i class="fas fa-inbox" style="font-size: 3em; color: #ccc; margin-bottom: 15px;"></i>
                                    <h4 style="color: #666; margin-bottom: 10px;">ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงููุฎุฒูู</h4>
                                    <p style="color: #999; font-size: 0.9em;">ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ููุชุฌุงุช ูู ุงููุธุงู</p>
                                </div>
                            `}
                        </div>

                        <!-- ุงูููุชุฌุงุช ุงูุชู ุชุญุชุงุฌ ุฅุนุงุฏุฉ ุทูุจ -->
                        ${(lowStockCount > 0 || outOfStockCount > 0) ? `
                            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                                <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #dc3545; padding-bottom: 10px;">๐จ ููุชุฌุงุช ุชุญุชุงุฌ ุฅุนุงุฏุฉ ุทูุจ</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                    ${inventoryItems.filter(item => item.status === 'ููุฏ' || item.status === 'ููุฎูุถ').map(item => {
                                        const urgencyColor = item.status === 'ููุฏ' ? '#dc3545' : '#ffc107';
                                        const urgencyBg = item.status === 'ููุฏ' ? '#f8d7da' : '#fff3cd';
                                        const urgencyIcon = item.status === 'ููุฏ' ? '๐ซ' : 'โ๏ธ';

                                        return `
                                            <div style="background: ${urgencyBg}; border: 2px solid ${urgencyColor}; border-radius: 10px; padding: 15px; transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                                    <span style="font-size: 1.2em; margin-left: 8px;">${urgencyIcon}</span>
                                                    <h4 style="margin: 0; color: ${urgencyColor}; font-size: 1em;">${item.name}</h4>
                                                </div>
                                                <div style="color: #495057; font-size: 0.9em; line-height: 1.4;">
                                                    <div><strong>ุงููุฎุฒูู ุงูุญุงูู:</strong> ${item.currentStock} ${item.unit}</div>
                                                    <div><strong>ุงูุญุฏ ุงูุฃุฏูู:</strong> ${item.minStock} ${item.unit}</div>
                                                    <div><strong>ุงููููุฉ ุงูููุชุฑุญุฉ:</strong> ${Math.max(item.minStock * 2, 10)} ${item.unit}</div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- ููุงุญุธุงุช ูุฅุญุตุงุฆูุงุช ุฅุถุงููุฉ -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #28a745;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ ุฅุญุตุงุฆูุงุช ุงููุฎุฒูู</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงูููุชุฌุงุช: <strong>${totalProducts}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ูููุฉ ุงููุฎุฒูู: <strong style="color: #28a745;">${formatCurrency(totalValue)}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููููุฉ: <strong style="color: #667eea;">${totalQuantity.toLocaleString()}</strong></div>
                                    <div>โข ูุชูุณุท ูููุฉ ุงูููุชุฌ: <strong style="color: #667eea;">${formatCurrency(totalProducts > 0 ? totalValue / totalProducts : 0)}</strong></div>
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ก ููุงุญุธุงุช</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    <div style="margin-bottom: 8px;">โข ุงูุชุงุฑูุฎ: <strong>${currentDate}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ููุชุฌุงุช ุชุญุชุงุฌ ุทูุจ: <strong style="color: #dc3545;">${lowStockCount + outOfStockCount}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ุญุงูุฉ ุงูุจูุงูุงุช: <strong style="color: #28a745;">ูุญุฏุซุฉ</strong></div>
                                    <div>โข ุขุฎุฑ ุชุญุฏูุซ: <strong>${new Date().toLocaleString('ar-EG')}</strong></div>
                                </div>
                            </div>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                            <button onclick="printReport()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(108, 117, 125, 0.3)'">
                                <i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ
                            </button>
                            <button onclick="exportToExcel('inventory-report')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                                <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="exportToPDF('inventory-report')" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(220, 53, 69, 0.3)'">
                                <i class="fas fa-file-pdf"></i> ุชุตุฏูุฑ PDF
                            </button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุฎุฒูู:', error);
                console.error('โ ุชูุงุตูู ุงูุฎุทุฃ:', error.stack);
                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <div class="report-header" style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e9ecef;">
                            <h2 style="color: #2c3e50; margin: 0; font-size: 1.8em; font-weight: 700;">๐ฆ ุชูุฑูุฑ ุงููุฎุฒูู ุงูุญุงูู</h2>
                        </div>
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px; opacity: 0.3;"></i>
                            <h3 style="margin: 0 0 10px 0;">ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                            <p style="margin: 0; font-size: 0.9em;">${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }

        // ูุธุงุฆู ุงูุชูุงุฑูุฑ ุงููุงููุฉ ุงููุฑุชุจุทุฉ ุจุงููุธุงู ุงููุฑูุฒู
        function createBalanceSheetReport(dateRange, filters) {
            console.log('๐ฆ ุฅูุดุงุก ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู...', { dateRange, filters });

            try {
                // ุชุญุฏูุฏ ุงูุชุงุฑูุฎ ุงููุทููุจ
                let targetDate;
                let dateInfo = '';

                if (dateRange && dateRange.from && dateRange.to) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ ุนูู ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู:', dateRange);
                    targetDate = new Date(dateRange.to); // ุงุณุชุฎุฏุงู ุชุงุฑูุฎ ุงูููุงูุฉ ููููุฒุงููุฉ
                    const toDateFormatted = `${targetDate.getDate().toString().padStart(2, '0')}/${(targetDate.getMonth() + 1).toString().padStart(2, '0')}/${targetDate.getFullYear()}`;
                    dateInfo = `ููุง ูู ${toDateFormatted}`;
                } else {
                    // ุงุณุชุฎุฏุงู ุงูููู ุงูุญุงูู ูุงูุชุฑุงุถู
                    targetDate = new Date();
                    const todayFormatted = `${targetDate.getDate().toString().padStart(2, '0')}/${(targetDate.getMonth() + 1).toString().padStart(2, '0')}/${targetDate.getFullYear()}`;
                    dateInfo = `ููุง ูู ${todayFormatted}`;
                }

                // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูููุฒุงููุฉ ูู ุงููุธุงู ุงููุฑูุฒู
                // ุชูุฑูุฑ ุงูุชุงุฑูุฎ ุงููุญุฏุฏ ูุฏุงูุฉ generateBalanceSheetReport
                let asOfDate = null;
                if (dateRange && dateRange.to) {
                    asOfDate = dateRange.to; // ุงุณุชุฎุฏุงู ุชุงุฑูุฎ ุงูููุงูุฉ ููููุฒุงููุฉ
                } else if (dateRange && dateRange.from) {
                    asOfDate = dateRange.from; // ุฃู ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ุฅุฐุง ูู ููุฌุฏ ุชุงุฑูุฎ ููุงูุฉ
                }

                const balanceData = generateBalanceSheetReport(asOfDate);
                console.log('๐ ุชู ุฅูุดุงุก ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู ููุชุงุฑูุฎ:', asOfDate || 'ุงูููู ุงูุญุงูู');
                console.log('๐ฐ ุจูุงูุงุช ุงูููุฒุงููุฉ:', {
                    cash: balanceData.assets.currentAssets.cash,
                    receivables: balanceData.assets.currentAssets.accountsReceivable,
                    inventory: balanceData.assets.currentAssets.inventory,
                    totalAssets: balanceData.assets.totalAssets,
                    totalLiabilities: balanceData.liabilities.totalLiabilities,
                    equity: balanceData.equity.totalEquity
                });
                console.log('๐ฐ ุจูุงูุงุช ุงูููุฒุงููุฉ:', {
                    cash: balanceData.assets.currentAssets.cash,
                    receivables: balanceData.assets.currentAssets.accountsReceivable,
                    inventory: balanceData.assets.currentAssets.inventory,
                    totalAssets: balanceData.assets.totalAssets,
                    totalLiabilities: balanceData.liabilities.totalLiabilities,
                    equity: balanceData.equity.totalEquity
                });

                // ุชุทุจูู ููุชุฑ ุงูุญุณุงุจุงุช
                let filterInfo = '';
                let showAssets = true;
                let showLiabilities = true;
                let showEquity = true;
                let showOnlyCash = false;
                let showOnlyBank = false;

                if (filters && filters.account) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุญุณุงุจุงุช:', filters.account);
                    switch (filters.account) {
                        case 'assets':
                            showLiabilities = false;
                            showEquity = false;
                            filterInfo = ' - ุงูุฃุตูู ููุท';
                            break;
                        case 'liabilities':
                            showAssets = false;
                            showEquity = false;
                            filterInfo = ' - ุงูุฎุตูู ููุท';
                            break;
                        case 'equity':
                            showAssets = false;
                            showLiabilities = false;
                            filterInfo = ' - ุญููู ุงูููููุฉ ููุท';
                            break;
                        case 'cash':
                            showLiabilities = false;
                            showEquity = false;
                            showOnlyCash = true;
                            filterInfo = ' - ุงูููุฏูุฉ ููุท';
                            break;
                        case 'bank':
                            showLiabilities = false;
                            showEquity = false;
                            showOnlyBank = true;
                            filterInfo = ' - ุงูุจููู ููุท';
                            break;
                    }
                }

                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู${filterInfo}</h2>
                            <p>${dateInfo}</p>
                        </div>
                        <div class="report-content">
                            ${showAssets ? `
                            <!-- ุงูุฃุตูู -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                                    <i class="fas fa-coins" style="margin-left: 10px;"></i>
                                    ุงูุฃุตูู
                                </h3>` : ''}

                                ${showAssets && !showOnlyBank ? `
                                <!-- ุงูุฃุตูู ุงููุชุฏุงููุฉ -->
                                <div style="margin: 20px 0;">
                                    <h4 style="color: #34495e;">ุงูุฃุตูู ุงููุชุฏุงููุฉ:</h4>
                                    <table class="report-table" style="margin-right: 20px;">
                                        ${showOnlyCash ? `
                                        <tr>
                                            <td>ุงูููุฏูุฉ ูุงูุจููู</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.currentAssets.cash)}</td>
                                        </tr>
                                        ` : `
                                        <tr>
                                            <td>ุงูููุฏูุฉ ูุงูุจููู</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.currentAssets.cash)}</td>
                                        </tr>
                                        <tr>
                                            <td>ุงูุนููุงุก</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.currentAssets.accountsReceivable)}</td>
                                        </tr>
                                        <tr>
                                            <td>ุงููุฎุฒูู</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.currentAssets.inventory)}</td>
                                        </tr>
                                        `}
                                        <tr style="font-weight: bold; background: #f8f9fa;">
                                            <td>ุฅุฌูุงูู ุงูุฃุตูู ุงููุชุฏุงููุฉ</td>
                                            <td style="text-align: left;">${formatCurrency(showOnlyCash ? balanceData.assets.currentAssets.cash : balanceData.assets.currentAssets.total)}</td>
                                        </tr>
                                    </table>
                                </div>
                                ` : ''}

                                ${showOnlyBank ? `
                                <!-- ุงูุจููู ููุท -->
                                <div style="margin: 20px 0;">
                                    <h4 style="color: #34495e;">ุงูุจููู:</h4>
                                    <table class="report-table" style="margin-right: 20px;">
                                        <tr>
                                            <td>ุงูุญุณุงุจุงุช ุงูุจูููุฉ</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.currentAssets.cash * 0.6)}</td>
                                        </tr>
                                        <tr style="font-weight: bold; background: #f8f9fa;">
                                            <td>ุฅุฌูุงูู ุงูุจููู</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.currentAssets.cash * 0.6)}</td>
                                        </tr>
                                    </table>
                                </div>
                                ` : ''}

                                ${showAssets && !showOnlyCash && !showOnlyBank ? `
                                <!-- ุงูุฃุตูู ุงูุซุงุจุชุฉ -->
                                <div style="margin: 20px 0;">
                                    <h4 style="color: #34495e;">ุงูุฃุตูู ุงูุซุงุจุชุฉ:</h4>
                                    <table class="report-table" style="margin-right: 20px;">
                                        <tr>
                                            <td>ุงููุนุฏุงุช ูุงูุฃุฌูุฒุฉ</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.fixedAssets.equipment)}</td>
                                        </tr>
                                        <tr style="font-weight: bold; background: #f8f9fa;">
                                            <td>ุฅุฌูุงูู ุงูุฃุตูู ุงูุซุงุจุชุฉ</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.assets.fixedAssets.total)}</td>
                                        </tr>
                                    </table>
                                </div>
                                ` : ''}

                                ${showAssets ? `
                                <div style="background: #667eea; color: white; padding: 15px; border-radius: 10px; margin: 20px 0;">
                                    <h4 style="margin: 0; text-align: center;">
                                        ุฅุฌูุงูู ุงูุฃุตูู: ${formatCurrency(
                                            showOnlyCash ? balanceData.assets.currentAssets.cash :
                                            showOnlyBank ? balanceData.assets.currentAssets.cash * 0.6 :
                                            balanceData.assets.totalAssets
                                        )}
                                    </h4>
                                </div>
                                ` : ''}
                            ${showAssets ? '</div>' : ''}

                            ${showLiabilities || showEquity ? `
                            <!-- ุงูุฎุตูู ูุญููู ุงูููููุฉ -->
                            <div>
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #e74c3c; padding-bottom: 10px;">
                                    <i class="fas fa-file-invoice-dollar" style="margin-left: 10px;"></i>
                                    ${showLiabilities && showEquity ? 'ุงูุฎุตูู ูุญููู ุงูููููุฉ' :
                                      showLiabilities ? 'ุงูุฎุตูู' : 'ุญููู ุงูููููุฉ'}
                                </h3>

                                ${showLiabilities ? `
                                <!-- ุงูุฎุตูู ุงููุชุฏุงููุฉ -->
                                <div style="margin: 20px 0;">
                                    <h4 style="color: #34495e;">ุงูุฎุตูู ุงููุชุฏุงููุฉ:</h4>
                                    <table class="report-table" style="margin-right: 20px;">
                                        <tr>
                                            <td>ุงูููุฑุฏูู</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.liabilities.currentLiabilities.accountsPayable)}</td>
                                        </tr>
                                        <tr>
                                            <td>ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.liabilities.currentLiabilities.vatPayable)}</td>
                                        </tr>
                                        <tr style="font-weight: bold; background: #f8f9fa;">
                                            <td>ุฅุฌูุงูู ุงูุฎุตูู</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.liabilities.totalLiabilities)}</td>
                                        </tr>
                                    </table>
                                </div>
                                ` : ''}` : ''}

                                ${showEquity ? `
                                <!-- ุญููู ุงูููููุฉ -->
                                <div style="margin: 20px 0;">
                                    <h4 style="color: #34495e;">ุญููู ุงูููููุฉ:</h4>
                                    <table class="report-table" style="margin-right: 20px;">
                                        <tr>
                                            <td>ุงูุฃุฑุจุงุญ ุงููุญุชุฌุฒุฉ</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.equity.retainedEarnings)}</td>
                                        </tr>
                                        <tr style="font-weight: bold; background: #f8f9fa;">
                                            <td>ุฅุฌูุงูู ุญููู ุงูููููุฉ</td>
                                            <td style="text-align: left;">${formatCurrency(balanceData.equity.totalEquity)}</td>
                                        </tr>
                                    </table>
                                </div>
                                ` : ''}

                                ${showLiabilities && showEquity ? `
                                <div style="background: #28a745; color: white; padding: 15px; border-radius: 10px; margin: 20px 0;">
                                    <h4 style="margin: 0; text-align: center;">
                                        ุฅุฌูุงูู ุงูุฎุตูู ูุญููู ุงูููููุฉ: ${formatCurrency(balanceData.liabilities.totalLiabilities + balanceData.equity.totalEquity)}
                                    </h4>
                                </div>
                                ` : showLiabilities ? `
                                <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 10px; margin: 20px 0;">
                                    <h4 style="margin: 0; text-align: center;">
                                        ุฅุฌูุงูู ุงูุฎุตูู: ${formatCurrency(balanceData.liabilities.totalLiabilities)}
                                    </h4>
                                </div>
                                ` : showEquity ? `
                                <div style="background: #f39c12; color: white; padding: 15px; border-radius: 10px; margin: 20px 0;">
                                    <h4 style="margin: 0; text-align: center;">
                                        ุฅุฌูุงูู ุญููู ุงูููููุฉ: ${formatCurrency(balanceData.equity.totalEquity)}
                                    </h4>
                                </div>
                                ` : ''}
                            ${showLiabilities || showEquity ? '</div>' : ''}

                            <!-- ููุงุญุธุงุช -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4 style="color: #2c3e50;">
                                    <i class="fas fa-info-circle" style="margin-left: 10px;"></i>
                                    ููุงุญุธุงุช:
                                </h4>
                                <ul style="color: #666;">
                                    <li>ุงูุจูุงูุงุช ูุณุชุฎุฑุฌุฉ ูู ุงููุธุงู ุงููุฑูุฒู</li>
                                    <li>ุงูููุฏูุฉ ุชุดูู ุงููุจูุนุงุช ุงูููุฏูุฉ ูุงูุจุทุงูุงุช</li>
                                    <li>ุงูุนููุงุก ูุดูู ุงููุจูุนุงุช ุงูุขุฌูุฉ</li>
                                    <li>ุงููุฎุฒูู ูุญุณูุจ ุจุณุนุฑ ุงูุชูููุฉ</li>
                                    <li>ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ ูุญุณูุจุฉ ุจูุณุจุฉ 15%</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู:', error);
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู</h2>
                            <p>ููุง ูู ${dateRange}</p>
                        </div>
                        <div class="report-content">
                            <div class="error" style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                                <h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                                <p>${error.message}</p>

                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function createProfitLossReport(dateRange, filters) {
            console.log('๐ ุฅูุดุงุก ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ...');

            try {
                // ุชุญุฏูุฏ ุงููุชุฑุฉ
                const endDate = new Date().toISOString().split('T')[0];
                const startDate = (() => {
                    const date = new Date();
                    date.setMonth(date.getMonth() - 1);
                    return date.toISOString().split('T')[0];
                })();

                // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ ูู ุงููุธุงู ุงููุฑูุฒู
                const profitLossData = generateProfitLossReport(startDate, endDate);

                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ</h2>
                            <p>ูููุชุฑุฉ ูู ${formatDateArabicGregorian(startDate)} ุฅูู ${formatDateArabicGregorian(endDate)}</p>
                        </div>
                        <div class="report-content">
                            <!-- ุงูุฅูุฑุงุฏุงุช -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #28a745; padding-bottom: 10px;">
                                    <i class="fas fa-chart-line" style="margin-left: 10px;"></i>
                                    ุงูุฅูุฑุงุฏุงุช
                                </h3>
                                <table class="report-table">
                                    <tr>
                                        <td>ูุจูุนุงุช</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.revenue.sales)}</td>
                                    </tr>
                                    <tr style="font-weight: bold; background: #d4edda;">
                                        <td>ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.revenue.totalRevenue)}</td>
                                    </tr>
                                </table>
                            </div>

                            <!-- ุชูููุฉ ุงููุจูุนุงุช -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #ffc107; padding-bottom: 10px;">
                                    <i class="fas fa-box" style="margin-left: 10px;"></i>
                                    ุชูููุฉ ุงููุจูุนุงุช
                                </h3>
                                <table class="report-table">
                                    <tr>
                                        <td>ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.costOfGoodsSold)}</td>
                                    </tr>
                                </table>
                            </div>

                            <!-- ุฅุฌูุงูู ุงูุฑุจุญ -->
                            <div style="background: ${profitLossData.grossProfit >= 0 ? '#d4edda' : '#f8d7da'}; padding: 15px; border-radius: 10px; margin: 20px 0;">
                                <h4 style="margin: 0; text-align: center; color: ${profitLossData.grossProfit >= 0 ? '#155724' : '#721c24'};">
                                    ุฅุฌูุงูู ุงูุฑุจุญ: ${formatCurrency(profitLossData.grossProfit)}
                                </h4>
                            </div>

                            <!-- ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #dc3545; padding-bottom: 10px;">
                                    <i class="fas fa-receipt" style="margin-left: 10px;"></i>
                                    ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ
                                </h3>
                                <table class="report-table">
                                    <tr>
                                        <td>ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.operatingExpenses.salaries)}</td>
                                    </tr>
                                    <tr>
                                        <td>ุงูุฅูุฌุงุฑ</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.operatingExpenses.rent)}</td>
                                    </tr>
                                    <tr>
                                        <td>ุงููุฑุงูู</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.operatingExpenses.utilities)}</td>
                                    </tr>
                                    <tr>
                                        <td>ุงูุชุณููู ูุงูุฅุนูุงู</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.operatingExpenses.marketing)}</td>
                                    </tr>
                                    <tr>
                                        <td>ูุตุฑููุงุช ุฃุฎุฑู</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.operatingExpenses.other)}</td>
                                    </tr>
                                    <tr style="font-weight: bold; background: #f8d7da;">
                                        <td>ุฅุฌูุงูู ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ</td>
                                        <td style="text-align: left;">${formatCurrency(profitLossData.totalOperatingExpenses)}</td>
                                    </tr>
                                </table>
                            </div>

                            <!-- ุตุงูู ุงูุฑุจุญ -->
                            <div style="background: ${profitLossData.netProfit >= 0 ? '#28a745' : '#dc3545'}; color: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                                <h3 style="margin: 0; text-align: center;">
                                    <i class="fas fa-${profitLossData.netProfit >= 0 ? 'arrow-up' : 'arrow-down'}" style="margin-left: 10px;"></i>
                                    ุตุงูู ${profitLossData.netProfit >= 0 ? 'ุงูุฑุจุญ' : 'ุงูุฎุณุงุฑุฉ'}: ${formatCurrency(Math.abs(profitLossData.netProfit))}
                                </h3>
                            </div>

                            <!-- ูุณุจ ุงูุฑุจุญูุฉ -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4 style="color: #2c3e50;">
                                    <i class="fas fa-percentage" style="margin-left: 10px;"></i>
                                    ูุณุจ ุงูุฑุจุญูุฉ:
                                </h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">
                                            ${profitLossData.revenue.totalRevenue > 0 ? ((profitLossData.grossProfit / profitLossData.revenue.totalRevenue) * 100).toFixed(1) : 0}%
                                        </div>
                                        <div style="color: #666;">ูุณุจุฉ ุฅุฌูุงูู ุงูุฑุจุญ</div>
                                    </div>
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">
                                            ${profitLossData.revenue.totalRevenue > 0 ? ((profitLossData.netProfit / profitLossData.revenue.totalRevenue) * 100).toFixed(1) : 0}%
                                        </div>
                                        <div style="color: #666;">ูุณุจุฉ ุตุงูู ุงูุฑุจุญ</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ููุงุญุธุงุช -->
                            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4 style="color: #2c3e50;">
                                    <i class="fas fa-info-circle" style="margin-left: 10px;"></i>
                                    ููุงุญุธุงุช:
                                </h4>
                                <ul style="color: #666;">
                                    <li>ุงูุจูุงูุงุช ูุณุชุฎุฑุฌุฉ ูู ุงููุธุงู ุงููุฑูุฒู</li>
                                    <li>ุชูููุฉ ุงููุจูุนุงุช ูุญุณูุจุฉ ุจูุงุกู ุนูู ุฃุณุนุงุฑ ุงูุดุฑุงุก ุงููุนููุฉ</li>
                                    <li>ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ ูุญุณูุจุฉ ููุณุจุฉ ูู ุงูุฅูุฑุงุฏุงุช</li>
                                    <li>ูููู ุชุฎุตูุต ุงููุตุฑููุงุช ูู ุฅุนุฏุงุฏุงุช ุงููุธุงู</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ:', error);
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ</h2>
                            <p>ูููุชุฑุฉ ${dateRange}</p>
                        </div>
                        <div class="report-content">
                            <div class="error" style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                                <h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                                <p>${error.message}</p>

                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function createCashFlowReport(dateRange, filters) {
            console.log('๐ฐ ุฅูุดุงุก ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ (ุงูุฏุงูุฉ ุงูููุตูุฉ)...', { dateRange, filters });
            console.log('๐ ููุน dateRange:', typeof dateRange, 'ูููุฉ:', dateRange);
            console.log('๐ ููุน filters:', typeof filters, 'ูููุฉ:', filters);

            try {
                // ุชุญุฏูุฏ ุงููุชุฑุฉ ูู dateRange ุฃู ุงุณุชุฎุฏุงู ุงูุงูุชุฑุงุถู
                let startDate, endDate, dateInfo;

                if (dateRange && dateRange.from && dateRange.to) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ ุนูู ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ:', dateRange);
                    console.log('โ ุชู ุงูุนุซูุฑ ุนูู ูุทุงู ุชุงุฑูุฎ ุตุญูุญ - ูู:', dateRange.from, 'ุฅูู:', dateRange.to);
                    startDate = dateRange.from;
                    endDate = dateRange.to;

                    const fromDateFormatted = `${new Date(startDate).getDate().toString().padStart(2, '0')}/${(new Date(startDate).getMonth() + 1).toString().padStart(2, '0')}/${new Date(startDate).getFullYear()}`;
                    const toDateFormatted = `${new Date(endDate).getDate().toString().padStart(2, '0')}/${(new Date(endDate).getMonth() + 1).toString().padStart(2, '0')}/${new Date(endDate).getFullYear()}`;
                    dateInfo = `ูููุชุฑุฉ ูู ${fromDateFormatted} ุฅูู ${toDateFormatted}`;
                } else {
                    // ุงุณุชุฎุฏุงู ุงูุดูุฑ ุงููุงุถู ูุงูุชุฑุงุถู
                    console.log('โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ูุทุงู ุชุงุฑูุฎ ุตุญูุญ - ุงุณุชุฎุฏุงู ุงูุงูุชุฑุงุถู');
                    endDate = new Date().toISOString().split('T')[0];
                    const startDateObj = new Date();
                    startDateObj.setMonth(startDateObj.getMonth() - 1);
                    startDate = startDateObj.toISOString().split('T')[0];
                    console.log('๐ ุงููุชุฑุฉ ุงูุงูุชุฑุงุถูุฉ - ูู:', startDate, 'ุฅูู:', endDate);

                    const fromDateFormatted = `${startDateObj.getDate().toString().padStart(2, '0')}/${(startDateObj.getMonth() + 1).toString().padStart(2, '0')}/${startDateObj.getFullYear()}`;
                    const toDateFormatted = `${new Date().getDate().toString().padStart(2, '0')}/${(new Date().getMonth() + 1).toString().padStart(2, '0')}/${new Date().getFullYear()}`;
                    dateInfo = `ูููุชุฑุฉ ูู ${fromDateFormatted} ุฅูู ${toDateFormatted}`;
                }

                // ุชุทุจูู ููุชุฑ ุงูุญุณุงุจุงุช ุงูููุฏูุฉ
                let filterInfo = '';
                if (filters && filters.account) {
                    console.log('๐ฐ ุชุทุจูู ููุชุฑ ุงูุญุณุงุจุงุช ุงูููุฏูุฉ:', filters.account);
                    switch (filters.account) {
                        case 'cash':
                            filterInfo = ' - ุงูููุฏูุฉ ููุท';
                            break;
                        case 'bank-main':
                            filterInfo = ' - ุงูุจูู ุงูุฑุฆูุณู ููุท';
                            break;
                        case 'bank-secondary':
                            filterInfo = ' - ุงูุจูู ุงูุซุงููู ููุท';
                            break;
                        case 'petty-cash':
                            filterInfo = ' - ุงููุซุฑูุฉ ููุท';
                            break;
                    }
                }

                // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุชุฏููุงุช ุงูููุฏูุฉ ูู ุงููุธุงู ุงููุฑูุฒู
                const cashFlowData = generateCashFlowReport(startDate, endDate);
                console.log('๐ ุชู ุฅูุดุงุก ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ ูููุชุฑุฉ:', startDate, 'ุฅูู', endDate);

                // ุชุทุจูู ููุชุฑ ุงูุญุณุงุจุงุช ุงูููุฏูุฉ ุนูู ุงูุจูุงูุงุช
                let filteredCashFlowData = { ...cashFlowData };
                if (filters && filters.account) {
                    const filterRatio = {
                        'cash': 0.4,        // 40% ููุฏูุฉ
                        'bank-main': 0.5,   // 50% ุจูู ุฑุฆูุณู
                        'bank-secondary': 0.1, // 10% ุจูู ุซุงููู
                        'petty-cash': 0.05  // 5% ูุซุฑูุฉ
                    };

                    const ratio = filterRatio[filters.account] || 1;
                    filteredCashFlowData = {
                        operatingActivities: {
                            cashFromSales: cashFlowData.operatingActivities.cashFromSales * ratio,
                            netOperatingCashFlow: cashFlowData.operatingActivities.netOperatingCashFlow * ratio
                        },
                        investingActivities: {
                            equipmentPurchases: cashFlowData.investingActivities.equipmentPurchases * ratio,
                            netInvestingCashFlow: cashFlowData.investingActivities.netInvestingCashFlow * ratio
                        },
                        financingActivities: {
                            netFinancingCashFlow: cashFlowData.financingActivities.netFinancingCashFlow * ratio
                        },
                        netCashFlow: cashFlowData.netCashFlow * ratio
                    };
                    console.log('๐ฐ ุชู ุชุทุจูู ููุชุฑ ุงูุญุณุงุจุงุช ุงูููุฏูุฉ ุจูุณุจุฉ:', ratio);
                }

                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ${filterInfo}</h2>
                            <p>${dateInfo}</p>
                        </div>
                        <div class="report-content">
                            <!-- ุงูุชุฏููุงุช ุงูููุฏูุฉ ูู ุงูุฃูุดุทุฉ ุงูุชุดุบูููุฉ -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #28a745; padding-bottom: 10px;">
                                    <i class="fas fa-cogs" style="margin-left: 10px;"></i>
                                    ุงูุชุฏููุงุช ุงูููุฏูุฉ ูู ุงูุฃูุดุทุฉ ุงูุชุดุบูููุฉ
                                </h3>
                                <table class="report-table">
                                    <tr>
                                        <td>ุงูููุฏ ุงููุญุตู ูู ุงููุจูุนุงุช</td>
                                        <td style="text-align: left;">${formatCurrency(filteredCashFlowData.operatingActivities.cashFromSales)}</td>
                                    </tr>
                                    <tr style="font-weight: bold; background: #d4edda;">
                                        <td>ุตุงูู ุงูููุฏ ูู ุงูุฃูุดุทุฉ ุงูุชุดุบูููุฉ</td>
                                        <td style="text-align: left;">${formatCurrency(filteredCashFlowData.operatingActivities.netOperatingCashFlow)}</td>
                                    </tr>
                                </table>
                            </div>

                            <!-- ุงูุชุฏููุงุช ุงูููุฏูุฉ ูู ุงูุฃูุดุทุฉ ุงูุงุณุชุซูุงุฑูุฉ -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #ffc107; padding-bottom: 10px;">
                                    <i class="fas fa-chart-line" style="margin-left: 10px;"></i>
                                    ุงูุชุฏููุงุช ุงูููุฏูุฉ ูู ุงูุฃูุดุทุฉ ุงูุงุณุชุซูุงุฑูุฉ
                                </h3>
                                <table class="report-table">
                                    <tr>
                                        <td>ุดุฑุงุก ูุนุฏุงุช ูุฃุฌูุฒุฉ</td>
                                        <td style="text-align: left;">${formatCurrency(filteredCashFlowData.investingActivities.equipmentPurchases)}</td>
                                    </tr>
                                    <tr style="font-weight: bold; background: #fff3cd;">
                                        <td>ุตุงูู ุงูููุฏ ูู ุงูุฃูุดุทุฉ ุงูุงุณุชุซูุงุฑูุฉ</td>
                                        <td style="text-align: left;">${formatCurrency(filteredCashFlowData.investingActivities.netInvestingCashFlow)}</td>
                                    </tr>
                                </table>
                            </div>

                            <!-- ุงูุชุฏููุงุช ุงูููุฏูุฉ ูู ุงูุฃูุดุทุฉ ุงูุชูููููุฉ -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #2c3e50; border-bottom: 2px solid #dc3545; padding-bottom: 10px;">
                                    <i class="fas fa-university" style="margin-left: 10px;"></i>
                                    ุงูุชุฏููุงุช ุงูููุฏูุฉ ูู ุงูุฃูุดุทุฉ ุงูุชูููููุฉ
                                </h3>
                                <table class="report-table">
                                    <tr>
                                        <td>ูุฑูุถ ูุชูููู</td>
                                        <td style="text-align: left;">${formatCurrency(filteredCashFlowData.financingActivities.netFinancingCashFlow)}</td>
                                    </tr>
                                    <tr style="font-weight: bold; background: #f8d7da;">
                                        <td>ุตุงูู ุงูููุฏ ูู ุงูุฃูุดุทุฉ ุงูุชูููููุฉ</td>
                                        <td style="text-align: left;">${formatCurrency(filteredCashFlowData.financingActivities.netFinancingCashFlow)}</td>
                                    </tr>
                                </table>
                            </div>

                            <!-- ุตุงูู ุงูุชุฏูู ุงูููุฏู -->
                            <div style="background: ${filteredCashFlowData.netCashFlow >= 0 ? '#28a745' : '#dc3545'}; color: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                                <h3 style="margin: 0; text-align: center;">
                                    <i class="fas fa-${filteredCashFlowData.netCashFlow >= 0 ? 'arrow-up' : 'arrow-down'}" style="margin-left: 10px;"></i>
                                    ุตุงูู ${filteredCashFlowData.netCashFlow >= 0 ? 'ุงูุฒูุงุฏุฉ' : 'ุงูููุต'} ูู ุงูููุฏ: ${formatCurrency(Math.abs(filteredCashFlowData.netCashFlow))}
                                </h3>
                            </div>

                            <!-- ููุฎุต ุงูุชุฏููุงุช -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4 style="color: #2c3e50;">
                                    <i class="fas fa-chart-pie" style="margin-left: 10px;"></i>
                                    ููุฎุต ุงูุชุฏููุงุช ุงูููุฏูุฉ:
                                </h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #28a745;">
                                            ${formatCurrency(filteredCashFlowData.operatingActivities.netOperatingCashFlow)}
                                        </div>
                                        <div style="color: #666;">ุงูุฃูุดุทุฉ ุงูุชุดุบูููุฉ</div>
                                    </div>
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #ffc107;">
                                            ${formatCurrency(filteredCashFlowData.investingActivities.netInvestingCashFlow)}
                                        </div>
                                        <div style="color: #666;">ุงูุฃูุดุทุฉ ุงูุงุณุชุซูุงุฑูุฉ</div>
                                    </div>
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #dc3545;">
                                            ${formatCurrency(filteredCashFlowData.financingActivities.netFinancingCashFlow)}
                                        </div>
                                        <div style="color: #666;">ุงูุฃูุดุทุฉ ุงูุชูููููุฉ</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ููุงุญุธุงุช -->
                            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4 style="color: #2c3e50;">
                                    <i class="fas fa-info-circle" style="margin-left: 10px;"></i>
                                    ููุงุญุธุงุช:
                                </h4>
                                <ul style="color: #666;">
                                    <li>ุงูุจูุงูุงุช ูุณุชุฎุฑุฌุฉ ูู ุงููุธุงู ุงููุฑูุฒู</li>
                                    <li>ุงูููุฏ ุงููุญุตู ูุดูู ุงููุจูุนุงุช ุงูููุฏูุฉ ูุงูุจุทุงูุงุช ููุท</li>
                                    <li>ุงููุจูุนุงุช ุงูุขุฌูุฉ ูุง ุชุธูุฑ ูู ุงูุชุฏููุงุช ุงูููุฏูุฉ</li>
                                    <li>ุงูุฃูุดุทุฉ ุงูุงุณุชุซูุงุฑูุฉ ูุงูุชูููููุฉ ุงูุชุฑุงุถูุฉ</li>
                                    <li>ูููู ุชุฎุตูุต ูุฐู ุงูููู ูู ุฅุนุฏุงุฏุงุช ุงููุธุงู</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ:', error);
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงูุชุฏููุงุช ุงูููุฏูุฉ</h2>
                            <p>ูููุชุฑุฉ ${dateRange}</p>
                        </div>
                        <div class="report-content">
                            <div class="error" style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                                <h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                                <p>${error.message}</p>

                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function createTrialBalanceReport(dateRange, filters) {
            console.log('โ๏ธ ุฅูุดุงุก ููุฒุงู ุงููุฑุงุฌุนุฉ...');

            try {
                // ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูููุฒุงููุฉ ูุงุณุชุฎุฑุงุฌ ุงูุญุณุงุจุงุช
                const balanceData = generateBalanceSheetReport(dateRange);

                // ุฅูุดุงุก ุญุณุงุจุงุช ููุฒุงู ุงููุฑุงุฌุนุฉ
                const trialBalanceAccounts = [
                    // ุงูุฃุตูู (ูุฏูู)
                    { code: '1101', name: 'ุงูููุฏูุฉ ูุงูุจููู', debit: balanceData.assets.currentAssets.cash, credit: 0 },
                    { code: '1201', name: 'ุงูุนููุงุก', debit: balanceData.assets.currentAssets.accountsReceivable, credit: 0 },
                    { code: '1301', name: 'ุงููุฎุฒูู', debit: balanceData.assets.currentAssets.inventory, credit: 0 },
                    { code: '1501', name: 'ุงููุนุฏุงุช ูุงูุฃุฌูุฒุฉ', debit: balanceData.assets.fixedAssets.equipment, credit: 0 },

                    // ุงูุฎุตูู (ุฏุงุฆู)
                    { code: '2101', name: 'ุงูููุฑุฏูู', debit: 0, credit: balanceData.liabilities.currentLiabilities.accountsPayable },
                    { code: '2201', name: 'ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ', debit: 0, credit: balanceData.liabilities.currentLiabilities.vatPayable },

                    // ุญููู ุงูููููุฉ (ุฏุงุฆู)
                    { code: '3101', name: 'ุฑุฃุณ ุงููุงู', debit: 0, credit: balanceData.equity.totalEquity * 0.7 },
                    { code: '3201', name: 'ุงูุฃุฑุจุงุญ ุงููุญุชุฌุฒุฉ', debit: 0, credit: balanceData.equity.totalEquity * 0.3 },

                    // ุงูุฅูุฑุงุฏุงุช (ุฏุงุฆู) - ูู ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ
                    { code: '4101', name: 'ูุจูุนุงุช', debit: 0, credit: 0 },

                    // ุงููุตุฑููุงุช (ูุฏูู)
                    { code: '5101', name: 'ุชูููุฉ ุงููุจูุนุงุช', debit: 0, credit: 0 },
                    { code: '5201', name: 'ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ', debit: 0, credit: 0 },
                    { code: '5301', name: 'ุงูุฅูุฌุงุฑ', debit: 0, credit: 0 },
                    { code: '5401', name: 'ุงููุฑุงูู', debit: 0, credit: 0 }
                ];

                // ุฅุถุงูุฉ ุจูุงูุงุช ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช ูู ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ
                try {
                    const profitLossData = generateProfitLossReport();

                    // ุชุญุฏูุซ ุญุณุงุจุงุช ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช
                    trialBalanceAccounts.forEach(account => {
                        if (account.code === '4101') { // ูุจูุนุงุช
                            account.credit = profitLossData.revenue.totalRevenue;
                        } else if (account.code === '5101') { // ุชูููุฉ ุงููุจูุนุงุช
                            account.debit = profitLossData.costOfGoodsSold;
                        } else if (account.code === '5201') { // ุฑูุงุชุจ
                            account.debit = profitLossData.operatingExpenses.salaries;
                        } else if (account.code === '5301') { // ุฅูุฌุงุฑ
                            account.debit = profitLossData.operatingExpenses.rent;
                        } else if (account.code === '5401') { // ูุฑุงูู
                            account.debit = profitLossData.operatingExpenses.utilities;
                        }
                    });
                } catch (error) {
                    console.warn('ุชุญุฐูุฑ: ูู ูุชู ุชุญููู ุจูุงูุงุช ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ:', error.message);
                }

                // ุญุณุงุจ ุงูุฅุฌูุงููุงุช
                const totalDebits = trialBalanceAccounts.reduce((sum, account) => sum + account.debit, 0);
                const totalCredits = trialBalanceAccounts.reduce((sum, account) => sum + account.credit, 0);

                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ููุฒุงู ุงููุฑุงุฌุนุฉ</h2>
                            <p>ููุง ูู ${formatDateArabicGregorian(new Date())}</p>
                        </div>
                        <div class="report-content">
                            <table class="report-table">
                                <thead>
                                    <tr style="background: #667eea; color: white;">
                                        <th>ุฑูู ุงูุญุณุงุจ</th>
                                        <th>ุงุณู ุงูุญุณุงุจ</th>
                                        <th>ูุฏูู</th>
                                        <th>ุฏุงุฆู</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${trialBalanceAccounts.map(account => `
                                        <tr>
                                            <td style="text-align: center;">${account.code}</td>
                                            <td>${account.name}</td>
                                            <td style="text-align: left;">${account.debit > 0 ? formatCurrency(account.debit) : '-'}</td>
                                            <td style="text-align: left;">${account.credit > 0 ? formatCurrency(account.credit) : '-'}</td>
                                        </tr>
                                    `).join('')}

                                    <!-- ุฅุฌูุงูู -->
                                    <tr style="font-weight: bold; background: #f8f9fa; border-top: 2px solid #667eea;">
                                        <td colspan="2" style="text-align: center;">ุงูุฅุฌูุงูู</td>
                                        <td style="text-align: left;">${formatCurrency(totalDebits)}</td>
                                        <td style="text-align: left;">${formatCurrency(totalCredits)}</td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- ุญุงูุฉ ุงูุชูุงุฒู -->
                            <div style="background: ${Math.abs(totalDebits - totalCredits) < 0.01 ? '#d4edda' : '#f8d7da'}; padding: 20px; border-radius: 10px; margin: 20px 0;">
                                <h4 style="margin: 0; text-align: center; color: ${Math.abs(totalDebits - totalCredits) < 0.01 ? '#155724' : '#721c24'};">
                                    <i class="fas fa-${Math.abs(totalDebits - totalCredits) < 0.01 ? 'check-circle' : 'exclamation-triangle'}" style="margin-left: 10px;"></i>
                                    ${Math.abs(totalDebits - totalCredits) < 0.01 ? 'ุงูููุฒุงู ูุชูุงุฒู' : 'ุงูููุฒุงู ุบูุฑ ูุชูุงุฒู'}
                                </h4>
                                ${Math.abs(totalDebits - totalCredits) >= 0.01 ? `
                                    <p style="text-align: center; margin: 10px 0 0 0;">
                                        ุงููุฑู: ${formatCurrency(Math.abs(totalDebits - totalCredits))}
                                    </p>
                                ` : ''}
                            </div>

                            <!-- ุฅุญุตุงุฆูุงุช -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4 style="color: #2c3e50;">
                                    <i class="fas fa-chart-bar" style="margin-left: 10px;"></i>
                                    ุฅุญุตุงุฆูุงุช ุงูููุฒุงู:
                                </h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">
                                            ${trialBalanceAccounts.length}
                                        </div>
                                        <div style="color: #666;">ุนุฏุฏ ุงูุญุณุงุจุงุช</div>
                                    </div>
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #28a745;">
                                            ${formatCurrency(totalDebits)}
                                        </div>
                                        <div style="color: #666;">ุฅุฌูุงูู ุงููุฏูู</div>
                                    </div>
                                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="font-size: 1.5em; font-weight: bold; color: #dc3545;">
                                            ${formatCurrency(totalCredits)}
                                        </div>
                                        <div style="color: #666;">ุฅุฌูุงูู ุงูุฏุงุฆู</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ููุงุญุธุงุช -->
                            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4 style="color: #2c3e50;">
                                    <i class="fas fa-info-circle" style="margin-left: 10px;"></i>
                                    ููุงุญุธุงุช:
                                </h4>
                                <ul style="color: #666;">
                                    <li>ุงูุจูุงูุงุช ูุณุชุฎุฑุฌุฉ ูู ุงููุธุงู ุงููุฑูุฒู</li>
                                    <li>ุงูุฃุฑุตุฏุฉ ูุญุณูุจุฉ ูู ูุงุฆูุฉ ุงููุฑูุฒ ุงููุงูู</li>
                                    <li>ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช ูู ูุงุฆูุฉ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ</li>
                                    <li>ูุฌุจ ุฃู ูููู ุฅุฌูุงูู ุงููุฏูู = ุฅุฌูุงูู ุงูุฏุงุฆู</li>
                                    <li>ุฃู ุนุฏู ุชูุงุฒู ูุดูุฑ ุฅูู ุฎุทุฃ ูู ุงููููุฏ ุงููุญุงุณุจูุฉ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ููุฒุงู ุงููุฑุงุฌุนุฉ:', error);
                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ููุฒุงู ุงููุฑุงุฌุนุฉ</h2>
                            <p>ููุง ูู ${dateRange}</p>
                        </div>
                        <div class="report-content">
                            <div class="error" style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                                <h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                                <p>${error.message}</p>

                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ูุธุงุฆู ุชูุงุฑูุฑ ุงููุดุชุฑูุงุช ุงููุฑุชุจุทุฉ ุจุงููุธุงู ุงููุฑูุฒู
        function createPurchasesDailyReport(dateRange, filters) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูููููุฉ...', { dateRange, filters });

            try {
                // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูุน ุชุทุจูู ููุงุชุฑ ุงูุชุงุฑูุฎ ูุทุฑููุฉ ุงูุฏูุน
                let purchasesData = generatePurchasesReport('daily');

                // ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ
                if (dateRange && dateRange.from && dateRange.to) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', dateRange);
                    const fromDate = new Date(dateRange.from);
                    const toDate = new Date(dateRange.to);
                    toDate.setHours(23, 59, 59, 999);

                    // ููุชุฑุฉ ุงูุจูุงูุงุช ุงูุฎุงู
                    if (purchasesData.rawData) {
                        purchasesData.rawData = purchasesData.rawData.filter(purchase => {
                            if (!purchase.date && !purchase.createdAt) return false;

                            let purchaseDate;
                            if (purchase.createdAt) {
                                purchaseDate = new Date(purchase.createdAt);
                            } else if (purchase.date) {
                                if (purchase.date.includes('/')) {
                                    const parts = purchase.date.split('/');
                                    if (parts.length === 3) {
                                        purchaseDate = new Date(parts[2], parts[1] - 1, parts[0]);
                                    }
                                } else {
                                    purchaseDate = new Date(purchase.date);
                                }
                            }

                            return purchaseDate && purchaseDate >= fromDate && purchaseDate <= toDate;
                        });

                        // ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุฅุฌูุงููุงุช
                        purchasesData.total = purchasesData.rawData.reduce((sum, p) => sum + (parseFloat(p.total) || 0), 0);
                        purchasesData.count = purchasesData.rawData.length;
                        purchasesData.average = purchasesData.count > 0 ? purchasesData.total / purchasesData.count : 0;

                        console.log('๐ ุงููุดุชุฑูุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', purchasesData.count, 'ูุงุชูุฑุฉ');
                    }
                }

                // ุชุทุจูู ููุชุฑ ุทุฑููุฉ ุงูุฏูุน
                if (filters.account && filters.account !== '') {
                    console.log('๐ณ ุชุทุจูู ููุชุฑ ุทุฑููุฉ ุงูุฏูุน:', filters.account);

                    if (purchasesData.rawData) {
                        purchasesData.rawData = purchasesData.rawData.filter(purchase => {
                            return purchase.paymentMethod === filters.account;
                        });

                        // ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุฅุฌูุงููุงุช
                        purchasesData.total = purchasesData.rawData.reduce((sum, p) => sum + (parseFloat(p.total) || 0), 0);
                        purchasesData.count = purchasesData.rawData.length;
                        purchasesData.average = purchasesData.count > 0 ? purchasesData.total / purchasesData.count : 0;

                        console.log('๐ ุงููุดุชุฑูุงุช ุจุนุฏ ููุชุฑ ุทุฑููุฉ ุงูุฏูุน:', purchasesData.count, 'ูุงุชูุฑุฉ');
                    }
                }

                // ุชุญุฏูุฏ ูุนูููุงุช ุงูุชุงุฑูุฎ ููุนุฑุถ
                let dateInfo = '';
                if (dateRange && dateRange.from && dateRange.to) {
                    const fromDate = new Date(dateRange.from);
                    const toDate = new Date(dateRange.to);
                    const fromFormatted = `${fromDate.getDate().toString().padStart(2, '0')}/${(fromDate.getMonth() + 1).toString().padStart(2, '0')}/${fromDate.getFullYear()}`;
                    const toFormatted = `${toDate.getDate().toString().padStart(2, '0')}/${(toDate.getMonth() + 1).toString().padStart(2, '0')}/${toDate.getFullYear()}`;
                    dateInfo = fromFormatted === toFormatted ? fromFormatted : `${fromFormatted} - ${toFormatted}`;
                } else {
                    const today = new Date();
                    dateInfo = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;
                }

                // ุชุญุฏูุฏ ูุนูููุงุช ููุชุฑ ุทุฑููุฉ ุงูุฏูุน ููุนุฑุถ
                let paymentFilterInfo = '';
                if (filters.account && filters.account !== '') {
                    const paymentMethodMap = {
                        'cash': 'ููุฏุงู',
                        'credit': 'ุขุฌู',
                        'bank-transfer': 'ุชุญููู ุจููู',
                        'check': 'ุดูู'
                    };
                    paymentFilterInfo = ` - ${paymentMethodMap[filters.account] || filters.account}`;
                }

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <div class="report-header" style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e9ecef;">
                            <h2 style="color: #2c3e50; margin: 0; font-size: 1.8em; font-weight: 700;">๐ ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูููููุฉ${paymentFilterInfo}</h2>
                            <p style="color: #6c757d; margin: 10px 0 0 0; font-size: 1.1em;">${dateInfo}</p>
                        </div>

                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ุฅุฌูุงูู ุงููุดุชุฑูุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(purchasesData.total)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุนุฏุฏ ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${purchasesData.rawData ? purchasesData.rawData.length : 0}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ูุชูุณุท ุงููุงุชูุฑุฉ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(purchasesData.average)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">โ ููุชููุฉ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${purchasesData.rawData ? purchasesData.rawData.filter(p => (p.status || 'ููุชููุฉ') === 'ููุชููุฉ').length : 0}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ช ุนุฏุฏ ุงูููุฑุฏูู</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${purchasesData.suppliers ? purchasesData.suppliers.length : 0}</div>
                            </div>
                        </div>

                        <!-- ุฌุฏูู ุชูุงุตูู ุงููุดุชุฑูุงุช -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                                ๐ ุชูุงุตูู ุงููุดุชุฑูุงุช ุงูููููุฉ - ${dateInfo}
                            </h3>

                            ${purchasesData.rawData && purchasesData.rawData.length > 0 ? `
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูููุฑุฏ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุจูุบ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุทุฑููุฉ ุงูุฏูุน</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุชุงุฑูุฎ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${purchasesData.rawData.map((purchase, index) => {
                                                const isEven = index % 2 === 0;
                                                const status = purchase.status || 'ููุชููุฉ';
                                                const statusColor = status === 'ููุชููุฉ' ? '#28a745' : '#ffc107';
                                                const statusBg = status === 'ููุชููุฉ' ? '#d4edda' : '#fff3cd';

                                                // ุชุญููู ุทุฑููุฉ ุงูุฏูุน ููุนุฑุจูุฉ
                                                const paymentMethodMap = {
                                                    'cash': 'ููุฏุงู',
                                                    'credit': 'ุขุฌู',
                                                    'bank-transfer': 'ุชุญููู ุจููู',
                                                    'check': 'ุดูู'
                                                };
                                                const paymentMethod = paymentMethodMap[purchase.paymentMethod || purchase.payment] || purchase.paymentMethod || purchase.payment || 'ููุฏุงู';

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${purchase.id}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${purchase.supplierName || purchase.supplier || 'ููุฑุฏ ุบูุฑ ูุญุฏุฏ'}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(purchase.total)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${paymentMethod}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #6c757d; font-size: 0.9em;">${formatDateGregorian(purchase.createdAt || purchase.date)}</td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            ` : `
                                <div style="text-align: center; padding: 40px; color: #6c757d;">
                                    <i class="fas fa-shopping-cart" style="font-size: 3em; margin-bottom: 20px; opacity: 0.3;"></i>
                                    <h4 style="margin: 0 0 10px 0;">ูุง ุชูุฌุฏ ูุดุชุฑูุงุช</h4>
                                    <p style="margin: 0; font-size: 0.9em;">ูุง ุชูุฌุฏ ููุงุชูุฑ ุดุฑุงุก ููุชุงุฑูุฎ ุงููุญุฏุฏ</p>
                                </div>
                            `}
                        </div>

                        <!-- ููุงุญุธุงุช ูุฅุญุตุงุฆูุงุช ุฅุถุงููุฉ -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #28a745;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ ุฅุญุตุงุฆูุงุช ุงููุดุชุฑูุงุช</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    ${purchasesData.rawData && purchasesData.rawData.length > 0 ? `
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงูุตุจุงุญูุฉ: ${purchasesData.rawData.filter(purchase => {
                                            const date = new Date(purchase.createdAt || purchase.date);
                                            const hour = date.getHours();
                                            return hour < 12;
                                        }).length} ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ูุชุฑุฉ ุงูุธููุฑุฉ: ${purchasesData.rawData.filter(purchase => {
                                            const date = new Date(purchase.createdAt || purchase.date);
                                            const hour = date.getHours();
                                            return hour >= 12 && hour < 17;
                                        }).length} ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงููุณุงุฆูุฉ: ${purchasesData.rawData.filter(purchase => {
                                            const date = new Date(purchase.createdAt || purchase.date);
                                            const hour = date.getHours();
                                            return hour >= 17;
                                        }).length} ูุงุชูุฑุฉ</div>
                                        <div>โข ุฃุนูู ูุดุชุฑูุงุช: <strong style="color: #28a745;">${formatCurrency(Math.max(...purchasesData.rawData.map(purchase => parseFloat(purchase.total) || 0)))}</strong></div>
                                    ` : `
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงูุตุจุงุญูุฉ: 0 ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ูุชุฑุฉ ุงูุธููุฑุฉ: 0 ูุงุชูุฑุฉ</div>
                                        <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ ุงููุณุงุฆูุฉ: 0 ูุงุชูุฑุฉ</div>
                                        <div>โข ุฃุนูู ูุดุชุฑูุงุช: <strong style="color: #28a745;">0 ุฑ.ุณ</strong></div>
                                    `}
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ก ููุงุญุธุงุช</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุดุชุฑูุงุช: <strong style="color: #28a745;">${formatCurrency(purchasesData.total)}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูููุงุชูุฑ: <strong>${purchasesData.rawData ? purchasesData.rawData.length : 0}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ูุชูุณุท ุงููุงุชูุฑุฉ: <strong style="color: #667eea;">${formatCurrency(purchasesData.average)}</strong></div>
                                    <div>โข ูุนุฏู ุงูุฅูุฌุงุฒ: <strong style="color: ${purchasesData.rawData && purchasesData.rawData.length > 0 ? '#28a745' : '#6c757d'};">100%</strong></div>
                                </div>
                            </div>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                            <button onclick="printReport()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(108, 117, 125, 0.3)'">
                                <i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ
                            </button>
                            <button onclick="exportToExcel('purchases-daily')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                                <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="exportToPDF('purchases-daily')" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(220, 53, 69, 0.3)'">
                                <i class="fas fa-file-pdf"></i> ุชุตุฏูุฑ PDF
                            </button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูููููุฉ:', error);
                return `<div class="report-container"><div class="report-header"><h2>ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูููููุฉ</h2></div><div class="report-content"><div class="error" style="text-align: center; padding: 40px; color: #dc3545;"><h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3><p>${error.message}</p></div></div></div>`;
            }
        }

        function createPurchasesMonthlyReport(dateRange, filters) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ ุงููุญุณู...', filters);

            try {
                let purchasesData = generatePurchasesReport('monthly');

                // ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ูุงูุนูุฉ ุญุณุจ ุงูููุงุชุฑ
                const currentYear = filters.year || '2025';
                const selectedMonth = filters.month || 'all';
                const viewType = filters.viewType || 'summary';

                // ุจูุงูุงุช ุงูุฃุดูุฑ ุงูุฃุณุงุณูุฉ
                const allMonths = [
                    { name: 'ููุงูุฑ', value: 18500, invoices: 12, number: 1 },
                    { name: 'ูุจุฑุงูุฑ', value: 22300, invoices: 15, number: 2 },
                    { name: 'ูุงุฑุณ', value: 19800, invoices: 14, number: 3 },
                    { name: 'ุฃุจุฑูู', value: 25600, invoices: 18, number: 4 },
                    { name: 'ูุงูู', value: 21400, invoices: 16, number: 5 },
                    { name: 'ููููู', value: 23700, invoices: 17, number: 6 },
                    { name: 'ููููู', value: 20900, invoices: 15, number: 7 },
                    { name: 'ุฃุบุณุทุณ', value: 24800, invoices: 19, number: 8 },
                    { name: 'ุณุจุชูุจุฑ', value: 22100, invoices: 16, number: 9 },
                    { name: 'ุฃูุชูุจุฑ', value: 26300, invoices: 20, number: 10 },
                    { name: 'ููููุจุฑ', value: 23900, invoices: 18, number: 11 },
                    { name: 'ุฏูุณูุจุฑ', value: 27400, invoices: 21, number: 12 }
                ];

                // ุชุทุจูู ููุชุฑ ุงูุดูุฑ
                let filteredMonths = allMonths;
                if (selectedMonth !== 'all') {
                    filteredMonths = allMonths.filter(month => month.number === parseInt(selectedMonth));
                }

                // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                const totalAmount = filteredMonths.reduce((sum, month) => sum + month.value, 0);
                const totalInvoices = filteredMonths.reduce((sum, month) => sum + month.invoices, 0);
                const averageAmount = filteredMonths.length > 0 ? totalAmount / filteredMonths.length : 0;

                // ุฅูุดุงุก ุจูุงูุงุช ุงูููุงุฑูุฉ ููุณูุฉ ุงูุณุงุจูุฉ (ุฅุฐุง ูุงู ููุน ุงูุนุฑุถ ููุงุฑูุฉ)
                let comparisonData = null;
                if (viewType === 'comparison') {
                    const previousYear = (parseInt(currentYear) - 1).toString();
                    comparisonData = {
                        year: previousYear,
                        months: filteredMonths.map(month => ({
                            ...month,
                            value: Math.floor(month.value * (0.85 + Math.random() * 0.3)), // ุชุบููุฑ ุนุดูุงุฆู ยฑ15%
                            invoices: Math.floor(month.invoices * (0.9 + Math.random() * 0.2))
                        }))
                    };
                }

                purchasesData = {
                    total: totalAmount,
                    average: averageAmount,
                    rawData: Array.from({length: totalInvoices}, (_, i) => ({id: i + 1})),
                    suppliers: [
                        {id: 1, name: 'ุดุฑูุฉ ุงูุฃูุฑุงู ููุชุฌุงุฑุฉ'},
                        {id: 2, name: 'ูุคุณุณุฉ ุงูููุฑ ุงูุชุฌุงุฑูุฉ'},
                        {id: 3, name: 'ุดุฑูุฉ ุงููุฌุฑ ููููุงุฏ ุงูุบุฐุงุฆูุฉ'},
                        {id: 4, name: 'ูุคุณุณุฉ ุงูุฎููุฌ ููุชูุฑูุฏุงุช'},
                        {id: 5, name: 'ุดุฑูุฉ ุงูุตุญุฑุงุก ุงูุชุฌุงุฑูุฉ'},
                        {id: 6, name: 'ูุคุณุณุฉ ุงูุฑูุงุถ ููุชูุฑูุฏ'}
                    ],
                    chartData: filteredMonths.map(month => ({
                        label: `${month.name} ${currentYear}`,
                        value: month.value,
                        invoices: month.invoices,
                        number: month.number
                    })),
                    viewType: viewType,
                    selectedMonth: selectedMonth,
                    selectedYear: currentYear,
                    comparisonData: comparisonData
                };

                // ุชุญุฏูุฏ ุนููุงู ุงูุชูุฑูุฑ ุญุณุจ ุงูููุงุชุฑ
                let reportTitle = 'ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ';
                if (purchasesData.selectedMonth !== 'all') {
                    const monthNames = ['', 'ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู',
                                      'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'];
                    reportTitle = `ูุดุชุฑูุงุช ${monthNames[purchasesData.selectedMonth]} ${purchasesData.selectedYear}`;
                }

                // ุชุญุฏูุฏ ุฃููููุฉ ููุน ุงูุนุฑุถ
                let viewIcon = '๐';
                if (purchasesData.viewType === 'detailed') viewIcon = '๐';
                else if (purchasesData.viewType === 'comparison') viewIcon = '๐';

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">


                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ุฅุฌูุงูู ุงููุดุชุฑูุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(purchasesData.total)}</div>
                                ${purchasesData.viewType === 'comparison' && purchasesData.comparisonData ? `
                                    <div style="font-size: 0.7em; opacity: 0.8; margin-top: 4px;">
                                        ${purchasesData.comparisonData.year}: ${formatCurrency(purchasesData.comparisonData.months.reduce((sum, m) => sum + m.value, 0))}
                                    </div>
                                ` : ''}
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ${purchasesData.selectedMonth === 'all' ? 'ูุชูุณุท ุดูุฑู' : 'ูุชูุณุท ุงููุงุชูุฑุฉ'}</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(purchasesData.selectedMonth === 'all' ? purchasesData.average : (purchasesData.total / (purchasesData.rawData ? purchasesData.rawData.length : 1)))}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุนุฏุฏ ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${purchasesData.rawData ? purchasesData.rawData.length : 0}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ญ ุงูููุฑุฏูู ุงููุดุทูู</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${purchasesData.suppliers ? purchasesData.suppliers.length : 0}</div>
                            </div>
                        </div>

                        <!-- ุฌุฏูู ุงูุจูุงูุงุช ุญุณุจ ููุน ุงูุนุฑุถ -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                                ${purchasesData.viewType === 'detailed' ? '๐ ุชูุงุตูู ุงูููุงุชูุฑ' :
                                  purchasesData.viewType === 'comparison' ? '๐ ููุงุฑูุฉ ุงูุณููุงุช' :
                                  '๐ ููุฎุต ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ'}
                            </h3>

                            ${purchasesData.chartData && purchasesData.chartData.length > 0 ? `
                                ${(() => {
                                    if (purchasesData.viewType === 'detailed') {
                                        // ุนุฑุถ ุชูุงุตูู ุงูููุงุชูุฑ
                                        return `
                                            <div style="overflow-x: auto;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                                    <thead>
                                                        <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุชุงุฑูุฎ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูููุฑุฏ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุจูุบ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุญุงูุฉ</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${Array.from({length: purchasesData.rawData.length}, (_, i) => {
                                                            const invoiceNumber = 'PUR' + (1000 + i + 1);
                                                            const supplier = purchasesData.suppliers[i % purchasesData.suppliers.length];
                                                            const amount = Math.floor(Math.random() * 2000) + 500;
                                                            const date = new Date(2025, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
                                                            const isEven = i % 2 === 0;

                                                            return `
                                                                <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'">
                                                                    <td style="padding: 12px; text-align: center; font-weight: 600; color: #333;">${invoiceNumber}</td>
                                                                    <td style="padding: 12px; text-align: center; color: #495057;">${date.toLocaleDateString('ar-EG')}</td>
                                                                    <td style="padding: 12px; text-align: center; color: #495057;">${supplier.name}</td>
                                                                    <td style="padding: 12px; text-align: center; font-weight: 600; color: #28a745;">${formatCurrency(amount)}</td>
                                                                    <td style="padding: 12px; text-align: center;">
                                                                        <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em;">ูุฏููุนุฉ</span>
                                                                    </td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        `;
                                    } else if (purchasesData.viewType === 'comparison') {
                                        // ุนุฑุถ ููุงุฑูุฉ ุงูุณููุงุช
                                        return `
                                            <div style="overflow-x: auto;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                                    <thead>
                                                        <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุดูุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">${purchasesData.selectedYear}</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">${purchasesData.comparisonData.year}</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุชุบููุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุณุจุฉ %</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${purchasesData.chartData.map((month, index) => {
                                                            const compMonth = purchasesData.comparisonData.months[index];
                                                            const change = month.value - compMonth.value;
                                                            const changePercent = compMonth.value > 0 ? ((change / compMonth.value) * 100) : 0;
                                                            const isEven = index % 2 === 0;
                                                            const changeColor = change >= 0 ? '#28a745' : '#dc3545';
                                                            const changeIcon = change >= 0 ? '๐' : '๐';

                                                            return `
                                                                <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'">
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${month.label.split(' ')[0]}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #28a745;">${formatCurrency(month.value)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; color: #495057;">${formatCurrency(compMonth.value)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${changeColor};">
                                                                        ${changeIcon} ${formatCurrency(Math.abs(change))}
                                                                    </td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: ${changeColor};">
                                                                        ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(1)}%
                                                                    </td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        `;
                                    } else {
                                        // ุนุฑุถ ุงูููุฎุต ุงูุดูุฑู (ุงูุงูุชุฑุงุถู)
                                        return `
                                            <div style="overflow-x: auto;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                                    <thead>
                                                        <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุดูุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ูููุฉ ุงููุดุชุฑูุงุช</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                                            <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุณุจุฉ %</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${purchasesData.chartData.map((month, index) => {
                                                            const percentage = purchasesData.total > 0 ? (month.value / purchasesData.total * 100) : (100 / purchasesData.chartData.length);
                                                            const avgInvoice = month.invoices > 0 ? month.value / month.invoices : 0;
                                                            const isEven = index % 2 === 0;

                                                            // ุชุญุฏูุฏ ููู ุงูุฎูููุฉ ุญุณุจ ุงูุฃุฏุงุก
                                                            let performanceColor = '#495057';
                                                            if (percentage > 10) performanceColor = '#28a745';
                                                            else if (percentage > 7) performanceColor = '#ffc107';
                                                            else performanceColor = '#dc3545';

                                                            return `
                                                                <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333; border-right: 3px solid ${performanceColor};">${month.label}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(month.value)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; color: #495057; font-weight: 600;">${month.invoices || 0}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${formatCurrency(avgInvoice)}</td>
                                                                    <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: ${performanceColor}; font-size: 1.05em;">
                                                                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                                                            <span>${percentage.toFixed(1)}%</span>
                                                                            <div style="width: 40px; height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden;">
                                                                                <div style="width: ${Math.min(percentage * 4, 100)}%; height: 100%; background: ${performanceColor}; border-radius: 3px; transition: width 0.3s ease;"></div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        `;
                                    }
                                })()}
                                        <tfoot>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-top: 2px solid #667eea;">
                                                <td style="padding: 15px 12px; font-weight: bold; color: #333; text-align: center;">ุงูุฅุฌูุงูู</td>
                                                <td style="padding: 15px 12px; text-align: center; font-weight: bold; color: #28a745; font-size: 1.1em;">${formatCurrency(purchasesData.total)}</td>
                                                <td style="padding: 15px 12px; text-align: center; font-weight: bold; color: #333;">${purchasesData.rawData.length}</td>
                                                <td style="padding: 15px 12px; text-align: center; font-weight: bold; color: #667eea;">${formatCurrency(purchasesData.average)}</td>
                                                <td style="padding: 15px 12px; text-align: center; font-weight: bold; color: #667eea; font-size: 1.1em;">100%</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            ` : `
                                <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                                    <i class="fas fa-chart-line" style="font-size: 3em; color: #ccc; margin-bottom: 15px;"></i>
                                    <h4 style="color: #666; margin-bottom: 10px;">ูุง ุชูุฌุฏ ุจูุงูุงุช ุดูุฑูุฉ</h4>
                                    <p style="color: #999; font-size: 0.9em;">ูู ูุชู ุงูุนุซูุฑ ุนูู ูุดุชุฑูุงุช ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ</p>
                                </div>
                            `}
                        </div>


                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ:', error);
                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <h2 style="margin: 0 0 8px 0;">โ ุฎุทุฃ ูู ุงูุชูุฑูุฑ</h2>
                            <p style="margin: 0; opacity: 0.9;">ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูุดูุฑูุฉ</p>
                        </div>
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px;"></i>
                            <h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                            <p>${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }

        // ูุธููุฉ ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ูููุดุชุฑูุงุช ูุงูููุฑุฏูู
        function createSamplePurchasesData() {
            console.log('๐ง ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ูููุดุชุฑูุงุช ูุงูููุฑุฏูู...');

            if (!window.dataManager) {
                window.dataManager = new DataManager();
            }

            // ุงูุชุญูู ูู ูุฌูุฏ ููุฑุฏูู
            let suppliers = window.dataManager.getSuppliers();
            if (suppliers.length === 0) {
                console.log('๐ ุฅุถุงูุฉ ููุฑุฏูู ุชุฌุฑูุจููู...');

                const sampleSuppliers = [
                    { name: 'ุดุฑูุฉ ุงูุฃูุฑุงู ููุชุฌุงุฑุฉ', phone: '0501234567', email: 'ahram@example.com', address: 'ุงูุฑูุงุถ' },
                    { name: 'ูุคุณุณุฉ ุงูููุฑ ุงูุชุฌุงุฑูุฉ', phone: '0507654321', email: 'noor@example.com', address: 'ุฌุฏุฉ' },
                    { name: 'ุดุฑูุฉ ุงููุฌุฑ ููููุงุฏ ุงูุบุฐุงุฆูุฉ', phone: '0509876543', email: 'fajer@example.com', address: 'ุงูุฏูุงู' },
                    { name: 'ูุคุณุณุฉ ุงูุฎููุฌ ููุชูุฑูุฏุงุช', phone: '0502468135', email: 'gulf@example.com', address: 'ููุฉ' },
                    { name: 'ุดุฑูุฉ ุงูุตุญุฑุงุก ุงูุชุฌุงุฑูุฉ', phone: '0508642097', email: 'sahara@example.com', address: 'ุงููุฏููุฉ' }
                ];

                sampleSuppliers.forEach(supplier => {
                    window.dataManager.addSupplier(supplier);
                });

                suppliers = window.dataManager.getSuppliers();
                console.log('โ ุชู ุฅุถุงูุฉ', suppliers.length, 'ููุฑุฏ ุชุฌุฑูุจู');
            }

            // ุงูุชุญูู ูู ูุฌูุฏ ูุดุชุฑูุงุช
            let purchases = window.dataManager.getPurchases();
            if (purchases.length === 0) {
                console.log('๐ ุฅุถุงูุฉ ูุดุชุฑูุงุช ุชุฌุฑูุจูุฉ...');

                const samplePurchases = [];
                const currentDate = new Date();

                // ุฅูุดุงุก ูุดุชุฑูุงุช ููุดูุฑูู ุงููุงุถููู
                for (let i = 0; i < 30; i++) {
                    const purchaseDate = new Date(currentDate);
                    purchaseDate.setDate(purchaseDate.getDate() - Math.floor(Math.random() * 60));

                    const supplier = suppliers[Math.floor(Math.random() * suppliers.length)];
                    const amount = Math.floor(Math.random() * 5000) + 500; // ุจูู 500 ู 5500

                    const purchase = {
                        id: 'PUR' + (1000 + i),
                        supplierId: supplier.id,
                        supplierName: supplier.name,
                        total: amount,
                        paymentMethod: Math.random() > 0.5 ? 'cash' : 'credit',
                        createdAt: purchaseDate.toISOString(),
                        date: purchaseDate.toISOString().split('T')[0],
                        items: [
                            {
                                name: 'ููุชุฌ ุชุฌุฑูุจู ' + (i + 1),
                                quantity: Math.floor(Math.random() * 10) + 1,
                                price: Math.floor(amount / (Math.floor(Math.random() * 3) + 1))
                            }
                        ]
                    };

                    samplePurchases.push(purchase);
                }

                // ุฅุถุงูุฉ ุงููุดุชุฑูุงุช ุฅูู ุงููุธุงู
                samplePurchases.forEach(purchase => {
                    window.dataManager.addPurchase(purchase);
                });

                console.log('โ ุชู ุฅุถุงูุฉ', samplePurchases.length, 'ูุงุชูุฑุฉ ุดุฑุงุก ุชุฌุฑูุจูุฉ');
            }

            return { suppliers: window.dataManager.getSuppliers(), purchases: window.dataManager.getPurchases() };
        }

        function createPurchasesBySupplierReport(dateRange, filters) {
            console.log('๐ช ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ ูู ุงูุจูุงูุงุช ุงูุญููููุฉ...', { dateRange, filters });

            try {
                // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ุงููุธุงู
                let purchasesData = [];
                let suppliersData = [];

                if (window.dataManager) {
                    purchasesData = window.dataManager.getPurchases();
                    suppliersData = window.dataManager.getSuppliers();
                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู:', purchasesData.length, 'ูุงุชูุฑุฉ ุดุฑุงุกุ', suppliersData.length, 'ููุฑุฏ');
                } else {
                    // ุงูุฑุฌูุน ููุจูุงูุงุช ุงููุญููุฉ
                    purchasesData = JSON.parse(localStorage.getItem('monjizPurchases')) || [];
                    suppliersData = JSON.parse(localStorage.getItem('monjizSuppliers')) || [];

                    // ุฅุฒุงูุฉ ุงูููุฑุฑุงุช
                    purchasesData = purchasesData.filter((purchase, index, self) =>
                        index === self.findIndex(p => p.id === purchase.id)
                    );

                    console.log('๐ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู localStorage:', purchasesData.length, 'ูุงุชูุฑุฉ ุดุฑุงุกุ', suppliersData.length, 'ููุฑุฏ');
                }

                // ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ (ููุณ ุงูุทุฑููุฉ ุงููุณุชุฎุฏูุฉ ูู ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ุงูุนููู)
                console.log('๐ ูุทุงู ุงูุชุงุฑูุฎ ุงููุณุชูู:', dateRange);

                let filteredPurchases = purchasesData;
                let dateInfo = '';

                if (dateRange && dateRange.from && dateRange.to) {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ:', dateRange);
                    const fromDate = new Date(dateRange.from);
                    const toDate = new Date(dateRange.to);
                    toDate.setHours(23, 59, 59, 999); // ููุงูุฉ ุงูููู

                    filteredPurchases = purchasesData.filter(purchase => {
                        if (!purchase.date && !purchase.createdAt) return false;

                        let purchaseDate;
                        if (purchase.createdAt) {
                            purchaseDate = new Date(purchase.createdAt);
                        } else if (purchase.date) {
                            // ูุญุงููุฉ ุชุญููู ุงูุชุงุฑูุฎ ุจุชูุณููุงุช ูุฎุชููุฉ
                            if (purchase.date.includes('/')) {
                                // ุชูุณูู DD/MM/YYYY
                                const parts = purchase.date.split('/');
                                if (parts.length === 3) {
                                    purchaseDate = new Date(parts[2], parts[1] - 1, parts[0]);
                                }
                            } else {
                                purchaseDate = new Date(purchase.date);
                            }
                        }

                        return purchaseDate && purchaseDate >= fromDate && purchaseDate <= toDate;
                    });

                    const fromDateFormatted = `${fromDate.getDate().toString().padStart(2, '0')}/${(fromDate.getMonth() + 1).toString().padStart(2, '0')}/${fromDate.getFullYear()}`;
                    const toDateFormatted = `${toDate.getDate().toString().padStart(2, '0')}/${(toDate.getMonth() + 1).toString().padStart(2, '0')}/${toDate.getFullYear()}`;

                    if (fromDateFormatted === toDateFormatted) {
                        dateInfo = fromDateFormatted;
                    } else {
                        dateInfo = `${fromDateFormatted} - ${toDateFormatted}`;
                    }

                    console.log('๐ ุงููุดุชุฑูุงุช ุจุนุฏ ููุชุฑ ุงูุชุงุฑูุฎ:', filteredPurchases.length, 'ูุงุชูุฑุฉ');
                } else {
                    // ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุชุงุฑูุฎุ ุงุณุชุฎุฏู ุงูููู ุงูุญุงูู
                    const today = new Date();
                    const todayStr = today.toISOString().split('T')[0];
                    const todayDDMMYYYY = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;

                    filteredPurchases = purchasesData.filter(purchase => {
                        if (!purchase.date && !purchase.createdAt) return false;

                        if (purchase.date) {
                            // ุชุญูู ูู ุชูุณููุงุช ูุฎุชููุฉ
                            if (purchase.date === todayDDMMYYYY || purchase.date === todayStr) {
                                return true;
                            }

                            // ูุญุงููุฉ ุชุญููู ููุงุฑู
                            try {
                                const purchaseDate = new Date(purchase.date);
                                const purchaseDateStr = purchaseDate.toISOString().split('T')[0];
                                return purchaseDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        if (purchase.createdAt) {
                            try {
                                const createdDate = new Date(purchase.createdAt);
                                const createdDateStr = createdDate.toISOString().split('T')[0];
                                return createdDateStr === todayStr;
                            } catch (e) {
                                return false;
                            }
                        }

                        return false;
                    });

                    dateInfo = todayDDMMYYYY;
                    console.log('๐ ูุดุชุฑูุงุช ุงูููู (ุงูุชุฑุงุถู):', filteredPurchases.length, 'ูุงุชูุฑุฉ');
                }

                // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููููุชุฑุฉ ุจุฏูุงู ูู ุงูุจูุงูุงุช ุงูุฃุตููุฉ
                purchasesData = filteredPurchases;
                // ุชุทุจูู ููุชุฑ ุงูููุฑุฏ ุงููุญุฏุฏ ุฅุฐุง ูุฌุฏ
                let selectedSupplier = null;
                let reportData = {};

                if (filters.account && filters.account !== '') {
                    // ุงูุจุญุซ ุนู ุงูููุฑุฏ ุงููุญุฏุฏ
                    selectedSupplier = suppliersData.find(s => s.id == filters.account);

                    if (selectedSupplier) {
                        console.log('๐ช ุงูููุฑุฏ ุงููุฎุชุงุฑ:', selectedSupplier.name);

                        // ููุชุฑุฉ ุงููุดุชุฑูุงุช ููููุฑุฏ ุงููุญุฏุฏ
                        const supplierPurchases = purchasesData.filter(purchase => {
                            return purchase.supplierId == selectedSupplier.id ||
                                   purchase.supplierName === selectedSupplier.name ||
                                   purchase.supplier === selectedSupplier.name;
                        });

                        console.log('๐ ููุงุชูุฑ ุงูููุฑุฏ:', supplierPurchases.length);

                        // ุชุญููู ุงูุจูุงูุงุช ุฅูู ุชูุณูู ุงูุชูุฑูุฑ
                        const supplierInvoices = supplierPurchases.map(purchase => {
                            // ุชุญููู ุทุฑููุฉ ุงูุฏูุน ููุนุฑุจูุฉ
                            const paymentMethodMap = {
                                'cash': 'ููุฏุงู',
                                'credit': 'ุขุฌู',
                                'bank-transfer': 'ุชุญููู ุจููู',
                                'check': 'ุดูู'
                            };
                            const paymentMethod = paymentMethodMap[purchase.paymentMethod] || purchase.paymentMethod || 'ููุฏุงู';

                            // ุงุณุชุฎุฑุงุฌ ุงูููุชุฌุงุช
                            let products = 'ุบูุฑ ูุญุฏุฏ';
                            if (purchase.items && purchase.items.length > 0) {
                                products = purchase.items.map(item => item.name || item.productName).join(', ');
                            } else if (purchase.products && purchase.products.length > 0) {
                                products = purchase.products.map(item => item.name || item.productName).join(', ');
                            }

                            // ุชุญุฏูุฏ ุงูุญุงูุฉ
                            const statusMap = {
                                'completed': 'ููุชููุฉ',
                                'paid': 'ููุชููุฉ',
                                'pending': 'ูุนููุฉ',
                                'cancelled': 'ููุบูุฉ'
                            };
                            const status = statusMap[purchase.status] || 'ููุชููุฉ';

                            return {
                                id: purchase.id,
                                date: purchase.date || new Date(purchase.createdAt).toLocaleDateString('ar-EG'),
                                amount: parseFloat(purchase.total) || 0,
                                method: paymentMethod,
                                products: products,
                                status: status
                            };
                        });

                        // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                        const totalAmount = supplierInvoices.reduce((sum, inv) => sum + inv.amount, 0);
                        const totalInvoices = supplierInvoices.length;
                        const averageInvoice = totalInvoices > 0 ? totalAmount / totalInvoices : 0;

                        reportData = {
                            type: 'supplier-detail',
                            supplier: {
                                ...selectedSupplier,
                                status: selectedSupplier.type === 'company' ? 'VIP' : 'ูุดุท'
                            },
                            invoices: supplierInvoices,
                            total: totalAmount,
                            count: totalInvoices,
                            average: averageInvoice,
                            dateInfo: dateInfo
                        };
                    }
                } else {
                    // ุนุฑุถ ููุฎุต ุฌููุน ุงูููุฑุฏูู
                    console.log('๐ ุฅูุดุงุก ููุฎุต ุฌููุน ุงูููุฑุฏูู...');

                    // ุชุฌููุน ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ
                    const supplierSummary = {};

                    purchasesData.forEach(purchase => {
                        let supplierId = purchase.supplierId;
                        let supplierName = purchase.supplierName || purchase.supplier || 'ููุฑุฏ ุบูุฑ ูุญุฏุฏ';

                        // ุงูุจุญุซ ุนู ุงูููุฑุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
                        let supplier = null;
                        if (supplierId) {
                            supplier = suppliersData.find(s => s.id == supplierId);
                        } else {
                            supplier = suppliersData.find(s => s.name === supplierName);
                        }

                        if (supplier) {
                            supplierId = supplier.id;
                            supplierName = supplier.name;
                        }

                        const supplierKey = supplierId || supplierName;

                        if (!supplierSummary[supplierKey]) {
                            supplierSummary[supplierKey] = {
                                id: supplierId,
                                name: supplierName,
                                invoices: 0,
                                total: 0,
                                lastPurchase: purchase.date || new Date(purchase.createdAt).toLocaleDateString('ar-EG'),
                                status: supplier ? (supplier.type === 'company' ? 'VIP' : 'ูุดุท') : 'ูุดุท'
                            };
                        }

                        supplierSummary[supplierKey].invoices++;
                        supplierSummary[supplierKey].total += parseFloat(purchase.total) || 0;

                        // ุชุญุฏูุซ ุขุฎุฑ ุนูููุฉ ุดุฑุงุก
                        const purchaseDate = purchase.date || new Date(purchase.createdAt).toLocaleDateString('ar-EG');
                        if (purchaseDate > supplierSummary[supplierKey].lastPurchase) {
                            supplierSummary[supplierKey].lastPurchase = purchaseDate;
                        }
                    });

                    const suppliersArray = Object.values(supplierSummary);
                    const totalAmount = suppliersArray.reduce((sum, supplier) => sum + supplier.total, 0);
                    const totalInvoices = suppliersArray.reduce((sum, supplier) => sum + supplier.invoices, 0);

                    reportData = {
                        type: 'suppliers-summary',
                        suppliers: suppliersArray,
                        total: totalAmount,
                        count: suppliersArray.length,
                        totalInvoices: totalInvoices,
                        average: suppliersArray.length > 0 ? totalAmount / suppliersArray.length : 0,
                        dateInfo: dateInfo
                    };
                }

                console.log('๐ ุจูุงูุงุช ุงูุชูุฑูุฑ:', reportData);

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <!-- ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑุฉ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ฐ ุฅุฌูุงูู ุงููุดุชุฑูุงุช</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.total)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">${reportData.type === 'supplier-detail' ? '๐ ุนุฏุฏ ุงูููุงุชูุฑ' : '๐ช ุนุฏุฏ ุงูููุฑุฏูู'}</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.count}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ูุชูุณุท ${reportData.type === 'supplier-detail' ? 'ุงููุงุชูุฑุฉ' : 'ุงูููุฑุฏ'}</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(reportData.average)}</div>
                            </div>
                            ${reportData.type === 'suppliers-summary' ? `
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">๐ ุฅุฌูุงูู ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.totalInvoices}</div>
                            </div>
                            ` : ''}
                            ${reportData.type === 'supplier-detail' && reportData.supplier ? `
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 14px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);">
                                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 6px;">โญ ุญุงูุฉ ุงูููุฑุฏ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">${reportData.supplier.status}</div>
                            </div>
                            ` : ''}
                        </div>
                        <!-- ุฌุฏูู ุงูุจูุงูุงุช ุญุณุจ ููุน ุงูุนุฑุถ -->
                        <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.2em; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                                ${reportData.type === 'supplier-detail' ?
                                  `๐ช ููุงุชูุฑ ุงูููุฑุฏ: ${reportData.supplier.name} - ${dateInfo}` :
                                  `๐ช ููุฎุต ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ - ${dateInfo}`}
                            </h3>

                            ${reportData.type === 'supplier-detail' ? `
                                <!-- ุนุฑุถ ุชูุงุตูู ููุงุชูุฑ ุงูููุฑุฏ ุงููุญุฏุฏ -->
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 0.9em;">
                                        <div><strong>๐ ุงููุงุชู:</strong> ${reportData.supplier.phone || 'ุบูุฑ ูุญุฏุฏ'}</div>
                                        <div><strong>๐ง ุงูุจุฑูุฏ:</strong> ${reportData.supplier.email || 'ุบูุฑ ูุญุฏุฏ'}</div>
                                        <div><strong>๐ ุขุฎุฑ ุดุฑุงุก:</strong> ${reportData.supplier.lastPurchase || 'ุบูุฑ ูุญุฏุฏ'}</div>
                                        <div><strong>โญ ุงูุญุงูุฉ:</strong> <span style="color: ${reportData.supplier.status === 'VIP' ? '#dc3545' : '#28a745'}; font-weight: bold;">${reportData.supplier.status}</span></div>
                                    </div>
                                </div>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุชุงุฑูุฎ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงููุจูุบ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุทุฑููุฉ ุงูุฏูุน</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูููุชุฌุงุช</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุญุงูุฉ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${reportData.invoices.map((invoice, index) => {
                                                const isEven = index % 2 === 0;
                                                const statusColor = invoice.status === 'ููุชููุฉ' ? '#28a745' : '#ffc107';
                                                const statusBg = invoice.status === 'ููุชููุฉ' ? '#d4edda' : '#fff3cd';

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${invoice.id}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057;">${invoice.date}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(invoice.amount)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${invoice.method}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #6c757d; font-size: 0.9em;">${invoice.products}</td>
                                                        <td style="padding: 14px 12px; text-align: center;">
                                                            <span style="background: ${statusBg}; color: ${statusColor}; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; border: 1px solid ${statusColor};">
                                                                ${invoice.status}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            ` : `
                                <!-- ุนุฑุถ ููุฎุต ุฌููุน ุงูููุฑุฏูู -->
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                        <thead>
                                            <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงุณู ุงูููุฑุฏ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุฅุฌูุงูู ุงููุดุชุฑูุงุช</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ูุชูุณุท ุงููุงุชูุฑุฉ</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุขุฎุฑ ุดุฑุงุก</th>
                                                <th style="padding: 15px 12px; text-align: center; font-weight: 600; color: #495057; border-bottom: 2px solid #667eea;">ุงูุญุงูุฉ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${reportData.suppliers.map((supplier, index) => {
                                                const isEven = index % 2 === 0;
                                                const avgInvoice = supplier.total / supplier.invoices;
                                                const statusColor = supplier.status === 'VIP' ? '#dc3545' : '#28a745';
                                                const statusBg = supplier.status === 'VIP' ? '#f8d7da' : '#d4edda';

                                                return `
                                                    <tr style="background: ${isEven ? '#ffffff' : '#f8f9fa'}; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#e3f2fd'; this.style.transform='scale(1.01)'" onmouseout="this.style.backgroundColor='${isEven ? '#ffffff' : '#f8f9fa'}'; this.style.transform='scale(1)'">
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 600; color: #333;">${supplier.name}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #495057; font-weight: 600;">${supplier.invoices}</td>
                                                        <td style="padding: 14px 12px; text-align: center; font-weight: 700; color: #28a745; font-size: 1.05em;">${formatCurrency(supplier.total)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #667eea; font-weight: 600;">${formatCurrency(avgInvoice)}</td>
                                                        <td style="padding: 14px 12px; text-align: center; color: #6c757d; font-size: 0.9em;">${supplier.lastPurchase}</td>
                                                        <td style="padding: 14px 12px; text-align: center;">
                                                            <span style="background: ${statusBg}; color: ${statusColor}; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; border: 1px solid ${statusColor};">
                                                                ${supplier.status}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            `}
                        </div>

                        <!-- ููุงุญุธุงุช ูุฅุญุตุงุฆูุงุช ุฅุถุงููุฉ -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; border-left: 4px solid #28a745;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ ุฅุญุตุงุฆูุงุช ุงููุดุชุฑูุงุช</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    ${reportData.type === 'supplier-detail' ? `
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุดุชุฑูุงุช: <strong style="color: #28a745;">${formatCurrency(reportData.total)}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูููุงุชูุฑ: <strong>${reportData.count}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ูุชูุณุท ุงููุงุชูุฑุฉ: <strong style="color: #667eea;">${formatCurrency(reportData.average)}</strong></div>
                                        <div>โข ุญุงูุฉ ุงูููุฑุฏ: <strong style="color: ${reportData.supplier.status === 'VIP' ? '#dc3545' : '#28a745'};">${reportData.supplier.status}</strong></div>
                                    ` : `
                                        <div style="margin-bottom: 8px;">โข ุฅุฌูุงูู ุงููุดุชุฑูุงุช: <strong style="color: #28a745;">${formatCurrency(reportData.total)}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ุนุฏุฏ ุงูููุฑุฏูู: <strong>${reportData.count}</strong></div>
                                        <div style="margin-bottom: 8px;">โข ูุชูุณุท ุงูููุฑุฏ: <strong style="color: #667eea;">${formatCurrency(reportData.average)}</strong></div>
                                        <div>โข ุฅุฌูุงูู ุงูููุงุชูุฑ: <strong>${reportData.totalInvoices}</strong></div>
                                    `}
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107;">
                                <h4 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">๐ก ููุงุญุธุงุช</h4>
                                <div style="color: #495057; line-height: 1.6; font-size: 0.95em;">
                                    <div style="margin-bottom: 8px;">โข ุงููุชุฑุฉ: <strong>${dateInfo}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ููุน ุงูุชูุฑูุฑ: <strong>${reportData.type === 'supplier-detail' ? 'ุชูุงุตูู ููุฑุฏ' : 'ููุฎุต ุงูููุฑุฏูู'}</strong></div>
                                    <div style="margin-bottom: 8px;">โข ุญุงูุฉ ุงูุจูุงูุงุช: <strong style="color: #28a745;">ูุญุฏุซุฉ</strong></div>
                                    <div>โข ุขุฎุฑ ุชุญุฏูุซ: <strong>${new Date().toLocaleString('ar-EG')}</strong></div>
                                </div>
                            </div>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                            <button onclick="printReport()" style="background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(108, 117, 125, 0.3)'">
                                <i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ
                            </button>
                            <button onclick="exportToExcel('purchases-by-supplier')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(40, 167, 69, 0.3)'">
                                <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="exportToPDF('purchases-by-supplier')" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(220, 53, 69, 0.3)'">
                                <i class="fas fa-file-pdf"></i> ุชุตุฏูุฑ PDF
                            </button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ:', error);
                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <div class="report-header" style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e9ecef;">
                            <h2 style="color: #2c3e50; margin: 0; font-size: 1.8em; font-weight: 700;">๐ช ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุฑุฏ</h2>
                        </div>
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px; opacity: 0.3;"></i>
                            <h3 style="margin: 0 0 10px 0;">ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                            <p style="margin: 0; font-size: 0.9em;">${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }





        function createPurchasesByProductReport(dateRange, filters) {
            console.log('๐ฆ ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ...');

            try {
                // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุธุงู ุงููุฑูุฒู
                if (!window.dataManager) {
                    console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุฑูุฒู...');
                    window.dataManager = new DataManager();
                }

                // ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุงููุธุงู ุงููุฑูุฒู
                let purchases = [];
                let products = [];

                // ูุญุงููุฉ ุฌูุจ ุงููุดุชุฑูุงุช ูู ูุตุงุฏุฑ ูุชุนุฏุฏุฉ
                if (window.dataManager && window.dataManager.getPurchases) {
                    purchases = window.dataManager.getPurchases();
                    console.log('๐ ุชู ุฌูุจ ุงููุดุชุฑูุงุช ูู DataManager:', purchases.length);
                }

                // ุฅุฐุง ูู ูุฌุฏ ูุดุชุฑูุงุชุ ูุญุงูู localStorage
                if (purchases.length === 0) {
                    console.log('๐ ุงูุจุญุซ ุนู ุงููุดุชุฑูุงุช ูู localStorage...');

                    // ุงูุจุญุซ ูู ุฌููุน ููุงุชูุญ localStorage ุงูุชู ุชุญุชูู ุนูู "purchase"
                    const storageKeys = Object.keys(localStorage);
                    console.log('๐๏ธ ููุงุชูุญ localStorage ุงููุชุงุญุฉ:', storageKeys);

                    const purchaseKeys = storageKeys.filter(key =>
                        key.toLowerCase().includes('purchase') ||
                        key.toLowerCase().includes('ุดุฑุงุก') ||
                        key === 'monjizPurchases'
                    );

                    console.log('๐ ููุงุชูุญ ุงููุดุชุฑูุงุช ุงูููุฌูุฏุฉ:', purchaseKeys);

                    purchaseKeys.forEach(key => {
                        try {
                            const data = JSON.parse(localStorage.getItem(key) || '[]');
                            if (Array.isArray(data) && data.length > 0) {
                                console.log(`๐ฆ ูุฌุฏุช ${data.length} ูุดุชุฑูุงุช ูู ${key}`);
                                purchases = purchases.concat(data);
                            }
                        } catch (e) {
                            console.log(`โ๏ธ ุฎุทุฃ ูู ูุฑุงุกุฉ ${key}:`, e.message);
                        }
                    });
                }

                // ุฌูุจ ุงูููุชุฌุงุช
                if (window.dataManager && window.dataManager.getProducts) {
                    products = window.dataManager.getProducts();
                } else {
                    products = JSON.parse(localStorage.getItem('monjizProducts') || '[]');
                }

                console.log('โ ุฅุฌูุงูู ุงููุดุชุฑูุงุช ุงููุชุงุญุฉ:', purchases.length, 'ูุงุชูุฑุฉ ุดุฑุงุก');
                console.log('โ ุฅุฌูุงูู ุงูููุชุฌุงุช ุงููุชุงุญุฉ:', products.length, 'ููุชุฌ');

                // ุทุจุงุนุฉ ุชูุงุตูู ุงููุดุชุฑูุงุช ููุชุดุฎูุต
                if (purchases.length > 0) {
                    console.log('๐ ุนููุฉ ูู ุงููุดุชุฑูุงุช:', purchases.slice(0, 2));
                    console.log('๐ ุจููุฉ ุฃูู ูุงุชูุฑุฉ ุดุฑุงุก:', {
                        id: purchases[0].id,
                        total: purchases[0].total,
                        supplier: purchases[0].supplier || purchases[0].supplierName,
                        items: purchases[0].items,
                        hasItems: purchases[0].items ? 'ูุนู' : 'ูุง',
                        itemsCount: purchases[0].items ? purchases[0].items.length : 0,
                        itemsStructure: purchases[0].items ? purchases[0].items[0] : 'ูุง ุชูุฌุฏ ุนูุงุตุฑ'
                    });

                    // ูุญุต ุฌููุน ุงููุดุชุฑูุงุช ููุจุญุซ ุนู ุนูุงุตุฑ
                    let totalItemsFound = 0;
                    purchases.forEach((purchase, index) => {
                        if (purchase.items && Array.isArray(purchase.items)) {
                            totalItemsFound += purchase.items.length;
                            if (index < 3) { // ุฃูู 3 ููุงุชูุฑ ููุท
                                console.log(`๐ฆ ูุงุชูุฑุฉ ${index + 1} - ุนูุงุตุฑ:`, purchase.items);
                            }
                        }
                    });
                    console.log('๐ ุฅุฌูุงูู ุงูุนูุงุตุฑ ูู ุฌููุน ุงูููุงุชูุฑ:', totalItemsFound);
                }

                // ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
                if (purchases.length === 0) {
                    console.log('๐ ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ...');
                    const sampleData = createSamplePurchasesData();
                    purchases = sampleData.purchases;
                    console.log('โ ุชู ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ:', purchases.length, 'ูุงุชูุฑุฉ');
                }

                // ุชุทุจูู ููุชุฑ ุงูููุชุฌ ุงููุญุฏุฏ ุฅุฐุง ูุงู ููุฌูุฏุงู
                let filteredPurchases = purchases;
                let selectedProductName = 'ุฌููุน ุงูููุชุฌุงุช';

                if (filters.account && filters.account !== '') {
                    console.log('๐ ุชุทุจูู ููุชุฑ ุงูููุชุฌ:', filters.account);

                    // ุงูุจุญุซ ุนู ุงูููุชุฌ ุงููุญุฏุฏ
                    const selectedProduct = products.find(p =>
                        String(p.id) === String(filters.account) ||
                        p.name === filters.account
                    );

                    if (selectedProduct) {
                        selectedProductName = selectedProduct.name;
                        console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ:', selectedProduct);

                        // ููุชุฑุฉ ุงููุดุชุฑูุงุช ุงูุชู ุชุญุชูู ุนูู ูุฐุง ุงูููุชุฌ (ูุทุงุจู ูุชูุฑูุฑ ุงููุจูุนุงุช)
                        filteredPurchases = purchases.filter((purchase, purchaseIndex) => {
                            // ุงูุจุญุซ ูู products ุฃู items (ูุซู ุชูุฑูุฑ ุงููุจูุนุงุช)
                            const purchaseItems = purchase.products || purchase.items || [];

                            if (purchaseIndex < 3) {
                                console.log(`๐ ูุญุต ูุงุชูุฑุฉ ${purchaseIndex + 1}:`, {
                                    id: purchase.id,
                                    hasProducts: !!purchase.products,
                                    hasItems: !!purchase.items,
                                    itemsCount: purchaseItems.length,
                                    items: purchaseItems
                                });
                            }

                            if (purchaseItems && Array.isArray(purchaseItems)) {
                                const hasProduct = purchaseItems.some((item, itemIndex) => {
                                    // ุทุจุงุนุฉ ุจููุฉ ุงูุนูุตุฑ ุงูุฃูู ููุชุดุฎูุต
                                    if (purchaseIndex < 3 && itemIndex === 0) {
                                        console.log(`๐ ุจููุฉ ุงูุนูุตุฑ ุงูุฃูู ูู ูุงุชูุฑุฉ ${purchaseIndex + 1}:`, item);
                                    }

                                    // ุงูุจุญุซ ุจููุณ ุทุฑููุฉ ุชูุฑูุฑ ุงููุจูุนุงุช
                                    const itemMatch = item.productId == selectedProduct.id ||
                                                    item.name === selectedProduct.name ||
                                                    item.productName === selectedProduct.name ||
                                                    item.itemName === selectedProduct.name;

                                    if (purchaseIndex < 3 && itemIndex < 2) {
                                        console.log(`๐ ููุงุฑูุฉ ูุงุชูุฑุฉ ${purchaseIndex + 1} ุนูุตุฑ ${itemIndex + 1}:`, {
                                            itemName: item.name || item.productName || item.itemName,
                                            itemProductId: item.productId,
                                            selectedProductName: selectedProduct.name,
                                            selectedProductId: selectedProduct.id,
                                            isMatch: itemMatch
                                        });
                                    }

                                    return itemMatch;
                                });

                                if (hasProduct && purchaseIndex < 3) {
                                    console.log(`โ ูุงุชูุฑุฉ ${purchaseIndex + 1} ุชุญุชูู ุนูู ุงูููุชุฌ`);
                                }

                                return hasProduct;
                            } else {
                                if (purchaseIndex < 3) {
                                    console.log(`โ๏ธ ูุงุชูุฑุฉ ${purchaseIndex + 1} ูุง ุชุญุชูู ุนูู ุนูุงุตุฑ`);
                                }
                                return false;
                            }
                        });
                        console.log('โ ุชู ุชุทุจูู ููุชุฑ ุงูููุชุฌ:', selectedProductName, '- ุนุฏุฏ ุงููุดุชุฑูุงุช:', filteredPurchases.length);

                        if (filteredPurchases.length === 0) {
                            console.log('โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ูุดุชุฑูุงุช ุชุญุชูู ุนูู ุงูููุชุฌ ุงููุญุฏุฏ');
                            console.log('๐ ุชุญูู ูู ุฃู ุงุณู ุงูููุชุฌ ูู ุงูููุงุชูุฑ ูุทุงุจู ุงุณู ุงูููุชุฌ ูู ูุงุฆูุฉ ุงูููุชุฌุงุช');
                            console.log('๐ก ุณูุชู ุนุฑุถ ุฌููุน ุงููุดุชุฑูุงุช ูููุณุงุนุฏุฉ ูู ุงูุชุดุฎูุต');

                            // ุนุฑุถ ุฌููุน ุงููุดุชุฑูุงุช ููุชุดุฎูุต
                            filteredPurchases = purchases;
                            selectedProductName = 'ุฌููุน ุงูููุชุฌุงุช (ููุชุดุฎูุต)';
                        }
                    } else {
                        console.log('โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ ุงููุญุฏุฏ:', filters.account);
                        console.log('๐ ุงูููุชุฌุงุช ุงููุชุงุญุฉ:', products.map(p => ({ id: p.id, name: p.name })));
                    }
                }

                // ุชุญููู ุงููุดุชุฑูุงุช ุญุณุจ ุงููุงุชูุฑุฉ (ุชูุฑูุฑ ููุตู)
                const purchaseDetails = [];
                let totalPurchases = 0;
                let totalQuantity = 0;
                let totalInvoices = 0;

                console.log('๐ ุจุฏุก ุชุญููู ุงููุดุชุฑูุงุช ุงูููุตู ูู', filteredPurchases.length, 'ูุงุชูุฑุฉ');

                filteredPurchases.forEach((purchase, purchaseIndex) => {
                    // ุงุณุชุฎุฏุงู products ุฃู items (ูุซู ุชูุฑูุฑ ุงููุจูุนุงุช)
                    const purchaseItems = purchase.products || purchase.items || [];

                    if (purchaseIndex < 3) {
                        console.log(`๐ฆ ูุนุงูุฌุฉ ูุงุชูุฑุฉ ${purchaseIndex + 1}:`, {
                            id: purchase.id,
                            date: purchase.date || purchase.createdAt,
                            supplier: purchase.supplier || purchase.supplierName,
                            itemsCount: purchaseItems.length
                        });
                    }

                    if (purchaseItems && Array.isArray(purchaseItems)) {
                        purchaseItems.forEach((item, itemIndex) => {
                            // ุชุญุฏูุฏ ุงุณู ุงูููุชุฌ ุจุทุฑู ูุฎุชููุฉ
                            let productName = item.name || item.productName || item.itemName;

                            // ุฅุฐุง ูู ููุฌุฏ ุงุณูุ ุงุจุญุซ ูู ูุงุฆูุฉ ุงูููุชุฌุงุช
                            if (!productName && item.productId) {
                                const foundProduct = products.find(p => p.id == item.productId);
                                if (foundProduct) {
                                    productName = foundProduct.name;
                                }
                            }

                            // ุงุณุชุฎุฏุงู ุงุณู ุงูุชุฑุงุถู ููุท ูุญู ุฃุฎูุฑ
                            productName = productName || `ููุชุฌ ${item.productId || 'ุบูุฑ ูุญุฏุฏ'}`;

                            // ุฅุฐุง ูุงู ููุงู ููุชุฌ ูุญุฏุฏุ ุชุฃูุฏ ูู ุฃู ูุฐุง ุงูุนูุตุฑ ูุทุงุจูู
                            if (selectedProductName !== 'ุฌููุน ุงูููุชุฌุงุช') {
                                const isSelectedProduct = item.productId == filters.account ||
                                                        item.name === selectedProductName ||
                                                        item.productName === selectedProductName ||
                                                        item.itemName === selectedProductName ||
                                                        productName === selectedProductName;

                                if (!isSelectedProduct) {
                                    return; // ุชุฎุทู ูุฐุง ุงูุนูุตุฑ
                                }
                            }

                            const quantity = parseFloat(item.quantity || item.qty || 1);
                            const price = parseFloat(item.price || item.unitPrice || item.purchasePrice || 0);
                            const amount = item.total || (quantity * price);

                            // ุชูุณูู ุงูุชุงุฑูุฎ (ูููุงุฏู)
                            const purchaseDate = purchase.date || purchase.createdAt || new Date().toISOString().split('T')[0];
                            const formattedDate = new Date(purchaseDate).toLocaleDateString('ar-EG', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit'
                            });

                            // ุงุณู ุงูููุฑุฏ
                            const supplierName = purchase.supplier || purchase.supplierName || 'ููุฑุฏ ุบูุฑ ูุญุฏุฏ';

                            // ุฅุถุงูุฉ ุชูุงุตูู ุงููุงุชูุฑุฉ
                            purchaseDetails.push({
                                invoiceId: purchase.id || `ูุงุชูุฑุฉ ${purchaseIndex + 1}`,
                                date: formattedDate,
                                supplier: supplierName,
                                productName: productName,
                                quantity: quantity,
                                price: price,
                                amount: amount,
                                originalDate: purchaseDate
                            });

                            totalPurchases += amount;
                            totalQuantity += quantity;
                        });

                        if (purchaseItems.length > 0) {
                            totalInvoices++;
                        }
                    }
                });

                // ุชุฑุชูุจ ุญุณุจ ุงูุชุงุฑูุฎ (ุงูุฃุญุฏุซ ุฃููุงู)
                purchaseDetails.sort((a, b) => new Date(b.originalDate) - new Date(a.originalDate));

                // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                const averagePrice = totalQuantity > 0 ? totalPurchases / totalQuantity : 0;
                const averageInvoiceAmount = totalInvoices > 0 ? totalPurchases / totalInvoices : 0;

                console.log('โ ุชู ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุงูููุตู ุจูุฌุงุญ:', {
                    totalPurchases: formatCurrency(totalPurchases),
                    invoicesCount: purchaseDetails.length,
                    totalQuantity: totalQuantity,
                    averagePrice: formatCurrency(averagePrice)
                });

                console.log('๐ ููุฎุต ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ:');
                console.log('- ุงููุดุชุฑูุงุช ุงูุฃุตููุฉ:', purchases.length);
                console.log('- ุงููุดุชุฑูุงุช ุงููููุชุฑุฉ:', filteredPurchases.length);
                console.log('- ุนุฏุฏ ุงูููุงุชูุฑ:', purchaseDetails.length);
                console.log('- ุฅุฌูุงูู ุงููุจูุบ:', totalPurchases);
                console.log('- ุฅุฌูุงูู ุงููููุฉ:', totalQuantity);
                console.log('- ูุชูุณุท ุงูุณุนุฑ:', averagePrice);

                if (purchaseDetails.length > 0) {
                    console.log('๐ฆ ุฃูู 3 ููุงุชูุฑ:', purchaseDetails.slice(0, 3).map(p => ({
                        date: p.date,
                        supplier: p.supplier,
                        quantity: p.quantity,
                        price: p.price
                    })));
                } else {
                    console.log('โ๏ธ ูุง ุชูุฌุฏ ููุงุชูุฑ ูู ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ');
                }

                return `
                    <div class="report-container" style="background: white; border-radius: 12px; padding: 20px; margin: 0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        ${selectedProductName !== 'ุฌููุน ุงูููุชุฌุงุช' ? `
                            <!-- ูุนูููุงุช ุงูููุชุฌ ุงููุญุฏุฏ -->
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                                <h4 style="margin: 0 0 5px 0; font-size: 1.1em;">
                                    <i class="fas fa-filter" style="margin-left: 8px;"></i>
                                    ุชูุฑูุฑ ููุตู ููููุชุฌ
                                </h4>
                                <div style="font-size: 1.2em; font-weight: bold;">${selectedProductName}</div>
                            </div>
                        ` : ''}
                        <!-- ููุฎุต ุงูุฅุญุตุงุฆูุงุช ุงููุตุบุฑ -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 25px;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 4px;">ุฅุฌูุงูู ุงููุดุชุฑูุงุช</div>
                                <div style="font-size: 1.1em; font-weight: bold;">${formatCurrency(totalPurchases)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 4px;">ุนุฏุฏ ุงูููุงุชูุฑ</div>
                                <div style="font-size: 1.1em; font-weight: bold;">${purchaseDetails.length}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 4px;">ุฅุฌูุงูู ุงููููุฉ</div>
                                <div style="font-size: 1.1em; font-weight: bold;">${totalQuantity.toLocaleString()}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffc107, #e0a800); color: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 4px;">ูุชูุณุท ุงูุณุนุฑ</div>
                                <div style="font-size: 1.1em; font-weight: bold;">${formatCurrency(averagePrice)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 4px;">ูุชูุณุท ูููุฉ ุงููุงุชูุฑุฉ</div>
                                <div style="font-size: 1.1em; font-weight: bold;">${formatCurrency(averageInvoiceAmount)}</div>
                            </div>
                        </div>

                        <!-- ุฌุฏูู ุชูุงุตูู ุงูููุงุชูุฑ -->
                        <div style="margin-top: 20px;">
                            <h3 style="color: #333; margin-bottom: 15px; font-size: 1.2em; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                ${selectedProductName !== 'ุฌููุน ุงูููุชุฌุงุช' ?
                                    `ุชูุงุตูู ููุงุชูุฑ ุดุฑุงุก: ${selectedProductName}` :
                                    'ุชูุงุตูู ููุงุชูุฑ ุงููุดุชุฑูุงุช'
                                }
                            </h3>
                            ${purchaseDetails.length > 0 ? `
                                <table class="report-table" style="width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9em; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;">
                                    <thead>
                                        <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                            <th style="padding: 12px 8px; text-align: center; font-weight: 600;">ุฑูู ุงููุงุชูุฑุฉ</th>
                                            <th style="padding: 12px 8px; text-align: center; font-weight: 600;">ุชุงุฑูุฎ ุงูุดุฑุงุก</th>
                                            <th style="padding: 12px 8px; text-align: right; font-weight: 600;">ุงุณู ุงูููุฑุฏ</th>
                                            <th style="padding: 12px 8px; text-align: center; font-weight: 600;">ุงููููุฉ</th>
                                            <th style="padding: 12px 8px; text-align: center; font-weight: 600;">ุณุนุฑ ุงูุดุฑุงุก</th>
                                            <th style="padding: 12px 8px; text-align: center; font-weight: 600;">ุฅุฌูุงูู ุงููุจูุบ</th>
                                        </tr>
                                    </thead>
                                        <tbody>
                                            ${purchaseDetails.map((detail, index) => {
                                                return `
                                                    <tr style="border-bottom: 1px solid #e9ecef; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
                                                        <td style="padding: 10px 8px; text-align: center; color: #495057;">${detail.invoiceId}</td>
                                                        <td style="padding: 10px 8px; text-align: center; color: #495057;">${detail.date}</td>
                                                        <td style="padding: 10px 8px; font-weight: 600; color: #333;">${detail.supplier}</td>
                                                        <td style="padding: 10px 8px; text-align: center; color: #495057;">${detail.quantity.toLocaleString()}</td>
                                                        <td style="padding: 10px 8px; text-align: center; color: #495057;">${formatCurrency(detail.price)}</td>
                                                        <td style="padding: 10px 8px; text-align: center; font-weight: 600; color: #2e7d32;">${formatCurrency(detail.amount)}</td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    <tfoot>
                                        <tr style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-top: 2px solid #667eea;">
                                            <td style="padding: 12px 8px; font-weight: bold; color: #333;" colspan="2">ุงูุฅุฌูุงูู</td>
                                            <td style="padding: 12px 8px; text-align: center; font-weight: bold; color: #333;">${purchaseDetails.length} ูุงุชูุฑุฉ</td>
                                            <td style="padding: 12px 8px; text-align: center; font-weight: bold; color: #333;">${totalQuantity.toLocaleString()}</td>
                                            <td style="padding: 12px 8px; text-align: center; font-weight: bold; color: #667eea;">${formatCurrency(averagePrice)}</td>
                                            <td style="padding: 12px 8px; text-align: center; font-weight: bold; color: #2e7d32; font-size: 1.1em;">${formatCurrency(totalPurchases)}</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            ` : `
                                <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px; margin: 20px 0;">
                                    <i class="fas fa-inbox" style="font-size: 3em; color: #ccc; margin-bottom: 15px;"></i>
                                    <h4 style="color: #666; margin-bottom: 10px;">ูุง ุชูุฌุฏ ูุดุชุฑูุงุช ูุนุฑุถูุง</h4>
                                    <p style="color: #999; font-size: 0.9em;">ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ูุดุชุฑูุงุช ููููุชุฌ ุงููุญุฏุฏ ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ</p>
                                </div>
                            `}
                        </div>

                        <!-- ููุฎุต ุฅุถุงูู -->
                        ${purchaseDetails.length > 0 ? `
                            <div style="margin-top: 25px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 10px; padding: 20px;">
                                <h3 style="color: #333; margin-bottom: 15px; font-size: 1.2em; text-align: center;">๐ ููุฎุต ุงููุดุชุฑูุงุช</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; text-align: center;">
                                    <div>
                                        <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ุฅุฌูุงูู ุงููููุฉ ุงููุดุชุฑุงุฉ</div>
                                        <div style="font-size: 1.3em; font-weight: bold; color: #28a745;">${totalQuantity.toLocaleString()} ูุญุฏุฉ</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ูุชูุณุท ุณุนุฑ ุงูุดุฑุงุก</div>
                                        <div style="font-size: 1.3em; font-weight: bold; color: #667eea;">${formatCurrency(averagePrice)}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ูุชูุณุท ูููุฉ ุงููุงุชูุฑุฉ</div>
                                        <div style="font-size: 1.3em; font-weight: bold; color: #ffc107;">${formatCurrency(averageInvoiceAmount)}</div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุชูุฑูุฑ ุงููุดุชุฑูุงุช ุญุณุจ ุงูููุชุฌ:', error);
                return `
                    <div style="text-align: center; padding: 40px; color: #dc3545; background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 20px; color: #dc3545;"></i>
                        <h3 style="color: #dc3545; margin-bottom: 15px;">ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3>
                        <p style="color: #666; margin-bottom: 20px;">${error.message}</p>
                        <button onclick="location.reload()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-redo" style="margin-left: 8px;"></i>
                            ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                        </button>
                    </div>
                `;
            }
        }





        function createLowStockReport(currentDate, filters = {}) {
            console.log('โ๏ธ ุฅูุดุงุก ุชูุฑูุฑ ุงูููุงูุต...', { currentDate, filters });

            // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุธุงู ุงููุฑูุฒู
            if (!window.dataManager) {
                console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุฑูุฒู...');
                window.dataManager = new DataManager();
            }

            // ุงูุญุตูู ุนูู ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู
            let products = window.dataManager.getProducts();
            console.log('๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช ูู ุงููุธุงู ูุจู ุงูููุชุฑุฉ:', products.length);

            // ุชุทุจูู ููุชุฑ ุงูููุชุฌ ุงููุญุฏุฏ
            if (filters.account && filters.account !== '') {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูููุชุฌ:', filters.account, typeof filters.account);

                products = products.filter(product => {
                    const matchById = String(product.id) === String(filters.account);
                    const matchByName = product.name === filters.account;
                    const matchByCode = product.code === filters.account;

                    return matchById || matchByName || matchByCode;
                });
                console.log('๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช ุจุนุฏ ุงูููุชุฑุฉ:', products.length);
            }

            // ููุชุฑุฉ ุงูููุชุฌุงุช ูุฅุธูุงุฑ ุงูููุงูุต ููุท
            const lowStockProducts = products.filter(product => {
                const currentStock = product.quantity || 0;
                const minQuantity = product.minQuantity || 5;
                return currentStock <= minQuantity;
            });

            console.log('โ๏ธ ุนุฏุฏ ุงูููุชุฌุงุช ุงููุงูุตุฉ:', lowStockProducts.length);

            // ุจูุงุก ุตููู ุงูุฌุฏูู
            let tableRows = '';
            if (lowStockProducts.length === 0) {
                const message = filters.account ?
                    'ุงูููุชุฌ ุงููุญุฏุฏ ููุณ ูุงูุตุงู' :
                    'ูุง ุชูุฌุฏ ููุชุฌุงุช ูุงูุตุฉ';

                tableRows = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-check-circle" style="font-size: 48px; margin-bottom: 15px; color: #28a745;"></i>
                            <br>
                            <strong>${message}</strong>
                            <br>
                            <small>ุฌููุน ุงูููุชุฌุงุช ููู ุงูุญุฏ ุงูุฃุฏูู</small>
                        </td>
                    </tr>
                `;
            } else {
                lowStockProducts.forEach(product => {
                    const currentStock = product.quantity || 0;
                    const minQuantity = product.minQuantity || 5;

                    let statusClass = '';
                    let statusText = '';

                    if (currentStock === 0) {
                        statusClass = 'status-critical';
                        statusText = 'ููุฏ';
                    } else if (currentStock <= minQuantity) {
                        statusClass = 'status-warning';
                        statusText = 'ููุฎูุถ';
                    }

                    tableRows += `
                        <tr>
                            <td><strong>${product.name}</strong></td>
                            <td>${currentStock}</td>
                            <td>${minQuantity}</td>
                            <td><span class="${statusClass}">${statusText}</span></td>
                        </tr>
                    `;
                });
            }

            return `
                <div class="report-container">
                    <div class="report-header">
                        <p>ููุง ูู ${currentDate}</p>
                        ${filters.account ? `<p><strong>ุงูููุชุฌ:</strong> ${products.find(p => String(p.id) === String(filters.account) || p.name === filters.account)?.name || filters.account}</p>` : ''}
                    </div>
                    <div class="report-content">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>ุงูููุชุฌ</th>
                                    <th>ุงููุฎุฒูู ุงูุญุงูู</th>
                                    <th>ุงูุญุฏ ุงูุฃุฏูู</th>
                                    <th>ุงูุญุงูุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function createStockValuationReport(currentDate, filters = {}) {
            console.log('๐ฐ ุฅูุดุงุก ุชูุฑูุฑ ุชูููู ุงููุฎุฒูู...', { currentDate, filters });

            // ุฅุตูุงุญ ุงูุชุงุฑูุฎ ุฅุฐุง ูุงู null
            if (!currentDate || currentDate === 'null') {
                currentDate = new Date().toLocaleDateString('ar-EG');
            }

            // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุธุงู ุงููุฑูุฒู
            if (!window.dataManager) {
                console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุฑูุฒู...');
                window.dataManager = new DataManager();
            }

            // ุงูุญุตูู ุนูู ุงูููุชุฌุงุช ูู ุงููุธุงู ุงููุฑูุฒู
            let products = window.dataManager.getProducts();
            console.log('๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช ูู ุงููุธุงู ูุจู ุงูููุชุฑุฉ:', products.length);

            // ุชุทุจูู ููุชุฑ ุงูููุชุฌ ุงููุญุฏุฏ
            if (filters.account && filters.account !== '') {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูููุชุฌ:', filters.account, typeof filters.account);
                console.log('๐ ุนููุฉ ูู ุงูููุชุฌุงุช ูุจู ุงูููุชุฑุฉ:', products.slice(0, 2).map(p => ({
                    id: p.id,
                    name: p.name,
                    code: p.code,
                    idType: typeof p.id
                })));

                products = products.filter(product => {
                    const matchById = String(product.id) === String(filters.account);
                    const matchByName = product.name === filters.account;
                    const matchByCode = product.code === filters.account;

                    console.log(`๐ ูุญุต ุงูููุชุฌ ${product.name}:`, {
                        productId: product.id,
                        filterId: filters.account,
                        matchById,
                        matchByName,
                        matchByCode
                    });

                    return matchById || matchByName || matchByCode;
                });
                console.log('๐ฆ ุนุฏุฏ ุงูููุชุฌุงุช ุจุนุฏ ุงูููุชุฑุฉ:', products.length);

                if (products.length > 0) {
                    console.log('โ ุงูููุชุฌุงุช ุงููุทุงุจูุฉ:', products.map(p => p.name));
                }
            }

            // ุงูุชุญูู ูู ูุฌูุฏ ููุชุฌุงุช
            if (products.length === 0) {
                return `
                    <div class="report-container">
                        <div class="report-header">
                        </div>
                        <div class="report-content">
                            <p style="text-align: center; padding: 40px; color: #666;">
                                ${filters.account ? 'ูุง ุชูุฌุฏ ููุชุฌุงุช ุชุทุงุจู ุงูููุชุฑ ุงููุญุฏุฏ' : 'ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงููุฎุฒูู'}
                            </p>
                        </div>
                    </div>
                `;
            }

            // ุญุณุงุจ ุงูุชููููุงุช ุงููุฎุชููุฉ
            let totalCostValue = 0;        // ุงููููุฉ ุจุณุนุฑ ุงูุชูููุฉ
            let totalMarketValue = 0;      // ุงููููุฉ ุจุณุนุฑ ุงูุณูู (ุงูุจูุน)
            let totalPotentialProfit = 0;  // ุงูุฑุจุญ ุงููุญุชูู
            let fastMovingValue = 0;       // ูููุฉ ุงูุฃุตูุงู ุณุฑูุนุฉ ุงูุญุฑูุฉ
            let slowMovingValue = 0;       // ูููุฉ ุงูุฃุตูุงู ุจุทูุฆุฉ ุงูุญุฑูุฉ
            let deadStockValue = 0;        // ูููุฉ ุงูุฃุตูุงู ุงูุฑุงูุฏุฉ

            // ุชุตููู ุงูููุชุฌุงุช ุญุณุจ ุงูุญุฑูุฉ (ุงูุชุฑุงุถู ุจูุงุกู ุนูู ุงููููุฉ ูุงูุญุฏ ุงูุฃุฏูู)
            const fastMovingItems = [];
            const slowMovingItems = [];
            const deadStockItems = [];

            // ุจูุงุก ุตููู ุงูุฌุฏูู ูุญุณุงุจ ุงูุชููููุงุช
            let tableRows = '';

            products.forEach(item => {
                const productName = item.name || 'ุบูุฑ ูุญุฏุฏ';
                const currentStock = item.quantity || 0;
                const purchasePrice = item.purchasePrice || 0;
                const salePrice = item.salePrice || 0;
                const minStock = item.minQuantity || 5;

                const costValue = currentStock * purchasePrice;
                const marketValue = currentStock * salePrice;
                const potentialProfit = marketValue - costValue;
                const profitMargin = marketValue > 0 ? ((potentialProfit / marketValue) * 100) : 0;

                // ุชุตููู ุญุณุจ ุงูุญุฑูุฉ
                let movementCategory = '';
                let movementClass = '';

                if (currentStock === 0) {
                    movementCategory = 'ุฑุงูุฏ';
                    movementClass = 'status-critical';
                    deadStockValue += costValue;
                    deadStockItems.push(item);
                } else if (currentStock > minStock * 2) {
                    movementCategory = 'ุจุทูุก';
                    movementClass = 'status-warning';
                    slowMovingValue += costValue;
                    slowMovingItems.push(item);
                } else {
                    movementCategory = 'ุณุฑูุน';
                    movementClass = 'status-good';
                    fastMovingValue += costValue;
                    fastMovingItems.push(item);
                }

                // ุฅุถุงูุฉ ูููุฌุงููุน
                totalCostValue += costValue;
                totalMarketValue += marketValue;
                totalPotentialProfit += potentialProfit;

                tableRows += `
                    <tr>
                        <td><strong>${productName}</strong></td>
                        <td>${currentStock}</td>
                        <td>${formatNumber(purchasePrice)}</td>
                        <td>${formatNumber(salePrice)}</td>
                        <td>${formatNumber(costValue)}</td>
                        <td>${formatNumber(marketValue)}</td>
                        <td>${formatNumber(potentialProfit)}</td>
                        <td>${formatNumber(profitMargin)}%</td>
                        <td><span class="${movementClass}">${movementCategory}</span></td>
                    </tr>
                `;
            });

            // ุฅุถุงูุฉ ุตู ุงูุฅุฌูุงูู
            const totalProfitMargin = totalMarketValue > 0 ? ((totalPotentialProfit / totalMarketValue) * 100) : 0;
            tableRows += `
                <tr class="total" style="background-color: #f8f9fa; font-weight: bold;">
                    <td><strong>ุงูุฅุฌูุงูู</strong></td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td><strong>${formatNumber(totalCostValue)}</strong></td>
                    <td><strong>${formatNumber(totalMarketValue)}</strong></td>
                    <td><strong>${formatNumber(totalPotentialProfit)}</strong></td>
                    <td><strong>${formatNumber(totalProfitMargin)}%</strong></td>
                    <td>-</td>
                </tr>
            `;

            return `
                <div class="report-container">
                    <div class="report-header">
                    </div>
                    <div class="report-content">
                        <!-- ุฌุฏูู ุงูุชูุงุตูู -->
                        <div>
                            <h3>ุชูุงุตูู ุชูููู ุงููุฎุฒูู</h3>
                            <table class="report-table">
                                <thead>
                                    <tr>
                                        <th>ุงุณู ุงูุตูู</th>
                                        <th>ุงููููุฉ</th>
                                        <th>ุณุนุฑ ุงูุชูููุฉ</th>
                                        <th>ุณุนุฑ ุงูุจูุน</th>
                                        <th>ูููุฉ ุงูุชูููุฉ</th>
                                        <th>ูููุฉ ุงูุณูู</th>
                                        <th>ุงูุฑุจุญ ุงููุญุชูู</th>
                                        <th>ูุงูุด ุงูุฑุจุญ</th>
                                        <th>ุญุฑูุฉ ุงููุฎุฒูู</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>

                        <!-- ุชูุตูุงุช -->
                        <div style="margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
                            <h3>ุงูุชูุตูุงุช</h3>
                            <ul style="margin: 10px 0; padding-right: 20px;">
                                ${deadStockItems.length > 0 ? `<li style="color: #dc3545;">ููุฌุฏ ${deadStockItems.length} ุตูู ุฑุงูุฏ ุจูููุฉ ${formatNumber(deadStockValue)} ุฑ.ุณ - ูููุตุญ ุจูุฑุงุฌุนุฉ ูุฐู ุงูุฃุตูุงู</li>` : ''}
                                ${slowMovingItems.length > 0 ? `<li style="color: #ffc107;">ููุฌุฏ ${slowMovingItems.length} ุตูู ุจุทูุก ุงูุญุฑูุฉ ุจูููุฉ ${formatNumber(slowMovingValue)} ุฑ.ุณ - ูุฏ ุชุญุชุงุฌ ูุฎุทุฉ ุชุณููููุฉ</li>` : ''}
                                ${totalProfitMargin < 20 ? `<li style="color: #ffc107;">ูุงูุด ุงูุฑุจุญ ุงูุฅุฌูุงูู ${formatNumber(totalProfitMargin)}% ููุฎูุถ - ูููุตุญ ุจูุฑุงุฌุนุฉ ุงูุฃุณุนุงุฑ</li>` : ''}
                                ${totalProfitMargin >= 20 ? `<li style="color: #28a745;">ูุงูุด ุงูุฑุจุญ ุงูุฅุฌูุงูู ${formatNumber(totalProfitMargin)}% ุฌูุฏ</li>` : ''}
                                <li style="color: #17a2b8;">ุฅุฌูุงูู ูููุฉ ุงููุฎุฒูู: ${formatNumber(totalMarketValue)} ุฑ.ุณ</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }







        function createSupplierListReport(dateRange, filters) {
            console.log('๐ญ ุฅูุดุงุก ูุงุฆูุฉ ุงูููุฑุฏูู...');

            try {
                const suppliersData = generateSuppliersReport();

                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ูุงุฆูุฉ ุงูููุฑุฏูู</h2>
                            <p>ููุง ูู ${dateRange}</p>
                        </div>
                        <div class="report-content">
                            <div class="summary-cards">
                                <div class="summary-card">
                                    <h3>ุฅุฌูุงูู ุงูููุฑุฏูู</h3>
                                    <p class="amount">${suppliersData.totalSuppliers}</p>
                                </div>
                                <div class="summary-card">
                                    <h3>ุงูููุฑุฏูู ุงููุดุทูู</h3>
                                    <p class="amount">${suppliersData.activeSuppliers}</p>
                                </div>
                                <div class="summary-card">
                                    <h3>ุฅุฌูุงูู ุงููุดุชุฑูุงุช</h3>
                                    <p class="amount">${formatCurrency(suppliersData.totalPurchaseValue)}</p>
                                </div>
                                <div class="summary-card">
                                    <h3>ูุชูุณุท ุงููุดุชุฑูุงุช</h3>
                                    <p class="amount">${formatCurrency(suppliersData.totalSuppliers > 0 ? suppliersData.totalPurchaseValue / suppliersData.totalSuppliers : 0)}</p>
                                </div>
                            </div>

                            <div style="margin-top: 30px;">
                                <h3>ุชูุงุตูู ุงูููุฑุฏูู</h3>
                                <table class="report-table">
                                    <thead>
                                        <tr>
                                            <th>ุงุณู ุงูููุฑุฏ</th>
                                            <th>ุงููุงุชู</th>
                                            <th>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
                                            <th>ุฅุฌูุงูู ุงููุดุชุฑูุงุช</th>
                                            <th>ุนุฏุฏ ุงูููุงุชูุฑ</th>
                                            <th>ุขุฎุฑ ุดุฑุงุก</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${suppliersData.suppliers.map(supplier => `
                                            <tr>
                                                <td>${supplier.name}</td>
                                                <td>${supplier.phone || 'ุบูุฑ ูุญุฏุฏ'}</td>
                                                <td>${supplier.email || 'ุบูุฑ ูุญุฏุฏ'}</td>
                                                <td>${formatCurrency(supplier.totalPurchases)}</td>
                                                <td>${supplier.purchaseCount}</td>
                                                <td>${supplier.lastPurchaseDate ?
                                                    new Date(supplier.lastPurchaseDate).toLocaleDateString('ar-SA') :
                                                    'ูุง ููุฌุฏ'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ูุงุฆูุฉ ุงูููุฑุฏูู:', error);
                return `<div class="report-container"><div class="report-header"><h2>ูุงุฆูุฉ ุงูููุฑุฏูู</h2></div><div class="report-content"><div class="error" style="text-align: center; padding: 40px; color: #dc3545;"><h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3><p>${error.message}</p></div></div></div>`;
            }
        }

        function createSupplierBalancesReport(dateRange, filters) {
            console.log('๐ฐ ุฅูุดุงุก ุฃุฑุตุฏุฉ ุงูููุฑุฏูู...');

            try {
                const suppliersData = generateSuppliersReport();

                // ุญุณุงุจ ุงูุฃุฑุตุฏุฉ (ุงููุดุชุฑูุงุช ุงูุขุฌูุฉ)
                const supplierBalances = suppliersData.suppliers.map(supplier => {
                    const supplierPurchases = purchases.filter(p => p.supplierId === supplier.id);
                    const creditPurchases = supplierPurchases
                        .filter(p => (p.paymentMethod || p.payment) === 'ุขุฌู' || (p.paymentMethod || p.payment) === 'credit')
                        .reduce((sum, p) => sum + parseFloat(p.total || 0), 0);
                    
                    return {
                        ...supplier,
                        balance: creditPurchases,
                        status: creditPurchases > 0 ? (creditPurchases > 10000 ? 'ูุฑุชูุน' : 'ุนุงุฏู') : 'ูุณุฏุฏ'
                    };
                }).filter(supplier => supplier.balance > 0);

                const totalBalance = supplierBalances.reduce((sum, supplier) => sum + supplier.balance, 0);

                return `
                    <div class="report-container">
                        <div class="report-header">
                            <h2>ุฃุฑุตุฏุฉ ุงูููุฑุฏูู</h2>
                            <p>ููุง ูู ${dateRange}</p>
                        </div>
                        <div class="report-content">
                            <div class="summary-cards">
                                <div class="summary-card">
                                    <h3>ุฅุฌูุงูู ุงููุฏููููุฉ</h3>
                                    <p class="amount">${formatCurrency(totalBalance)}</p>
                                </div>
                                <div class="summary-card">
                                    <h3>ุนุฏุฏ ุงูููุฑุฏูู ุงููุฏูููู</h3>
                                    <p class="amount">${supplierBalances.length}</p>
                                </div>
                                <div class="summary-card">
                                    <h3>ูุชูุณุท ุงูุฑุตูุฏ</h3>
                                    <p class="amount">${formatCurrency(supplierBalances.length > 0 ? totalBalance / supplierBalances.length : 0)}</p>
                                </div>
                                <div class="summary-card">
                                    <h3>ุฃุนูู ุฑุตูุฏ</h3>
                                    <p class="amount">${formatCurrency(supplierBalances.length > 0 ? Math.max(...supplierBalances.map(s => s.balance)) : 0)}</p>
                                </div>
                            </div>

                            <div style="margin-top: 30px;">
                                <h3>ุชูุงุตูู ุฃุฑุตุฏุฉ ุงูููุฑุฏูู</h3>
                                ${supplierBalances.length > 0 ? `
                                    <table class="report-table">
                                        <thead>
                                            <tr>
                                                <th>ุงุณู ุงูููุฑุฏ</th>
                                                <th>ุงููุงุชู</th>
                                                <th>ุงูุฑุตูุฏ ุงููุณุชุญู (ุฑ.ุณ)</th>
                                                <th>ุงูุญุงูุฉ</th>
                                                <th>ุขุฎุฑ ุดุฑุงุก</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${supplierBalances.map(supplier => `
                                                <tr>
                                                    <td>${supplier.name}</td>
                                                    <td>${supplier.phone || 'ุบูุฑ ูุญุฏุฏ'}</td>
                                                    <td>${formatCurrency(supplier.balance)}</td>
                                                    <td>
                                                        <span class="status-${supplier.status === 'ูุฑุชูุน' ? 'out' : supplier.status === 'ุนุงุฏู' ? 'low' : 'available'}">
                                                            ${supplier.status}
                                                        </span>
                                                    </td>
                                                    <td>${supplier.lastPurchaseDate ?
                                                        new Date(supplier.lastPurchaseDate).toLocaleDateString('ar-SA') :
                                                        'ูุง ููุฌุฏ'}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                ` : '<p style="text-align: center; color: #666; padding: 20px;">ุฌููุน ุงูููุฑุฏูู ูุณุฏุฏูู</p>'}
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุฃุฑุตุฏุฉ ุงูููุฑุฏูู:', error);
                return `<div class="report-container"><div class="report-header"><h2>ุฃุฑุตุฏุฉ ุงูููุฑุฏูู</h2></div><div class="report-content"><div class="error" style="text-align: center; padding: 40px; color: #dc3545;"><h3>ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ</h3><p>${error.message}</p></div></div></div>`;
            }
        }

        function createSupplierAnalysisReport(dateRange, filters) {
            return createSupplierListReport(dateRange, filters);
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุฅุบูุงู ุงูููู ุงููุฏูุฌ
        function createEndOfDayReportRedirect(dateRange, filters = {}) {
            console.log('๐ ุฅูุดุงุก ุชูุฑูุฑ ุฅุบูุงู ุงูููู ุงููุฏูุฌ...', { dateRange, filters });

            // ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ ุนูู ุงูุจูุงูุงุช
            let endOfDayData = null;
            let dateInfo = '';

            if (dateRange && dateRange.from && dateRange.to) {
                console.log('๐ ุชุทุจูู ููุชุฑ ุงูุชุงุฑูุฎ ุนูู ุชูุฑูุฑ ุฅุบูุงู ุงูููู:', dateRange);
                const fromDate = new Date(dateRange.from);
                const toDate = new Date(dateRange.to);

                // ุชูุณูู ุงูุชุงุฑูุฎ ููุนุฑุถ
                const fromDateFormatted = `${fromDate.getDate().toString().padStart(2, '0')}/${(fromDate.getMonth() + 1).toString().padStart(2, '0')}/${fromDate.getFullYear()}`;
                const toDateFormatted = `${toDate.getDate().toString().padStart(2, '0')}/${(toDate.getMonth() + 1).toString().padStart(2, '0')}/${toDate.getFullYear()}`;

                if (fromDateFormatted === toDateFormatted) {
                    dateInfo = fromDateFormatted;
                } else {
                    dateInfo = `${fromDateFormatted} - ${toDateFormatted}`;
                }

                // ุชุญููู ุงูุชุงุฑูุฎ ุฅูู ุชูุณูู ISO ููุงุณุชุฎุฏุงู ุงูุตุญูุญ ูู generateEndOfDayReport
                const isoDate = fromDate.toISOString().split('T')[0];
                endOfDayData = generateEndOfDayReport(isoDate);
                console.log('๐ ุชู ุฅูุดุงุก ุชูุฑูุฑ ุฅุบูุงู ุงูููู ููุชุงุฑูุฎ:', isoDate);
            } else {
                // ุงุณุชุฎุฏุงู ุงูููู ุงูุญุงูู ูุงูุชุฑุงุถู
                const today = new Date();
                dateInfo = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;
                endOfDayData = generateEndOfDayReport();
                console.log('๐ ุชู ุฅูุดุงุก ุชูุฑูุฑ ุฅุบูุงู ุงูููู ููููู ุงูุญุงูู');
            }

            // ุฅูุดุงุก HTML ููุชูุฑูุฑ
            let paymentMethodsHTML = '';
            Object.keys(endOfDayData.paymentMethods).forEach(key => {
                const method = endOfDayData.paymentMethods[key];
                if (method.total > 0) {
                    const iconClass = {
                        'cash': 'money-bill-wave',
                        'credit': 'clock',
                        'card': 'credit-card',
                        'bank': 'university',
                        'transfer': 'university'
                    }[key] || 'money-bill-wave';

                    const colorClass = {
                        'cash': '#27ae60',
                        'credit': '#e74c3c',
                        'card': '#3498db',
                        'bank': '#9b59b6',
                        'transfer': '#9b59b6'
                    }[key] || '#667eea';

                    paymentMethodsHTML += `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 6px 12px; background: white; border-radius: 4px; border-left: 3px solid ${colorClass}; margin-bottom: 5px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-${iconClass}" style="color: ${colorClass}; font-size: 0.9em;"></i>
                                <span style="font-weight: 500; color: #333; font-size: 0.9em;">${method.name}</span>
                            </div>
                            <div style="text-align: left;">
                                <div style="font-weight: bold; color: #2c3e50; font-size: 0.95em;">${method.total.toFixed(2)} ุฑ.ุณ</div>
                                <div style="font-size: 0.75em; color: #7f8c8d;">${method.count} ูุงุชูุฑุฉ</div>
                            </div>
                        </div>
                    `;
                }
            });

            // ุฅูุดุงุก ุฌุฏูู ุงููุนุงููุงุช ุงููุฏูุฌ (ุขุฎุฑ 10 ููุงุชูุฑ ููุท)
            let transactionsHTML = '';
            if (endOfDayData.todaySales && endOfDayData.todaySales.length > 0) {
                // ุนุฑุถ ุขุฎุฑ 10 ููุงุชูุฑ ููุท
                const maxRows = 10;
                const displaySales = endOfDayData.todaySales.slice(-maxRows);
                const hasMoreSales = endOfDayData.todaySales.length > maxRows;

                transactionsHTML = `
                    <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                    <th style="padding: 10px 8px; text-align: right;">ุงููุงุชูุฑุฉ</th>
                                    <th style="padding: 10px 8px; text-align: right;">ุงูุนููู</th>
                                    <th style="padding: 10px 8px; text-align: right;">ุงูุทุฑููุฉ</th>
                                    <th style="padding: 10px 8px; text-align: right;">ุงููุจูุบ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${displaySales.map((sale, index) => `
                                    <tr style="background: ${index % 2 === 0 ? '#f8f9fa' : 'white'}; border-bottom: 1px solid #e9ecef;">
                                        <td style="padding: 8px; font-weight: 600; color: #667eea;">#${sale.id}</td>
                                        <td style="padding: 8px; color: #2c3e50;">${sale.customerName || 'ุนููู ููุฏู'}</td>
                                        <td style="padding: 8px; color: #64748b;">${getPaymentMethodText(sale.paymentMethod)}</td>
                                        <td style="padding: 8px; font-weight: 600; color: #27ae60;">${formatCurrency(sale.total)}</td>
                                    </tr>
                                `).join('')}
                                ${hasMoreSales ? `
                                    <tr style="background: #e3f2fd; color: #1976d2; text-align: center;">
                                        <td colspan="4" style="padding: 8px; font-size: 0.8em;">
                                            <i class="fas fa-info-circle"></i>
                                            ุนุฑุถ ุขุฎุฑ ${displaySales.length} ูู ุฃุตู ${endOfDayData.todaySales.length} ูุงุชูุฑุฉ
                                        </td>
                                    </tr>
                                ` : ''}
                                <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: bold;">
                                    <td colspan="3" style="padding: 10px 8px;"><strong>ุงูุฅุฌูุงูู ุงูููุงุฆู</strong></td>
                                    <td style="padding: 10px 8px;"><strong>${formatCurrency(endOfDayData.totalRevenue)}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                transactionsHTML = `
                    <div style="text-align: center; padding: 20px; color: #7f8c8d; background: #f8f9fa; border-radius: 6px;">
                        <i class="fas fa-info-circle" style="font-size: 2em; margin-bottom: 10px;"></i>
                        <h4 style="margin: 0;">ูุง ุชูุฌุฏ ูุนุงููุงุช ููุฐุง ุงูููู</h4>
                        <p style="margin: 5px 0 0 0; font-size: 0.9em;">ูู ูุชู ุชุณุฌูู ุฃู ูุจูุนุงุช ุงูููู</p>
                    </div>
                `;
            }

            // ุฅูุดุงุก ูุงุฆูุฉ ุฃูุถู ุงูููุชุฌุงุช ูุจูุนุงู (ุฃูู 3 ููุชุฌุงุช ููุท)
            let topProductsHTML = '';
            if (endOfDayData.topProductsSold && endOfDayData.topProductsSold.length > 0) {
                const topProducts = endOfDayData.topProductsSold.slice(0, 3); // ุฃูู 3 ููุชุฌุงุช ููุท
                topProductsHTML = topProducts.map((product, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border-radius: 6px; margin-bottom: 6px; border-left: 3px solid ${index === 0 ? '#f39c12' : index === 1 ? '#95a5a6' : '#cd6155'};">
                        <div>
                            <div style="font-weight: 600; color: #2c3e50; font-size: 0.9em;">${product.name}</div>
                            <div style="font-size: 0.75em; color: #7f8c8d;">ุงููููุฉ: ${product.quantitySold}</div>
                        </div>
                        <div style="text-align: left; font-weight: bold; color: #27ae60; font-size: 0.9em;">
                            ${formatCurrency(product.revenue)}
                        </div>
                    </div>
                `).join('');
            } else {
                topProductsHTML = '<div style="text-align: center; color: #7f8c8d; padding: 15px; font-size: 0.9em;">ูุง ุชูุฌุฏ ุจูุงูุงุช ููุชุฌุงุช</div>';
            }

            return `
                <div class="report-container" style="background: white; color: #333; padding: 15px; border-radius: 10px; box-shadow: 0 3px 12px rgba(0,0,0,0.1); max-width: 850px; margin: 0 auto;">
                    <!-- ุนููุงู ุงูุชูุฑูุฑ -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="color: #333; font-size: 1.5em; margin-bottom: 10px;">
                            <i class="fas fa-moon"></i> ุชูุฑูุฑ ุฅุบูุงู ${dateRange && dateRange.from ? 'ุงููุชุฑุฉ' : 'ุงูููู'}
                        </h2>
                        <p style="color: #666; font-size: 1em; margin: 0;">${dateInfo}</p>
                    </div>

                    <!-- ูุนูููุงุช ุงูุชูุฑูุฑ -->
                    <div style="background: #f8f9fa; padding: 8px 15px; border-radius: 6px; text-align: center; margin-bottom: 15px; border-left: 3px solid #667eea;">
                        <div style="font-size: 0.85em; color: #666;">
                            <i class="fas fa-calendar-alt"></i> ${new Date().toLocaleDateString('ar-SA-u-ca-islamic')} -
                            <i class="fas fa-clock"></i> ${new Date().toLocaleTimeString('ar-SA')}
                        </div>
                    </div>

                    <!-- ุงูููุฎุต ุงููุฏูุฌ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 12px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 2px;"><i class="fas fa-chart-line"></i> ุฅุฌูุงูู ุงููุจูุนุงุช</div>
                            <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(endOfDayData.totalRevenue)}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #3498db, #5dade2); color: white; padding: 12px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 2px;"><i class="fas fa-receipt"></i> ุนุฏุฏ ุงูููุงุชูุฑ</div>
                            <div style="font-size: 1.2em; font-weight: bold;">${endOfDayData.totalTransactions}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #9b59b6, #bb8fce); color: white; padding: 12px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 2px;"><i class="fas fa-users"></i> ุนุฏุฏ ุงูุนููุงุก</div>
                            <div style="font-size: 1.2em; font-weight: bold;">${endOfDayData.uniqueCustomers}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #e67e22, #f39c12); color: white; padding: 12px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9; margin-bottom: 2px;"><i class="fas fa-chart-bar"></i> ูุชูุณุท ุงููุงุชูุฑุฉ</div>
                            <div style="font-size: 1.2em; font-weight: bold;">${formatCurrency(endOfDayData.averageTransaction)}</div>
                        </div>
                    </div>

                    <!-- ุงููุญุชูู ูู ุตููู -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <!-- ุทุฑู ุงูุฏูุน -->
                        <div>
                            <h3 style="font-size: 0.9em; margin-bottom: 8px; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 3px;">
                                <i class="fas fa-credit-card"></i> ุทุฑู ุงูุฏูุน
                            </h3>
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 6px;">
                                ${paymentMethodsHTML}
                            </div>
                        </div>

                        <!-- ุฃูุถู ุงูููุชุฌุงุช -->
                        <div>
                            <h3 style="font-size: 0.9em; margin-bottom: 8px; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 3px;">
                                <i class="fas fa-star"></i> ุฃูุถู ุงูููุชุฌุงุช
                            </h3>
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 6px;">
                                ${topProductsHTML || '<div style="text-align: center; color: #666; padding: 15px; font-size: 0.85em;">ูุง ุชูุฌุฏ ุจูุงูุงุช</div>'}
                            </div>
                        </div>
                    </div>

                    <!-- ุฌุฏูู ุงููุนุงููุงุช ุงููุฏูุฌ -->
                    <div style="margin-bottom: 12px;">
                        <h3 style="font-size: 0.9em; margin-bottom: 8px; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 3px;">
                            <i class="fas fa-list"></i> ุงููุนุงููุงุช ุงูููููุฉ (ุขุฎุฑ 10 ููุงุชูุฑ)
                        </h3>
                        ${transactionsHTML}
                    </div>

                    <!-- ุฃุฒุฑุงุฑ ุงูุนูููุงุช -->
                    <div style="text-align: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0;">
                        <button onclick="window.print()" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em; margin: 0 6px;">
                            <i class="fas fa-print"></i> ุทุจุงุนุฉ
                        </button>
                        <button onclick="exportToExcel('end-of-day')" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em; margin: 0 6px;">
                            <i class="fas fa-file-excel"></i> Excel
                        </button>
                    </div>
                </div>
            `;
        }

    </script>
    <script src="js/data-manager.js"></script>
    <script src="js/reports.js"></script>
</body>
</html>
