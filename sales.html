<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ - Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/action-buttons-horizontal.css">
    <link rel="stylesheet" href="css/user-experience-improvements.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª */
        .table-container-modern {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-top: 20px;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª */
        .table-footer-modern {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            border-radius: 0 0 12px 12px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .results-info-modern {
            color: #6c757d;
            font-size: 14px;
            font-weight: 500;
        }

        .pagination-modern {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .page-btn {
            background: white;
            border: 1px solid #dee2e6;
            color: #495057;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
            transform: translateY(-1px);
        }

        .page-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .page-btn.disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .page-btn.disabled:hover {
            background: #f8f9fa;
            transform: none;
        }

        .page-btn.prev,
        .page-btn.next {
            padding: 8px 16px;
            font-weight: 600;
        }

        .page-btn i {
            margin: 0 4px;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .table-footer-modern {
                flex-direction: column;
                gap: 15px;
            }

            .pagination-modern {
                justify-content: center;
            }

            .page-btn {
                min-width: 35px;
                height: 35px;
                padding: 6px 10px;
                font-size: 13px;
            }
        }

        /* ØªØ£ÙƒÙŠØ¯ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª - Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ© */
        .action-buttons-horizontal .action-btn.view,
        .action-buttons-horizontal .action-btn.view i {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
            color: white !important;
            border: none !important;
        }

        .action-buttons-horizontal .action-btn.edit,
        .action-buttons-horizontal .action-btn.edit i {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%) !important;
            color: white !important;
            border: none !important;
        }

        .action-buttons-horizontal .action-btn.delete,
        .action-buttons-horizontal .action-btn.delete i {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
            color: white !important;
            border: none !important;
        }

        /* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .action-buttons-horizontal .action-btn i {
            font-size: 14px !important;
            color: inherit !important;
            background: none !important;
        }

        .action-buttons-horizontal .action-btn.view i {
            color: white !important;
        }

        .action-buttons-horizontal .action-btn.edit i {
            color: white !important;
        }

        .action-buttons-horizontal .action-btn.delete i {
            color: white !important;
        }

        .modern-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Cairo', sans-serif;
        }

        .modern-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modern-table th {
            padding: 12px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
        }

        .modern-table th i {
            margin-left: 5px;
        }

        .modern-table td {
            padding: 8px 10px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
            line-height: 1.3;
        }

        .modern-table tbody tr {
            transition: background-color 0.2s;
        }

        .modern-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .modern-table tbody tr:nth-child(even) {
            background-color: #fafbfc;
        }

        .modern-table tbody tr:nth-child(even):hover {
            background-color: #f1f3f4;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
            min-width: 60px;
        }

        .badge.primary {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .badge.success {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .badge.info {
            background-color: #e1f5fe;
            color: #0277bd;
        }

        .badge.warning {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .badge.secondary {
            background-color: #f5f5f5;
            color: #616161;
        }

        .positive {
            color: #2e7d32;
            font-weight: 600;
        }

        .negative {
            color: #d32f2f;
            font-weight: 600;
        }

        .action-btn {
            background: none;
            border: 1px solid #ddd;
            padding: 4px 6px;
            margin: 0 1px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
            font-size: 0.85rem;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .action-buttons-horizontal .action-btn.edit {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%) !important;
            color: white !important;
            border: none !important;
        }

        .action-buttons-horizontal .action-btn.edit:hover {
            background: linear-gradient(135deg, #ff8f00 0%, #f57c00 100%) !important;
            transform: translateY(-1px) scale(1.05) !important;
            box-shadow: 0 3px 8px rgba(255, 193, 7, 0.4) !important;
        }

        .action-buttons-horizontal .action-btn.view {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
            color: white !important;
            border: none !important;
        }

        .action-buttons-horizontal .action-btn.view:hover {
            background: linear-gradient(135deg, #138496 0%, #117a8b 100%) !important;
            transform: translateY(-1px) scale(1.05) !important;
            box-shadow: 0 3px 8px rgba(23, 162, 184, 0.4) !important;
        }

        .action-buttons-horizontal .action-btn.delete {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
            color: white !important;
            border: none !important;
        }

        .action-buttons-horizontal .action-btn.delete:hover {
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%) !important;
            transform: translateY(-1px) scale(1.05) !important;
            box-shadow: 0 3px 8px rgba(220, 53, 69, 0.4) !important;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙÙ‚ÙŠØ© - Ù…Ø­Ø³Ù† ÙˆÙ‚ÙˆÙŠ */
        .action-buttons-horizontal {
            display: flex !important;
            flex-direction: row !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 6px !important;
            flex-wrap: nowrap !important;
            padding: 4px 0 !important;
            width: 100% !important;
        }

        .action-buttons-horizontal .action-btn {
            width: 32px !important;
            height: 32px !important;
            border: none !important;
            border-radius: 6px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.2s ease !important;
            font-size: 13px !important;
            margin: 0 !important;
            flex-shrink: 0 !important;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¶ØºÙˆØ· */
        .modern-table {
            font-size: 0.9rem;
        }

        .badge {
            padding: 3px 6px;
            font-size: 0.75rem;
            min-width: 50px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ØªØµÙÙŠØ© */
        .filter-dropdowns-modern {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select-modern {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            background: white;
            font-family: 'Cairo', sans-serif;
            font-size: 0.9rem;
            min-width: 150px;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .filter-select-modern:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #6c757d;
            color: #6c757d;
        }

        .btn-outline:hover {
            background: #6c757d;
            color: white;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .modern-table {
                font-size: 0.8rem;
            }

            .modern-table th,
            .modern-table td {
                padding: 6px 4px;
            }

            .action-btn {
                padding: 3px 4px;
                margin: 0;
                font-size: 0.75rem;
            }

            .badge {
                padding: 2px 4px;
                font-size: 0.7rem;
                min-width: 40px;
            }
        }

        /* ========== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ ========== */
        .main-header {
            background: linear-gradient(to left, #0078ff, #00c3ff);
            color: white;
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
            height: 70px;
        }

        .main-header .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            height: 100%;
        }

        .main-header .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .main-header .logo i {
            font-size: 28px;
            color: #f39c12;
        }

        .main-header .logo h1 {
            font-size: 24px;
            margin: 0;
            font-weight: 600;
            color: white;
        }

        .main-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 0;
        }

        .main-nav li {
            margin: 0;
        }

        .main-nav a {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            height: 50px;
            box-sizing: border-box;
        }

        .main-nav a:hover {
            background: rgba(255,255,255,0.1);
            border-bottom-color: #f39c12;
            transform: translateY(-1px);
        }

        .main-nav a.active {
            background: rgba(255,255,255,0.15);
            border-bottom-color: #f39c12;
            font-weight: 600;
        }

        .main-nav a i {
            font-size: 16px;
            width: 18px;
            text-align: center;
        }

        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .main-header .container {
                flex-direction: column;
                height: auto;
                padding: 10px 20px;
            }

            .main-header .logo {
                margin-bottom: 10px;
            }

            .main-nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }

            .main-nav a {
                padding: 12px 15px;
                font-size: 13px;
                height: auto;
            }

            .main-header .logo h1 {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .main-nav ul {
                flex-direction: column;
                width: 100%;
            }

            .main-nav a {
                justify-content: center;
                padding: 15px;
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
        }
    </style>
    <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª Excel Ùˆ PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="sales.html" class="active"><i class="fas fa-shopping-cart"></i> Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a></li>
                    <li><a href="purchases.html"><i class="fas fa-truck"></i> Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</a></li>
                    <li><a href="customers.html"><i class="fas fa-users"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a></li>
                    <li><a href="suppliers.html"><i class="fas fa-user-tie"></i> Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</a></li>
                    <li><a href="products.html"><i class="fas fa-boxes"></i> Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a></li>
                    <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
                    <li><a href="accounting.html"><i class="fas fa-calculator"></i> Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</a></li>
                    <li><a href="settings.html"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
    <main class="main-content">
        <div class="container">
            <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
            <div class="products-management-modern">
                <!-- Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³Ù… -->
                <div class="section-header-modern">
                    <div class="header-title">
                        <h3><i class="fas fa-shopping-cart"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                        <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-modern btn-primary add-invoice-btn">
                            <i class="fas fa-plus"></i>
                            ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                        </button>
                    </div>
                </div>

                <!-- ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ù„Ø¹Ø¯Ù… Ø§Ø±ØªØ¨Ø§Ø·Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© -->

                <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© -->
                <div class="search-filters-modern">
                    <div class="search-box-modern">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙØ§ØªÙˆØ±Ø© Ø£Ùˆ Ø¹Ù…ÙŠÙ„..." class="input-modern">
                        <div class="search-suggestions" id="search-suggestions"></div>
                    </div>
                    <div class="filters-modern">
                        <select id="status-filter" class="filter-select-modern" onchange="filterByStatus()">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option>
                            <option value="pending">Ù…Ø¹Ù„Ù‚Ø©</option>
                            <option value="cancelled">Ù…Ù„ØºÙŠØ©</option>
                        </select>
                        <select id="payment-filter" class="filter-select-modern" onchange="filterByPaymentMethod()">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</option>
                            <option value="cash">Ù†Ù‚Ø¯Ø§Ù‹</option>
                            <option value="bank">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                            <option value="credit">Ø¢Ø¬Ù„</option>
                        </select>
                        <button class="btn-modern btn-outline" id="clear-filters" onclick="clearFilters()">
                            <i class="fas fa-times"></i>
                            Ù…Ø³Ø­ Ø§Ù„ØªØµÙÙŠØ©
                        </button>
                    </div>
                </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
            <div class="table-container-modern">
                <table class="modern-table invoices-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                            <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th><i class="fas fa-user"></i> Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th><i class="fas fa-boxes"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                            <th><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            <th><i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                            <th><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>INV-001</strong></td>
                            <td>2024-01-15</td>
                            <td>Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ</td>
                            <td>5</td>
                            <td><strong class="positive">2,450 Ø±.Ø³</strong></td>
                            <td><span class="badge success">Ù†Ù‚Ø¯Ø§Ù‹</span></td>
                            <td><span class="badge primary">Ù…ÙƒØªÙ…Ù„Ø©</span></td>
                            <td>
                                <div class="action-buttons-horizontal">
                                    <button class="action-btn edit" onclick="editInvoice('INV-001')" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn view" onclick="viewInvoice('INV-001')" title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteInvoice('INV-001')" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>INV-002</strong></td>
                            <td>2024-01-14</td>
                            <td>Ø´Ø±ÙƒØ© Ø§Ù„Ù†ÙˆØ± Ù„Ù„ØªØ¬Ø§Ø±Ø©</td>
                            <td>12</td>
                            <td><strong class="positive">3,500 Ø±.Ø³</strong></td>
                            <td><span class="badge info">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</span></td>
                            <td><span class="badge primary">Ù…ÙƒØªÙ…Ù„Ø©</span></td>
                            <td>
                                <div class="action-buttons-horizontal">
                                    <button class="action-btn edit" onclick="editInvoice('INV-002')" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn view" onclick="viewInvoice('INV-002')" title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteInvoice('INV-002')" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>INV-003</strong></td>
                            <td>2024-01-13</td>
                            <td>Ø³Ø§Ø±Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</td>
                            <td>3</td>
                            <td><strong class="positive">750 Ø±.Ø³</strong></td>
                            <td><span class="badge warning">Ø¢Ø¬Ù„</span></td>
                            <td><span class="badge secondary">Ù…Ø¹Ù„Ù‚Ø©</span></td>
                            <td>
                                <div class="action-buttons-horizontal">
                                    <button class="action-btn edit" onclick="editInvoice('INV-003')" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn view" onclick="viewInvoice('INV-003')" title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteInvoice('INV-003')" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>INV-004</strong></td>
                            <td>2024-01-12</td>
                            <td>Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ø­Ù…Ø¯</td>
                            <td>8</td>
                            <td><strong class="positive">1,200 Ø±.Ø³</strong></td>
                            <td><span class="badge success">Ù†Ù‚Ø¯Ø§Ù‹</span></td>
                            <td><span class="badge primary">Ù…ÙƒØªÙ…Ù„Ø©</span></td>
                            <td>
                                <div class="action-buttons-horizontal">
                                    <button class="action-btn edit" onclick="editInvoice('INV-004')" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn view" onclick="viewInvoice('INV-004')" title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteInvoice('INV-004')" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>INV-005</strong></td>
                            <td>2024-01-11</td>
                            <td>Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø®ÙŠØ±</td>
                            <td>15</td>
                            <td><strong class="positive">5,800 Ø±.Ø³</strong></td>
                            <td><span class="badge info">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</span></td>
                            <td><span class="badge primary">Ù…ÙƒØªÙ…Ù„Ø©</span></td>
                            <td>
                                <div class="action-buttons-horizontal">
                                    <button class="action-btn edit" onclick="editInvoice('INV-005')" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn view" onclick="viewInvoice('INV-005')" title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteInvoice('INV-005')" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
                <div class="table-footer-modern">
                    <div class="results-info-modern">
                        Ø¹Ø±Ø¶ <span id="sales-start-result">1</span> - <span id="sales-end-result">10</span> Ù…Ù† <span id="sales-total-results">0</span> ÙØ§ØªÙˆØ±Ø©
                    </div>
                    <div class="pagination-modern" id="sales-pagination-container">
                        <button class="page-btn prev" id="sales-prev-btn" onclick="changeSalesPage('prev')">
                            <i class="fas fa-chevron-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                        </button>
                        <button class="page-btn active" onclick="changeSalesPage(1)">1</button>
                        <button class="page-btn" onclick="changeSalesPage(2)">2</button>
                        <button class="page-btn" onclick="changeSalesPage(3)">3</button>
                        <button class="page-btn next" id="sales-next-btn" onclick="changeSalesPage('next')">
                            Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </main>

    <!-- Ø§Ù„Ù‚Ø¯Ù… -->
    <footer class="main-footer">
        <div class="container">
            <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2023 - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</p>
        </div>
    </footer>

    <script src="js/data-manager.js"></script>
    <script src="js/sales-new.js"></script>
    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        let salesCurrentPage = 1;
        let salesItemsPerPage = 10;
        let salesTotalItems = 0;
        let salesAllData = [];

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©
        function updateSalesDataDisplay() {
            const startIndex = (salesCurrentPage - 1) * salesItemsPerPage;
            const endIndex = startIndex + salesItemsPerPage;
            const pageData = salesAllData.slice(startIndex, endIndex);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            updateSalesTableDisplay(pageData);

            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            updateSalesResultsInfo();

            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            updateSalesPaginationButtons();
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function updateSalesTableDisplay(data) {
            const tbody = document.querySelector('.invoices-table tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                            <i class="fas fa-receipt" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                            Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù„Ù„Ø¹Ø±Ø¶
                        </td>
                    </tr>
                `;
                return;
            }

            data.forEach((invoice, index) => {
                const globalIndex = (salesCurrentPage - 1) * salesItemsPerPage + index + 1;
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const productCount = invoice.products ? invoice.products.length : 1;

                const row = `
                    <tr>
                        <td><strong>${invoice.id}</strong></td>
                        <td>${invoice.date}</td>
                        <td>${invoice.customerName}</td>
                        <td>${productCount}</td>
                        <td><strong class="positive">${parseFloat(invoice.total).toFixed(2)} Ø±.Ø³</strong></td>
                        <td><span class="badge ${getPaymentMethodClass(invoice.paymentMethod)}">${convertPaymentMethodToArabic(invoice.paymentMethod) || 'Ù†Ù‚Ø¯Ø§Ù‹'}</span></td>
                        <td><span class="badge primary">Ù…ÙƒØªÙ…Ù„Ø©</span></td>
                        <td>
                            <div class="action-buttons-horizontal">
                                <button class="action-btn view" onclick="viewInvoice('${invoice.id}')" title="Ø¹Ø±Ø¶">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn edit" onclick="editInvoice('${invoice.id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" onclick="deleteInvoice('${invoice.id}')" title="Ø­Ø°Ù">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function updateSalesResultsInfo() {
            const startResult = salesTotalItems === 0 ? 0 : (salesCurrentPage - 1) * salesItemsPerPage + 1;
            const endResult = Math.min(salesCurrentPage * salesItemsPerPage, salesTotalItems);

            document.getElementById('sales-start-result').textContent = startResult;
            document.getElementById('sales-end-result').textContent = endResult;
            document.getElementById('sales-total-results').textContent = salesTotalItems;
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function updateSalesPaginationButtons() {
            const totalPages = Math.ceil(salesTotalItems / salesItemsPerPage);
            const paginationContainer = document.getElementById('sales-pagination-container');

            if (totalPages <= 1) {
                paginationContainer.style.display = 'none';
                return;
            }

            paginationContainer.style.display = 'flex';

            let paginationHTML = '';

            // Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
            const prevDisabled = salesCurrentPage === 1 ? 'disabled' : '';
            paginationHTML += `
                <button class="page-btn prev ${prevDisabled}" onclick="changeSalesPage('prev')">
                    <i class="fas fa-chevron-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
            `;

            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª
            const startPage = Math.max(1, salesCurrentPage - 2);
            const endPage = Math.min(totalPages, salesCurrentPage + 2);

            if (startPage > 1) {
                paginationHTML += `<button class="page-btn" onclick="changeSalesPage(1)">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="page-dots">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const activeClass = i === salesCurrentPage ? 'active' : '';
                paginationHTML += `<button class="page-btn ${activeClass}" onclick="changeSalesPage(${i})">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="page-dots">...</span>`;
                }
                paginationHTML += `<button class="page-btn" onclick="changeSalesPage(${totalPages})">${totalPages}</button>`;
            }

            // Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
            const nextDisabled = salesCurrentPage === totalPages ? 'disabled' : '';
            paginationHTML += `
                <button class="page-btn next ${nextDisabled}" onclick="changeSalesPage('next')">
                    Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-chevron-left"></i>
                </button>
            `;

            paginationContainer.innerHTML = paginationHTML;
        }

        // Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± ØµÙØ­Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function changeSalesPage(page) {
            const totalPages = Math.ceil(salesTotalItems / salesItemsPerPage);

            if (page === 'prev') {
                if (salesCurrentPage > 1) {
                    salesCurrentPage--;
                }
            } else if (page === 'next') {
                if (salesCurrentPage < totalPages) {
                    salesCurrentPage++;
                }
            } else if (typeof page === 'number') {
                if (page >= 1 && page <= totalPages) {
                    salesCurrentPage = page;
                }
            }

            updateSalesDataDisplay();
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
        function loadSalesData() {
            console.log('ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');

            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            if (!window.dataManager) {
                console.log('ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                try {
                    window.dataManager = new DataManager();
                    console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                } catch (error) {
                    console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', error);
                    // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    const localSales = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                    salesAllData = localSales;
                    salesTotalItems = salesAllData.length;
                    salesCurrentPage = 1;
                    updateSalesDataDisplay();
                    return;
                }
            }

            try {
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                let salesData = window.dataManager.getSales();
                console.log('âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', salesData.length, 'ÙØ§ØªÙˆØ±Ø©');

                // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø¬Ù„Ø¨ Ù…Ù† localStorage ÙˆØ¯Ù…Ø¬Ù‡Ø§
                if (salesData.length === 0) {
                    const localSales = JSON.parse(localStorage.getItem('monjizInvoices')) || [];

                    if (localSales.length > 0) {
                        console.log('ğŸ“¦ Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', localSales.length, 'ÙØ§ØªÙˆØ±Ø©');

                        // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                        localSales.forEach(sale => {
                            try {
                                window.dataManager.addSale(sale);
                            } catch (error) {
                                console.warn('ØªØ­Ø°ÙŠØ±: ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø©:', sale.id, error.message);
                            }
                        });

                        // Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ù…Ø¬
                        salesData = window.dataManager.getSales();
                        console.log('âœ… ØªÙ… Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', salesData.length, 'ÙØ§ØªÙˆØ±Ø©');
                    }
                }

                // ØªØ±ØªÙŠØ¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
                salesData.sort((a, b) => {
                    let timeA, timeB;

                    if (a.createdAt) {
                        timeA = new Date(a.createdAt).getTime();
                    } else if (a.id && a.id.includes('-')) {
                        const parts = a.id.split('-');
                        timeA = parseInt(parts[parts.length - 1]) || 0;
                    } else {
                        timeA = 0;
                    }

                    if (b.createdAt) {
                        timeB = new Date(b.createdAt).getTime();
                    } else if (b.id && b.id.includes('-')) {
                        const parts = b.id.split('-');
                        timeB = parseInt(parts[parts.length - 1]) || 0;
                    } else {
                        timeB = 0;
                    }

                    return timeB - timeA; // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                salesAllData = salesData;
                salesTotalItems = salesAllData.length;
                salesCurrentPage = 1;

                updateSalesDataDisplay();

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', error);

                // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                const localSales = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                console.log('ğŸ“¦ ØªÙ… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©:', localSales.length, 'ÙØ§ØªÙˆØ±Ø©');

                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                localSales.sort((a, b) => {
                    let timeA, timeB;

                    if (a.createdAt) {
                        timeA = new Date(a.createdAt).getTime();
                    } else if (a.id && a.id.includes('-')) {
                        const parts = a.id.split('-');
                        timeA = parseInt(parts[parts.length - 1]) || 0;
                    } else {
                        timeA = 0;
                    }

                    if (b.createdAt) {
                        timeB = new Date(b.createdAt).getTime();
                    } else if (b.id && b.id.includes('-')) {
                        const parts = b.id.split('-');
                        timeB = parseInt(parts[parts.length - 1]) || 0;
                    } else {
                        timeB = 0;
                    }

                    return timeB - timeA;
                });

                salesAllData = localSales;
                salesTotalItems = salesAllData.length;
                salesCurrentPage = 1;

                updateSalesDataDisplay();
            }
        }



        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        function editInvoice(invoiceId) {
            console.log('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', invoiceId);

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const invoiceData = getInvoiceDataFromTable(invoiceId);

            // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
            disableBodyScroll();

            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
            const modal = document.createElement('div');
            modal.className = 'modal edit-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
            `;
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 12px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 85vh;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    animation: slideIn 0.3s ease;
                ">
                    <div style="
                        background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
                        color: white;
                        padding: 20px 25px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    ">
                        <h3 style="margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-edit"></i>
                            ØªØ¹Ø¯ÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                        </h3>
                        <button onclick="closeSalesEditModal()" style="
                            background: none;
                            border: none;
                            color: white;
                            font-size: 24px;
                            cursor: pointer;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: background 0.2s;
                        " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='none'">
                            &times;
                        </button>
                    </div>

                    <div style="padding: 25px; max-height: 60vh; overflow-y: auto;">
                        <form id="editInvoiceForm" class="form-modern">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-hashtag" style="color: #ffc107;"></i>
                                        Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                                    </label>
                                    <input type="text" value="${invoiceId}" readonly style="
                                        width: 100%;
                                        padding: 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 8px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        background: #f8f9fa;
                                        color: #6c757d;
                                    ">
                                </div>

                                <div>
                                    <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-calendar" style="color: #ffc107;"></i>
                                        ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                                    </label>
                                    <input type="date" id="editInvoiceDate" value="${convertDateToInput(invoiceData.date)}" style="
                                        width: 100%;
                                        padding: 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 8px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        transition: border-color 0.3s ease;
                                    " onfocus="this.style.borderColor='#ffc107'" onblur="this.style.borderColor='#e9ecef'">
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-user" style="color: #ffc107;"></i>
                                        Ø§Ù„Ø¹Ù…ÙŠÙ„
                                    </label>
                                    <input type="text" id="editInvoiceCustomer" value="${invoiceData.customer}" style="
                                        width: 100%;
                                        padding: 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 8px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        transition: border-color 0.3s ease;
                                    " onfocus="this.style.borderColor='#ffc107'" onblur="this.style.borderColor='#e9ecef'">
                                </div>

                                <div>
                                    <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-sort-numeric-up" style="color: #ffc107;"></i>
                                        Ø§Ù„ÙƒÙ…ÙŠØ©
                                    </label>
                                    <input type="number" id="editInvoiceQuantity" value="${invoiceData.quantity}" step="1" min="1" style="
                                        width: 100%;
                                        padding: 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 8px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        transition: border-color 0.3s ease;
                                    " onfocus="this.style.borderColor='#ffc107'" onblur="this.style.borderColor='#e9ecef'">
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div>
                                    <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-credit-card" style="color: #ffc107;"></i>
                                        Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                                    </label>
                                    <select id="editInvoicePayment" style="
                                        width: 100%;
                                        padding: 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 8px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        background: white;
                                        cursor: pointer;
                                        transition: border-color 0.3s ease;
                                    " onfocus="this.style.borderColor='#ffc107'" onblur="this.style.borderColor='#e9ecef'">
                                        <option value="Ù†Ù‚Ø¯Ø§Ù‹" ${invoiceData.paymentMethod.includes('Ù†Ù‚Ø¯Ø§Ù‹') ? 'selected' : ''}>Ù†Ù‚Ø¯Ø§Ù‹</option>
                                        <option value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ" ${invoiceData.paymentMethod.includes('ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ') ? 'selected' : ''}>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                                        <option value="Ø¢Ø¬Ù„" ${invoiceData.paymentMethod.includes('Ø¢Ø¬Ù„') ? 'selected' : ''}>Ø¢Ø¬Ù„</option>
                                    </select>
                                </div>

                                <div>
                                    <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-info-circle" style="color: #ffc107;"></i>
                                        Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                                    </label>
                                    <select id="editInvoiceStatus" style="
                                        width: 100%;
                                        padding: 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 8px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        background: white;
                                        cursor: pointer;
                                        transition: border-color 0.3s ease;
                                    " onfocus="this.style.borderColor='#ffc107'" onblur="this.style.borderColor='#e9ecef'">
                                        <option value="Ù…ÙƒØªÙ…Ù„Ø©" ${invoiceData.status.includes('Ù…ÙƒØªÙ…Ù„Ø©') ? 'selected' : ''}>Ù…ÙƒØªÙ…Ù„Ø©</option>
                                        <option value="Ù…Ø¹Ù„Ù‚Ø©" ${invoiceData.status.includes('Ù…Ø¹Ù„Ù‚Ø©') ? 'selected' : ''}>Ù…Ø¹Ù„Ù‚Ø©</option>
                                        <option value="Ù…Ù„ØºÙŠØ©" ${invoiceData.status.includes('Ù…Ù„ØºÙŠØ©') ? 'selected' : ''}>Ù…Ù„ØºÙŠØ©</option>
                                    </select>
                                </div>
                            </div>


                            <div style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 8px; font-weight: 600; color: #495057;">
                                    <i class="fas fa-money-bill-wave" style="color: #ffc107;"></i>
                                    Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                                </label>
                                <input type="text" id="editInvoiceAmount" value="${invoiceData.amount}" style="
                                    width: 100%;
                                    padding: 12px;
                                    border: 2px solid #e9ecef;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    box-sizing: border-box;
                                    transition: border-color 0.3s ease;
                                    font-weight: 600;
                                    color: #28a745;
                                " onfocus="this.style.borderColor='#ffc107'" onblur="this.style.borderColor='#e9ecef'">
                            </div>

                            <div style="
                                display: flex;
                                gap: 12px;
                                justify-content: flex-end;
                                padding-top: 20px;
                                border-top: 1px solid #e9ecef;
                                margin-top: 20px;
                            ">
                                <button type="button" onclick="closeSalesEditModal()" style="
                                    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
                                    color: white;
                                    border: none;
                                    padding: 12px 24px;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    font-size: 14px;
                                    display: flex;
                                    align-items: center;
                                    gap: 8px;
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                    <i class="fas fa-times"></i>
                                    Ø¥Ù„ØºØ§Ø¡
                                </button>

                                <button type="submit" id="updateInvoiceBtn" style="
                                    background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
                                    color: white;
                                    border: none;
                                    padding: 12px 24px;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    font-size: 14px;
                                    display: flex;
                                    align-items: center;
                                    gap: 8px;
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                    <i class="fas fa-save"></i>
                                    Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            const form = document.getElementById('editInvoiceForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                updateInvoice(invoiceId);
            });

            window.closeSalesEditModal = function() {
                document.body.removeChild(modal);
                enableBodyScroll();
            };

            // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeSalesEditModal();
                }
            });
        }

        function updateInvoice(invoiceId) {
            const updateBtn = document.getElementById('updateInvoiceBtn');
            const originalText = updateBtn.innerHTML;

            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
            updateBtn.disabled = true;

            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
            const updatedData = {
                date: document.getElementById('editInvoiceDate').value,
                customer: document.getElementById('editInvoiceCustomer').value.trim(),
                quantity: document.getElementById('editInvoiceQuantity').value,
                paymentMethod: document.getElementById('editInvoicePayment').value,
                status: document.getElementById('editInvoiceStatus').value,
                amount: document.getElementById('editInvoiceAmount').value.trim()
            };

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!updatedData.customer || !updatedData.amount) {
                updateBtn.innerHTML = originalText;
                updateBtn.disabled = false;
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠØ«
            setTimeout(() => {
                try {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    updateInvoiceInTable(invoiceId, updatedData);

                    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                    closeSalesEditModal();

                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª "${invoiceId}" Ø¨Ù†Ø¬Ø§Ø­!`);

                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«:', error);
                    updateBtn.innerHTML = originalText;
                    updateBtn.disabled = false;
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                }
            }, 1000);
        }

        function updateInvoiceInTable(invoiceId, updatedData) {
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const rows = document.querySelectorAll('tbody tr');
            for (let row of rows) {
                const editBtn = row.querySelector(`button[onclick*="editInvoice('${invoiceId}')"]`);
                if (editBtn) {
                    // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙ
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 6) {
                        cells[1].textContent = updatedData.date;
                        cells[2].textContent = updatedData.customer;
                        cells[3].innerHTML = `<strong class="positive">${updatedData.amount}</strong>`;

                        // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø±Ø© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                        const paymentClass = updatedData.paymentMethod === 'Ù†Ù‚Ø¯Ø§Ù‹' ? 'success' :
                                           updatedData.paymentMethod === 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ' ? 'info' : 'warning';
                        cells[4].innerHTML = `<span class="badge ${paymentClass}">${updatedData.paymentMethod}</span>`;

                        // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
                        const statusClass = updatedData.status === 'Ù…ÙƒØªÙ…Ù„Ø©' ? 'primary' :
                                          updatedData.status === 'Ù…Ø¹Ù„Ù‚Ø©' ? 'secondary' : 'danger';
                        cells[5].innerHTML = `<span class="badge ${statusClass}">${updatedData.status}</span>`;

                        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„ØªØ­Ø¯ÙŠØ«
                        row.style.background = '#fff3cd';
                        setTimeout(() => {
                            row.style.background = '';
                        }, 2000);
                    }
                    break;
                }
            }
        }

        function viewInvoice(invoiceId) {
            console.log('Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', invoiceId);

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø£ÙˆÙ„Ø§Ù‹
            let invoiceData = null;

            if (window.dataManager) {
                const sales = window.dataManager.getSales();
                invoiceData = sales.find(s => s.id === invoiceId);
                console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', invoiceData);
            }

            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (!invoiceData) {
                invoiceData = getInvoiceDataFromTable(invoiceId);
                console.log('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØ¨Ø¯ÙŠÙ„:', invoiceData);
            }

            // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
            disableBodyScroll();

            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø¹Ø±Ø¶
            const modal = document.createElement('div');
            modal.className = 'modal view-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
            `;
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 12px;
                    max-width: 700px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    animation: slideIn 0.3s ease;
                ">
                    <div style="
                        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
                        color: white;
                        padding: 20px 25px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    ">
                        <h3 style="margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-eye"></i>
                            ØªÙØ§ØµÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                        </h3>
                        <button onclick="closeSalesViewModal()" style="
                            background: none;
                            border: none;
                            color: white;
                            font-size: 24px;
                            cursor: pointer;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: background 0.2s;
                        " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='none'">
                            &times;
                        </button>
                    </div>

                    <div style="padding: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                                <p style="margin: 5px 0 0 0; font-size: 1.1rem; font-weight: 600;">${invoiceData.id}</p>
                            </div>
                            <div>
                                <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                                <p style="margin: 5px 0 0 0; font-size: 1.1rem; font-weight: 600;">${invoiceData.date}</p>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <p style="margin: 5px 0 0 0; font-size: 1.1rem;">${invoiceData.customer || invoiceData.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            </div>
                            <div>
                                <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                                <p style="margin: 5px 0 0 0; font-size: 1.1rem;">${invoiceData.quantity || invoiceData.itemsCount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                <p style="margin: 5px 0 0 0; font-size: 1.2rem; font-weight: 600; color: #28a745;">${invoiceData.amount || (invoiceData.total ? invoiceData.total + ' Ø±.Ø³' : '0 Ø±.Ø³')}</p>
                            </div>
                            <div>
                                <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                                <p style="margin: 5px 0 0 0; font-size: 1.1rem;">${invoiceData.paymentMethod}</p>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                            <p style="margin: 5px 0 0 0;">
                                <span class="badge ${invoiceData.status === 'Ù…ÙƒØªÙ…Ù„Ø©' ? 'primary' : invoiceData.status === 'Ù…Ø¹Ù„Ù‚Ø©' ? 'secondary' : 'warning'}">
                                    ${invoiceData.status}
                                </span>
                            </p>
                        </div>

                        ${invoiceData.notes || invoiceData.description ? `
                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem;">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <p style="margin: 5px 0 0 0; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #007bff;">
                                ${invoiceData.notes || invoiceData.description}
                            </p>
                        </div>
                        ` : ''}

                        ${invoiceData.items && invoiceData.items.length > 0 ? `
                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; color: #6c757d; font-size: 0.9rem; margin-bottom: 10px; display: block;">Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</label>
                            <div style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
                                ${invoiceData.items.map(item => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                                        <div>
                                            <strong>${item.name || item.productName || 'ØµÙ†Ù ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong>
                                            <br>
                                            <small style="color: #6c757d;">Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity || 1}</small>
                                        </div>
                                        <div style="text-align: left;">
                                            <strong style="color: #28a745;">${item.price || item.total || '0'} Ø±.Ø³</strong>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <div style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 20px; border-top: 1px solid #e9ecef; margin-top: 20px; position: sticky; bottom: 0; background: white; z-index: 10;">
                            <button onclick="closeSalesViewModal(); editInvoice('${invoiceData.id}')" style="
                                background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: 600;
                                display: inline-flex;
                                align-items: center;
                                gap: 8px;
                                min-width: 100px;
                                justify-content: center;
                            ">
                                <i class="fas fa-edit"></i>
                                ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button onclick="printInvoice('${invoiceData.id}')" style="
                                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: 600;
                                display: inline-flex;
                                align-items: center;
                                gap: 8px;
                                min-width: 100px;
                                justify-content: center;
                            ">
                                <i class="fas fa-print"></i>
                                Ø·Ø¨Ø§Ø¹Ø©
                            </button>
                            <button onclick="closeSalesViewModal()" style="
                                background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: 600;
                                display: inline-flex;
                                align-items: center;
                                gap: 8px;
                                min-width: 100px;
                                justify-content: center;
                            ">
                                <i class="fas fa-times"></i>
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ø§Ù†ÙŠÙ…ÙŠØ´Ù†
            if (!document.querySelector('#sales-modal-animations')) {
                const style = document.createElement('style');
                style.id = 'sales-modal-animations';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideIn {
                        from { opacity: 0; transform: translateY(-50px) scale(0.9); }
                        to { opacity: 1; transform: translateY(0) scale(1); }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(modal);

            window.closeSalesViewModal = function() {
                document.body.removeChild(modal);
                enableBodyScroll();
            };

            // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø§ÙØ°Ø©
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeSalesViewModal();
                }
            });
        }

        function deleteInvoice(invoiceId) {
            console.log('Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', invoiceId);

            // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
            disableBodyScroll();

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            const invoiceData = getInvoiceDataFromTable(invoiceId);

            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
            const modal = document.createElement('div');
            modal.className = 'modal delete-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 12px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    animation: slideIn 0.3s ease;
                ">
                    <div style="
                        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                        color: white;
                        padding: 20px 25px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-radius: 12px 12px 0 0;
                    ">
                        <h3 style="margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-exclamation-triangle"></i>
                            ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
                        </h3>
                        <button onclick="closeSalesDeleteModal()" style="
                            background: none;
                            border: none;
                            color: white;
                            font-size: 24px;
                            cursor: pointer;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: background 0.2s;
                        " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='none'">
                            &times;
                        </button>
                    </div>

                    <div style="padding: 25px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="
                                width: 80px;
                                height: 80px;
                                background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                margin: 0 auto 15px auto;
                                color: white;
                                font-size: 2rem;
                            ">
                                <i class="fas fa-trash"></i>
                            </div>
                            <h4 style="margin: 0 0 10px 0; color: #dc3545;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ</h4>
                            <p style="margin: 0; color: #6c757d;">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
                        </div>

                        <div style="
                            background: #f8f9fa;
                            padding: 20px;
                            border-radius: 8px;
                            margin: 20px 0;
                            border-left: 4px solid #dc3545;
                        ">
                            <h5 style="margin: 0 0 10px 0; color: #dc3545;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</h5>
                            <p style="margin: 5px 0; color: #333;"><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> ${invoiceId}</p>
                            <p style="margin: 5px 0; color: #333;"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${invoiceData.date}</p>
                            <p style="margin: 5px 0; color: #333;"><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${invoiceData.customer}</p>
                            <p style="margin: 5px 0; color: #333;"><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> ${invoiceData.amount}</p>
                        </div>

                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button onclick="closeSalesDeleteModal()" style="
                                background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 600;
                                font-size: 14px;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                <i class="fas fa-times"></i>
                                Ø¥Ù„ØºØ§Ø¡
                            </button>

                            <button onclick="confirmDeleteInvoice('${invoiceId}')" style="
                                background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 600;
                                font-size: 14px;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220, 53, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <i class="fas fa-trash"></i>
                                Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            window.closeSalesDeleteModal = function() {
                document.body.removeChild(modal);
                enableBodyScroll();
            };

            window.confirmDeleteInvoice = function(invoiceId) {
                console.log('ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', invoiceId);

                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                if (!window.dataManager) {
                    console.log('ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                    window.dataManager = new DataManager();
                }

                try {
                    // Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                    const success = window.dataManager.deleteSale(invoiceId);

                    if (success) {
                        console.log('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', invoiceId);

                        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù…Ø®Ø²ÙˆÙ† (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª)
                        try {
                            const deletedSale = window.dataManager.getSales().find(s => s.id === invoiceId);
                            if (deletedSale && deletedSale.products) {
                                deletedSale.products.forEach(product => {
                                    try {
                                        window.dataManager.updateProductQuantity(product.productId, product.quantity);
                                        console.log(`ğŸ“¦ ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ ${product.quantity} Ù…Ù† ${product.productName} Ù„Ù„Ù…Ø®Ø²ÙˆÙ†`);
                                    } catch (error) {
                                        console.warn('ØªØ­Ø°ÙŠØ±: ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†:', product.productName, error.message);
                                    }
                                });
                            }
                        } catch (error) {
                            console.warn('ØªØ­Ø°ÙŠØ±: ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù…Ø®Ø²ÙˆÙ†:', error.message);
                        }

                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        loadSalesData();

                    } else {
                        throw new Error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ');
                    }

                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', error);

                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ ÙƒØ¨Ø¯ÙŠÙ„
                    console.log('ğŸ“¦ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ...');
                    try {
                        const localInvoices = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                        const filteredInvoices = localInvoices.filter(inv => inv.id !== invoiceId);

                        localStorage.setItem('monjizInvoices', JSON.stringify(filteredInvoices));
                        localStorage.setItem('monjizSales', JSON.stringify(filteredInvoices));

                        console.log('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­');

                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        loadSalesData();

                    } catch (localError) {
                        console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ Ø£ÙŠØ¶Ø§Ù‹:', localError);
                    }
                }

                // Ø­Ø°Ù Ø§Ù„ØµÙ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ ØªØ£Ø«ÙŠØ±
                const rows = document.querySelectorAll('tbody tr');
                for (let row of rows) {
                    const deleteBtn = row.querySelector(`button[onclick*="deleteInvoice('${invoiceId}')"]`);
                    if (deleteBtn) {
                        row.style.animation = 'slideOutRow 0.5s ease';
                        row.style.background = '#ffebee';
                        setTimeout(() => {
                            row.remove();
                        }, 500);
                        break;
                    }
                }

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                closeSalesDeleteModal();

                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                setTimeout(() => {
                    alert(`ØªÙ… Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª "${invoiceId}" Ø¨Ù†Ø¬Ø§Ø­`);
                }, 600);
            };

            // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeSalesDeleteModal();
                }
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            if (!document.querySelector('#sales-animations')) {
                const style = document.createElement('style');
                style.id = 'sales-animations';
                style.textContent = `
                    @keyframes slideOutRow {
                        from { opacity: 1; transform: translateX(0); }
                        to { opacity: 0; transform: translateX(-50px); }
                    }
                `;
                document.head.appendChild(style);
            }
        });

        function closeModal(element) {
            const modal = element.closest('.modal-overlay');
            if (modal) {
                modal.remove();
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                document.body.style.overflow = 'auto';
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        function disableBodyScroll() {
            document.body.style.overflow = 'hidden';
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        function enableBodyScroll() {
            document.body.style.overflow = 'auto';
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£ØµÙ†Ø§Ù ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ÙØ§ØªÙˆØ±Ø©
        function generateSampleItemsForInvoice(invoiceId, totalAmount) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº
            const cleanAmount = parseFloat(totalAmount.replace(/[^\d.]/g, '')) || 0;

            // Ø£ØµÙ†Ø§Ù ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø®ØªÙ„ÙØ© Ø­Ø³Ø¨ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            const sampleItems = {
                'INV-001': [
                    { name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell', productName: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell', quantity: 1, price: 1500, total: 1500 },
                    { name: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', productName: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', quantity: 2, price: 50, total: 100 },
                    { name: 'Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­', productName: 'Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­', quantity: 1, price: 150, total: 150 }
                ],
                'INV-002': [
                    { name: 'Ø´Ø§Ø´Ø© Samsung 24"', productName: 'Ø´Ø§Ø´Ø© Samsung 24"', quantity: 2, price: 800, total: 1600 },
                    { name: 'ÙƒÙŠØ¨Ù„ HDMI', productName: 'ÙƒÙŠØ¨Ù„ HDMI', quantity: 3, price: 30, total: 90 },
                    { name: 'Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ«', productName: 'Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ù„ÙˆØªÙˆØ«', quantity: 1, price: 200, total: 200 }
                ],
                'INV-003': [
                    { name: 'Ø·Ø§Ø¨Ø¹Ø© HP LaserJet', productName: 'Ø·Ø§Ø¨Ø¹Ø© HP LaserJet', quantity: 1, price: 600, total: 600 },
                    { name: 'ÙˆØ±Ù‚ Ø·Ø¨Ø§Ø¹Ø© A4', productName: 'ÙˆØ±Ù‚ Ø·Ø¨Ø§Ø¹Ø© A4', quantity: 5, price: 30, total: 150 }
                ],
                'INV-004': [
                    { name: 'Ù‡Ø§Ø±Ø¯ Ø¯ÙŠØ³Ùƒ Ø®Ø§Ø±Ø¬ÙŠ 1TB', productName: 'Ù‡Ø§Ø±Ø¯ Ø¯ÙŠØ³Ùƒ Ø®Ø§Ø±Ø¬ÙŠ 1TB', quantity: 1, price: 300, total: 300 },
                    { name: 'ÙÙ„Ø§Ø´ Ù…ÙŠÙ…ÙˆØ±ÙŠ 64GB', productName: 'ÙÙ„Ø§Ø´ Ù…ÙŠÙ…ÙˆØ±ÙŠ 64GB', quantity: 2, price: 80, total: 160 },
                    { name: 'ÙƒÙŠØ¨Ù„ USB-C', productName: 'ÙƒÙŠØ¨Ù„ USB-C', quantity: 3, price: 25, total: 75 }
                ],
                'INV-005': [
                    { name: 'Ø±Ø§ÙˆØªØ± WiFi 6', productName: 'Ø±Ø§ÙˆØªØ± WiFi 6', quantity: 1, price: 400, total: 400 },
                    { name: 'ÙƒÙŠØ¨Ù„ Ø¥ÙŠØ«Ø±Ù†Øª', productName: 'ÙƒÙŠØ¨Ù„ Ø¥ÙŠØ«Ø±Ù†Øª', quantity: 5, price: 20, total: 100 },
                    { name: 'Ù…Ø­ÙˆÙ„ Ø´Ø¨ÙƒØ©', productName: 'Ù…Ø­ÙˆÙ„ Ø´Ø¨ÙƒØ©', quantity: 2, price: 60, total: 120 }
                ]
            };

            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø£ØµÙ†Ø§ÙÙ‡Ø§
            if (sampleItems[invoiceId]) {
                return sampleItems[invoiceId];
            }

            // Ù„Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø£Ø®Ø±Ù‰ØŒ Ø£Ù†Ø´Ø¦ Ø£ØµÙ†Ø§Ù Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº
            if (cleanAmount > 0) {
                const itemCount = Math.min(Math.max(1, Math.floor(cleanAmount / 500)), 4);
                const items = [];
                const basePrice = cleanAmount / itemCount;

                const productNames = [
                    'Ù…Ù†ØªØ¬ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                    'Ø¬Ù‡Ø§Ø² ÙƒÙ…Ø¨ÙŠÙˆØªØ±',
                    'Ù…Ù„Ø­Ù‚Ø§Øª ØªÙ‚Ù†ÙŠØ©',
                    'Ù…Ø¹Ø¯Ø§Øª Ù…ÙƒØªØ¨ÙŠØ©'
                ];

                for (let i = 0; i < itemCount; i++) {
                    const price = Math.round(basePrice * (0.8 + Math.random() * 0.4));
                    items.push({
                        name: productNames[i] || `Ù…Ù†ØªØ¬ ${i + 1}`,
                        productName: productNames[i] || `Ù…Ù†ØªØ¬ ${i + 1}`,
                        quantity: 1,
                        price: price,
                        total: price
                    });
                }

                return items;
            }

            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¨Ù„ØºØŒ Ø£Ø±Ø¬Ø¹ ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ
            return [
                { name: 'Ù…Ù†ØªØ¬ Ø§ÙØªØ±Ø§Ø¶ÙŠ', productName: 'Ù…Ù†ØªØ¬ Ø§ÙØªØ±Ø§Ø¶ÙŠ', quantity: 1, price: 0, total: 0 }
            ];
        }

        // ÙˆØ¸ÙŠÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function getInvoiceDataFromTable(invoiceId) {
            const tableRows = document.querySelectorAll('.modern-table tbody tr');

            for (let row of tableRows) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø¯Ø§Ø®Ù„ <strong>)
                const invoiceCell = row.cells[0];
                const rowInvoiceId = invoiceCell.querySelector('strong') ?
                    invoiceCell.querySelector('strong').textContent.trim() :
                    invoiceCell.textContent.trim();

                if (rowInvoiceId === invoiceId) {
                    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØŒ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ØŒ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                    const paymentCell = row.cells[5]; // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                    const statusCell = row.cells[6];  // Ø§Ù„Ø­Ø§Ù„Ø©

                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† badge Ø£Ùˆ span
                    const paymentText = paymentCell.querySelector('.badge') || paymentCell.querySelector('span') ?
                        (paymentCell.querySelector('.badge') || paymentCell.querySelector('span')).textContent.trim() :
                        paymentCell.textContent.trim();

                    const statusText = statusCell.querySelector('.badge') || statusCell.querySelector('span') ?
                        (statusCell.querySelector('.badge') || statusCell.querySelector('span')).textContent.trim() :
                        statusCell.textContent.trim();

                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¨Ù„Øº (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø¯Ø§Ø®Ù„ <strong>)
                    const amountCell = row.cells[4];
                    const amountText = amountCell.querySelector('strong') ?
                        amountCell.querySelector('strong').textContent.trim() :
                        amountCell.textContent.trim();

                    const quantityText = row.cells[3].textContent.trim();

                    return {
                        id: rowInvoiceId,
                        date: row.cells[1].textContent.trim(),
                        customer: row.cells[2].textContent.trim(),
                        customerName: row.cells[2].textContent.trim(),
                        quantity: quantityText === '' || quantityText === 'undefined' ? '1' : quantityText,
                        itemsCount: quantityText === '' || quantityText === 'undefined' ? '1' : quantityText,
                        amount: amountText,
                        total: amountText.replace(' Ø±.Ø³', '').replace(',', ''),
                        paymentMethod: paymentText,
                        status: statusText,
                        rowElement: row,
                        items: generateSampleItemsForInvoice(rowInvoiceId, amountText) // Ø¥Ù†Ø´Ø§Ø¡ Ø£ØµÙ†Ø§Ù ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                    };
                }
            }

            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ Ø¥Ø±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            return {
                id: invoiceId,
                date: new Date().toLocaleDateString('ar-SA'),
                customer: 'Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯',
                customerName: 'Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯',
                quantity: '1',
                itemsCount: '1',
                amount: '100 Ø±.Ø³',
                total: '100',
                paymentMethod: 'Ù†Ù‚Ø¯Ø§Ù‹',
                status: 'Ø¬Ø¯ÙŠØ¯Ø©',
                rowElement: null,
                items: [
                    { name: 'Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯', productName: 'Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯', quantity: 1, price: 100, total: 100 }
                ]
            };
        }

        function printInvoice(invoiceId) {
            console.log('Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', invoiceId);

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø£ÙˆÙ„Ø§Ù‹
            let invoiceData = null;

            if (window.dataManager) {
                const sales = window.dataManager.getSales();
                invoiceData = sales.find(s => s.id === invoiceId);
                console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', invoiceData);
            }

            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (!invoiceData) {
                invoiceData = getInvoiceDataFromTable(invoiceId);
                console.log('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØ¨Ø¯ÙŠÙ„:', invoiceData);
            }

            const printWindow = window.open('', '_blank');

            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ HTML Ù…Ø­Ø³Ù† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            let itemsHtml = '';
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø®Ø§ØµÙŠØ© items Ø£Ùˆ products
            const productsArray = invoiceData.products || invoiceData.items || [];
            
            if (productsArray && productsArray.length > 0) {
                itemsHtml = `
                    <div class="items-section">
                        <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØµÙ†Ù</th>
                                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productsArray.map(item => {
                                    const quantity = item.quantity || 1;
                                    const total = item.total || item.price || 0;
                                    const price = item.price || (total / quantity) || 0;

                                    return `
                                    <tr>
                                        <td>${item.name || item.productName || 'ØµÙ†Ù ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                        <td>${quantity}</td>
                                        <td>${price.toFixed(2)} Ø±.Ø³</td>
                                        <td>${typeof total === 'number' ? total.toFixed(2) : total} Ø±.Ø³</td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ${invoiceId}</title>
                    <style>
                        body {
                            font-family: 'Arial', sans-serif;
                            margin: 0;
                            padding: 20px;
                            background: white;
                            color: #333;
                        }
                        .invoice-container {
                            max-width: 800px;
                            margin: 0 auto;
                            background: white;
                            border: 2px solid #ddd;
                            border-radius: 10px;
                            overflow: hidden;
                        }
                        .header {
                            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
                            color: white;
                            text-align: center;
                            padding: 30px;
                            margin-bottom: 0;
                        }
                        .header h1 {
                            margin: 0;
                            font-size: 2.5rem;
                            font-weight: bold;
                        }
                        .header h2 {
                            margin: 10px 0 0 0;
                            font-size: 1.5rem;
                            opacity: 0.9;
                        }
                        .content {
                            padding: 30px;
                        }
                        .invoice-info {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 30px;
                            margin-bottom: 30px;
                            padding: 20px;
                            background: #f8f9fa;
                            border-radius: 8px;
                        }
                        .info-group {
                            margin-bottom: 15px;
                        }
                        .label {
                            font-weight: bold;
                            color: #495057;
                            display: block;
                            margin-bottom: 5px;
                            font-size: 0.9rem;
                        }
                        .value {
                            font-size: 1.1rem;
                            color: #212529;
                            padding: 8px 12px;
                            background: white;
                            border-radius: 4px;
                            border: 1px solid #e9ecef;
                        }
                        /* ØªÙ†Ø³ÙŠÙ‚ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù„ØªÙƒÙˆÙ† Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ù‹Ø§ */
                        .info-group:has(.label:contains("Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹")) .value {
                            background: linear-gradient(135deg, #007bff, #0056b3);
                            color: white;
                            border: none;
                        }
                        
                        /* Ø¯Ø¹Ù… Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ¯Ø¹Ù… :has */
                        [data-payment-method] {
                            background: linear-gradient(135deg, #007bff, #0056b3);
                            color: white;
                            border: none;
                        }
                        .status {
                            display: inline-block;
                            padding: 6px 12px;
                            border-radius: 20px;
                            font-weight: bold;
                            font-size: 0.9rem;
                        }
                        .status.success { background: #d4edda; color: #155724; }
                        .status.warning { background: #fff3cd; color: #856404; }
                        .status.info { background: #d1ecf1; color: #0c5460; }
                        .status.primary { background: #cce7ff; color: #004085; }
                        .items-section {
                            margin-top: 30px;
                            padding-top: 20px;
                            border-top: 2px solid #e9ecef;
                        }
                        .items-section h3 {
                            color: #007bff;
                            margin-bottom: 20px;
                            font-size: 1.3rem;
                        }
                        .items-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        .items-table th,
                        .items-table td {
                            padding: 12px;
                            text-align: center;
                            border: 1px solid #dee2e6;
                        }
                        .items-table th {
                            background: #007bff;
                            color: white;
                            font-weight: bold;
                        }
                        .items-table tbody tr:nth-child(even) {
                            background: #f8f9fa;
                        }
                        .notes-section {
                            margin-top: 30px;
                            padding: 20px;
                            background: #f8f9fa;
                            border-radius: 8px;
                            border-left: 4px solid #007bff;
                        }
                        .notes-section h4 {
                            margin: 0 0 10px 0;
                            color: #007bff;
                        }
                        .total-section {
                            margin-top: 30px;
                            text-align: center;
                            padding: 20px;
                            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                            color: white;
                            border-radius: 8px;
                        }
                        .total-amount {
                            font-size: 2rem;
                            font-weight: bold;
                            margin: 10px 0;
                        }
                        .footer {
                            margin-top: 40px;
                            text-align: center;
                            color: #6c757d;
                            font-size: 0.9rem;
                            border-top: 1px solid #e9ecef;
                            padding-top: 20px;
                        }
                        @media print {
                            body { margin: 0; padding: 0; }
                            .invoice-container { border: none; border-radius: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="invoice-container">
                        <div class="header">
                            <h1>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>
                            <h2>${invoiceData.id}</h2>
                        </div>

                        <div class="content">
                            <div class="invoice-info">
                                <div>
                                    <div class="info-group">
                                        <span class="label">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</span>
                                        <div class="value">${invoiceData.id}</div>
                                    </div>
                                    <div class="info-group">
                                        <span class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</span>
                                        <div class="value">${invoiceData.date}</div>
                                    </div>
                                </div>
                                <div>
                                    <div class="info-group">
                                        <span class="label">Ø§Ù„Ø¹Ù…ÙŠÙ„:</span>
                                        <div class="value">${invoiceData.customer || invoiceData.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    </div>
                                    <div class="info-group">
                                    <span class="label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                                    <div class="value" data-payment-method>${invoiceData.paymentMethod || 'Ù†Ù‚Ø¯Ø§Ù‹'}</div>
                                </div>
                                </div>
                            </div>

                            ${itemsHtml}

                            ${invoiceData.notes || invoiceData.description ? `
                            <div class="notes-section">
                                <h4>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h4>
                                <p>${invoiceData.notes || invoiceData.description}</p>
                            </div>
                            ` : ''}

                            <div class="total-section">
                                <div>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                                <div class="total-amount">${invoiceData.total || '0'} Ø±.Ø³</div>
                            </div>

                            <div class="footer">
                                <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ ${new Date().toLocaleDateString('ar-SA')} - Ù†Ø¸Ø§Ù… Ù…Ù†Ø¬Ø² Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `);

            printWindow.document.close();
            printWindow.focus();

            // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø«Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-family: 'Cairo', sans-serif;
                animation: slideIn 0.3s ease-out;
            `;
            successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;

            document.body.appendChild(successDiv);

            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø³Ù†Ø©
        function filterByPaymentMethod() {
            const select = document.getElementById('payment-filter');
            const selectedValue = select.value;
            const tableRows = document.querySelectorAll('.modern-table tbody tr');

            console.log('ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:', selectedValue);

            tableRows.forEach(row => {
                if (selectedValue === 'all' || selectedValue === '') {
                    row.style.display = '';
                } else {
                    const paymentCell = row.cells[5];
                    const paymentText = paymentCell.textContent.trim();

                    let shouldShow = false;

                    switch(selectedValue) {
                        case 'cash':
                            shouldShow = paymentText.includes('Ù†Ù‚Ø¯Ø§Ù‹');
                            break;
                        case 'bank':
                            shouldShow = paymentText.includes('ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ');
                            break;
                        case 'credit':
                            shouldShow = paymentText.includes('Ø¢Ø¬Ù„');
                            break;
                    }

                    row.style.display = shouldShow ? '' : 'none';
                }
            });

            updateVisibleRowsCount();
        }

        function filterByStatus() {
            const select = document.getElementById('status-filter');
            const selectedValue = select.value;
            const tableRows = document.querySelectorAll('.modern-table tbody tr');

            console.log('ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©:', selectedValue);

            tableRows.forEach(row => {
                if (selectedValue === 'all' || selectedValue === '') {
                    row.style.display = '';
                } else {
                    const statusCell = row.cells[6];
                    const statusText = statusCell.textContent.trim();

                    let shouldShow = false;

                    switch(selectedValue) {
                        case 'completed':
                            shouldShow = statusText.includes('Ù…ÙƒØªÙ…Ù„Ø©');
                            break;
                        case 'pending':
                            shouldShow = statusText.includes('Ù…Ø¹Ù„Ù‚Ø©');
                            break;
                        case 'cancelled':
                            shouldShow = statusText.includes('Ù…Ù„ØºÙŠØ©');
                            break;
                    }

                    row.style.display = shouldShow ? '' : 'none';
                }
            });

            updateVisibleRowsCount();
        }

        function clearFilters() {
            document.getElementById('status-filter').value = 'all';
            document.getElementById('payment-filter').value = 'all';
            document.getElementById('search-input').value = '';

            const tableRows = document.querySelectorAll('.modern-table tbody tr');
            tableRows.forEach(row => {
                row.style.display = '';
            });

            updateVisibleRowsCount();
            showSuccessMessage('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙÙŠØ§Øª');
        }

        function updateVisibleRowsCount() {
            const tableRows = document.querySelectorAll('.modern-table tbody tr');
            const visibleRows = Array.from(tableRows).filter(row => row.style.display !== 'none');
            console.log(`Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: ${visibleRows.length} Ù…Ù† Ø£ØµÙ„ ${tableRows.length}`);

            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateResultsCounter(visibleRows.length, tableRows.length);
        }

        function updateResultsCounter(visible, total) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„ØªÙ†Ù‚Ù„
            if (document.getElementById('sales-start-result')) {
                const startResult = visible === 0 ? 0 : (salesCurrentPage - 1) * salesItemsPerPage + 1;
                const endResult = Math.min(salesCurrentPage * salesItemsPerPage, visible);

                document.getElementById('sales-start-result').textContent = startResult;
                document.getElementById('sales-end-result').textContent = endResult;
                document.getElementById('sales-total-results').textContent = total;
            }

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            const oldCounter = document.getElementById('results-counter');
            if (oldCounter) {
                oldCounter.remove();
            }
        }

        function searchInvoices() {
            const searchInput = document.getElementById('search-input');
            const searchTerm = searchInput.value.toLowerCase().trim();
            const tableRows = document.querySelectorAll('.modern-table tbody tr');

            console.log('Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†:', searchTerm);

            tableRows.forEach(row => {
                if (searchTerm === '') {
                    row.style.display = '';
                } else {
                    const rowText = row.textContent.toLowerCase();
                    const shouldShow = rowText.includes(searchTerm);
                    row.style.display = shouldShow ? '' : 'none';
                }
            });

            updateVisibleRowsCount();
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªØµØ¯ÙŠØ±
        function printSales() {
            console.log('Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª...');

            const printWindow = window.open('', '_blank');
            const tableContent = document.querySelector('.modern-table').outerHTML;

            printWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
                    <style>
                        body { font-family: 'Cairo', sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .modern-table { width: 100%; border-collapse: collapse; }
                        .modern-table th, .modern-table td {
                            border: 1px solid #ddd;
                            padding: 8px;
                            text-align: center;
                        }
                        .modern-table th { background-color: #f5f5f5; }
                        .action-buttons-horizontal { display: none; }
                        @media print {
                            .action-buttons-horizontal { display: none !important; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-SA')}</p>
                    </div>
                    ${tableContent}
                </body>
                </html>
            `);

            printWindow.document.close();
            printWindow.print();
        }

        function exportToExcel() {
            console.log('ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel...');
            showSuccessMessage('Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        function exportToPDF() {
            console.log('ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF...');
            showSuccessMessage('Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ PDF Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        const style = document.createElement('style');
        style.textContent = `
            /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
                box-sizing: border-box;
                overflow-y: auto;
            }

            .modal-content-modern {
                background: white;
                border-radius: 12px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-width: 600px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                margin: auto;
                animation: modalSlideIn 0.3s ease-out;
                position: relative;
            }

            .modal-header-modern {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px;
                border-radius: 12px 12px 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .modal-header-modern h3 {
                margin: 0;
                font-size: 1.3rem;
                font-weight: 600;
            }

            .close-btn {
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                transition: background 0.2s;
            }

            .close-btn:hover {
                background: rgba(255, 255, 255, 0.2);
            }

            .modal-body-modern {
                padding: 25px;
            }

            .form-modern {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .form-group {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .form-group label {
                font-weight: 600;
                color: #333;
                font-size: 0.9rem;
            }

            .input-modern, .select-modern, .textarea-modern {
                padding: 10px 12px;
                border: 2px solid #e1e5e9;
                border-radius: 6px;
                font-family: 'Cairo', sans-serif;
                font-size: 0.9rem;
                transition: border-color 0.2s;
            }

            .input-modern:focus, .select-modern:focus, .textarea-modern:focus {
                outline: none;
                border-color: #667eea;
            }

            .products-section, .totals-section {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                border: 1px solid #e9ecef;
            }

            .products-section h4, .totals-section h4 {
                margin: 0 0 15px 0;
                color: #495057;
                font-size: 1.1rem;
            }

            .total-final {
                background: #e8f5e8 !important;
                font-weight: 600;
                font-size: 1.1rem;
                color: #28a745;
            }

            .form-actions {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
                padding-top: 20px;
                border-top: 1px solid #e9ecef;
                margin-top: 20px;
            }

            .invoice-details {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
            }

            .detail-row {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e9ecef;
            }

            .detail-row:last-child {
                border-bottom: none;
            }

            .detail-row .label {
                font-weight: 600;
                color: #495057;
            }

            .detail-row .value {
                color: #212529;
            }

            @keyframes modalSlideIn {
                from {
                    transform: scale(0.8);
                    opacity: 0;
                }
                to {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØµØºÙŠØ± */
            .table-modern-small {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                font-size: 0.85rem;
            }

            .table-modern-small th,
            .table-modern-small td {
                padding: 8px;
                border: 1px solid #e9ecef;
                text-align: center;
            }

            .table-modern-small th {
                background: #f8f9fa;
                font-weight: 600;
                color: #495057;
            }

            .table-modern-small .input-modern,
            .table-modern-small .select-modern {
                padding: 5px 8px;
                font-size: 0.8rem;
                border: 1px solid #ced4da;
                width: 100%;
            }

            .total-cell {
                font-weight: 600;
                color: #28a745;
            }

            .btn-small {
                padding: 4px 8px;
                font-size: 0.75rem;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .btn-danger {
                background: #dc3545;
                color: white;
            }

            .btn-danger:hover {
                background: #c82333;
            }

            .products-table {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 8px;
                border: 1px solid #e9ecef;
            }

            /* ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
            @media (max-width: 768px) {
                .modal-overlay {
                    padding: 10px;
                }

                .modal-content-modern {
                    max-width: 100%;
                    margin: 0;
                }

                .form-row {
                    grid-template-columns: 1fr;
                }

                .modal-header-modern {
                    padding: 15px;
                }

                .modal-body-modern {
                    padding: 20px;
                }

                .table-modern-small {
                    font-size: 0.75rem;
                }

                .table-modern-small th,
                .table-modern-small td {
                    padding: 5px;
                }
            }
        `;
        document.head.appendChild(style);

        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
        const productsDatabase = {
            '1': { name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell', price: 2450 },
            '2': { name: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', price: 85 },
            '3': { name: 'ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ', price: 320 },
            '4': { name: 'Ø´Ø§Ø´Ø© 24 Ø¨ÙˆØµØ©', price: 890 },
            '5': { name: 'Ø·Ø§Ø¨Ø¹Ø© Ù„ÙŠØ²Ø±', price: 1200 },
            '6': { name: 'ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆÙŠØ¨', price: 150 }
        };

        // ÙˆØ¸ÙŠÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬
        function getProductPrice(productId) {
            return productsDatabase[productId] ? productsDatabase[productId].price : 0;
        }

        // ÙˆØ¸ÙŠÙØ© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
        function calculateTotals() {
            let subtotal = 0;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const productRows = document.querySelectorAll('.products-table tbody tr');
            productRows.forEach(row => {
                const quantity = parseFloat(row.querySelector('input[type="number"]').value) || 0;
                const price = parseFloat(row.querySelectorAll('input[type="number"]')[1].value) || 0;
                subtotal += quantity * price;
            });

            const tax = subtotal * 0.15; // Ø¶Ø±ÙŠØ¨Ø© 15%
            const total = subtotal + tax;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ID
            const subtotalField = document.getElementById('subtotal-field');
            const taxField = document.getElementById('tax-field');
            const totalField = document.getElementById('total-field');

            if (subtotalField) subtotalField.value = `${subtotal.toFixed(2)} Ø±.Ø³`;
            if (taxField) taxField.value = `${tax.toFixed(2)} Ø±.Ø³`;
            if (totalField) totalField.value = `${total.toFixed(2)} Ø±.Ø³`;

            console.log(`Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ: ${subtotal.toFixed(2)}, Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: ${tax.toFixed(2)}, Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)}`);
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        function updateProductPrice(selectElement) {
            console.log('ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬...');
            const row = selectElement.closest('tr');
            const priceInputs = row.querySelectorAll('input[type="number"]');
            const priceInput = priceInputs[1]; // Ø«Ø§Ù†ÙŠ input Ù„Ù„Ø³Ø¹Ø±
            const quantityInput = priceInputs[0]; // Ø£ÙˆÙ„ input Ù„Ù„ÙƒÙ…ÙŠØ©
            const productId = selectElement.value;

            console.log('Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø®ØªØ§Ø±:', productId);

            if (productId && priceInput) {
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                const products = window.dataManager.getProducts();
                const product = products.find(p => p.id == productId);

                console.log('Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯:', product);

                if (product) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±
                    priceInput.value = product.salePrice;

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    const requestedQuantity = parseInt(quantityInput.value) || 1;
                    if (requestedQuantity > product.quantity) {
                        alert(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${requestedQuantity}) Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (${product.quantity})`);
                        quantityInput.value = product.quantity;
                    }

                    console.log('ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø¹Ø±:', product.salePrice);
                    updateRowTotal(row);
                    calculateTotals();
                } else {
                    console.log('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    priceInput.value = '';
                }
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØµÙ
        function updateRowTotal(row) {
            const quantity = parseFloat(row.querySelector('input[type="number"]').value) || 0;
            const price = parseFloat(row.querySelectorAll('input[type="number"]')[1].value) || 0;
            const total = quantity * price;

            const totalCell = row.querySelector('.total-cell');
            if (totalCell) {
                totalCell.textContent = `${total.toFixed(2)} Ø±.Ø³`;
            }
        }

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', searchInvoices);
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            updateVisibleRowsCount();

            // ØªÙØ¹ÙŠÙ„ Ø²Ø± ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
            const addInvoiceBtn = document.querySelector('.add-invoice-btn');
            if (addInvoiceBtn) {
                addInvoiceBtn.addEventListener('click', showAddInvoiceModal);
            }
        });

        // ÙˆØ¸ÙŠÙØ© Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function showAddInvoiceModal() {
            console.log('ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©...');

            // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
            disableBodyScroll();

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content-modern" style="max-width: 900px;">
                    <div class="modal-header-modern">
                        <h3><i class="fas fa-receipt"></i> Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body-modern">
                        <form class="form-modern" id="new-invoice-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                                    <input type="text" class="input-modern" value="INV-006" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" class="input-modern" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                    <select class="select-modern" id="customerSelect">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                                    <select class="select-modern" id="paymentMethodSelect">
                                        <option value="Ù†Ù‚Ø¯Ø§Ù‹">Ù†Ù‚Ø¯Ø§Ù‹</option>
                                        <option value="ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                                        <option value="Ø¢Ø¬Ù„">Ø¢Ø¬Ù„</option>
                                    </select>
                                </div>
                            </div>

                            <div class="products-section">
                                <h4><i class="fas fa-boxes"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
                                <div class="products-table">
                                    <table class="table-modern-small">
                                        <thead>
                                            <tr>
                                                <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <select class="select-modern product-select" onchange="updateProductPrice(this)">
                                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input type="number" class="input-modern" value="1" min="1"
                                                           onchange="updateRowTotal(this.closest('tr')); calculateTotals();">
                                                </td>
                                                <td>
                                                    <input type="number" class="input-modern" placeholder="0.00" step="0.01"
                                                           onchange="updateRowTotal(this.closest('tr')); calculateTotals();">
                                                </td>
                                                <td><span class="total-cell">0.00 Ø±.Ø³</span></td>
                                                <td>
                                                    <button type="button" class="btn-small btn-danger" onclick="removeProductRow(this)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <button type="button" class="btn-modern btn-outline" onclick="addProductRow()">
                                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¢Ø®Ø±
                                </button>
                            </div>

                            <div class="totals-section">
                                <h4><i class="fas fa-calculator"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</label>
                                        <input type="text" class="input-modern" id="subtotal-field" value="0.00 Ø±.Ø³" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15%)</label>
                                        <input type="text" class="input-modern" id="tax-field" value="0.00 Ø±.Ø³" readonly>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
                                    <input type="text" class="input-modern total-final" id="total-field" value="0.00 Ø±.Ø³" readonly>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                <textarea class="textarea-modern" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-modern btn-primary" onclick="saveInvoice()">
                                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                                </button>
                                <button type="button" class="btn-modern btn-secondary" onclick="closeModal(this)">
                                    <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©
            setTimeout(() => {
                console.log('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª...');
                updateSalesModalData();
            }, 100);

            // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal(modal.querySelector('.close-btn'));
                }
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
            setTimeout(() => {
                calculateTotals();
            }, 100);
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function updateSalesModalData() {
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª...');

            try {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                if (!window.dataManager) {
                    console.log('ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                    window.dataManager = new DataManager();
                }

                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                const customers = window.dataManager.getCustomers();
                const customerSelect = document.getElementById('customerSelect');
                if (customerSelect) {
                    customerSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</option>';
                    customers.forEach(customer => {
                        const option = document.createElement('option');
                        option.value = customer.id;
                        option.textContent = customer.name;
                        customerSelect.appendChild(option);
                    });
                    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:', customers.length, 'Ø¹Ù…ÙŠÙ„');
                } else {
                    console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± customerSelect');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:', error);
            }

            // ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const products = window.dataManager.getProducts();
            const productSelects = document.querySelectorAll('.product-select');
            productSelects.forEach(select => {
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬</option>';
                products.forEach(product => {
                    if (product.quantity > 0) { // ÙÙ‚Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.setAttribute('data-price', product.salePrice);
                        option.setAttribute('data-stock', product.quantity);
                        option.textContent = `${product.name} (Ù…ØªÙˆÙØ±: ${product.quantity})`;
                        select.appendChild(option);
                    }
                });
            });
        }

        function addProductRow() {
            console.log('Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯...');

            const tbody = document.querySelector('.products-table tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <select class="select-modern product-select" onchange="updateProductPrice(this)">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬</option>
                    </select>
                </td>
                <td>
                    <input type="number" class="input-modern" value="1" min="1"
                           onchange="updateRowTotal(this.closest('tr')); calculateTotals();">
                </td>
                <td>
                    <input type="number" class="input-modern" placeholder="0.00" step="0.01"
                           onchange="updateRowTotal(this.closest('tr')); calculateTotals();">
                </td>
                <td><span class="total-cell">0.00 Ø±.Ø³</span></td>
                <td>
                    <button type="button" class="btn-small btn-danger" onclick="removeProductRow(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;

            tbody.appendChild(newRow);
            showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯');

            // ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            updateProductSelectsAfterAdd();
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© Ø¨Ø³ÙŠØ·
        function generateSimpleInvoiceNumber() {
            console.log('ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯...');

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            const savedInvoices = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:', savedInvoices.length);

            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯
            let maxNumber = 0;
            savedInvoices.forEach(invoice => {
                if (invoice.id) {
                    // ØªØ­ÙˆÙŠÙ„ ID Ø¥Ù„Ù‰ Ù†Øµ Ù„Ù„ØªØ£ÙƒØ¯
                    const idStr = String(invoice.id);

                    if (idStr.startsWith('INV-')) {
                        const numberPart = idStr.replace('INV-', '');
                        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ØµÙØ§Ø± Ø§Ù„Ø¨Ø§Ø¯Ø¦Ø© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                        const number = parseInt(numberPart);
                        if (!isNaN(number) && number > maxNumber) {
                            maxNumber = number;
                        }
                        console.log(`ÙØ§ØªÙˆØ±Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©: ${idStr}, Ø±Ù‚Ù…: ${number}`);
                    } else if (idStr.startsWith('TEST-')) {
                        // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                        console.log(`ØªØ¬Ø§Ù‡Ù„ ÙØ§ØªÙˆØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ${idStr}`);
                    } else {
                        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ù…Ù† ID ØºÙŠØ± Ù…Ù†Ø³Ù‚
                        const number = parseInt(idStr);
                        if (!isNaN(number) && number > maxNumber) {
                            maxNumber = number;
                        }
                        console.log(`ÙØ§ØªÙˆØ±Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ Ù…Ø®ØªÙ„Ù: ${idStr}, Ø±Ù‚Ù…: ${number}`);
                    }
                }
            });

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ
            const nextNumber = maxNumber + 1;
            const newInvoiceId = 'INV-' + nextNumber.toString().padStart(3, '0');
            console.log(`Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${newInvoiceId}`);

            return newInvoiceId;
        }

        function saveInvoice() {
            try {
                // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                const customerSelect = document.getElementById('customerSelect');
                const productsTable = document.querySelector('#new-invoice-form .products-table tbody');

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„
                let customerId = 1; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                let customerName = 'Ø¹Ù…ÙŠÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ';

                if (customerSelect && customerSelect.value) {
                    customerId = customerSelect.value;
                    customerName = customerSelect.options[customerSelect.selectedIndex].text;
                } else {
                    console.warn('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
                }

                // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const products = [];

                if (productsTable) {
                    const rows = productsTable.querySelectorAll('tr');

                    rows.forEach((row, index) => {
                        const productSelect = row.querySelector('select.product-select') || row.querySelector('select');
                        const quantityInputs = row.querySelectorAll('input[type="number"]');
                        const quantityInput = quantityInputs[0]; // Ø£ÙˆÙ„ input Ù„Ù„ÙƒÙ…ÙŠØ©
                        const priceInput = quantityInputs[1]; // Ø«Ø§Ù†ÙŠ input Ù„Ù„Ø³Ø¹Ø±

                        if (productSelect && productSelect.value && quantityInput && priceInput) {
                            const quantity = parseInt(quantityInput.value) || 0;
                            const price = parseFloat(priceInput.value) || 0;

                            if (quantity > 0 && price > 0) {
                                const product = {
                                    productId: productSelect.value,
                                    productName: productSelect.options[productSelect.selectedIndex].text,
                                    quantity: quantity,
                                    price: price,
                                    total: quantity * price
                                };

                                products.push(product);
                            }
                        }
                    });
                }

                // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§ØªØŒ Ø£Ø¶Ù Ù…Ù†ØªØ¬ Ø§ÙØªØ±Ø§Ø¶ÙŠ
                if (products.length === 0) {
                    products.push({
                        productId: 1,
                        productName: 'Ù…Ù†ØªØ¬ Ø§ÙØªØ±Ø§Ø¶ÙŠ',
                        quantity: 1,
                        price: 100,
                        total: 100
                    });
                }

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            const subtotal = products.reduce((sum, product) => sum + product.total, 0);
            const tax = subtotal * 0.15; // Ø¶Ø±ÙŠØ¨Ø© 15%
            const total = subtotal + tax;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© Ø¨Ù€ timestamp Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­
            const invoiceNumber = 'INV-' + Date.now();

            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
            const currentDate = new Date();
            const day = currentDate.getDate().toString().padStart(2, '0');
            const month = (currentDate.getMonth() + 1).toString().padStart(2, '0');
            const year = currentDate.getFullYear();
            const formattedDate = `${day}/${month}/${year}`;



            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            const paymentMethodSelect = document.getElementById('paymentMethodSelect');
            const selectedPaymentMethod = paymentMethodSelect.value;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            const invoice = {
                id: invoiceNumber,
                date: formattedDate, // ØªÙ†Ø³ÙŠÙ‚ Ù…ÙŠÙ„Ø§Ø¯ÙŠ dd/mm/yyyy
                createdAt: currentDate.toISOString(), // Ù„Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¨Ø­Ø«
                customerId: customerSelect.value,
                customerName: customerSelect.options[customerSelect.selectedIndex].text,
                paymentMethod: selectedPaymentMethod,
                products: products,  // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªÙØ®Ø²Ù† Ù‡Ù†Ø§
                subtotal: subtotal,
                tax: tax,
                total: total,
                status: 'paid'
            };

                // Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                console.log('ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');

                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                if (!window.dataManager) {
                    console.log('ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                    window.dataManager = new DataManager();
                }

                try {
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ (ÙŠØªØ¶Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
                    window.dataManager.addSale(invoice);
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', invoice.id);

                } catch (error) {
                    console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', error);

                    // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙƒØ¨Ø¯ÙŠÙ„
                    console.log('ğŸ“¦ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙƒØ¨Ø¯ÙŠÙ„...');
                    const existingInvoices = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                    existingInvoices.push(invoice);
                    localStorage.setItem('monjizInvoices', JSON.stringify(existingInvoices));
                    localStorage.setItem('monjizSales', JSON.stringify(existingInvoices)); // Ù„Ù„ØªÙˆØ§ÙÙ‚
                }

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
                loadAndDisplayInvoices();

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                const modal = document.querySelector('.modal-overlay');
                if (modal) {
                    modal.remove();
                    enableBodyScroll();
                }

                // Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
                viewInvoice(invoice.id);

                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                setTimeout(() => {
                    showSuccessMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­: ' + invoice.id);
                }, 500);

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ' + error.message);
            }


        }



        // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        function convertPaymentMethodToArabic(paymentMethod) {
            const conversionMap = {
                'cash': 'Ù†Ù‚Ø¯Ø§Ù‹',
                'credit': 'Ø¢Ø¬Ù„',
                'transfer': 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ',
                'bank-transfer': 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ',
                'card': 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ'
            };
            return conversionMap[paymentMethod] || paymentMethod;
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø´Ø§Ø±Ø© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
        function getPaymentMethodClass(paymentMethod) {
            // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            const arabicPaymentMethod = convertPaymentMethodToArabic(paymentMethod);

            switch(arabicPaymentMethod) {
                case 'Ù†Ù‚Ø¯Ø§Ù‹':
                    return 'success';
                case 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ':
                    return 'info';
                case 'Ø¢Ø¬Ù„':
                    return 'warning';
                default:
                    return 'success';
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„
        function addInvoiceToTable(invoice) {
            const tbody = document.querySelector('.invoices-table tbody') ||
                         document.querySelector('.modern-table tbody') ||
                         document.querySelector('.sales-table tbody') ||
                         document.querySelector('#sales-table tbody') ||
                         document.querySelector('table tbody');

            if (tbody) {
                // Ø¥Ø²Ø§Ù„Ø© ØµÙ "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ±" Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                const noDataRow = tbody.querySelector('tr td[colspan]');
                if (noDataRow) {
                    noDataRow.parentElement.remove();
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${invoice.id}</strong></td>
                    <td>${invoice.date}</td>
                    <td>${invoice.customerName || invoice.customer || 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>${invoice.products ? invoice.products.length : 1}</td>
                    <td><strong class="positive">${invoice.total.toFixed(2)} Ø±.Ø³</strong></td>
                    <td><span class="badge ${getPaymentMethodClass(invoice.paymentMethod)}">${convertPaymentMethodToArabic(invoice.paymentMethod) || 'Ù†Ù‚Ø¯Ø§Ù‹'}</span></td>
                    <td><span class="badge primary">Ù…ÙƒØªÙ…Ù„Ø©</span></td>
                    <td>
                        <div class="action-buttons-horizontal">
                            <button class="action-btn edit" onclick="editInvoice('${invoice.id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn view" onclick="viewInvoice('${invoice.id}')" title="Ø¹Ø±Ø¶">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteInvoice('${invoice.id}')" title="Ø­Ø°Ù">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function saveEditedInvoice(invoiceId) {
            console.log('ğŸ’¾ Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', invoiceId);

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            const updatedData = {
                date: document.getElementById('edit-date').value,
                customer: document.getElementById('edit-customer').value,
                paymentMethod: document.getElementById('edit-payment').value,
                status: document.getElementById('edit-status').value,
                quantity: document.getElementById('edit-quantity').value
            };

            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            if (!window.dataManager) {
                console.log('ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                window.dataManager = new DataManager();
            }

            try {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                const success = window.dataManager.updateSale(invoiceId, updatedData);

                if (success) {
                    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', invoiceId);

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    updateInvoiceInTable(invoiceId, updatedData);

                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«
                    loadSalesData();

                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ');
                }

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', error);

                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ù„ÙŠ ÙƒØ¨Ø¯ÙŠÙ„
                console.log('ğŸ“¦ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ù„ÙŠ...');
                updateInvoiceInTable(invoiceId, updatedData);

                // ØªØ­Ø¯ÙŠØ« localStorage Ø£ÙŠØ¶Ø§Ù‹
                try {
                    const localInvoices = JSON.parse(localStorage.getItem('monjizInvoices')) || [];
                    const invoiceIndex = localInvoices.findIndex(inv => inv.id === invoiceId);

                    if (invoiceIndex !== -1) {
                        localInvoices[invoiceIndex] = { ...localInvoices[invoiceIndex], ...updatedData };
                        localStorage.setItem('monjizInvoices', JSON.stringify(localInvoices));
                        localStorage.setItem('monjizSales', JSON.stringify(localInvoices));
                        console.log('âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                    }
                } catch (localError) {
                    console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ù„ÙŠ Ø£ÙŠØ¶Ø§Ù‹:', localError);
                }
            }

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
                enableBodyScroll();
            }

            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            showSuccessMessage(`ØªÙ… Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© ${invoiceId} Ø¨Ù†Ø¬Ø§Ø­`);
        }

        function updateInvoiceInTable(invoiceId, updatedData) {
            const tableRows = document.querySelectorAll('.modern-table tbody tr');

            for (let row of tableRows) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„
                const invoiceCell = row.cells[0];
                const rowInvoiceId = invoiceCell.querySelector('strong') ?
                    invoiceCell.querySelector('strong').textContent.trim() :
                    invoiceCell.textContent.trim();

                if (rowInvoiceId === invoiceId) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØµØ­ÙŠØ­)
                    row.cells[1].textContent = formatDateForDisplay(updatedData.date); // Ø§Ù„ØªØ§Ø±ÙŠØ®
                    row.cells[2].textContent = updatedData.customer; // Ø§Ù„Ø¹Ù…ÙŠÙ„
                    row.cells[3].textContent = updatedData.quantity; // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª

                    // ØªØ­Ø¯ÙŠØ« Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
                    const paymentCell = row.cells[5];
                    let paymentClass = 'success';
                    if (updatedData.paymentMethod === 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ') paymentClass = 'info';
                    if (updatedData.paymentMethod === 'Ø¢Ø¬Ù„') paymentClass = 'warning';

                    paymentCell.innerHTML = `<span class="badge ${paymentClass}">${updatedData.paymentMethod}</span>`;

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
                    const statusCell = row.cells[6];
                    let statusClass = 'primary';
                    if (updatedData.status === 'Ù…Ø¹Ù„Ù‚Ø©') statusClass = 'secondary';
                    if (updatedData.status === 'Ù…Ù„ØºÙŠØ©') statusClass = 'danger';

                    statusCell.innerHTML = `<span class="badge ${statusClass}">${updatedData.status}</span>`;

                    console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„:', invoiceId);
                    break;
                }
            }
        }

        function convertDateToInput(dateString) {
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ input[type="date"]
            if (dateString.includes('-')) {
                return dateString; // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø§Ù„ÙØ¹Ù„
            }

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨ØªÙ†Ø³ÙŠÙ‚ Ø¢Ø®Ø±ØŒ Ù†Ø­ÙˆÙ„Ù‡
            const parts = dateString.split('-');
            if (parts.length === 3) {
                return `${parts[0]}-${parts[1].padStart(2, '0')}-${parts[2].padStart(2, '0')}`;
            }

            return '2024-01-15'; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        }

        function formatDateForDisplay(dateString) {
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ input Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶
            return dateString;
        }

        function addEditProductRow() {
            console.log('Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„...');

            const tbody = document.querySelector('#edit-invoice-form .products-table tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <select class="select-modern">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬</option>
                        <option value="1">Ù„Ø§Ø¨ØªÙˆØ¨ Dell</option>
                        <option value="2">Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ</option>
                        <option value="3">ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ</option>
                        <option value="4">Ø´Ø§Ø´Ø© 24 Ø¨ÙˆØµØ©</option>
                    </select>
                </td>
                <td><input type="number" class="input-modern" value="1" min="1"></td>
                <td><input type="number" class="input-modern" placeholder="0.00" step="0.01"></td>
                <td><span class="total-cell">0.00 Ø±.Ø³</span></td>
                <td>
                    <button type="button" class="btn-small btn-danger" onclick="removeProductRow(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;

            tbody.appendChild(newRow);
            showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯');

            // ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø·
            updateProductSelectsAfterAdd();
        }

        function removeProductRow(button) {
            const row = button.closest('tr');
            const tbody = row.parentNode;

            if (tbody.children.length > 1) {
                row.remove();
                showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬');
            } else {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¢Ø®Ø± Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† localStorage
        function loadCustomersFromStorage() {
            console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');

            try {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                if (!window.dataManager) {
                    console.log('ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                    window.dataManager = new DataManager();
                }

                let customersData = [];

                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø£ÙˆÙ„Ø§Ù‹
                if (window.dataManager && typeof window.dataManager.getCustomers === 'function') {
                    customersData = window.dataManager.getCustomers();
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„', customersData.length, 'Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ');
                } else {
                    // Ø§Ù„Ø¨Ø¯ÙŠÙ„: Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
                    console.warn('âš ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… localStorage');
                    customersData = JSON.parse(localStorage.getItem('monjizCustomers')) || [];
                    console.log('ğŸ“¦ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰', customersData.length, 'Ø¹Ù…ÙŠÙ„ ÙÙŠ localStorage');
                }

                const customerSelect = document.getElementById('customerSelect');

                if (customerSelect) {
                    // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ø¯Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„
                    while (customerSelect.children.length > 1) {
                        customerSelect.removeChild(customerSelect.lastChild);
                    }

                    if (customersData.length > 0) {
                        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                        customersData.forEach(customer => {
                            const option = document.createElement('option');
                            option.value = customer.id;
                            option.textContent = customer.name;
                            option.dataset.customerType = customer.type;
                            customerSelect.appendChild(option);
                        });
                        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„', customersData.length, 'Ø¹Ù…ÙŠÙ„ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª');
                    } else {
                        console.log('â„¹ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ÙÙˆØ¸ÙŠÙ†ØŒ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ†');
                        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ† Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        const defaultCustomers = [
                            { id: 'default-1', name: 'Ø¹Ù…ÙŠÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ 1', type: 'individual' },
                            { id: 'default-2', name: 'Ø´Ø±ÙƒØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', type: 'company' }
                        ];

                        defaultCustomers.forEach(customer => {
                            const option = document.createElement('option');
                            option.value = customer.id;
                            option.textContent = customer.name;
                            option.dataset.customerType = customer.type;
                            customerSelect.appendChild(option);
                        });
                        console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Ø¡ Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ† Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                    }
                } else {
                    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† localStorage
        function loadProductsFromStorage() {
            console.log('Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† localStorage...');
            let productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];
            console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰', productsData.length, 'Ù…Ù†ØªØ¬ ÙÙŠ localStorage');

            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§ØªØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            if (productsData.length === 0) {
                console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                productsData = [
                    { id: 1, name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell XPS 13', price: 3500, code: 'DELL-XPS13' },
                    { id: 2, name: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', price: 150, code: 'MOUSE-001' },
                    { id: 3, name: 'ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ', price: 300, code: 'KEYBOARD-001' },
                    { id: 4, name: 'Ø´Ø§Ø´Ø© 24 Ø¨ÙˆØµØ©', price: 800, code: 'MONITOR-24' },
                    { id: 5, name: 'Ø·Ø§Ø¨Ø¹Ø© Ù„ÙŠØ²Ø± HP', price: 1200, code: 'HP-LASER' },
                    { id: 6, name: 'ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆÙŠØ¨', price: 250, code: 'WEBCAM-001' }
                ];
            }

            const productSelects = document.querySelectorAll('.product-select');

            if (productsData.length > 0) {
                productSelects.forEach(select => {
                    // Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                    const currentValue = select.value;
                    console.log('Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©:', currentValue);

                    // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ø¯Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„
                    while (select.children.length > 1) {
                        select.removeChild(select.lastChild);
                    }

                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                    productsData.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = `${product.name} - ${product.price} Ø±.Ø³`;
                        option.dataset.price = product.price;
                        option.dataset.code = product.code;
                        select.appendChild(option);
                    });

                    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    if (currentValue && currentValue !== '') {
                        select.value = currentValue;
                        console.log('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±:', currentValue);
                    }
                });
                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„', productsData.length, 'Ù…Ù†ØªØ¬ ÙÙŠ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
        function updateProductSelectsAfterAdd() {
            console.log('ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...');
            setTimeout(() => {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø· Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
                const newRows = document.querySelectorAll('.products-table tbody tr:last-child .product-select');
                if (newRows.length > 0) {
                    loadProductsForSpecificSelects(newRows);
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ ØµÙ Ø¬Ø¯ÙŠØ¯ØŒ Ù†Ø­Ø¯Ø« Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
                    loadProductsFromStorage();
                }
            }, 50);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù‚ÙˆØ§Ø¦Ù… Ù…Ø­Ø¯Ø¯Ø© ÙÙ‚Ø·
        function loadProductsForSpecificSelects(selects) {
            console.log('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù‚ÙˆØ§Ø¦Ù… Ù…Ø­Ø¯Ø¯Ø©...');
            let productsData = JSON.parse(localStorage.getItem('monjizProducts')) || [];

            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§ØªØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            if (productsData.length === 0) {
                productsData = [
                    { id: 1, name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell XPS 13', price: 3500, code: 'DELL-XPS13' },
                    { id: 2, name: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', price: 150, code: 'MOUSE-001' },
                    { id: 3, name: 'ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ', price: 300, code: 'KEYBOARD-001' },
                    { id: 4, name: 'Ø´Ø§Ø´Ø© 24 Ø¨ÙˆØµØ©', price: 800, code: 'MONITOR-24' },
                    { id: 5, name: 'Ø·Ø§Ø¨Ø¹Ø© Ù„ÙŠØ²Ø± HP', price: 1200, code: 'HP-LASER' },
                    { id: 6, name: 'ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆÙŠØ¨', price: 250, code: 'WEBCAM-001' }
                ];
            }

            if (productsData.length > 0) {
                selects.forEach(select => {
                    // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ø¯Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„
                    while (select.children.length > 1) {
                        select.removeChild(select.lastChild);
                    }

                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                    productsData.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = `${product.name} - ${product.price} Ø±.Ø³`;
                        option.dataset.price = product.price;
                        option.dataset.code = product.code;
                        select.appendChild(option);
                    });
                });
                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©');
            }
        }

        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
        function listenForDataUpdates() {
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª localStorage
            window.addEventListener('storage', function(e) {
                if (e.key === 'monjizDataUpdate') {
                    console.log('ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„...');
                    setTimeout(loadCustomersFromStorage, 100);
                    setTimeout(loadProductsFromStorage, 200);
                }
            });

            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
            if (window.BroadcastChannel) {
                const channel = new BroadcastChannel('monjiz-updates');
                channel.addEventListener('message', function(e) {
                    if (e.data.type === 'customers-updated') {
                        console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...');
                        setTimeout(loadCustomersFromStorage, 100);
                    } else if (e.data.type === 'products-updated') {
                        console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…...');
                        setTimeout(loadProductsFromStorage, 100);
                    }
                });
            }
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function listenForDataUpdates() {
            console.log('Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª localStorage
            window.addEventListener('storage', function(e) {
                console.log('ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØºÙŠÙŠØ± ÙÙŠ localStorage:', e.key);
                if (e.key === 'monjizDataUpdate' || e.key === 'monjizCustomers' || e.key === 'monjizProducts') {
                    console.log('Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                    setTimeout(loadCustomersFromStorage, 100);
                    setTimeout(loadProductsFromStorage, 200);
                }
            });

            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø±Ø³Ø§Ø¦Ù„ BroadcastChannel
            if (window.BroadcastChannel) {
                const channel = new BroadcastChannel('monjiz-updates');
                channel.addEventListener('message', function(event) {
                    console.log('ğŸ”” ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ«:', event.data);
                    if (event.data.type === 'data-updated' || event.data.type === 'customers-updated' || event.data.type === 'products-updated') {
                        setTimeout(loadCustomersFromStorage, 100);
                        setTimeout(loadProductsFromStorage, 200);
                    }
                });
            }

            // Ù…Ø³ØªÙ…Ø¹ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            window.addEventListener('monjizDataUpdate', function(event) {
                console.log('ğŸ”” ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ:', event.detail);
                if (event.detail.dataType === 'monjizCustomers') {
                    console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                    setTimeout(loadCustomersFromStorage, 100);
                } else if (event.detail.dataType === 'monjizProducts') {
                    console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ...');
                    setTimeout(loadProductsFromStorage, 200);
                }
            });

            // Ù…Ø³ØªÙ…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯
            document.addEventListener('customerAdded', function(event) {
                console.log('ğŸ”” ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯:', event.detail);
                setTimeout(loadCustomersFromStorage, 100);
            });
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ù† localStorage (ØªØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­)
        function loadInvoicesFromStorage() {
            console.log('ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ù† localStorage Ù…Ø¹ ØªØ±ØªÙŠØ¨...');
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ø§Ù„ØªÙŠ ØªÙ‚ÙˆÙ… Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
            loadAndDisplayInvoices();
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function addImprovedSalesData() {
            if (!window.dataManager) {
                window.dataManager = new DataManager();
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
            const existingSales = window.dataManager.getSales();
            if (existingSales.length > 0) {
                console.log('ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø§Ù„ÙØ¹Ù„:', existingSales.length);
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            const sampleSales = [
                {
                    id: 'INV-001',
                    date: '2025-07-21',
                    customerName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    customer: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    paymentMethod: 'cash',
                    status: 'completed',
                    total: 285,
                    items: [
                        { productId: 1, productName: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell', name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell', quantity: 1, price: 150, total: 150 },
                        { productId: 2, productName: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', name: 'Ù…Ø§ÙˆØ³ Ù„Ø§Ø³Ù„ÙƒÙŠ', quantity: 2, price: 25, total: 50 },
                        { productId: 3, productName: 'Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­', name: 'Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­', quantity: 1, price: 85, total: 85 }
                    ],
                    notes: 'Ø¹Ù…ÙŠÙ„ Ù…Ù…ÙŠØ² - Ø®ØµÙ… 10%'
                },
                {
                    id: 'INV-002',
                    date: '2025-07-20',
                    customerName: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ',
                    customer: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ',
                    paymentMethod: 'card',
                    status: 'completed',
                    total: 420,
                    items: [
                        { productId: 4, productName: 'Ø´Ø§Ø´Ø© Samsung', name: 'Ø´Ø§Ø´Ø© Samsung', quantity: 1, price: 300, total: 300 },
                        { productId: 5, productName: 'ÙƒÙŠØ¨Ù„ HDMI', name: 'ÙƒÙŠØ¨Ù„ HDMI', quantity: 2, price: 30, total: 60 },
                        { productId: 6, productName: 'Ø³Ù…Ø§Ø¹Ø§Øª', name: 'Ø³Ù…Ø§Ø¹Ø§Øª', quantity: 1, price: 60, total: 60 }
                    ],
                    notes: 'Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©'
                },
                {
                    id: 'INV-003',
                    date: '2025-07-19',
                    customerName: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ø­Ù…Ø¯',
                    customer: 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ø­Ù…Ø¯',
                    paymentMethod: 'bank',
                    status: 'pending',
                    total: 180,
                    items: [
                        { productId: 7, productName: 'Ø·Ø§Ø¨Ø¹Ø© HP', name: 'Ø·Ø§Ø¨Ø¹Ø© HP', quantity: 1, price: 120, total: 120 },
                        { productId: 8, productName: 'ÙˆØ±Ù‚ Ø·Ø¨Ø§Ø¹Ø©', name: 'ÙˆØ±Ù‚ Ø·Ø¨Ø§Ø¹Ø©', quantity: 3, price: 20, total: 60 }
                    ],
                    notes: 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ'
                },
                {
                    id: 'INV-004',
                    date: '2025-07-18',
                    customerName: 'Ø³Ø§Ø±Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡',
                    customer: 'Ø³Ø§Ø±Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡',
                    paymentMethod: 'cash',
                    status: 'completed',
                    total: 95,
                    items: [
                        { productId: 9, productName: 'ÙÙ„Ø§Ø´ Ù…ÙŠÙ…ÙˆØ±ÙŠ', name: 'ÙÙ„Ø§Ø´ Ù…ÙŠÙ…ÙˆØ±ÙŠ', quantity: 2, price: 35, total: 70 },
                        { productId: 10, productName: 'ÙƒÙŠØ¨Ù„ USB', name: 'ÙƒÙŠØ¨Ù„ USB', quantity: 1, price: 25, total: 25 }
                    ],
                    notes: 'Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ Ø³Ø±ÙŠØ¹Ø©'
                }
            ];

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            sampleSales.forEach(sale => {
                try {
                    window.dataManager.addSale(sale);
                    console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', sale.id);
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', error);
                }
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            loadAndDisplayInvoices();

            console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª');
            alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }

        // Ø¯Ø§Ù„Ø© ÙØ§Ø±ØºØ© Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…
        function addSampleSalesIfEmpty() {
            // Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© - Ø§Ù„Ù†Ø¸Ø§Ù… Ù†Ø¸ÙŠÙ
        }

        // Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ø¹ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
        function loadAndDisplayInvoices() {
            console.log('ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ±...');

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ù† localStorage
            const savedInvoices = JSON.parse(localStorage.getItem('monjizInvoices')) || [];

            // ØªØ±ØªÙŠØ¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            savedInvoices.sort((a, b) => {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… createdAt Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹ØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… timestamp Ù…Ù† ID
                let timeA, timeB;

                if (a.createdAt) {
                    timeA = new Date(a.createdAt).getTime();
                } else if (a.id && a.id.includes('-')) {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ timestamp Ù…Ù† ID Ù…Ø«Ù„ INV-1752667823966
                    const parts = a.id.split('-');
                    timeA = parseInt(parts[parts.length - 1]) || 0;
                } else {
                    timeA = 0;
                }

                if (b.createdAt) {
                    timeB = new Date(b.createdAt).getTime();
                } else if (b.id && b.id.includes('-')) {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ timestamp Ù…Ù† ID Ù…Ø«Ù„ INV-1752667823966
                    const parts = b.id.split('-');
                    timeB = parseInt(parts[parts.length - 1]) || 0;
                } else {
                    timeB = 0;
                }

                return timeB - timeA; // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªÙ†Ù‚Ù„
            salesAllData = savedInvoices;
            salesCurrentPage = 1; // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰

            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
            const startIndex = (salesCurrentPage - 1) * salesItemsPerPage;
            const endIndex = startIndex + salesItemsPerPage;
            const pageData = savedInvoices.slice(startIndex, endIndex);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            updateSalesTableDisplay(pageData);

            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            updateSalesResultsInfo();

            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            updateSalesPaginationButtons();
        }





        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            localStorage.setItem('monjizLoggedIn', 'true');

            // ÙØ­Øµ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            checkLoginStatus();

            setTimeout(loadCustomersFromStorage, 100);
            setTimeout(loadProductsFromStorage, 200);
            setTimeout(loadAndDisplayInvoices, 300);
            setTimeout(loadSalesData, 400);
            listenForDataUpdates();
        });

        // ÙØ­Øµ Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('monjizLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }
    </script>

    <!-- ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù„ÙˆØµÙˆÙ„ Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
    <script src="js/reports.js"></script>
    <script src="js/apply-buttons-fix.js"></script>
    <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
    <script src="js/permissions.js"></script>
    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            if (typeof checkPagePermission === 'function') {
                checkPagePermission();
            }
        });
    </script>
</body>
</html>
